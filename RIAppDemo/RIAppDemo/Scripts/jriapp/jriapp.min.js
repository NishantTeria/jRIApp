if(!window.RIAPP)var RIAPP={};
RIAPP.utils=function(){Array.clone||(Array.clone=function(b){return 1===b.length?[b[0]]:Array.apply(null,b)});var b={isFunc:function(b){if(!b)return!1;var e=/Function/;return"function"===typeof b?e.test(b.constructor.toString()):!1},endsWith:function(b,e){return b.substr(b.length-e.length)===e},startsWith:function(b,e){return b.substr(0,e.length)===e},fastTrim:function(b){return b.replace(/^\s+|\s+$/g,"")},trim:function(g,e){return!e?b.fastTrim(g):b.ltrim(b.rtrim(g,e),e)},ltrim:function(b,e){return b.replace(RegExp("^["+
(e||"\\s")+"]+","g"),"")},rtrim:function(b,e){return b.replace(RegExp("["+(e||"\\s")+"]+$","g"),"")},isArray:function(b){return!b?!1:"[object Array]"===Object.prototype.toString.call(b)},format:function(){for(var g="",e=arguments,l=e[0],k=0;;){var m=l.indexOf("{",k),a=l.indexOf("}",k);if(0>m&&0>a){g+=l.slice(k);break}if(0<a&&(a<m||0>m)){if("}"!==l.charAt(a+1))throw Error(b.format(RIAPP.ERRS.ERR_STRING_FORMAT_INVALID,l));g+=l.slice(k,a+1);k=a+2}else if(g+=l.slice(k,m),k=m+1,"{"===l.charAt(k))g+="{",
k++;else{if(0>a)throw Error(b.format(RIAPP.ERRS.ERR_STRING_FORMAT_INVALID,l));var m=l.substring(k,a),d=m.indexOf(":"),k=parseInt(0>d?m:m.substring(0,d),10)+1;if(isNaN(k))throw Error(b.format(RIAPP.ERRS.ERR_STRING_FORMAT_INVALID,l));m=0>d?"":m.substring(d+1);k=e[k];if(void 0===k||null===k)k="";g=k.format?g+k.format(m):g+k.toString();k=a+1}}return g},cloneObj:function(g){if(!g||"object"!==typeof g)return g;for(var e=b.isArray(g)?[]:{},l,k,m=Object.getOwnPropertyNames(g),a=0,d=m.length;a<d;a+=1)l=m[a],
k=g[l],e[l]=k&&"object"===typeof k?b.cloneObj(k):k;return e}};String.format||(String.format=function(){var g=Array.prototype.slice.call(arguments);return b.format.apply(b,g)});return b}();RIAPP.global=null;RIAPP.Application=null;
RIAPP.BaseObject={_create:function(){this.__events=this.__callState=null;this._isDestroying=this._isDestroyed=!1},create:function(){var b=Object.create(this);b._create.apply(b,arguments);return b},extend:function(b,g,e){var l=g||{},k,m=0,a,d;Object.getOwnPropertyNames(l).forEach(function(a){a=l[a];void 0===a.enumerable&&(a.enumerable=!0);void 0===a.configurable&&(a.configurable=!1)});l._typeName=Object.getOwnPropertyDescriptor({_typeName:""},"_typeName");l.__eventNames=Object.getOwnPropertyDescriptor({__eventNames:[]},
"__eventNames");if(b){k=Object.getOwnPropertyNames(b);m=0;for(a=k.length;m<a;m+=1)g=k[m],l.hasOwnProperty(g)||(l[g]=Object.getOwnPropertyDescriptor(b,g))}d=Object.create(this,l);Object.getOwnPropertyNames(d).forEach(function(a){var f=Object.getOwnPropertyDescriptor(d,a),b,e;f.value&&RIAPP.utils.isFunc(f.value)&&(e=f.value.toString(),-1<e.indexOf("._super(")&&(b=d[a],f.value=function(){var f=this.__callState;this.__callState={methodName:a,definedOn:d};try{return b.apply(this,arguments)}finally{this.__callState=
f}},Object.defineProperty(d,a,f)))});d.__eventNames=d._getEventNames();e&&e(d);return d},_super:function(){if(!this.__callState)throw Error(RIAPP.ERRS.ERR_SUPER_INVALID);var b=this.__callState.methodName,g=Object.getPrototypeOf(this.__callState.definedOn);if(!g)throw Error(String.format(RIAPP.ERRS.ERR_ASSERTION_FAILED,"superProto must not be undefined"));b=g[b];if(!b)throw Error(String.format(RIAPP.ERRS.ERR_ASSERTION_FAILED,"superProto[methodName] must be a Function"));return b.apply(this,arguments)},
_addHandler:function(b,g,e,l){if(!this._isDestroyed){if(!RIAPP.utils.isFunc(g))throw Error(RIAPP.ERRS.ERR_EVENT_INVALID_FUNC);if(!b)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_EVENT_INVALID,b));null===this.__events&&(this.__events={});var k=this.__events,m="*";e&&(m=""+e);k[b]||(k[b]=[]);b=k[b];b.some(function(a){return a.fn===g&&a.ns==m})||(l?b.unshift({fn:g,ns:m}):b.push({fn:g,ns:m}))}},_removeHandler:function(b,g){var e=this.__events,l="*";if(e){g&&(l=""+g);var k,m,a;if(b){if(e[b])if("*"==l)delete e[b];
else{k=e[b];m=k.filter(function(a){return a.ns==l});for(a=k.length;0<a;)a-=1,-1<m.indexOf(k[a])&&k.splice(a,1);0==k.length&&delete e[b]}}else"*"!=l?Object.keys(e).forEach(function(d){var c=e[d],f=c.filter(function(a){return a.ns==l});for(a=c.length;0<a;)a-=1,-1<f.indexOf(c[a])&&c.splice(a,1);0==c.length&&delete e[d]}):this.__events=null}},_raiseEvent:function(b,g){var e=this,l=e.__events;null!==l&&b&&("0*"!=b&&RIAPP.utils.startsWith(b,"0")&&this._raiseEvent("0*",g),l[b]&&Array.clone(l[b]).forEach(function(b){b.fn.apply(e,
[e,g])}))},_onError:function(b,g){if(RIAPP.global&&RIAPP.global._checkIsDummy(b))return!0;b.message||(b=Error(""+b));var e={error:b,source:g,isHandled:!1};this._raiseEvent("error",e);return e.isHandled},_getEventNames:function(){return["error","destroyed"]},_checkEventName:function(b){if(-1===this.__eventNames.indexOf(b))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_EVENT_INVALID,b));},_isNotDestroyed:function(){return!(this._isDestroying||this._isDestroyed)},raisePropertyChanged:function(b){this._raiseEvent("0"+
b,{property:b})},addHandler:function(b,g,e){this._checkEventName(b);this._addHandler(b,g,e,!1)},removeHandler:function(b,g){b&&this._checkEventName(b);this._removeHandler(b,g)},addOnDestroyed:function(b,g){this._addHandler("destroyed",b,g,!1)},removeOnDestroyed:function(b){this._removeHandler("destroyed",b)},removeNSHandlers:function(b){this._removeHandler(void 0,b)},raiseEvent:function(b,g){this._checkEventName(b);this._raiseEvent(b,g)},getEventNames:function(){return this.__eventNames},addOnPropertyChange:function(b,
g,e){if(!b)throw Error(RIAPP.ERRS.ERR_PROP_NAME_EMPTY);this._addHandler("0"+b,g,e,!1)},removeOnPropertyChange:function(b,g){b&&(b="0"+b);this._removeHandler(b,g)},destroy:function(){if(!this._isDestroyed){this._isDestroyed=!0;try{this._raiseEvent("destroyed",{})}finally{this.__events=null,this._isDestroying=!1}}},toString:function(){return this._typeName?this._typeName:"RIAPP Object"}};RIAPP._glob_modules="array_ext consts errors defaults utils riapp".split(" ");RIAPP._app_modules="converter parser baseElView binding template mvvm collection db listbox datadialog baseContent datagrid pager stackpanel dataform elview content".split(" ");
RIAPP.Global=RIAPP.BaseObject.extend({version:"1.1.0",_coreModules:{},_create:function(b,g){this._super();if(RIAPP.global)throw Error(RIAPP.ERRS.ERR_GLOBAL_SINGLTON);if(!g)throw Error(RIAPP.ERRS.ERR_APP_NEED_JQUERY);var e,l;this._window=b;this._appInst={};this._$=g;this._modInst={};this._defaults=this._currentSelectable=null;this._userCode={};this._exports={};for(var k=0;k<RIAPP._glob_modules.length;k+=1)e={},l=RIAPP._glob_modules[k],RIAPP.Global._coreModules[l].apply(e,[this]),Object.freeze(e),this._modInst[RIAPP._glob_modules[k]]=
e;this._init();Object.freeze(this._coreModules)},_init:function(){var b=this;this.$(this.document).on("click.global",function(g){g.stopPropagation();b.currentSelectable=null});this.$(this.document).on("keydown.global",function(g){g.stopPropagation();b._currentSelectable&&b._currentSelectable._onKeyDown(g.which,g)});this.$(this.document).on("keyup.global",function(g){g.stopPropagation();b._currentSelectable&&b._currentSelectable._onKeyUp(g.which,g)});this.$(this.window).unload(function(){b.raiseEvent("unload",
{})});this.window.onerror=function(b,e,l){if(b&&-1<b.indexOf("DUMMY_ERROR"))return!0;alert("Error message: "+b+"\nURL: "+e+"\nLine Number: "+l);return!1}},_getEventNames:function(){var b=this._super();return["unload"].concat(b)},_onGridAdded:function(b){var g=this,e=g.utils,l=b.$container;l.on("click."+b.uniqueID,function(k){k.stopPropagation();e.isContained(k.target,l.get(0))&&(g.currentSelectable=b)})},_onGridRemoved:function(b){b.$container.off("click."+b.uniqueID);this.currentSelectable===b&&
(this.currentSelectable=null)},_onStackPanelAdded:function(b){var g=this,e=g.utils,l=b._$el;l.on("click."+b.uniqueID,function(k){k.stopPropagation();e.isContained(k.target,l.get(0))&&(g.currentSelectable=b)})},_onStackPanelRemoved:function(b){b._$el.off("click."+b.uniqueID);this.currentSelectable===b&&(this.currentSelectable=null)},_registerApp:function(b){this._appInst[b.appName]||(this._appInst[b.appName]=b)},_unregisterApp:function(b){this._appInst[b.appName]&&delete this._appInst[b.appName]},
_destroyApps:function(){var b=this;this.utils.forEachProp(this._appInst,function(g){b._appInst[g].destroy()})},_throwDummy:function(b){var g=this.modules.errors;if(g&&b&&!b.isDummy)throw g.DummyError.create(b);throw b;},_checkIsDummy:function(b){return!!b.isDummy},_registerType:function(b,g,e){var l=g.split(".");b=b._exports;var k;for(k=0;k<l.length-1;k+=1)b[l[k]]||(b[l[k]]={}),b=b[l[k]];l=l[l.length-1];if(b[l])throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_TYPE_ALREDY_REGISTERED,g));e._typeName=g;
b[l]=e;return b},_getType:function(b,g){var e=g.split("."),l=b._exports,k;for(k=0;k<e.length;k+=1){if(!l[e[k]])return null;l=l[e[k]]}return l},reThrow:function(b,g){if(g)this._throwDummy(b);else throw b;},findApp:function(b){return this._appInst[b]},destroy:function(){this.removeHandler();this._destroyApps();this._modInst={};this._exports={};this.$(this.document).off(".global");RIAPP.Application=null;RIAPP.global=null;this.window.onerror=null;this._super()},registerType:function(b,g){return this._registerType(this,
b,g)},getType:function(b){return this._getType(this,b)},getImagePath:function(b){return this.defaults.imagesPath+b},toString:function(){return"Global"}},{$:{get:function(){return this._$}},modules:{get:function(){return this._modInst}},window:{get:function(){return this._window}},document:{get:function(){return this._window.document}},currentSelectable:{set:function(b){this._currentSelectable!==b&&(this._currentSelectable=b,this.raisePropertyChanged("currentSelectable"))},get:function(){return this._currentSelectable}},
defaults:{set:function(b){this._defaults!==b&&(this._defaults=b,this.raisePropertyChanged("defaults"))},get:function(){return this._defaults}},UC:{get:function(){return this._userCode}}},null);
RIAPP.Global._coreModules.array_ext=function(b){Array.prototype.distinct=function(){var b={},e,l=this.length,k=[];for(e=0;e<l;e+=1)b[this[e]]=this[e];var m=Object.keys(b);e=0;for(l=m.length;e<l;e+=1)k.push(b[m[e]]);return k};Array.prototype.intersect=function(b){return this.filter(function(e){return-1<b.indexOf(e)})};Array.fromList=function(b){for(var e=Array(b.length),l=0,k=b.length;l<k;l++)e[l]=b[l];return e}};
RIAPP.Global._coreModules.consts=function(b){var g={DATA_ATTR:{EL_VIEW_KEY:"data-elvwkey",DATA_BIND:"data-bind",DATA_VIEW:"data-view",DATA_APP:"data-app",DATA_EVENT_SCOPE:"data-scope",DATA_ITEM_KEY:"data-key",DATA_CONTENT:"data-content",DATA_COLUMN:"data-column",DATA_NAME:"data-name"},DATA_TYPE:{None:0,String:1,Bool:2,Integer:3,Decimal:4,Float:5,DateTime:6,Date:7,Time:8,Guid:9,Binary:10},CHANGE_TYPE:{NONE:0,ADDED:1,UPDATED:2,DELETED:3},KEYS:{backspace:8,tab:9,enter:13,esc:27,space:32,pageUp:33,pageDown:34,
end:35,home:36,left:37,up:38,right:39,down:40,del:127},ELVIEW_NM:{DATAFORM:"dataform"}};Object.getOwnPropertyNames(g).forEach(function(b){Object.freeze(g[b])});Object.freeze(g);this.consts=g;b.consts=this.consts};
RIAPP.Global._coreModules.errors=function(b){var g=this;RIAPP.BaseObject.extend({_create:function(b){this._super();this._message=b;this._isDummy=!1;this._origError=null},toString:function(){return this._message}},{message:{set:function(b){this._message=b},get:function(){return this._message}},isDummy:{set:function(b){this._isDummy=b},get:function(){return this._isDummy}},origError:{set:function(b){this._origError=b},get:function(){return this._origError}}},function(b){g.BaseError=b}).extend({_create:function(b){this._super("DUMMY_ERROR");
this._origError=b;this._isDummy=!0}},null,function(b){g.DummyError=b})};
RIAPP.Global._coreModules.defaults=function(b){var g=this,e=RIAPP.BaseObject.extend({_create:function(){this._super();this._datepickerRegional=this._imagesPath="";if(!b.$.datepicker)throw Error(RIAPP.ERRS.ERR_JQUERY_DATEPICKER_NOTFOUND);this._datepickerDefaults=b.$.datepicker.regional[this._datepickerRegional];this._dateTimeFormat="dd.MM.yyyy HH:mm:ss";this._timeFormat="HH:mm:ss";this._decimalPoint=",";this._thousandSep=" ";this._decPrecision=2;this._ajaxTimeOut=600},destroy:function(){this._super()},
_setDatePickerRegion:function(e){this.datepickerDefaults=e?b.$.datepicker.regional[e]:b.$.datepicker.regional[""]},toString:function(){return"Defaults"}},{ajaxTimeOut:{set:function(b){this._ajaxTimeOut!==b&&(this._ajaxTimeOut=b,this.raisePropertyChanged("ajaxTimeOut"))},get:function(){return this._ajaxTimeOut}},dateFormat:{set:function(e){this._datepickerDefaults.dateFormat!==e&&(this._datepickerDefaults.dateFormat=e,b.$.datepicker.setDefaults(this._datepickerDefaults),this.raisePropertyChanged("dateFormat"))},
get:function(){return this._datepickerDefaults.dateFormat}},timeFormat:{set:function(b){this._timeFormat!==b&&(this._timeFormat=b,this.raisePropertyChanged("timeFormat"))},get:function(){return this._timeFormat}},dateTimeFormat:{set:function(b){this._dateTimeFormat!==b&&(this._dateTimeFormat=b,this.raisePropertyChanged("timeFormat"))},get:function(){return this._dateTimeFormat}},datepickerDefaults:{set:function(e){e||(e=b.$.datepicker.regional[this._datepickerRegional]);var k=this._datepickerDefaults;
this._datepickerDefaults=e;b.$.datepicker.setDefaults(e);k.dateFormat!==e.dateFormat&&this.raisePropertyChanged("dateFormat")},get:function(){return this._datepickerDefaults}},datepickerRegional:{set:function(b){b||(b="");this._datepickerRegional!==b&&(this._datepickerRegional=b,this._setDatePickerRegion(b),this.raisePropertyChanged("datepickerRegional"))},get:function(){return this._datepickerRegional}},imagesPath:{set:function(b){b||(b="");this._imagesPath!==b&&(RIAPP.utils.endsWith(b,"/")?this._imagesPath=
b:this._imagesPath=b+"/",this.raisePropertyChanged("imagesPath"))},get:function(){return this._imagesPath}},decimalPoint:{set:function(b){this._decimalPoint!==b&&(this._decimalPoint=b,this.raisePropertyChanged("decimalPoint"))},get:function(){return this._decimalPoint}},thousandSep:{set:function(b){this._thousandSep!==b&&(this._thousandSep=b,this.raisePropertyChanged("thousandSep"))},get:function(){return this._thousandSep}},decPrecision:{set:function(b){this._decPrecision!==b&&(this._decPrecision=
b,this.raisePropertyChanged("decPrecision"))},get:function(){return this._decPrecision}}},function(b){g.Defaults=b});b.defaults=e.create();b.defaults.dateFormat="dd.mm.yy";b.defaults.imagesPath="/Scripts/jriapp/img/"};
RIAPP.Global._coreModules.utils=function(b){var g=this,e=RIAPP.utils,l=0,k={getNewID:function(){var a=l;l+=1;return a},isContained:function(a,d){if(!a)return!1;for(;a=a.parentNode;)if(a===d)return!0;return!1},slice:Array.prototype.slice,get_timeZoneOffset:function(){var a=(new Date).getTimezoneOffset();return function(){return a}}(),parseBool:function(a){var d=e.trim(a).toLowerCase();if("false"===d)return!1;if("true"===d)return!0;throw Error(k.format(RIAPP.ERRS.ERR_PARAM_INVALID,"bool_value",a));
},round:function(a,d){return parseFloat(a.toFixed(d))},performAjaxCall:function(a,d,c,f,e,k){b.$.ajax({url:a,type:"POST",dataType:"json",data:d,async:c,context:k,timeout:1E3*b.defaults.ajaxTimeOut,contentType:"application/json; charset=utf-8",success:function(a){f.call(this,a)},error:function(a,c,d){e.call(this,""+c+": "+d)}})},check_is:{Null:function(a){return null===a},Undefined:function(a){return void 0===a},nt:function(a){return null===a||void 0===a},Function:function(a){return e.isFunc(a)},String:function(a){if(k.check_is.nt(a))return!1;
var d=/string/i;return"string"===typeof a?!0:"object"===typeof a?d.test(a.constructor.toString()):!1},Array:function(a){return e.isArray(a)},Boolean:function(a){if(k.check_is.nt(a))return!1;var d=/boolean/i;return"boolean"===typeof a?!0:"object"===typeof a?d.test(a.constructor.toString()):!1},Date:function(a){if(k.check_is.nt(a))return!1;var d=/date/i;return"date"===typeof a?!0:"object"===typeof a?d.test(a.constructor.toString()):!1},HTML:function(a){if(k.check_is.nt(a))return!1;var d=/html/i;return"object"===
typeof a?d.test(a.constructor.toString()):!1},Number:function(a){if(k.check_is.nt(a))return!1;var d=/Number/;return"number"===typeof a?!0:"object"===typeof a?d.test(a.constructor.toString()):!1},Object:function(a){if(k.nt(a))return!1;var d=/object/i;return"object"===typeof a?d.test(a.constructor.toString()):!1},RegExp:function(a){if(k.nt(a))return!1;var d=/regexp/i;return"function"===typeof a?d.test(a.constructor.toString()):!1},Numeric:function(a){return k.check_is.Number(a)||k.check_is.String(a)&&
!isNaN(Number(a))},BoolString:function(a){return k.check_is.nt(a)?!1:"true"==a||"false"==a}},format:function(){var a=Array.prototype.slice.call(arguments);return e.format.apply(e,a)},normalizeURL:function(a){var d=b.window;"/"==a.slice(0,1)?a=d.location.protocol+"//"+d.location.host+a:"http:"==a.slice(0,5)||"https:"==a.slice(0,6)||(a=d.location.href+"/"+a);return a},extend:function(a,d,c){return a?b.$.extend(!0,d,c):b.$.extend(d,c)},getElementById:function(a){return b.document.getElementById(a)},
removeNode:function(a){if(a){var d=a.parentNode;d&&d.removeChild(a)}},insertAfter:function(a,d){var c=a.parentNode;c.lastChild===a?c.appendChild(d):c.insertBefore(d,a.nextSibling)},getProps:function(a){return Object.getOwnPropertyNames(a)},forEachProp:function(a,d){Object.getOwnPropertyNames(a).forEach(d)},addToolTip:function(a,d,c){c={content:{text:d},style:{classes:c?c:null},position:{my:"top left",at:"bottom right",target:a,viewport:$(b.window),adjust:{method:"flip none",x:0,y:0}},hide:{fixed:!0,
delay:250}};a.data("qtip")?d?a.qtip("option","content.text",d):a.qtip("destroy"):d&&a.qtip(c)},checkNumRange:function(a,d){var c=d.split(",");if(c[0]&&a<parseFloat(c[0]))throw Error(String.format(RIAPP.ERRS.ERR_FIELD_RANGE,a,d));if(c[1]&&a>parseFloat(c[1]))throw Error(String.format(RIAPP.ERRS.ERR_FIELD_RANGE,a,d));},dtRangeToDate:function(a){a=a.split("-");return new Date(parseInt(a[0],10),parseInt(a[1],10)-1,a[2])},checkDateRange:function(a,d){var c=d.split(",");if(c[0]&&a<k.dtRangeToDate(c[0]))throw Error(String.format(RIAPP.ERRS.ERR_FIELD_RANGE,
a,d));if(c[1]&&a>k.dtRangeToDate(c[1]))throw Error(String.format(RIAPP.ERRS.ERR_FIELD_RANGE,a,d));},hasProp:function(a,d){if(!a)return!1;if(a.hasOwnProperty(d))return!0;if(Object===a)return!1;var c=Object.getPrototypeOf(a);return k.hasProp(c,d)},createDeferred:function(a){return a?b.$.Deferred(a):b.$.Deferred()},merge:function(a,d){if(null==a||null==d)return a;k.forEachProp(d,function(c){a[c]=d[c]});return a},uuid:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");
return function(d,c){var f,b=[],e=Math.random;c=c||a.length;if(d)for(f=0;f<d;f+=1)b[f]=a[0|e()*c];else{var p;b[8]=b[13]=b[18]=b[23]="-";b[14]="4";for(f=0;36>f;f+=1)b[f]||(p=0|16*e(),b[f]=a[19==f?p&3|8:p&15])}return b.join("")}}(),str:{endsWith:function(a,d){return e.endsWith(a,d)},startsWith:function(a,d){return e.startsWith(a,d)},trim:function(a,d){return e.trim(a,d)},formatNumber:function(a,d,c,f){a=(a+"").replace(/[^0-9+-Ee.]/g,"");var b=!isFinite(+a)?0:+a;a=!isFinite(+d)?0:Math.abs(d);f=void 0===
f?",":f;c=void 0===c?".":c;var e="",e=function(a,c){var d=Math.pow(10,c);return""+Math.round(a*d)/d};k.check_is.nt(d)?(e=(""+b).split("."),a=2):e=(a?e(b,a):""+Math.round(b)).split(".");var b="",p=e[0].length;if(3<p){for(d=0;d<p;d+=1)b+=e[0].charAt(d),d<p-1&&0===(p-d-1)%3&&(b+=f);e[0]=b}if((e[1]||"").length<a)e[1]=e[1]||"",e[1]+=Array(a-e[1].length+1).join("0");return e.join(c)},stripNonNumeric:function(a){a+="";for(var d=/^\d|\.|-$/,c="",f=0;f<a.length;f++)d.test(a.charAt(f))&&("."==a.charAt(f)&&
-1!=c.indexOf(".")||"-"==a.charAt(f)&&0!=c.length||(c+=a.charAt(f)));return c}}},m=RIAPP.BaseObject.extend({_cnt:0,_create:function(){this._super();this._objs=[];m._cnt+=1;this._cnt=m._cnt},addObj:function(a){0>this._objs.indexOf(a)&&this._objs.push(a)},removeObj:function(a){a=this._objs.indexOf(a);0>a||this._objs.splice(a,1)},getObjs:function(){return this._objs},destroy:function(){this._objs.forEach(function(a){a._isNotDestroyed()&&a.destroy()});this._objs=[];this._super()},toString:function(){return"LifeTimeScope "+
this._cnt}},null,function(a){g.LifeTimeScope=a});g.PropWatcher=RIAPP.BaseObject.extend({_create:function(){this._super();this._objId="prw"+k.getNewID();this._objs=[]},addPropWatch:function(a,d,c){a.addOnPropertyChange(d,function(a,d){c(d.property)},this.uniqueID);0>this._objs.indexOf(a)&&this._objs.push(a)},addWatch:function(a,d,c){a.addOnPropertyChange("*",function(a,b){-1<d.indexOf(b.property)&&c(b.property)},this.uniqueID);0>this._objs.indexOf(a)&&this._objs.push(a)},removeWatch:function(a){a.removeNSHandlers(this.uniqueID)},
destroy:function(){var a=this;this._objs.forEach(function(d){a.removeWatch(d)});this._objs=[];this._super()},toString:function(){return"PropWatcher "+this._objId}},{uniqueID:{get:function(){return this._objId}}},function(a){b.registerType("PropWatcher",a)});g.WaitQueue=RIAPP.BaseObject.extend({_create:function(a){this._super();this._objId="wq"+k.getNewID();this._owner=a;this._queue={}},_checkQueue:function(a,d){if(this._owner){var c=this,f=this._queue[a],b;if(f&&0!=f.length){var e,p,u=null,n=[],v=
[],k=[];for(e=0;e<f.length;e+=1)if(b=f[e],b.predicate(d))if(!b.group&&0==n.length){p=b;break}else b.group&&(u||(u=b.group),u==b.group&&n.push(b));if(p)v.push(p),k.push(p);else for(;0<n.length;)b=n.pop(),p||(p=b),p.lastWins?0==v.length&&v.push(b):v.push(b),k.push(b);try{if(0<v.length){for(e=f.length;0<e;)e-=1,-1<k.indexOf(f[e])&&f.splice(e,1);v.forEach(function(a){try{a.action.apply(c._owner,a.args)}catch(d){c._owner._onError(d,c)}})}}finally{0==f.length&&(delete this._queue[a],this._owner.removeOnPropertyChange(a,
this.uniqueID))}}}},enQueue:function(a){a=k.extend(!1,{prop:"",groupName:null,predicate:null,action:null,actionArgs:[],lastWins:!1,syncCheck:!1},a);var d=this;if(this._owner){var c=a.prop,f=this._queue[c];f||(f=[],this._queue[c]=f,this._owner.addOnPropertyChange(c,function(a,f){setTimeout(function(){d._checkQueue(c,d._owner[c])},50)},d.uniqueID));f.push({predicate:a.predicate,action:a.action,group:a.groupName,lastWins:a.lastWins,args:!a.actionArgs?[]:a.actionArgs});a.syncCheck?d._checkQueue(c,d._owner[c]):
setTimeout(function(){d._checkQueue(c,d._owner[c])},50)}},destroy:function(){this._owner.removeOnPropertyChange(null,this.uniqueID);this._queue={};this._owner=null;this._super()},toString:function(){return"WaitQueue "+this._objId}},{uniqueID:{get:function(){return this._objId}},owner:{get:function(){return this._owner}}},null);k.merge(g,k);b.utils=g};
RIAPP.Global._coreModules.riapp=function(b){var g=this,e=b.utils,l=b.consts,k={riaTemplate:"ria-template"};g.css=k;Object.freeze(k);var m=RIAPP.BaseObject.extend({_nextInstanceNum:0,_coreModules:{},_userModules:{},_DATA_BIND_SELECTOR:["*[",l.DATA_ATTR.DATA_BIND,"]"].join(""),_TEMPLATES_DATA_BIND_SELECTOR:["section.",k.riaTemplate," *[",l.DATA_ATTR.DATA_BIND,"]"].join(""),_create:function(a){this._super();a=e.extend(!1,{app_name:"default",service_url:"",metadata:null,createDbContext:!0,moduleNames:[]},
a);var d=a.app_name;if(b.findApp(d))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_APP_NAME_NOT_UNIQUE,d));Object.freeze(a);this._options=a;this._parser=null;this._converters={};this._lftmBind=this._dbContext=null;this._instanceNum=m._nextInstanceNum;m._nextInstanceNum+=1;this.ELV_STORE_KEY=l.DATA_ATTR.EL_VIEW_KEY+this._instanceNum;this._bindingContentFactory=null;this._modInst={};this._exports={};this._types={_grids:{},_elViews:{},_registerGrid:function(a){this._grids[a.uniqueID]||(this._grids[a.uniqueID]=
a,b._onGridAdded(a))},_unregisterGrid:function(a){this._grids[a.uniqueID]&&(delete this._grids[a.uniqueID],b._onGridRemoved(a))},_destroyGrids:function(){var a=this;e.forEachProp(this._grids,function(c){a._grids[c].destroy()})}};this._global=b;this._elViewStore={};this._nextElViewStoreKey=0;this._userCode={};this._viewModels={};var c,f;c=0;for(f=RIAPP._app_modules.length;c<f;c+=1)d={},m._coreModules[RIAPP._app_modules[c]].apply(d,[this]),Object.freeze(d),this._modInst[RIAPP._app_modules[c]]=d;a=e.check_is.Array(a.moduleNames)&&
0<a.moduleNames.length?a.moduleNames:[];c=0;for(f=a.length;c<f;c+=1){if(!m._userModules[a[c]])throw Error(String.format(RIAPP.ERRS.ERR_MODULE_UNDEFINED,a[c]));d={};m._userModules[a[c]].apply(d,[this]);Object.freeze(d);this._modInst[a[c]]=d}b._registerApp(this)},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._lftmBind&&(this._lftmBind.destroy(),this._lftmBind=null),this._types._destroyGrids(),this._dbContext&&(this._dbContext.destroy(),this._dbContext=null),this._types._grids={},
this._types._elViews={},this._exports={},this._parser=this.options=this._global=null,this._converters={},this._elViewStore={},this._userCode={},this._viewModels={},this._modInst={},this._bindingContentFactory=null,b._unregisterApp(this),this._super())},_getEventNames:function(){var a=this._super();return["define_calc"].concat(a)},_onError:function(a,d){if(b._checkIsDummy(a))return!0;var c=this._super(a,d);return!c?b._onError(a,d):c},_onGetCalcField:function(a){this.raiseEvent("define_calc",a)},_getBindingOption:function(a,
d,c){var f={},b=a.source,k=a.target;f.sourcePath=!a.sourcePath&&a.to?a.to:a.sourcePath;f.targetPath=a.targetPath;f.converterParam=a.converterParam;f.mode=a.mode;a.converter&&e.check_is.String(a.converter)?f.converter=this.getConverter(a.converter):f.converter=a.converter;k?e.check_is.String(k)?f.target="this"==k?d:this.parser.resolveBindingSource(this,this.parser._getPathParts(k)):f.target=k:f.target=d;b?(f.isSourceFixed=!0,e.check_is.String(b)?f.source="this"==b?d:this.parser.resolveBindingSource(this,
this.parser._getPathParts(b)):f.source=b):f.source=c;return f},_getElViewType:function(a){return this._types._elViews[a]},_getElView:function(a){return(a=a.getAttribute(this.ELV_STORE_KEY))?this._elViewStore[a]:null},_setElView:function(a,d){var c=this.ELV_STORE_KEY,f=a.getAttribute(c);f?d?this._elViewStore[f]=d:(a.removeAttribute(c),delete this._elViewStore[f]):d&&(f="s_"+this._nextElViewStoreKey,this._nextElViewStoreKey+=1,a.setAttribute(c,f),this._elViewStore[f]=d)},_bindTemplateElements:function(a,
d){var c=this,f=Array.fromList(d.querySelectorAll(c._DATA_BIND_SELECTOR)),b=e.LifeTimeScope.create();d.hasAttribute(l.DATA_ATTR.DATA_BIND)&&f.push(d);f.forEach(function(a,d){var f,n,e,k,g,m;if(!c._isInsideDataForm(a)){f=a.getAttribute(l.DATA_ATTR.DATA_BIND);a.removeAttribute(l.DATA_ATTR.DATA_BIND);g=c.parser.parseOptions(f);m=c.getElementView(a);b.addObj(m);n=0;for(e=g.length;n<e;n+=1)f=c._getBindingOption(g[n],m,null),k=c.bind(f),f.target=null,b.addObj(k)}});return b},_isDataForm:function(a){if(!a)return!1;
a=a.getAttribute(l.DATA_ATTR.DATA_VIEW);if(!a)return!1;a=this.parser.parseOptions(a);return 0<a.length&&a[0].name===l.ELVIEW_NM.DATAFORM},_isInsideDataForm:function(a){if(!a)return!1;a=a.parentNode;var d=b.document;return a&&a!==d?this._isDataForm(a)?!0:this._isInsideDataForm(a):!1},_bindElements:function(a,d,c){var f=this;a=a||b.document;var k=Array.fromList(a.querySelectorAll(f._TEMPLATES_DATA_BIND_SELECTOR));a=Array.fromList(a.querySelectorAll(f._DATA_BIND_SELECTOR));var g=e.LifeTimeScope.create();
a.forEach(function(a){var b,n;if(!(-1<k.indexOf(a))&&(c||!f._isInsideDataForm(a))){if(!c&&(a.hasAttribute(l.DATA_ATTR.DATA_APP)&&(b=a.getAttribute(l.DATA_ATTR.DATA_APP)),b&&f.appName!==b||!b&&"default"!==f.appName))return;b=a.getAttribute(l.DATA_ATTR.DATA_BIND);a=f.getElementView(a);g.addObj(a);b=f.parser.parseOptions(b);for(var e=0,w=b.length;e<w;e+=1)n=f._getBindingOption(b[e],a,d),n=f.bind(n),g.addObj(n)}});return g},_getContent:function(a,d,c,f,b){if(d.templateInfo)a=a.create(c,d.templateInfo,
f,b);else if(d.bindingInfo)a=a.create(c,d,f,b);else throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"options","bindingInfo"));return a},_getContentType:function(a){if(a.templateInfo)a=this.modules.baseContent.TemplateContent;else if(a.bindingInfo)a=this.bindingContentFactory.getContentType(a);else throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"options","bindingInfo"));return a},_parseContentAttr:function(a){var d={templateInfo:null,bindingInfo:null,displayInfo:null,fieldName:null};
a=this.parser.parseOptions(a);if(0===a.length)return d;a=a[0];!a.template&&a.fieldName?(a.bindingInfo={target:null,source:null,targetPath:null,sourcePath:a.fieldName,mode:"OneWay",converter:null,converterParam:null},a.displayInfo=a.css):a.template&&(a.templateInfo=a.template,delete a.template);return e.extend(!0,d,a)},getNewObjectID:function(){return e.getNewID()},setUpBindings:function(){var a=b.document;this.destroyBindings();this._lftmBind=this._bindElements(a,this,!1)},destroyBindings:function(){this._lftmBind&&
(this._lftmBind.destroy(),this._lftmBind=null)},registerElView:function(a,d){this._types._elViews[a]||(this._types._elViews[a]=d)},getElementView:function(a){var d,c,f;if(c=this._getElView(a))return c;if(a.hasAttribute(l.DATA_ATTR.DATA_VIEW)&&(c=a.getAttribute(l.DATA_ATTR.DATA_VIEW),(c=this.parser.parseOptions(c))&&0<c.length)){c=c[0];if(c.name&&"default"!==c.name&&(d=this._getElViewType(c.name),!d))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_ELVIEW_NOT_REGISTERED,c.name));c.options&&(f=c.options)}if(!d){c=
a.nodeName.toLowerCase();switch(c){case "input":d=a.getAttribute("type");c=c+":"+d;d=this._getElViewType(c);break;default:d=this._getElViewType(c)}if(!d)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_ELVIEW_NOT_CREATED,c));}return c=d.create(a,f||{})},registerConverter:function(a,d){if(this._converters[a])throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_TYPE_ALREDY_REGISTERED,a));this._converters[a]=d},getConverter:function(a){var d=this._converters[a];if(!d)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CONVERTER_NOTREGISTERED,
a));return d},registerType:function(a,d){return b._registerType(this,a,d)},getType:function(a){var d=b._getType(this,a);d||(d=b._getType(this.global,a));return d},findGrid:function(a){for(var d=this._types._grids,c=e.getProps(d),f,b=0;b<c.length;++b)if(f=c[b],d[f].name===a)return d[f];return null},bind:function(a){var d=this.modules.binding.BINDING_MODE;a=e.extend(!1,{target:null,source:null,targetPath:null,sourcePath:null,mode:"OneWay",converter:null,converterParam:null,isSourceFixed:!1},a);if(!a.target)throw Error(RIAPP.ERRS.ERR_BIND_TARGET_EMPTY);
if(!e.check_is.String(a.targetPath))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_BIND_TGTPATH_INVALID,a.targetPath));if(0>d.indexOf(a.mode))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_BIND_MODE_INVALID,a.mode));if(!RIAPP.BaseObject.isPrototypeOf(a.target))throw Error(RIAPP.ERRS.ERR_BIND_TARGET_INVALID);return this.getType("Binding").create(a)},startUp:function(a){var d=this;try{if(!e.check_is.Function(a))throw Error(RIAPP.ERRS.ERR_APP_SETUP_INVALID);d.options.createDbContext?(d._dbContext=d.getType("DbContext").create(),
d._dbContext.addHandler("define_calc",function(a,c){d._onGetCalcField(c)}),d._dbContext.initialize({serviceUrl:d.options.service_url,metadata:d.options.metadata}),d._dbContext.waitForInitialized(function(){a.apply(d,[d]);d.setUpBindings()},null)):(a.apply(d,[d]),d.setUpBindings())}catch(c){b.reThrow(c,d._onError(c,d))}},registerModule:function(a,d){if(m._userModules[a])throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_MODULE_ALREDY_REGISTERED,a));m._userModules[a]=d},toString:function(){return"Application"+
this._instanceNum}},{bindingContentFactory:{get:function(){return this._bindingContentFactory},set:function(a){this._bindingContentFactory=a}},options:{get:function(){return this._options}},modules:{get:function(){return this._modInst}},parser:{get:function(){return this._parser}},instanceNum:{get:function(){return this._instanceNum}},appName:{get:function(){return this.options.app_name}},global:{get:function(){return this._global}},dbContext:{get:function(){return this._dbContext}},UC:{get:function(){return this._userCode}},
VM:{get:function(){return this._viewModels}},localizable:{get:function(){return RIAPP.localizable}}},function(a){g.Application=a;b.registerType("Application",a)});RIAPP.Application=m};RIAPP.global=RIAPP.Global.create(window,jQuery,[]);
RIAPP.Application._coreModules.converter=function(b){var g=b.global,e=g.utils,l=e.str,k=RIAPP.BaseObject.extend({convertToSource:function(a,d,c){return a},convertToTarget:function(a,d,c){return e.check_is.nt(a)?null:a}},null,function(a){b.registerType("BaseConverter",a);b.registerConverter("BaseConverter",a)});k.extend({convertToSource:function(a,d,c){return!a?null:g.$.datepicker.parseDate(d,a)},convertToTarget:function(a,d,c){return e.check_is.nt(a)?"":g.$.datepicker.formatDate(d,a)},toString:function(){return"DateConverter"}},
null,function(a){b.registerConverter("dateConverter",a)});k.extend({convertToSource:function(a,d,c){if(!a)return null;d=Date.parseExact(a,d);if(!d)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CONV_INVALID_DATE,a));return d},convertToTarget:function(a,d,c){return e.check_is.nt(a)?"":a.toString(d)},toString:function(){return"DateTimeConverter"}},null,function(a){b.registerConverter("dateTimeConverter",a)});var m=k.extend({convertToSource:function(a,d,c){if(e.check_is.nt(a))return null;c=g.defaults;
var f=c.decimalPoint,b=4,k=a.replace(c.thousandSep,""),k=k.replace(f,"."),k=l.stripNonNumeric(k);if(""===k)return null;f=null;switch(d){case 4:f=parseInt(k,10);break;case 1:f=parseInt(k,10);break;case 2:b=c.decPrecision;f=e.round(parseFloat(k),b);break;case 3:f=parseFloat(k);break;default:f=Number(k)}if(!e.check_is.Number(f))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CONV_INVALID_NUM,a));return f},convertToTarget:function(a,d,c){if(e.check_is.nt(a))return"";var f=g.defaults;c=f.decimalPoint;var b=
f.thousandSep;switch(d){case 1:return l.formatNumber(a,0,c,b);case 2:return d=f.decPrecision,l.formatNumber(a,d,c,b);case 4:return l.formatNumber(a,0,c,"");case 3:return l.formatNumber(a,null,c,b);default:return l.formatNumber(a,null,c,b)}},toString:function(){return"NumberConverter"}},null,function(a){b.registerConverter("numberConverter",a)});k.extend({convertToSource:function(a,d,c){return m.convertToSource(a,1,c)},convertToTarget:function(a,d,c){return m.convertToTarget(a,1,c)},toString:function(){return"IntegerConverter"}},
null,function(a){b.registerConverter("integerConverter",a)});k.extend({convertToSource:function(a,d,c){return m.convertToSource(a,4,c)},convertToTarget:function(a,d,c){return m.convertToTarget(a,4,c)},toString:function(){return"SmallIntConverter"}},null,function(a){b.registerConverter("smallIntConverter",a)});k.extend({convertToSource:function(a,d,c){return m.convertToSource(a,2,c)},convertToTarget:function(a,d,c){return m.convertToTarget(a,2,c)},toString:function(){return"DecimalConverter"}},null,
function(a){b.registerConverter("decimalConverter",a)});k.extend({convertToSource:function(a,d,c){return m.convertToSource(a,3,c)},convertToTarget:function(a,d,c){return m.convertToTarget(a,3,c)},toString:function(){return"FloatConverter"}},null,function(a){b.registerConverter("floatConverter",a)})};
RIAPP.Application._coreModules.parser=function(b){var g=b.global.utils,e=g.str,l=RIAPP.BaseObject.extend({__trimOuterBracesRX:/^([{]){0,1}|([}]){0,1}$/g,__trimQuotsRX:/^(['"])+|(['"])+$/g,__trimBracketsRX:/^(\[)+|(\])+$/g,__indexedPropRX:/(^\w+)\s*\[\s*['"]?\s*([^'"]+)\s*['",]?\s*\]/i,__valueDelimeter1:":",__valueDelimeter2:"=",__keyValDelimeter:",",_getPathParts:function(b){var e=this,a=[];(!b?[]:b.split(".")).forEach(function(d){var c;(c=d.match(e.__indexedPropRX))?(d=c[1],c=c[2],a.push(d),a.push("["+
c+"]")):a.push(d)});return a},_resolveProp:function(k,g){var a;return!g?k:e.startsWith(g,"[")?(a=b.modules.collection,g=this.trimQuotes(this.trimBrackets(g)),a.Dictionary.isPrototypeOf(k)?k.getItemByKey(g):a.Collection.isPrototypeOf(k)?k.getItemByPos(parseInt(g,10)):RIAPP.utils.isArray(k)?k[parseInt(g,10)]:k[g]):k[g]},_resolvePath:function(b,e){return!b?void 0:0===e.length?b:1===e.length?this._resolveProp(b,e[0]):this._resolvePath(this._resolveProp(b,e[0]),e.slice(1))},_setPropertyValue:function(b,
e,a){RIAPP.utils.startsWith(e,"[")?(e=this.trimQuotes(this.trimBrackets(e)),RIAPP.utils.isArray(b)?b[parseInt(e,10)]=a:b[e]=a):b[e]=a},_getKeyVals:function(b){var l,a,d,c=[],f={key:"",val:""},s=!0,q=this.__valueDelimeter1,p=this.__valueDelimeter2,u=this.__keyValDelimeter,n=function(a){a.val&&(g.check_is.Numeric(a.val)?a.val=Number(a.val):g.check_is.BoolString(a.val)&&(a.val=g.parseBool(a.val)));c.push(a)};for(l=0;l<b.length;l+=1){a=b.charAt(l);if("'"===a||'"'===a)d?d===a&&(d=null):d=a;!d&&"{"===a&&
!s?(a=b.substr(l),a=this.getBraceParts(a,!0)[0],f.val+=a,l+=a.length-1):!d&&a===u?f.key&&(n(f),f={key:"",val:""},s=!0):!d&&(a===q||a===p)?s=!1:s?f.key+=a:f.val+=a}f.key&&n(f);c.forEach(function(a){a.key=e.trim(a.key);g.check_is.String(a.val)&&(a.val=e.trim(a.val));""===a.val&&e.startsWith(a.key,"this.")&&(a.val=a.key.substr(5),a.key="targetPath")});return c=c.filter(function(a){return""!==a.val})},resolveBindingSource:function(b,e){if(b){if(0===e.length)return b;if(0<e.length)return this.resolveBindingSource(this._resolveProp(b,
e[0]),e.slice(1));throw Error("Invalid operation");}},resolvePath:function(b,e){if(!e)return b;var a=this._getPathParts(e);return this._resolvePath(b,a)},getBraceParts:function(b,e){var a,d="",c,f,g=0,l=[];for(a=0;a<b.length;a+=1){c=b.charAt(a);if("'"===c||'"'===c)f?f===c&&(f=null):f=c;if(!f&&"{"===c)g+=1,d+=c;else if(!f&&"}"===c){if(g-=1,d+=c,0===g&&(l.push(d),d="",e))break}else 0<g&&(d+=c)}return l},trimOuterBraces:function(b){return e.trim(b.replace(this.__trimOuterBracesRX,""))},trimQuotes:function(b){return e.trim(b.replace(this.__trimQuotsRX,
""))},trimBrackets:function(b){return e.trim(b.replace(this.__trimBracketsRX,""))},isWithOuterBraces:function(b){return e.startsWith(b,"{")&&e.endsWith(b,"}")},parseOption:function(b){var l={},a=this;b=e.trim(b);a.isWithOuterBraces(b)&&(b=a.trimOuterBraces(b));a._getKeyVals(b).forEach(function(d){var c=g.check_is.String(d.val);c&&a.isWithOuterBraces(d.val)?l[d.key]=a.parseOption(d.val):l[d.key]=c?a.trimQuotes(d.val):d.val});return l},parseOptions:function(b){var g=[],a=this;b=e.trim(b);var d=[b];
a.isWithOuterBraces(b)&&(d=a.getBraceParts(b,!1));d.forEach(function(c){g.push(a.parseOption(c))});return g},toString:function(){return"Parser"}},null);b._parser=l.create()};
RIAPP.Application._coreModules.baseElView=function(b){var g=b.global,e=g.utils,l=g.consts,k=RIAPP.localizable.VALIDATE,m=this.css={fieldError:"ria-field-error",errorTip:"ui-tooltip-red",commandLink:"ria-command-link"};Object.freeze(m);this.BaseElView=RIAPP.BaseObject.extend({_app:b,_create:function(a,d){this._super();this._el=a;this._oldDisplay=this._$el=null;this._objId="elv"+this._app.getNewObjectID();this._propChangedCommand=null;this._app._setElView(this._el,this);this._errors=null;this._toolTip=
d.tip;this._css=d.css;this._init(d);this._applyToolTip()},_applyToolTip:function(){this._toolTip&&this._setToolTip(this.$el,this._toolTip)},_init:function(a){this._css&&this.$el.addClass(this._css)},_createElement:function(a){return g.$(g.document.createElement(a))},_setIsEnabled:function(a,d){a.prop("disabled",!d);d?a.removeClass("disabled"):a.addClass("disabled")},_getIsEnabled:function(a){return!a.prop("disabled")},destroy:function(){if(!this._isDestroyed&&this._el){var a=this._$el,d=this._el;
a&&a.off("."+this._objId);try{this._$el=this._el=this.toolTip=this.validationErrors=this._propChangedCommand=null}finally{this._app._setElView(d,null)}this._super()}},invokePropChanged:function(a){a={property:a};this._propChangedCommand&&this._propChangedCommand.execute(this,a)},_getErrorTipInfo:function(a){var d=["<b>",k.errorInfo,"</b>","<br/>"];a.forEach(function(a){var b="";a.errors.forEach(function(a){b=b+" "+a});d.push(b);b=""});return d.join("")},_setFieldError:function(a){var d=this.$el;a?
d.addClass(m.fieldError):d.removeClass(m.fieldError)},_updateErrorUI:function(a,d){if(a){var c=this.$el;d&&0<d.length?(e.addToolTip(c,this._getErrorTipInfo(d),m.errorTip),this._setFieldError(!0)):(this._setToolTip(c,this.toolTip),this._setFieldError(!1))}},_onError:function(a,d){var c=this._super(a,d);return!c?this._app._onError(a,d):c},_setToolTip:function(a,d,c){e.addToolTip(a,d,c)},toString:function(){return"BaseElView"}},{app:{get:function(){return this._app}},$el:{get:function(){this._el&&!this._$el&&
(this._$el=g.$(this._el));return this._$el}},el:{get:function(){return this._el}},uniqueID:{get:function(){return this._objId}},isVisible:{set:function(a){a=!!a;a!==this.isVisible&&(a?this.el.style.display=this._oldDisplay?this._oldDisplay:"":(this._oldDisplay=this.el.style.display,this.el.style.display="none"),this.raisePropertyChanged("isVisible"))},get:function(){return"none"!==this.el.style.display}},propChangedCommand:{set:function(a){a!==this._propChangedCommand&&(this._propChangedCommand=a,
this.invokePropChanged("*"))},get:function(){return this._propChangedCommand}},validationErrors:{set:function(a){a!==this._errors&&(this._errors=a,this.raisePropertyChanged("validationErrors"),this._updateErrorUI(this._el,this._errors))},get:function(){return this._errors}},dataNameAttr:{get:function(){return this._el.getAttribute(l.DATA_ATTR.DATA_NAME)}},toolTip:{set:function(a){this._toolTip!=a&&(this._toolTip=a,this._setToolTip(this.$el,a),this.raisePropertyChanged("toolTip"))},get:function(){return this._toolTip}},
css:{set:function(a){var d=this.$el;this._css!=a&&(this._css&&d.removeClass(this._css),(this._css=a)&&d.addClass(this._css),this.raisePropertyChanged("css"))},get:function(){return this._css}}},function(a){b.registerType("BaseElView",a)})};
RIAPP.Application._coreModules.binding=function(b){var g=this,e=b.global,l=e.utils,k=e.modules.errors,m=b.modules.baseElView.BaseElView,a=["OneTime","OneWay","TwoWay"];g.BINDING_MODE=a;g.ValidationError=k.BaseError.extend({_create:function(a,c){var b=RIAPP.ERRS.ERR_VALIDATION+"\r\n",e=0;a.forEach(function(a){0<e&&(b+="\r\n");b=a.fieldName?b+" "+RIAPP.localizable.TEXT.txtField+": "+a.fieldName+" -> "+a.errors.join(", "):b+a.errors.join(", ");e+=1});this._super(b);this._errors=a;this._item=c}},{item:{get:function(){return this._item}},
errors:{get:function(){return this._errors}}},function(a){b.registerType("ValidationError",a)});g.Binding=RIAPP.BaseObject.extend({_app:b,_create:function(a){this._super();this._state=null;this._mode=a.mode;this._converter=a.converter||this._app.getConverter("BaseConverter");this._converterParam=a.converterParam;this._srcPath=this._app.parser._getPathParts(a.sourcePath);this._tgtPath=this._app.parser._getPathParts(a.targetPath);if(1>this._tgtPath.length)throw Error(String.format(RIAPP.ERRS.ERR_BIND_TGTPATH_INVALID,
a.targetPath));this._isSourceFixed=!!a.isSourceFixed;this._bounds={};this._objId="bnd"+this._app.getNewObjectID();this._ignoreTgtChange=this._ignoreSrcChange=!1;this._target=this._source=this._targetObj=this._sourceObj=null;this.target=a.target;this.source=a.source;this._sourceObj&&(this._sourceObj.addOnItemErrorsChanged&&this._sourceObj.getIsHasErrors())&&this._onSrcErrorsChanged()},_getOnTgtDestroyedProxy:function(){var a=this;return function(c,b){a._onTgtDestroyed()}},_getOnSrcDestroyedProxy:function(){var a=
this;return function(c,b){a._onSrcDestroyed()}},_getUpdTgtProxy:function(){var a=this;return function(){a._updateTarget()}},_getUpdSrcProxy:function(){var a=this;return function(){a._updateSource()}},_getSrcErrChangedProxy:function(){var a=this;return function(c,b){a._onSrcErrorsChanged()}},_onSrcErrorsChanged:function(){var a=[],c=this._targetObj,b=this._sourceObj,e=this._srcPath;c&&m.isPrototypeOf(c)&&(b&&0<e.length&&(a=b.getFieldErrors(e[e.length-1])),c.validationErrors=a)},_onError:function(a,
c){var b=this._super(a,c);return!b?this._app._onError(a,c):b},_getTgtChangedFn:function(a,c,b,e,g){return function(p,u){var n=a._app.parser._resolveProp(c,b);0<e.length&&a._checkBounded(null,"target",g,e);a._parseTgtPath(n,e,g)}},_getSrcChangedFn:function(a,c,b,e,g){return function(p,u){var n=a._app.parser._resolveProp(c,b);0<e.length&&a._checkBounded(null,"source",g,e);a._parseSrcPath(n,e,g)}},_parseSrcPath:function(a,c,b){this._sourceObj=null;0===c.length?this._sourceObj=a:this._parseSrcPath2(a,
c,b);this._targetObj&&this._updateTarget()},_parseSrcPath2:function(b,c,f){var e=RIAPP.BaseObject;if(e=!!b&&e.isPrototypeOf(b))b.addOnDestroyed(this._getOnSrcDestroyedProxy(),this._objId),this._checkBounded(b,"source",f,c);1<c.length?(e&&b.addOnPropertyChange(c[0],this._getSrcChangedFn(this,b,c[0],c.slice(1),f+1),this._objId),b&&(b=this._app.parser._resolveProp(b,c[0]))&&this._parseSrcPath2(b,c.slice(1),f+1)):b&&1===c.length&&((this._mode===a[1]||this._mode===a[2])&&e&&b.addOnPropertyChange(c[0],
this._getUpdTgtProxy(),this._objId),b&&b.addOnItemErrorsChanged&&b.addOnItemErrorsChanged(this._getSrcErrChangedProxy(),this._objId),this._sourceObj=b)},_parseTgtPath:function(a,c,b){this._targetObj=null;0===c.length?this._targetObj=a:this._parseTgtPath2(a,c,b);this._targetObj&&this._updateTarget()},_parseTgtPath2:function(b,c,f){var e=RIAPP.BaseObject;if(e=!!b&&e.isPrototypeOf(b))b.addOnDestroyed(this._getOnTgtDestroyedProxy(),this._objId),this._checkBounded(b,"target",f,c);1<c.length?(e&&b.addOnPropertyChange(c[0],
this._getTgtChangedFn(this,b,c[0],c.slice(1),f+1),this._objId),b&&(b=this._app.parser._resolveProp(b,c[0]))&&this._parseTgtPath2(b,c.slice(1),f+1)):b&&1===c.length&&(this._mode===a[2]&&e&&b.addOnPropertyChange(c[0],this._getUpdSrcProxy(),this._objId),this._targetObj=b)},_checkBounded:function(a,c,b,e){var g,p;if("source"===c)p="s"+b;else if("target"===c)p="t"+b;else throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"to",c));if(g=this._bounds[p])g.removeNSHandlers(this._objId),delete this._bounds[p];
0<e.length&&this._checkBounded(null,c,b+1,e.slice(1));a&&(this._bounds[p]=a)},_onTgtDestroyed:function(a,c){!this._isDestroyed&&!this._isDestroying&&(this.target=null)},_onSrcDestroyed:function(a,c){var b=this;!b._isDestroyed&&!b._isDestroying&&(a===b.source?b.source=null:(b._checkBounded(null,"source",0,b._srcPath),setTimeout(function(){!b._isDestroyed&&!b._isDestroying&&b._bindToSource()},0)))},_bindToSource:function(){this._parseSrcPath(this.source,this._srcPath,0)},_bindToTarget:function(){this._parseTgtPath(this.target,
this._tgtPath,0)},_updateTarget:function(){if(!this._ignoreSrcChange){this._ignoreTgtChange=!0;try{var a=this._converter.convertToTarget(this.sourceValue,this._converterParam,this._sourceObj);void 0!==a&&(this.targetValue=a)}catch(c){e.reThrow(c,this._onError(c,this))}finally{this._ignoreTgtChange=!1}}},_updateSource:function(){if(!this._ignoreTgtChange){this._ignoreSrcChange=!0;try{var a=this._converter.convertToSource(this.targetValue,this._converterParam,this._sourceObj);void 0!==a&&(this.sourceValue=
a)}catch(c){if(!g.ValidationError.isPrototypeOf(c)||!m.isPrototypeOf(this._targetObj))if(this._updateTarget(),!this._onError(c,this))throw c;}finally{this._ignoreSrcChange=!1}}},destroy:function(){if(!this._isDestroyed){this._isDestroying=!0;var a=this;l.forEachProp(this._bounds,function(c){a._bounds[c].removeNSHandlers(a._objId)});this._bounds={};this._target=this._source=this._targetObj=this._sourceObj=this._tgtPath=this._srcPath=this._converterParam=this._converter=this._state=this.target=this.source=
null;this._super()}},toString:function(){return"Binding"}},{bindingID:{get:function(){return this._objId}},target:{set:function(a){if(this._state)this._state.target=a;else if(this._target!==a){var c=this._targetObj;if(c&&!c._isDestroyed&&!c._isDestroying){this._ignoreTgtChange=!0;try{this.targetValue=null}finally{this._ignoreTgtChange=!1}}this._checkBounded(null,"target",0,this._tgtPath);if(a&&!RIAPP.BaseObject.isPrototypeOf(a))throw Error(RIAPP.ERRS.ERR_BIND_TARGET_INVALID);this._target=a;this._bindToTarget();
if(this._target&&!this._targetObj)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_BIND_TGTPATH_INVALID,this._tgtPath.join(".")));}},get:function(){return this._target}},source:{set:function(a){this._state?this._state.source=a:this._source!==a&&(this._checkBounded(null,"source",0,this._srcPath),this._source=a,this._bindToSource())},get:function(){return this._source}},targetPath:{get:function(){return this._tgtPath}},sourcePath:{get:function(){return this._srcPath}},sourceValue:{set:function(a){0===
this._srcPath.length||null===this._sourceObj||this._app.parser._setPropertyValue(this._sourceObj,this._srcPath[this._srcPath.length-1],a)},get:function(){return 0===this._srcPath.length?this._sourceObj:null===this._sourceObj?null:this._app.parser._resolveProp(this._sourceObj,this._srcPath[this._srcPath.length-1])}},targetValue:{set:function(a){null!==this._targetObj&&this._app.parser._setPropertyValue(this._targetObj,this._tgtPath[this._tgtPath.length-1],a)},get:function(){return null===this._targetObj?
null:this._app.parser._resolveProp(this._targetObj,this._tgtPath[this._tgtPath.length-1])}},mode:{get:function(){return this._mode}},converter:{set:function(a){this._converter=a},get:function(){return this._converter}},converterParam:{set:function(a){this._converterParam=a},get:function(){return this._converterParam}},isSourceFixed:{get:function(){return this._isSourceFixed}},isDisabled:{set:function(a){a=!!a;if(this.isDisabled!=a)if(a){a={source:this._source,target:this._target};try{this.source=
this.target=null}finally{this._state=a}}else a=this._state,this._state=null,this.target=a.target,this.source=a.source},get:function(){return!!this._state}}},function(a){b.registerType("Binding",a)})};
RIAPP.Application._coreModules.template=function(b){var g=b.global,e=g.utils,l=g.consts,k=b.modules.binding.Binding,m=b.modules.baseElView.BaseElView;this.Template=RIAPP.BaseObject.extend({_app:b,_create:function(a){this._super();this._el=this._dctxt=null;this._isDisabled=!1;this._lfTime=null;this._templateID=a;this._templElView=void 0;this._templateID&&this._loadTemplate()},_getBindings:function(){if(!this._lfTime)return[];for(var a=this._lfTime.getObjs(),b=[],c=0,f=a.length;c<f;c+=1)k.isPrototypeOf(a[c])&&
b.push(a[c]);return b},_getElViews:function(){if(!this._lfTime)return[];for(var a=this._lfTime.getObjs(),b=[],c=0,f=a.length;c<f;c+=1)m.isPrototypeOf(a[c])&&b.push(a[c]);return b},_getTemplateElView:function(){if(!this._lfTime||null===this._templElView)return null;if(this._templElView)return this._templElView;for(var a=null,b=this._app.modules.elview.TemplateElView,c=this._getElViews(),f=0,e=c.length;f<e;f+=1)if(b.isPrototypeOf(c[f])){a=c[f];break}return this._templElView=a},_loadTemplate:function(){var a,
b=this._templateID;this._unloadTemplate();if(b){a=e.getElementById(b);if(!a)throw Error(String.format(RIAPP.ERRS.ERR_TEMPLATE_ID_INVALID,this._templateID));a=a.cloneNode(!0);a.removeAttribute("id");this._lfTime=this._app._bindTemplateElements(b,a);this._el=a;(b=this._getTemplateElView())&&b.templateLoaded(this)}},_updateBindingSource:function(){var a,b,c,f=this._getBindings();a=0;for(b=f.length;a<b;a+=1)c=f[a],c.isDisabled=this._isDisabled,c.isSourceFixed||(c.source=this._dctxt)},_updateIsDisabled:function(){var a,
b,c,f=this._getBindings(),e=this._getElViews(),g=this._app._getElViewType(l.ELVIEW_NM.DATAFORM);a=0;for(b=f.length;a<b;a+=1)c=f[a],c.isDisabled=this._isDisabled;a=0;for(b=e.length;a<b;a+=1)c=e[a],g.isPrototypeOf(c)&&c.form&&(c.form.isDisabled=this._isDisabled)},_unloadTemplate:function(){try{if(this._el){var a=this._templElView;this._templElView=void 0;a&&a.templateUnloading(this)}}finally{this._lfTime&&(this._lfTime.destroy(),this._lfTime=null),this._el&&g.$(this._el).remove(),this._el=null}},destroy:function(){this._isDestroyed||
(this._isDestroying=!0,this._dctxt=null,this._unloadTemplate(),this._templateID=null,this._templElView=void 0,this._super())},findElByDataName:function(a){return g.$(this._el).find(["*[",l.DATA_ATTR.DATA_NAME,'="',a,'"]'].join("")).toArray()},findElViewsByDataName:function(a){var b=this,c=[];this.findElByDataName(a).forEach(function(a){(a=b._app._getElView(a))&&c.push(a)});return c},toString:function(){return"Template"}},{dataContext:{set:function(a){this._dctxt!==a&&(this._dctxt=a,this.raisePropertyChanged("dataContext"),
this._updateBindingSource())},get:function(){return this._dctxt}},templateID:{set:function(a){this._templateID!==a&&(this._templateID=a,this._loadTemplate(),this.raisePropertyChanged("templateID"),this._updateBindingSource())},get:function(){return this._templateID}},el:{get:function(){return this._el}},isDisabled:{set:function(a){this._isDisabled!==a&&(this._isDisabled=!!a,this._updateIsDisabled(),this.raisePropertyChanged("isDisabled"))},get:function(){return this._isDisabled}}},function(a){b.registerType("Template",
a)})};
RIAPP.Application._coreModules.mvvm=function(b){this.Command=RIAPP.BaseObject.extend({_app:b,_create:function(b,e,l){this._super();this._action=b;this._thisObj=e;this._canExecute=l;this._isEnabled=!0;this._objId="cmd"+this._app.getNewObjectID()},_getEventNames:function(){var b=this._super();return["canExecute_changed"].concat(b)},canExecute:function(b,e){return!this._canExecute?!0:this._canExecute.apply(this._thisObj,[b,e])},execute:function(b,e){this._isEnabled&&this._action&&this._action.apply(this._thisObj,[b,
e])},destroy:function(){this._isDestroyed||(this._canExecute=this._thisObj=this._action=null,this._super())},raiseCanExecuteChanged:function(){this.raiseEvent("canExecute_changed",{})},toString:function(){return"Command"}},{app:{get:function(){return this._app}}},function(g){b.registerType("Command",g)});this.BaseViewModel=RIAPP.BaseObject.extend({_app:b,_create:function(){this._super();this._objId="vm"+this._app.getNewObjectID()},_onError:function(b,e){var l=this._super(b,e);return!l?this._app._onError(b,
e):l},toString:function(){return"BaseViewModel"}},{uniqueID:{get:function(){return this._objId}},app:{get:function(){return this._app}},$:{get:function(){return this._app.global.$}}},function(g){b.registerType("BaseViewModel",g)})};
RIAPP.Application._coreModules.baseContent=function(b){var g=b.global,e=g.utils,l=b.modules.template.Template,k=b.modules.binding.Binding,m=this.css={content:"ria-content-field",required:"ria-required-field"};Object.freeze(m);this.BindingContent=RIAPP.BaseObject.extend({_app:b,_create:function(a,b,c,f){this._super();this._parentEl=a;this._el=null;this._options=b;this._isReadOnly=!!this._options.readOnly;this._isEditing=!!f;this._dctx=c;this._tgt=this._lfScope=null;g.$(this._parentEl).addClass(m.content);
b.initContentFn&&b.initContentFn(this);this._init();this.update()},_init:function(){},_updateCss:function(){var a=this._getDisplayInfo(),b=g.$(this._parentEl),c=this.getFieldInfo();this._isEditing&&this._canBeEdited()?(a&&(a.editCss&&b.addClass(a.editCss),a.displayCss&&b.removeClass(a.displayCss)),c&&!c.isNullable&&b.addClass(m.required)):a&&(a.displayCss&&b.addClass(a.displayCss),a.editCss&&b.removeClass(a.editCss),c&&!c.isNullable&&b.removeClass(m.required))},_canBeEdited:function(){if(this._isReadOnly)return!1;
var a=this.getFieldInfo();return!a?!1:!!this._dctx&&!!this._dctx.beginEdit&&!a.isReadOnly&&!a.isCalculated},_createTargetElement:function(){var a;a=g.document;this._isEditing&&this._canBeEdited()?(a=a.createElement("input"),a.setAttribute("type","text")):a=a.createElement("span");this._updateCss();return a},_getBindingOption:function(a,b,c,f){a=this._app._getBindingOption(a,b,c);this.isEditing&&this._canBeEdited()?a.mode="TwoWay":a.mode="OneWay";f&&(a.targetPath=f);return a},_getBindings:function(){if(!this._lfScope)return[];
for(var a=this._lfScope.getObjs(),b=[],c=0,f=a.length;c<f;c+=1)k.isPrototypeOf(a[c])&&b.push(a[c]);return b},_updateBindingSource:function(){var a,b,c,f=this._getBindings();a=0;for(b=f.length;a<b;a+=1)c=f[a],c.isSourceFixed||(c.source=this._dctx)},_cleanUp:function(){this._lfScope&&(this._lfScope.destroy(),this._lfScope=null);this._el&&(e.removeNode(this._el),this._el=null);this._tgt=null},getFieldInfo:function(){return this._options.fieldInfo},_getBindingInfo:function(){return this._options.bindingInfo},
_getDisplayInfo:function(){return this._options.displayInfo},_getElementView:function(a){return this._app.getElementView(a)},update:function(){this._cleanUp();var a=this._getBindingInfo();a&&(this._el=this._createTargetElement(),this._tgt=this._getElementView(this._el),this._lfScope=g.utils.LifeTimeScope.create(),this._lfScope.addObj(this._tgt),a=this._getBindingOption(a,this._tgt,this._dctx,"value"),this._parentEl.appendChild(this._el),this._lfScope.addObj(this._app.bind(a)))},destroy:function(){if(!this._isDestroyed){this._isDestroying=
!0;var a=this._getDisplayInfo(),b=g.$(this._parentEl);b.removeClass(m.content);b.removeClass(m.required);a&&a.displayCss&&b.removeClass(a.displayCss);a&&a.editCss&&b.removeClass(a.editCss);this._cleanUp();this._options=this._dctx=this._parentEl=null;this._super()}},toString:function(){return"BindingContent"}},{parentEl:{get:function(){return this._parentEl}},target:{get:function(){return this._tgt}},isEditing:{set:function(a){this._isEditing!==a&&(this._isEditing=a,this.update())},get:function(){return this._isEditing}},
dataContext:{set:function(a){this._dctx!==a&&(this._dctx=a,this._updateBindingSource())},get:function(){return this._dctx}},app:{get:function(){return this._app}}},null);this.TemplateContent=RIAPP.BaseObject.extend({_app:b,_create:function(a,b,c,f){this._super();this._parentEl=a;this._isEditing=!!f;this._dctx=c;this._templateInfo=b;this._template=null;g.$(this._parentEl).addClass(m.content);this.update()},_createTemplate:function(){var a=this._templateInfo,b=a.displayID;this._isEditing?a.editID&&
(b=a.editID):b||(b=a.editID);if(!b)throw Error(RIAPP.ERRS.ERR_TEMPLATE_ID_INVALID);return l.create(b)},update:function(){this._cleanUp();var a;this._templateInfo&&(this._template=a=this._createTemplate(),this._parentEl.appendChild(a.el),a.dataContext=this._dctx)},_cleanUp:function(){this._template&&(this._template.destroy(),this._template=null)},destroy:function(){this._isDestroyed||(this._isDestroying=!0,g.$(this._parentEl).removeClass(m.content),this._cleanUp(),this._templateInfo=this._dctx=this._parentEl=
null,this._super())},toString:function(){return"TemplateContent"}},{parentEl:{get:function(){return this._parentEl}},template:{get:function(){return this._template}},isEditing:{set:function(a){this._isEditing!==a&&(this._isEditing=a,this.update())},get:function(){return this._isEditing}},dataContext:{set:function(a){this._dctx!==a&&(this._dctx=a,this._template&&(this._template.dataContext=this._dctx))},get:function(){return this._dctx}},app:{get:function(){return this._app}}},null)};
RIAPP.Application._coreModules.collection=function(b){var g=this,e=b.global,l=e.utils,k,m,a,d=e.consts.DATA_TYPE,c={REMOVE:"0",ADDED:"1",RESET:"2",REMAP_KEY:"3"},f={};f.DATA_TYPE=d;f.SORT_ORDER={ASC:0,DESC:1};f.COLL_CHANGE_TYPE=c;f.DATE_CONVERSION={None:0,ServerLocalToClientLocal:1,UtcToClientLocal:2};g.consts=f;Object.freeze(f);var s=b.modules.binding.ValidationError,q={valueToDate:function(a,c,b){if(!a)return null;a=""+a;var d=a.split("&");if(7!=d.length)throw Error(base_utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,
"val",a));a=new Date(parseInt(d[0],10),parseInt(d[1],10)-1,parseInt(d[2],10),parseInt(d[3],10),parseInt(d[4],10),parseInt(d[5],10),parseInt(d[6],10));var d=f.DATE_CONVERSION,e=l.get_timeZoneOffset();switch(c){case d.None:break;case d.ServerLocalToClientLocal:a.setMinutes(a.getMinutes()+b);a.setMinutes(a.getMinutes()-e);break;case d.UtcToClientLocal:a.setMinutes(a.getMinutes()-e);break;default:throw Error(base_utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"dtcnv",c));}return a},dateToValue:function(a,
c,b){if(null===a)return null;if(!l.check_is.Date(a))throw Error(base_utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"dt",a));var d=f.DATE_CONVERSION,e=l.get_timeZoneOffset();switch(c){case d.None:break;case d.ServerLocalToClientLocal:a.setMinutes(a.getMinutes()+e);a.setMinutes(a.getMinutes()-b);break;case d.UtcToClientLocal:a.setMinutes(a.getMinutes()+e);break;default:throw Error(l.format(RIAPP.ERRS.ERR_PARAM_INVALID,"dtcnv",c));}return""+a.getFullYear()+"&"+(a.getMonth()+1)+"&"+a.getDate()+"&"+a.getHours()+
"&"+a.getMinutes()+"&"+a.getSeconds()+"&"+a.getMilliseconds()},compareVals:function(a,c,b){if(null===a&&null!==c||null!==a&&null===c)return!1;switch(b){case d.DateTime:case d.Date:case d.Time:return l.check_is.Date(a)&&l.check_is.Date(c)?a.getTime()===c.getTime():!1;default:return a===c}},stringifyValue:function(a,c,b){return l.check_is.nt(a)?null:l.check_is.Date(a)?q.dateToValue(a,c,b):""+a},parseValue:function(a,c,b,f){var e=null;if(void 0===a||null===a)return e;switch(c){case d.None:e=a;break;
case d.String:e=a;break;case d.Bool:e=l.parseBool(a);break;case d.Integer:e=parseInt(a,10);break;case d.Decimal:case d.Float:e=parseFloat(a);break;case d.DateTime:case d.Date:case d.Time:e=q.valueToDate(a,b,f);break;case d.Guid:case d.Binary:e=a;break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"dataType",c));}return e}};g.valueUtils=q;m=RIAPP.BaseObject.extend({_app:b,_create:function(){this._super();this._fkey=null;this._isEditing=!1;this._saveVals=null;this._vals={};this._notEdited=
!0},_getEventNames:function(){var a=this._super();return["errors_changed"].concat(a)},_onError:function(a,c){var b=this._super(a,c);return!b?this._collection._onError(a,c):b},_beginEdit:function(){var a=this._collection;if(a.isEditing){var c=a._EditingItem;if(c===this)return!1;try{c.endEdit(),c.getIsHasErrors()&&(this._onError(s.create(c.getAllErrors(),c),c),c.cancelEdit())}catch(b){a=this._onError(b,c),c.cancelEdit(),e.reThrow(b,a)}}this._isEditing=!0;this._saveVals=l.extend(!0,{},this._vals);this._collection.currentItem=
this;return!0},_endEdit:function(){if(!this._isEditing)return!1;var a,c=this._collection;if(this.getIsHasErrors())return!1;c._removeAllErrors(this);a=this._validateAll();0<a.length&&c._addErrors(this,a);if(this.getIsHasErrors())return!1;this._isEditing=!1;this._saveVals=null;return!0},_validate:function(){return this._collection._validateItem(this)},_skipValidate:function(a,c){return!1},_validateField:function(a){var c,b=this.getFieldInfo(a),f=null;try{c=this._vals[a];if(this._skipValidate(b,c))return f;
if(this._isNew){if(null===c&&!b.isNullable&&!b.isReadOnly&&!b.isAutoGenerated)throw Error(RIAPP.ERRS.ERR_FIELD_ISNOT_NULLABLE);}else if(null===c&&!b.isNullable&&!b.isReadOnly)throw Error(RIAPP.ERRS.ERR_FIELD_ISNOT_NULLABLE);}catch(d){f={fieldName:a,errors:[d.message]}}a=this._collection._validateItemField(this,a);f&&a?f.errors=f.errors.concat(a.errors):a&&(f=a);return f},_validateAll:function(){var a=this,c=[];this.getFieldNames().forEach(function(b){(b=a._validateField(b))&&c.push(b)});var b=a._validate();
b&&c.push(b);return c},_checkVal:function(a,c){var b=c,f=RIAPP.ERRS;if(this._skipValidate(a,c))return b;if(a.isReadOnly&&(!a.allowClientDefault||!this._isNew))throw Error(f.ERR_FIELD_READONLY);if((null===c||l.check_is.String(c)&&!c)&&!a.isNullable)throw Error(f.ERR_FIELD_ISNOT_NULLABLE);if(null===c)return c;switch(a.dataType){case d.None:break;case d.Guid:case d.Binary:case d.String:if(!l.check_is.String(c))throw Error(String.format(f.ERR_FIELD_WRONG_TYPE,c,"String"));if(0<a.maxLength&&c.length>a.maxLength)throw Error(String.format(f.ERR_FIELD_MAXLEN,
a.maxLength));a.isNullable&&""===c&&(b=null);if(a.regex&&!RegExp(a.regex,"i").test(c))throw Error(String.format(f.ERR_FIELD_REGEX,c));break;case d.Bool:if(!l.check_is.Boolean(c))throw Error(String.format(f.ERR_FIELD_WRONG_TYPE,c,"Boolean"));break;case d.Integer:case d.Decimal:case d.Float:if(!l.check_is.Number(c))throw Error(String.format(f.ERR_FIELD_WRONG_TYPE,c,"Number"));a.range&&l.checkNumRange(Number(c),a.range);break;case d.DateTime:case d.Date:if(!l.check_is.Date(c))throw Error(String.format(f.ERR_FIELD_WRONG_TYPE,
c,"Date"));a.range&&l.checkDateRange(c,a.range);break;case d.Time:if(!l.check_is.Date(c))throw Error(String.format(f.ERR_FIELD_WRONG_TYPE,c,"Time"));break;default:throw Error(String.format(f.ERR_PARAM_INVALID,"dataType",a.dataType));}return b},_onErrorsChanged:function(a){this.raiseEvent("errors_changed",a)},_resetIsNew:function(){},getFieldInfo:function(a){return this._collection.getFieldInfo(a)},getFieldNames:function(){return this._collection.getFieldNames()},addOnItemErrorsChanged:function(a,
c){this.addHandler("errors_changed",a,c)},getFieldErrors:function(a){var c=this._collection._getErrors(this);if(!c)return[];var b=a;a||(a="*");if(!c[a])return[];"*"===a&&(b=null);return[{fieldName:b,errors:c[a]}]},getAllErrors:function(){var a=this._collection._getErrors(this);if(!a)return[];var c=[];l.forEachProp(a,function(b){var f=null;"*"!==b&&(f=b);c.push({fieldName:f,errors:a[b]})});return c},getErrorString:function(){var a=this._collection._getErrors(this);if(!a)return"";var c=[];l.forEachProp(a,
function(b){c.push(String.format("{0}: {1}",b,a[b]))});return c.join("|")},_onAttaching:function(){},_onAttach:function(){},beginEdit:function(){var a=this._collection;if(!this._beginEdit())return!1;a._onEditing(this,!0,!1);this.raisePropertyChanged("isEditing");return!0},endEdit:function(){var a=this._collection;if(!this._endEdit())return!1;a._onEditing(this,!1,!1);this._notEdited=!1;this.raisePropertyChanged("isEditing");return!0},cancelEdit:function(){if(!this._isEditing)return!1;var a=this._collection,
c=this._isNew,b=this._saveVals;this._vals=this._saveVals;this._saveVals=null;a._removeAllErrors(this);a.getFieldNames().forEach(function(a){b[a]!==this._vals[a]&&this.raisePropertyChanged(a)},this);c&&this._notEdited&&a.removeItem(this);this._isEditing=!1;a._onEditing(this,!1,!0);this.raisePropertyChanged("isEditing");return!0},deleteItem:function(){var a=this._collection;if(null===this._key||!a._onItemDeleting(this))return!1;a.removeItem(this);return!0},getIsNew:function(){return this._isNew},getIsDeleted:function(){return this._isDeleted},
getKey:function(){return this._key},getCollection:function(){return this._collection},getIsEditing:function(){return this._isEditing},getIsHasErrors:function(){return!!this._collection._getErrors(this)},destroy:function(){this._saveVals=this._fkey=null;this._vals={};this._isEditing=!1;this._super()},toString:function(){return"CollectionItem"}},{_isNew:{get:function(){return!1}},_isDeleted:{get:function(){return!1}},_key:{set:function(a){null!==a&&(a=""+a);this._fkey=a},get:function(){return this._fkey}},
_collection:{get:function(){return null}},_isUpdating:{get:function(){var a=this._collection;return!a?!1:a.isUpdating}},isEditing:{get:function(){return this._isEditing}}},function(a){g.CollectionItem=a});k=RIAPP.BaseObject.extend({_app:b,_create:function(){this._super();this._options={};this._isLoading=!1;this._options.enablePaging=!1;this._options.pageSize=10;this._EditingItem=null;this._perms={canAddRow:!0,canEditRow:!0,canDeleteRow:!0,canRefreshRow:!1};this._pageIndex=this._totalCount=0;this._items=
[];this._itemsByKey={};this._currentPos=-1;this._newKey=0;this._fieldMap={};this._errors={};this._ignoreChangeErrors=!1;this._pkInfo=null;this._isUpdating=!1;this._waitQueue=e.utils.WaitQueue.create(this)},_getEventNames:function(){var a=this._super();return"begin_edit end_edit fill coll_changed item_deleting item_adding item_added validate current_changing page_changing errors_changed status_changed clearing cleared commit_changes".split(" ").concat(a)},_getStrValue:function(a,c){var b=c.dateConversion,
f=l.get_timeZoneOffset();return q.stringifyValue(a,b,f)},_getPKFieldInfos:function(){if(this._pkInfo)return this._pkInfo;var a=this._fieldMap,c=[];l.forEachProp(a,function(b){0<a[b].isPrimaryKey&&c.push(a[b])});c.sort(function(a,c){return a.isPrimaryKey-c.isPrimaryKey});return this._pkInfo=c},_onError:function(a,c){var b=this._super(a,c);return!b?this._app._onError(a,c):b},_onCurrentChanging:function(a){try{this.endEdit()}catch(c){e.reThrow(c,this._onError(c,this))}this.raiseEvent("current_changing",
{newCurrent:a})},_onCurrentChanged:function(){this.raisePropertyChanged("currentItem")},_onEditing:function(a,c,b){this._isUpdating||(c?(this._EditingItem=a,this.raiseEvent("begin_edit",{item:a})):(this._EditingItem=null,this.raiseEvent("end_edit",{item:a,isCanceled:b})))},_onCommitChanges:function(a,c,b,f){this.raiseEvent("commit_changes",{item:a,isBegin:c,isRejected:b,changeType:f})},_onItemStatusChanged:function(a,c){this.raiseEvent("status_changed",{item:a,oldChangeType:c,key:a._key})},_validateItem:function(a){a=
{item:a,fieldName:null,errors:[]};this.raiseEvent("validate",a);return a.errors&&0<a.errors.length?{fieldName:null,errors:a.errors}:null},_validateItemField:function(a,c){var b={item:a,fieldName:c,errors:[]};this.raiseEvent("validate",b);return b.errors&&0<b.errors.length?{fieldName:c,errors:b.errors}:null},_addErrors:function(a,c){var b=this;this._ignoreChangeErrors=!0;try{c.forEach(function(c){b._addError(a,c.fieldName,c.errors)})}finally{this._ignoreChangeErrors=!1}this._onErrorsChanged(a)},_addError:function(a,
c,b){c||(c="*");l.check_is.Array(b)&&0<b.length?(this._errors[a._key]||(this._errors[a._key]={}),this._errors[a._key][c]=b,this._ignoreChangeErrors||this._onErrorsChanged(a)):this._removeError(a,c)},_removeError:function(a,c){var b=this._errors[a._key];b&&(c||(c="*"),b[c]&&(delete b[c],0===l.getProps(b).length&&delete this._errors[a._key],this._onErrorsChanged(a)))},_removeAllErrors:function(a){this._errors[a._key]&&(delete this._errors[a._key],this._onErrorsChanged(a))},_getErrors:function(a){return this._errors[a._key]},
_onErrorsChanged:function(a){var c={item:a};this.raiseEvent("errors_changed",c);a._onErrorsChanged(c)},_onItemDeleting:function(a){a={item:a,isCancel:!1};this.raiseEvent("item_deleting",a);return!a.isCancel},_onFillStart:function(a){this.raiseEvent("fill",a)},_onFillEnd:function(a){this.raiseEvent("fill",a)},_onItemsChanged:function(a){this.raiseEvent("coll_changed",a)},_onItemAdding:function(a){a={item:a,isCancel:!1};this.raiseEvent("item_adding",a);a.isCancel&&e._throwDummy(Error("operation canceled"))},
_onItemAdded:function(a){this.raiseEvent("item_added",{item:a,isAddNewHandled:!1})},_createNew:function(){throw Error("Not implemented");},_attach:function(a,b){if(this._itemsByKey[a._key])throw Error(RIAPP.ERRS.ERR_ITEM_IS_ATTACHED);try{this.endEdit()}catch(f){e.reThrow(f,this._onError(f,this))}var d;a._onAttaching();l.check_is.nt(b)?(d=this._items.length,this._items.push(a)):(d=b,this._items.splice(d,0,a));this._itemsByKey[a._key]=a;this._onItemsChanged({change_type:c.ADDED,items:[a],pos:[d]});
a._onAttach();this.raisePropertyChanged("count");this._onCurrentChanging(a);this._currentPos=d;this._onCurrentChanged();return d},_onRemoved:function(a,b){try{this._onItemsChanged({change_type:c.REMOVE,items:[a],pos:[b]})}finally{this.raisePropertyChanged("count")}},_onPageSizeChanged:function(){},_onPageChanging:function(){var a={page:this.pageIndex,isCancel:!1};this._raiseEvent("page_changing",a);if(!a.isCancel)try{this.endEdit()}catch(c){e.reThrow(c,this._onError(c,this))}return!a.isCancel},_onPageChanged:function(){},
_setCurrentItem:function(a){var c=this._currentPos;if(a){if(null===a._key)throw Error(RIAPP.ERRS.ERR_ITEM_IS_DETACHED);var b,f;if(!this.getItemByKey(a._key))throw Error(RIAPP.ERRS.ERR_ITEM_IS_NOTFOUND);b=this.getItemByPos(c);f=this._items.indexOf(a);if(0>f)throw Error(RIAPP.ERRS.ERR_ITEM_IS_NOTFOUND);if(c!==f||b!==a)this._onCurrentChanging(a),this._currentPos=f,this._onCurrentChanged()}else-1!==c&&(this._onCurrentChanging(null),this._currentPos=-1,this._onCurrentChanged())},_destroyItems:function(){this._items.forEach(function(a){a.destroy()})},
getFieldInfo:function(a){return this._fieldMap[a]},getFieldNames:function(){return l.getProps(this._fieldMap)},cancelEdit:function(){this.isEditing&&this._EditingItem.cancelEdit()},endEdit:function(){var a;this.isEditing&&(a=this._EditingItem,!a.endEdit()&&a.getIsHasErrors()&&(this._onError(s.create(a.getAllErrors(),a),a),this.cancelEdit()))},getItemsWithErrors:function(){var a=this,c=[];l.forEachProp(this._errors,function(b){b=a.getItemByKey(b);c.push(b)});return c},addNew:function(){var a,c;a=this._createNew();
this._onItemAdding(a);this._attach(a,null);try{this.currentItem=a,a.beginEdit(),this._onItemAdded(a)}catch(b){c=this._onError(b,this),a.cancelEdit(),e.reThrow(b,c)}return a},getItemByPos:function(a){return 0>a||a>=this._items.length?null:this._items[a]},getItemByKey:function(a){if(!a)throw Error(RIAPP.ERRS.ERR_KEY_IS_EMPTY);return this._itemsByKey[""+a]},findByPK:function(){if(0===arguments.length)return null;var a=l.slice.call(arguments),c=this._getPKFieldInfos(),b=[];1===a.length&&l.check_is.Array(a[0])&&
(a=a[0]);if(a.length!==c.length)return null;for(var f=0,d=c.length;f<d;f+=1)b.push(this._getStrValue(a[f],c[f]));a=b.join(";");return this.getItemByKey(a)},moveFirst:function(a){if(0===this._currentPos)return!1;var c=this.getItemByPos(0);if(!c)return!1;if(a&&c._isDeleted)return this.moveNext(!0);this._onCurrentChanging(c);this._currentPos=0;this._onCurrentChanged();return!0},movePrev:function(a){var c=-1,b=this._currentPos,f=this.getItemByPos(b);f&&(c=b-1);f=this.getItemByPos(c);if(!f)return!1;if(a&&
f._isDeleted)return this._currentPos=c,this.movePrev(!0);this._onCurrentChanging(f);this._currentPos=c;this._onCurrentChanged();return!0},moveNext:function(a){var c=-1,b=this._currentPos,f=this.getItemByPos(b);f&&(c=b+1);f=this.getItemByPos(c);if(!f)return!1;if(a&&f._isDeleted)return this._currentPos=c,this.moveNext(!0);this._onCurrentChanging(f);this._currentPos=c;this._onCurrentChanged();return!0},moveLast:function(a){var c=this._items.length-1;if(this._currentPos===c)return!1;var b=this.getItemByPos(c);
if(!b)return!1;if(a&&b._isDeleted)return this.movePrev(!0);this._onCurrentChanging(b);this._currentPos=c;this._onCurrentChanged();return!0},goTo:function(a){if(this._currentPos===a)return!1;var c=this.getItemByPos(a);if(!c)return!1;this._onCurrentChanging(c);this._currentPos=a;this._onCurrentChanged();return!0},forEach:function(a,c){this._items.forEach(a,c)},removeItem:function(a){if(null===a._key)throw Error(RIAPP.ERRS.ERR_ITEM_IS_DETACHED);if(this._itemsByKey[a._key]){var c=this._items.indexOf(a);
if(0>c)throw Error(RIAPP.ERRS.ERR_ITEM_IS_NOTFOUND);this._items.splice(c,1);delete this._itemsByKey[a._key];delete this._errors[a._key];this._onRemoved(a,c);a._key=null;a.removeHandler(null,null);a=this.getItemByPos(c);var b=this._currentPos;b===c&&(a||(this._currentPos=b-1),this._onCurrentChanged());b>c&&(this._currentPos=b-1,this._onCurrentChanged())}},getIsHasErrors:function(){return!this._errors?!1:0<l.getProps(this._errors).length},sortLocal:function(a,c){var b=1;c&&"DESC"===c.toUpperCase()&&
(b=-1);this.sortLocalByFunc(function(c,f){var d=0,e,t,x;e=0;for(t=a.length;e<t&&!(x=a[e],d=c[x],x=f[x],d=d<x?-1*b:d>x?b:0,0!==d);e+=1);return d})},sortLocalByFunc:function(a){this.waitForNotLoading(function(){var b=this.currentItem;this.isLoading=!0;try{this._items.sort(a),this._onItemsChanged({change_type:c.RESET,items:[]})}finally{this.isLoading=!1}this.currentItem=null;this.currentItem=b},[],!1,null)},clear:function(){this.raiseEvent("clearing",{});this.cancelEdit();this._EditingItem=null;this._newKey=
0;this.currentItem=null;this._destroyItems();this._items=[];this._itemsByKey={};this._errors={};this._onItemsChanged({change_type:c.RESET,items:[]});this.raiseEvent("cleared",{});this.raisePropertyChanged("count")},destroy:function(){this._waitQueue&&(this._waitQueue.destroy(),this._waitQueue=null,this.clear(),this._fieldMap={},this._super())},waitForNotLoading:function(a,c,b,f){this._waitQueue.enQueue({prop:"isLoading",groupName:null,predicate:function(a){return!a},action:a,actionArgs:c,lastWins:!!f,
syncCheck:!!b})},toString:function(){return"Collection"}},{app:{get:function(){return this._app}},options:{get:function(){return this._options}},currentItem:{set:function(a){this._setCurrentItem(a)},get:function(){return this.getItemByPos(this._currentPos)}},count:{get:function(){return this._items.length}},totalCount:{set:function(a){a!=this._totalCount&&(this._totalCount=a,this.raisePropertyChanged("totalCount"),this.raisePropertyChanged("pageCount"))},get:function(){return this._totalCount}},pageSize:{set:function(a){this._options.pageSize!==
a&&(this._options.pageSize=a,this.raisePropertyChanged("pageSize"),this._onPageSizeChanged())},get:function(){return this._options.pageSize}},pageIndex:{set:function(a){a!==this._pageIndex&&this.isPagingEnabled&&!(0>a)&&this._onPageChanging()&&(this._pageIndex=a,this._onPageChanged(),this.raisePropertyChanged("pageIndex"))},get:function(){return this._pageIndex}},items:{get:function(){return this._items}},isPagingEnabled:{get:function(){return this._options.enablePaging}},permissions:{get:function(){return this._perms}},
isEditing:{get:function(){return!!this._EditingItem}},isLoading:{set:function(a){this._isLoading!==a&&(this._isLoading=a,this.raisePropertyChanged("isLoading"))},get:function(){return this._isLoading}},isUpdating:{set:function(a){this._isUpdating!==a&&(this._isUpdating=a,this.raisePropertyChanged("isUpdating"))},get:function(){return this._isUpdating}},pageCount:{get:function(){var a=this.totalCount,c=this.pageSize;return 0===a||0===c?0:0===a%c?a/c:a=Math.floor(a/c)+1}}},function(a){g.Collection=
a});k.getEmptyFieldInfo=function(a){return{isPrimaryKey:0,isRowTimeStamp:!1,dataType:d.NONE,isNullable:!0,maxLength:-1,isReadOnly:!1,isAutoGenerated:!1,allowClientDefault:!1,dateConversion:f.DATE_CONVERSION.NONE,isClientOnly:!0,isCalculated:!1,isNeedOriginal:!1,dependentOn:null,range:null,regex:null,isNavigation:!1,fieldName:a}};a=m.extend({_create:function(a){this._super();this.__isNew=!a;a&&(this._vals=a);a||this._collection.getFieldNames().forEach(function(a){this._vals[a]=null},this)},_setProp:function(a,
c){var b,f=this._collection;if(this._vals[a]!==c)try{if(this._vals[a]=c,this.raisePropertyChanged(a),f._removeError(this,a),b=this._validateField(a))throw s.create([b],this);}catch(d){throw b=s.isPrototypeOf(d)?d:s.create([{fieldName:a,errors:[d.message]}],this),f._addError(this,a,b.errors[0].errors),b;}},_getProp:function(a){return this._vals[a]},_resetIsNew:function(){this.__isNew=!1},toString:function(){return"ListItem"}},{_isNew:{get:function(){return this.__isNew}},_collection:{get:function(){return this.__coll}}},
function(a){g.ListItem=a});k.extend({_create:function(a,c){this._super();this._type_name=a;if(RIAPP.utils.isArray(c)){this._props=c;if(0===this._props.length)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"properties",c));this._initFieldMap(!1,c)}else if(m.isPrototypeOf(c))this._props=c.getFieldNames(),this._initFieldMap(!0,c);else if(c)this._props=Object.keys(c),this._initFieldMap(!1,c);else throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"properties",c));this._itemType=
null;this._createItemType()},_initFieldMap:function(a,c){var b=this;a?this._props.forEach(function(a){b._fieldMap[a]=l.extend(!1,{},c.getFieldInfo(a))}):this._props.forEach(function(a){b._fieldMap[a]=k.getEmptyFieldInfo(a)})},_attach:function(a){try{this.endEdit()}catch(c){e.reThrow(c,this._onError(c,this))}return this._super(a)},_createNew:function(){var a=this._itemType.create(null);a._key=this._getNewKey(null);return a},_createItemType:function(){var c={};this.getFieldNames().forEach(function(a){c[a]=
{set:function(c){this._setProp(a,c)},get:function(){return this._getProp(a)}}},this);c._collection={get:function(){return this.__coll}};var b=this._type_name;this._itemType=a.extend({__coll:this},c,function(a){a._typeName=b+"Item"})},_getNewKey:function(a){a="clkey_"+this._newKey;this._newKey+=1;return a},fillItems:function(a,b){var f=[],d=[],e=[];this._onFillStart({isBegin:!0,rowCount:a.length,time:new Date,isPageChanged:!1});try{b&&this.clear(),a.forEach(function(a){a=this._itemType.create(a);a._key=
this._getNewKey(a);var c=this._itemsByKey[a._key];c?e.push(c):(this._items.push(a),this._itemsByKey[a._key]=a,f.push(a),d.push(this._items.length-1),e.push(a))},this),0<f.length&&(this._onItemsChanged({change_type:c.ADDED,items:f,pos:d}),this.raisePropertyChanged("count"))}finally{this._onFillEnd({isBegin:!1,rowCount:e.length,time:new Date,resetUI:!!b,fetchedItems:e,newItems:f,isPageChanged:!1})}this.moveFirst()},getNewObjects:function(){return this._items.filter(function(a){return a._isNew})},resetNewObjects:function(){this._items.forEach(function(a){a._resetIsNew()})},
toString:function(){return"List"}},null,function(a){g.List=a;b.registerType("List",a)}).extend({_create:function(a,c,b){if(!b)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"keyName",b));this._keyName=b;this._super(a,c);a=this.getFieldInfo(b);if(!a)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DICTKEY_IS_NOTFOUND,b));a.isPrimaryKey=1},_getNewKey:function(a){if(!a)return this._super(null);a=a[this._keyName];if(l.check_is.nt(a))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DICTKEY_IS_EMPTY,
this._keyName));return""+a},toString:function(){return"Dictionary"}},null,function(a){g.Dictionary=a;b.registerType("Dictionary",a)})};
RIAPP.Application._coreModules.db=function(b){var g=this,e=b.global,l=b.modules.collection,k=e.utils,m,a,d,c=e.consts.DATA_TYPE,f=e.consts.CHANGE_TYPE,s=l.valueUtils,q=l.consts.COLL_CHANGE_TYPE,p=l.consts.SORT_ORDER,u=e.modules.errors.BaseError.extend({_create:function(a,c){var b;a&&(b=a.message);b||(b=""+a);this._super(b);this._origError=a;this._operationName=c}},{operationName:{get:function(){return this._operationName}}},function(a){g.DataOperationError=a;b.registerType("DataOperationError",a)}),
n=b.modules.binding.ValidationError;g.AccessDeniedError=u.extend(null,null,function(a){b.registerType("AccessDeniedError",a)});g.ConcurrencyError=u.extend(null,null,function(a){b.registerType("ConcurrencyError",a)});g.SvcValidationError=u.extend(null,null,function(a){b.registerType("SvcValidationError",a)});var v=g.SubmitError=u.extend({_create:function(a,c,b){var h=a.message||""+a;this._super(h,"submit");this._origError=a;this._allSubmitted=c||[];this._notValidated=b||[];if(0<this._notValidated.length){var f=
[h+":"];this._notValidated.forEach(function(a){f.push(String.format("item key:{0} errors:{1}",a._key,a.getErrorString()))});this._message=f.join("\r\n")}}},{allSubmitted:{get:function(){return this._allSubmitted}},notValidated:{get:function(){return this._notValidated}}},function(a){b.registerType("SubmitError",a)});g.checkError=function(a,c){if(a)switch(a.name){case "AccessDeniedException":throw g.AccessDeniedError.create(RIAPP.ERRS.ERR_ACCESS_DENIED,c);case "ConcurrencyException":throw g.ConcurrencyError.create(RIAPP.ERRS.ERR_CONCURRENCY,
c);case "ValidationException":throw g.SvcValidationError.create(k.format(RIAPP.ERRS.ERR_VALIDATION,a.message),c);case "DomainServiceException":throw u.create(k.format(RIAPP.ERRS.ERR_SVC_ERROR,a.message),c);default:throw u.create(k.format(RIAPP.ERRS.ERR_UNEXPECTED_SVC_ERROR,a.message),c);}};var w=RIAPP.BaseObject.extend({_create:function(a){this._super();this._query=a;this._cache=[];this._totalCount=0;this._itemsByKey={}},getCachedPage:function(a){var c=this._cache.filter(function(c){return c.pageIndex===
a});if(0==c.length)return null;if(1!=c.length)throw Error(String.format(RIAPP.ERRS.ERR_ASSERTION_FAILED,"res.length == 1"));return c[0]},reindexCache:function(){this._itemsByKey={};for(var a=0;a<this._cache.length;a+=1)this._cache[a].items.forEach(function(a){this._itemsByKey[a._key]=a},this)},getPrevCachedPageIndex:function(a){for(var c=-1,b,h=0;h<this._cache.length;h+=1)b=this._cache[h].pageIndex,b>c&&b<a&&(c=b);return c},getNextRange:function(a){var c=Math.floor((this.loadPageCount-1)/2),b=a+c+
(this.loadPageCount-1)%2,c=a-c;a=this.getPrevCachedPageIndex(a);0>c&&(b+=0-c,c=0);c<=a&&(b+=a-c+1,c+=a-c+1);this._pageCount>this.loadPageCount&&b>this._pageCount-1&&(c-=b-(this._pageCount-1),0>c&&(c=0),b=this._pageCount-1);c<=a&&(b+=a-c+1,c+=a-c+1);a=b-c+1;a<this.loadPageCount&&(b+=this.loadPageCount-a,a=b-c+1);return{start:c,end:b,cnt:a}},fillCache:function(a,c){var b,h=this._itemsByKey,f,d,e=c.length,n,g=this.pageSize;for(f=0;f<this.loadPageCount;f+=1){d=a+f;n=this.getCachedPage(d);n||(n={items:[],
pageIndex:d},this._cache.push(n));for(d=0;d<g;d+=1)if(b=f*g+d,b<e)b=c[b],h[b._key]||(n.items.push(b),h[b._key]=b,b._isCached=!0);else return}},clear:function(){var a,c,b,h,f=this._query.dbSet;for(a=0;a<this._cache.length;a+=1){b=this._cache[a].items;for(c=0;c<b.length;c+=1)if((h=b[c])&&null!==h._key)h._isCached=!1,f.getItemByKey(h._key)||h.destroy()}this._cache=[];this._itemsByKey={}},clearCacheForPage:function(a){var c=this.getCachedPage(a);a=this._query.dbSet;if(c){var b,h,f=this._cache.indexOf(c);
b=c.items;for(c=0;c<b.length;c+=1)if((h=b[c])&&null!==h._key)delete this._itemsByKey[h._key],h._isCached=!1,a.getItemByKey(h._key)||h.destroy();this._cache.splice(f,1)}},hasPage:function(a){for(var c=0;c<this._cache.length;c+=1)if(this._cache[c].pageIndex===a)return!0;return!1},getItemByKey:function(a){return this._itemsByKey[a]},getPageByItem:function(a){a=this._itemsByKey[a._key];if(!a)return-1;for(var c=0;c<this._cache.length;c+=1)if(-1<this._cache[c].items.indexOf(a))return this._cache[c].pageIndex;
return-1},destroy:function(){this.clear();this._super()},toString:function(){return"DataCache"}},{_pageCount:{get:function(){var a=this.totalCount,c=this.pageSize;return 0===a||0===c?0:0===a%c?a/c:a=Math.floor(a/c)+1}},pageSize:{get:function(){return this._query.pageSize}},loadPageCount:{get:function(){return this._query.loadPageCount}},totalCount:{set:function(a){k.check_is.nt(a)&&(a=0);a!==this._totalCount&&(this._totalCount=a,this.raisePropertyChanged("totalCount"))},get:function(){return this._totalCount}},
cacheSize:{get:function(){return this._cache.length}}},function(a){g.DataCache=a});a=RIAPP.BaseObject.extend({_app:b,_create:function(a,c){this._super();this._dbSet=a;this.__queryInfo=c;this._filterInfo={filterItems:[]};this._sortInfo={sortItems:[]};this._isClearPrevData=this._isIncludeTotalCount=!0;this._pageSize=a.pageSize;this._pageIndex=a.pageIndex;this._params={};this._loadPageCount=1;this._isClearCacheOnEveryLoad=!0;this._dataCache=null;this._cacheInvalidated=!1},getFieldInfo:function(a){return this._dbSet.getFieldInfo(a)},
getFieldNames:function(){return k.getProps(this._dbSet._fieldMap)},_addSort:function(a,c){var b=p.ASC,h=this._sortInfo;c&&"d"===c.toLowerCase().substr(0,1)&&(b=p.DESC);h.sortItems.push({fieldName:a,sortOrder:b});this._cacheInvalidated=!0},_addFilterItem:function(a,c,b){var h=0,h=this.getFieldInfo(a);if(!h)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,this.dbSetName,a));var f=this._serverTimezone,d=h.dateConversion,e=b;k.check_is.Array(e)||(e=[b]);e=Array.clone(e).map(function(a){return s.stringifyValue(a,
d,f)});switch(c.toLowerCase()){case "equals":case "=":h=0;break;case "noteq":case "!=":case "<>":h=9;break;case "between":h=1;if(2!=b.length)throw Error(RIAPP.ERRS.ERR_QUERY_BETWEEN);break;case "startswith":h=2;break;case "endswith":h=3;break;case "contains":h=4;break;case "gt":case ">":h=5;break;case "gteq":case ">=":h=7;break;case "lt":case "<":h=6;break;case "lteq":case "<=":h=8;break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_QUERY_OPERATOR_INVALID,c));}this._filterInfo.filterItems.push({fieldName:a,
kind:h,values:e});this._cacheInvalidated=!0},where:function(a,c,b){this._addFilterItem(a,c,b);return this},and:function(a,c,b){this._addFilterItem(a,c,b);return this},orderBy:function(a,c){this._addSort(a,c);return this},thenBy:function(a,c){this._addSort(a,c);return this},clearSort:function(){this._sortInfo.sortItems=[];this._cacheInvalidated=!0;return this},clearFilter:function(){this._filterInfo.filterItems=[];this._cacheInvalidated=!0;return this},clearParams:function(){this._params={};this._cacheInvalidated=
!0;return this},_clearCache:function(){this._dataCache&&(this._dataCache.destroy(),this._dataCache=null);this._resetCacheInvalidated()},_getCache:function(){this._dataCache||(this._dataCache=w.create(this));return this._dataCache},_reindexCache:function(){this._dataCache&&this._dataCache.reindexCache()},_isPageCached:function(a){return!this._dataCache?!1:this._dataCache.hasPage(a)},_resetCacheInvalidated:function(){this._cacheInvalidated=!1},destroy:function(){this._clearCache();this._super()},toString:function(){return"DataQuery"}},
{_queryInfo:{get:function(){return this.__queryInfo}},_serverTimezone:{get:function(){return this._dbSet.dbContext.serverTimezone}},entityType:{get:function(){return this._dbSet.entityType}},dbSet:{get:function(){return this._dbSet}},dbSetName:{get:function(){return this._dbSet.dbSetName}},queryName:{get:function(){return this.__queryInfo.methodName}},filterInfo:{get:function(){return this._filterInfo}},sortInfo:{get:function(){return this._sortInfo}},isIncludeTotalCount:{set:function(a){this._isIncludeTotalCount=
a},get:function(){return this._isIncludeTotalCount}},isClearPrevData:{set:function(a){this._isClearPrevData=a},get:function(){return this._isClearPrevData}},pageSize:{set:function(a){this._pageSize!=a&&(this._pageSize=a)},get:function(){return this._pageSize}},pageIndex:{set:function(a){this._pageIndex!=a&&(this._pageIndex=a)},get:function(){return this._pageIndex}},params:{set:function(a){this._params!==a&&(this._params=a,this._cacheInvalidated=!0)},get:function(){return this._params}},isPagingEnabled:{get:function(){return this._dbSet.isPagingEnabled}},
loadPageCount:{set:function(a){1>a&&(a=1);this._loadPageCount!=a&&(this._loadPageCount=a,1===a&&this._clearCache(),this.raisePropertyChanged("loadPageCount"))},get:function(){return this._loadPageCount}},isClearCacheOnEveryLoad:{set:function(a){this._isClearCacheOnEveryLoad!=a&&(this._isClearCacheOnEveryLoad=a,this.raisePropertyChanged("isClearCacheOnEveryLoad"))},get:function(){return this._isClearCacheOnEveryLoad}},isCacheValid:{get:function(){return!!this._dataCache&&!this._cacheInvalidated}}},
function(a){g.DataQuery=a});m=l.CollectionItem.extend({_create:function(a,c){this._super();this.__changeType=f.NONE;this._saveChangeType=this._origVals=this._srvRowKey=null;this.__isCached=this.__isRefreshing=!1;this.getFieldNames().forEach(function(a){this._vals[a]=null},this);this._initRowInfo(a,c);Object.seal(this)},_initRowInfo:function(a,c){if(a){var b=this,h=b._serverTimezone;this._key=this._srvRowKey=a.key;a.values.forEach(function(a,t){var f=c[t],d=b.getFieldInfo(f);if(!d)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,
b._dbSetName,f));f=s.parseValue(a,d.dataType,d.dateConversion,h);b._vals[d.fieldName]=f})}},_checkCanRefresh:function(){if(null===this._key||this._changeType===f.ADDED)throw Error(RIAPP.ERRS.ERR_OPER_REFRESH_INVALID);},_refreshValue:function(a,c,b){var h=this.getFieldInfo(c);if(!h)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,this._dbSetName,c));var f,d,e=h.dataType;a=s.parseValue(a,e,h.dateConversion,this._serverTimezone);f=this._vals[c];switch(b){case 3:s.compareVals(a,f,
e)||(this._vals[c]=a,this._onFieldChanged(h));break;case 1:this._origVals&&(this._origVals[c]=a);this._saveVals&&(this._saveVals[c]=a);s.compareVals(a,f,e)||(this._vals[c]=a,this._onFieldChanged(h));break;case 2:this._origVals&&(d=this._origVals[c],this._origVals[c]=a);if((void 0===d||s.compareVals(d,f,e))&&!s.compareVals(a,f,e))this._vals[c]=a,this._onFieldChanged(h);break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"refreshMode",b));}},_refreshValues:function(a,c){var b=
this,h=this._changeType;this._isDestroyed||(c||(c=1),a.values.forEach(function(a){4===(a.flags&4)&&b._refreshValue(a.val,a.fieldName,c)}),h===f.UPDATED&&0===this._getStrValues(!0).length&&(this._origVals=null,this._changeType=f.NONE))},_onFieldChanged:function(a){this.raisePropertyChanged(a.fieldName);a.dependents&&0<a.dependents.length&&a.dependents.forEach(function(a){this.raisePropertyChanged(a)},this)},_getStrValues:function(a){var c=this.getFieldNames(),b=this._dbSet;return c.map(function(a){var c=
this.getFieldInfo(a);if(c.isClientOnly)return null;var t=b._getStrValue(this._vals[a],c),f=null===this._origVals?t:b._getStrValue(this._origVals[a],c);return f!==t?{val:t,orig:f,fieldName:a,flags:3}:0<c.isPrimaryKey||c.isRowTimeStamp||c.isNeedOriginal?{val:t,orig:f,fieldName:a,flags:2}:{val:null,orig:null,fieldName:a,flags:0}},this).filter(function(c){return!c?!1:a?1===(c.flags&1):!0})},_getRowInfo:function(){return{values:this._getStrValues(!1),changeType:this._changeType,serverKey:this._srvKey,
clientKey:this._key,error:null}},_fldChanging:function(a,c,b){this._origVals||(this._origVals=k.extend(!0,{},this._vals));return!0},_fldChanged:function(a,c,b){if(!a.isClientOnly)switch(this._changeType){case f.NONE:this._changeType=f.UPDATED}this._onFieldChanged(a);return!0},_clearFieldVal:function(a){this._vals[a]=null},_skipValidate:function(a,c){var b=this._dbSet._trackAssocMap[a.fieldName],h=!1;if(b&&null===c)for(var f=0,d=b.length;f<d&&!(h=!!this._getFieldVal(b[f]));f+=1);return h},_getFieldVal:function(a){return this._vals[a]},
_setFieldVal:function(a,c){var b,h=this._dbSetName,f=this._collection,d=RIAPP.ERRS,e=this._vals[a],g=c,k=this.getFieldInfo(a);if(!k)throw Error(String.format(d.ERR_DBSET_INVALID_FIELDNAME,h,a));!this._isEditing&&!this._isUpdating&&this.beginEdit();try{if(g=this._checkVal(k,g),e!=g&&this._fldChanging(k,e,g)&&(this._vals[a]=g,this._fldChanged(k,e,g)),f._removeError(this,a),b=this._validateField(a))throw n.create([b],this);}catch(w){throw b=n.isPrototypeOf(w)?w:n.create([{fieldName:a,errors:[w.message]}],
this),f._addError(this,a,b.errors[0].errors),b;}return!0},_onAttaching:function(){this._super();this.__changeType=f.ADDED},_onAttach:function(){this._super();if(null===this._key)throw Error(RIAPP.ERRS.ERR_ITEM_IS_DETACHED);this._dbSet._addToChanged(this)},_beginEdit:function(){if(!this._super())return!1;this._saveChangeType=this._changeType;return!0},_endEdit:function(){if(!this._super())return!1;this._saveChangeType=null;return!0},deleteItem:function(){return this.deleteOnSubmit()},deleteOnSubmit:function(){var a=
this._changeType,c=this._dbSet;if(!c._onItemDeleting(this)||null===this._key)return!1;if(a===f.ADDED)return c.removeItem(this),!0;this._changeType=f.DELETED;return!0},acceptChanges:function(a){var c=this._changeType,b=this._dbSet;null!==this._key&&c!==f.NONE&&(b._onCommitChanges(this,!0,!1,c),c===f.DELETED?b.removeItem(this):(this._origVals=null,this._saveVals&&(this._saveVals=k.extend(!0,{},this._vals)),this._changeType=f.NONE,b._removeAllErrors(this),a&&this._refreshValues(a,3),b._onCommitChanges(this,
!1,!1,c)))},rejectChanges:function(){var a=this._changeType,c=this._dbSet;if(null!==this._key&&a!==f.NONE)if(c._onCommitChanges(this,!0,!0,a),a===f.ADDED)c.removeItem(this);else{var b=this._getStrValues(!0);this._origVals&&(this._vals=k.extend(!0,{},this._origVals),this._origVals=null,this._saveVals&&(this._saveVals=k.extend(!0,{},this._vals)));this._changeType=f.NONE;c._removeAllErrors(this);b.forEach(function(a){this._onFieldChanged(c.getFieldInfo(a.fieldName))},this);c._onCommitChanges(this,!1,
!0,a)}},refresh:function(){return this._dbSet.dbContext._refreshItem(this)},cancelEdit:function(){if(!this._isEditing)return!1;var a=this._getStrValues(!0),c=this._isNew,b=this._dbSet;this._isEditing=!1;this._vals=this._saveVals;this._saveVals=null;this._changeType=this._saveChangeType;this._saveChangeType=null;b._removeAllErrors(this);a.forEach(function(a){this.raisePropertyChanged(a.fieldName)},this);c&&this._notEdited&&b.removeItem(this);b._onEditing(this,!1,!0);this.raisePropertyChanged("isEditing");
return!0},getDbContext:function(){return this._dbSet.dbContext},toString:function(){return"Entity: "+this._typeName},destroy:function(){this._saveChangeType=this._origVals=this._srvRowKey=null;this.__isCached=this.__isRefreshing=!1;this._super()}},{_isNew:{get:function(){return this._changeType===f.ADDED}},_isDeleted:{get:function(){return this._changeType===f.DELETED}},_entityType:{get:function(){return this._dbSet.entityType}},_srvKey:{get:function(){return this._srvRowKey}},_dbSetName:{get:function(){return this._dbSet.dbSetName}},
_changeType:{set:function(a){if(this.__changeType!==a){var c=this.__changeType;this.__changeType=a;a!==f.NONE?this._dbSet._addToChanged(this):this._dbSet._removeFromChanged(this._key);this._dbSet._onItemStatusChanged(this,c)}},get:function(){return this.__changeType}},_serverTimezone:{get:function(){return this.getDbContext().serverTimezone}},_collection:{get:function(){return this._dbSet}},_isRefreshing:{set:function(a){this.__isRefreshing!==a&&(this.__isRefreshing=a,this.raisePropertyChanged("_isRefreshing"))},
get:function(){return this.__isRefreshing}},_isCached:{set:function(a){this.__isCached=a},get:function(){return this.__isCached}},isHasChanges:{get:function(){return this._changeType!==f.NONE}}},function(a){g.Entity=a});d=l.Collection.extend({_create:function(a){this._super();a=k.extend(!1,{dbContext:null,dbSetInfo:null,childAssoc:[],parentAssoc:[]},a);var c=a.dbSetInfo;this._dbContext=a.dbContext;this._options.dbSetName=c.dbSetName;this._options.enablePaging=c.enablePaging;this._options.pageSize=
c.pageSize;this._perms=k.extend(!1,{},c.permissions);this._entityType=this._query=null;this._isSubmitOnDelete=!1;this._trackAssoc={};this._trackAssocMap={};this._childAssocMap={};this._parentAssocMap={};this._changeCount=0;this._changeCache={};this._ignorePageChanged=!1;Object.freeze(this._perms);this._createEntityType(c.dbSetName,c.fieldInfos,a.childAssoc,a.parentAssoc)},getFieldInfo:function(a){var c,b=a.split(".");if(1==b.length)return this._fieldMap[a];if(1<b.length&&(c=this._childAssocMap[b[0]]))return c=
this.dbContext.getDbSet(c.parentDbSetName),a=b.slice(1).join("."),c.getFieldInfo(a);throw Error(String.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,this.dbSetName,a));},_onError:function(a,c){return this.dbContext._onError(a,c)},_mapAssocFields:function(){for(var a=this._trackAssoc,c,b=Object.keys(a),h,f=this._trackAssocMap,d=0,e=b.length;d<e;d+=1){c=a[b[d]];for(var n=0,g=c.fieldRels.length;n<g;n+=1)h=c.fieldRels[n],f[h.childField]?f[h.childField].push(c.childToParentName):f[h.childField]=[c.childToParentName]}},
_getStrValue:function(a,c){return s.stringifyValue(a,c.dateConversion,this.dbContext.serverTimezone)},_createEntityType:function(a,c,b,h){var f=this,d={};if(!k.check_is.Array(c))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID_TYPE,"fldInfos","Array"));c.forEach(function(a){var c=k.extend(!1,{},a);c.dependents=[];f._fieldMap[a.fieldName]=c},this);var e=function(a){a.dependentOn.split(",").forEach(function(c){var b=f._fieldMap[c];if(!b)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CALC_FIELD_DEFINE,
c));if(a.fieldName===c)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CALC_FIELD_SELF_DEPEND,c));0>b.dependents.indexOf(a.fieldName)&&b.dependents.push(a.fieldName)})},n=function(a){var c=f._fieldMap[a.fieldName],t=!0,e=b.filter(function(c){return c.childToParentName==a.fieldName});0===e.length&&(e=h.filter(function(c){return c.parentToChildrenName==a.fieldName}),t=!1);if(1!=e.length)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID_TYPE,"assocs","Array"));c.isClientOnly=!0;c.isReadOnly=
!0;var n=function(){throw Error("getFunc is not emplemented!");},x,g=e[0].name;t?(c.isReadOnly=!1,f._childAssocMap[e[0].childToParentName]=e[0],e[0].fieldRels.forEach(function(a){a=f._fieldMap[a.childField];!c.isReadOnly&&a.isReadOnly&&(c.isReadOnly=!0)}),n=function(){return f.dbContext.getAssociation(g).getParentItem(this)},c.isReadOnly||(f._trackAssoc[g]=e[0],x=function(c){var b,h,t=f.dbContext.getAssociation(g);if(c&&!t.parentDS.entityType.isPrototypeOf(c))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID_TYPE,
"value",t.parentDS.entityType._typeName));if(c&&c._isNew)this._setFieldVal(a.fieldName,c._key);else if(c){b=0;for(h=t.childFldInfos.length;b<h;b+=1)this[t.childFldInfos[b].fieldName]=c[t.parentFldInfos[b].fieldName]}else{this._getFieldVal(a.fieldName)&&this._setFieldVal(a.fieldName,null);b=0;for(h=t.childFldInfos.length;b<h;b+=1)this[t.childFldInfos[b].fieldName]=null}})):(f._parentAssocMap[e[0].parentToChildrenName]=e[0],n=function(){return f.dbContext.getAssociation(g).getChildItems(this)});d[a.fieldName]=
{set:x,get:n}},g=function(a){d[a.fieldName]={set:function(c){this._setFieldVal(a.fieldName,c)},get:function(){return this._getFieldVal(a.fieldName)}}};c.forEach(function(c){if(k.hasProp(m,c.fieldName))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_ITEM_NAME_COLLISION,a,c.fieldName));if(c.isCalculated){var b=f.getFieldInfo(c.fieldName);b.isClientOnly=!0;b.isReadOnly=!0;b={dbSetName:a,fieldName:c.fieldName,getFunc:null};f.dbContext._onGetCalcField(b);k.check_is.Function(b.getFunc)&&(c.dependentOn&&e(c),
d[c.fieldName]={get:b.getFunc})}else c.isNavigation?n(c):g(c)});d._dbSet={get:function(){return this.__dbSet}};this._entityType=m.extend({__dbSet:f},d,function(c){c._typeName=a+"Entity"});this._mapAssocFields()},_fillFromService:function(a){a=k.extend(!1,{res:{names:[],rows:[],pageIndex:null,pageCount:null,dbSetName:this.dbSetName,totalCount:null},isPageChanged:!1,fn_beforeFillEnd:null},a);var c=a.res,b=c.names,h=c.rows,f=this._entityType,d=[],e=[],n=[],g=[],w=this.isPagingEnabled,l=this.query,s=
!0,v;this._onFillStart({isBegin:!0,rowCount:h.length,time:new Date,isPageChanged:a.isPageChanged});try{l&&(s=l.isClearPrevData,l.isClearCacheOnEveryLoad&&l._clearCache(),s&&this.clear(),l._reindexCache(),1<l.loadPageCount&&w&&(v=l._getCache(),l.isIncludeTotalCount&&!k.check_is.nt(c.totalCount)&&(v.totalCount=c.totalCount)));n=h.map(function(a){var c=a.key;if(!c)throw Error(RIAPP.ERRS.ERR_KEY_IS_EMPTY);var h=this._itemsByKey[c];h?a.values.forEach(function(a,c){h._refreshValue(a,b[c],1)}):(v&&(h=v.getItemByKey(c)),
h?a.values.forEach(function(a,c){h._refreshValue(a,b[c],1)}):h=f.create(a,b));return h},this);if(l&&(l.isIncludeTotalCount&&!k.check_is.nt(c.totalCount)&&(this.totalCount=c.totalCount),1<l.loadPageCount&&w)){v.fillCache(c.pageIndex,n);var m=v.getCachedPage(l.pageIndex),n=m?m.items:[]}n.forEach(function(a){var c=this._itemsByKey[a._key];c?g.push(c):(this._items.push(a),this._itemsByKey[a._key]=a,d.push(a),e.push(this._items.length-1),g.push(a))},this);0<d.length&&(this._onItemsChanged({change_type:q.ADDED,
items:d,pos:e}),this.raisePropertyChanged("count"));a.fn_beforeFillEnd&&a.fn_beforeFillEnd()}finally{this._onFillEnd({isBegin:!1,rowCount:g.length,time:new Date,resetUI:s,fetchedItems:g,newItems:d,isPageChanged:a.isPageChanged})}this.moveFirst();return{fetchedItems:g,newItems:d,isPageChanged:a.isPageChanged}},_fillFromCache:function(a){a=k.extend(!1,{isPageChanged:!1,fn_beforeFillEnd:null},a);var c=[],b=[],h=this.query;if(!h)throw Error(String.format(RIAPP.ERRS.ERR_ASSERTION_FAILED,"query is not null"));
h=h._getCache().getCachedPage(h.pageIndex);h=!h?[]:h.items;this._onFillStart({isBegin:!0,rowCount:h.length,time:new Date,isPageChanged:a.isPageChanged});try{this.clear(),this._items=h,h.forEach(function(a,h){this._itemsByKey[a._key]=a;c.push(h);b.push(a)},this),a.fn_beforeFillEnd&&a.fn_beforeFillEnd(),0<b.length&&(this._onItemsChanged({change_type:q.ADDED,items:b,pos:c}),this.raisePropertyChanged("count"))}finally{this._onFillEnd({isBegin:!1,rowCount:b.length,time:new Date,resetUI:!0,fetchedItems:b,
newItems:b,isPageChanged:a.isPageChanged})}this.moveFirst();return{fetchedItems:b,newItems:b,isPageChanged:a.isPageChanged}},_commitChanges:function(a){var c=this;a.forEach(function(a){var b=a.clientKey,t=c._itemsByKey[b];if(!t)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_KEY_IS_NOTFOUND,b));var d=t._changeType;t.acceptChanges(a);d===f.ADDED&&(delete c._itemsByKey[b],t._srvRowKey=a.serverKey,t._key=t._srvRowKey,c._itemsByKey[t._key]=t,c._onItemsChanged({change_type:q.REMAP_KEY,items:[t],old_key:b,
new_key:t._key}))})},_setItemInvalid:function(a){var c=this._itemsByKey[a.clientKey],b={};a.invalid.forEach(function(a){a.fieldName||(a.fieldName="*");b[a.fieldName]?b[a.fieldName].push(a.message):b[a.fieldName]=[a.message]});var h=[];k.forEachProp(b,function(a){h.push({fieldName:a,errors:b[a]})});this._addErrors(c,h);return c},_getChanges:function(){var a=[],c=this._changeCache;k.forEachProp(c,function(b){a.push(c[b]._getRowInfo())});return a},_getTrackAssocInfo:function(){var a=this,c=[],b=this._changeCache,
h=Object.keys(a._trackAssoc);k.forEachProp(b,function(f){var d=b[f];h.forEach(function(b){var h=d._getFieldVal(a._trackAssoc[b].childToParentName),f=d._key;h&&f&&c.push({assocName:b,parentKey:h,childKey:f})})});return c},_getNewKey:function(a){a="clkey_"+this._newKey;this._newKey+=1;return a},_createNew:function(){var a=this._entityType.create(null,null);a._key=this._getNewKey(a);return a},_addToChanged:function(a){null!==a._key&&!this._changeCache[a._key]&&(this._changeCache[a._key]=a,this._changeCount+=
1,1===this._changeCount&&this.raisePropertyChanged("hasChanges"))},_removeFromChanged:function(a){null!==a&&this._changeCache[a]&&(delete this._changeCache[a],this._changeCount-=1,0===this._changeCount&&this.raisePropertyChanged("hasChanges"))},_clearChangeCache:function(){var a=this._changeCount;this._changeCache={};this._changeCount=0;a!==this._changeCount&&this.raisePropertyChanged("hasChanges")},_onItemStatusChanged:function(a,c){this._super(a,c);a._isDeleted&&this.isSubmitOnDelete&&this.dbContext.submitChanges()},
_onRemoved:function(a,c){this._removeFromChanged(a._key);this._super(a,c)},_onPageChanging:function(){var a=this._super();if(!a)return a;this.hasChanges&&this.rejectChanges();return a},_onPageChanged:function(){this.cancelEdit();this._super();this._ignorePageChanged||(this.query.pageIndex=this.pageIndex,this.dbContext._load(this.query,!0))},_onPageSizeChanged:function(){this._super();this._query&&(this._query.pageSize=this.pageSize)},_destroyItems:function(){this._items.forEach(function(a){a._isCached?
a.removeHandler(null,null):a.destroy()})},fillItems:function(a){a={res:k.extend(!1,{names:[],rows:[],pageIndex:this.query?this.query.pageIndex:null,pageCount:null,dbSetName:this.dbSetName,totalCount:null},a),isPageChanged:!1,fn_beforeFillEnd:null};this._fillFromService(a)},acceptChanges:function(){var a=this._changeCache;k.forEachProp(a,function(c){a[c].acceptChanges(null)});this._changeCount=0},rejectChanges:function(){var a=this._changeCache;k.forEachProp(a,function(c){a[c].rejectChanges()})},deleteOnSubmit:function(a){a.deleteOnSubmit()},
clear:function(){this._clearChangeCache();this._super()},createQuery:function(c){var b=this.dbContext._getQueryInfo(c);if(!b)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_QUERY_NAME_NOTFOUND,c));return a.create(this,b)},clearCache:function(){var a=this._query;a&&a._clearCache()()},destroy:function(){var a=this._query;this._query=null;a&&a.destroy();this._super()},toString:function(){return"DbSet:"+this._options.dbSetName}},{dbContext:{get:function(){return this._dbContext}},dbSetName:{get:function(){return this._options.dbSetName}},
entityType:{get:function(){return this._entityType}},query:{get:function(){return this._query}},hasChanges:{get:function(){return 0<this._changeCount}},cacheSize:{get:function(){var a=this._query;return a&&a.isCacheValid?(a=a._getCache(),a.cacheSize):0}},isSubmitOnDelete:{set:function(a){this._isSubmitOnDelete!==a&&(this._isSubmitOnDelete=!!a,this.raisePropertyChanged("isSubmitOnDelete"))},get:function(){return this._isSubmitOnDelete}}},function(a){g.DbSet=a});RIAPP.BaseObject.extend({_app:b,_create:function(){this._super();
this._isInitialized=!1;this._dbSets={};this._arrDbSets=[];this._svcMethods={};this._assoc={};this._arrAssoc=[];this._queryInf={};this._serviceUrl=null;this._isBusy=0;this._hasChanges=this._isSubmiting=!1;this._pendingSubmit=null;this._serverTimezone=k.get_timeZoneOffset();this._waitQueue=k.WaitQueue.create(this)},_onGetCalcField:function(a){this.raiseEvent("define_calc",a)},_getQueryInfo:function(a){return this._queryInf[a]},_initDbSets:function(a){if(this._isInitialized)throw Error(RIAPP.ERRS.ERR_DOMAIN_CONTEXT_INITIALIZED);
var c=this,b=this._dbSets;if(!k.check_is.Array(a.dbSets))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID_TYPE,"metadata.dbSets","Array"));this._serverTimezone=a.serverTimezone;a.dbSets.forEach(function(h){var f=h.dbSetName,e;e=a.associations.filter(function(a){return h.dbSetName==a.childDbSetName});var n=a.associations.filter(function(a){return h.dbSetName==a.parentDbSetName});e=d.create({dbContext:c,dbSetInfo:h,childAssoc:e,parentAssoc:n});c._arrDbSets.push(e);e.addOnPropertyChange("hasChanges",
function(a,b){c._onDbSetHasChangesChanged(a)},null);b[f]=e});a.associations.forEach(function(a){c._initAssociation(a)});a.methods.forEach(function(a){a.isQuery?c._queryInf[a.methodName]=a:c._initMethod(a)});Object.freeze(this._dbSets);Object.freeze(this._svcMethods);Object.freeze(this._queryInf);this._isInitialized=!0;this.raisePropertyChanged("isInitialized")},_onDbSetHasChangesChanged:function(a){var c=this._hasChanges;this._hasChanges=!1;if(a.hasChanges)this._hasChanges=!0;else for(var b=0,h=this._arrDbSets.length;b<
h;b+=1)if(a=this._arrDbSets[b],a.hasChanges){this._hasChanges=!0;break}this._hasChanges!==c&&this.raisePropertyChanged("hasChanges")},_initAssociation:function(a){var c=this,b={dbContext:c,parentName:a.parentDbSetName,childName:a.childDbSetName,onDeleteAction:a.onDeleteAction,parentKeyFields:a.fieldRels.map(function(a){return a.parentField}),childKeyFields:a.fieldRels.map(function(a){return a.childField}),parentToChildrenName:a.parentToChildrenName,childToParentName:a.childToParentName,name:a.name};
this._assoc[a.name]=function(){var h=z.create(b);c._arrAssoc.push(h);c._assoc[a.name]=function(){return h};return h}},_initMethod:function(a){var c=this;this._svcMethods[a.methodName]=function(b){var h=k.createDeferred(),f=function(a){a.error?h.reject():h.resolve(a.result)};try{var d=c._getMethodParams(a,b);c._invokeMethod(a,d,f)}catch(n){e._checkIsDummy(n)||(c._onError(n,c),f({result:null,error:n}))}return h.promise()}},_getMethodParams:function(a,b){var f={methodName:a.methodName,paramInfo:{parameters:[]}},
h,d=a.parameters,e=d.length,n,g,l;b||(b={});for(h=0;h<e;h+=1){n=d[h];g=b[n.name];if(!n.isNullable&&!n.isArray&&n.dataType!==c.String&&k.check_is.nt(g))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_SVC_METH_PARAM_INVALID,n.name,g,a.methodName));if(k.check_is.Function(g))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_SVC_METH_PARAM_INVALID,n.name,g,a.methodName));n.isArray&&(!k.check_is.nt(g)&&!k.check_is.Array(g))&&(g=[g]);l=null;k.check_is.Array(g)?(l=[],g.forEach(function(a){l.push(s.stringifyValue(a,
n.dateConversion,self._serverTimezone))}),l=JSON.stringify(l)):l=s.stringifyValue(g,n.dateConversion,self._serverTimezone);f.paramInfo.parameters.push({name:n.name,value:l})}return f},_invokeMethod:function(a,c,b){var h=this,f,d;this.isBusy=!0;var n=function(a){try{if(!a)throw Error(k.format(RIAPP.ERRS.ERR_UNEXPECTED_SVC_ERROR,"operation result is undefined"));g.checkError(a.error,"invoke");b({result:a.result,error:null})}catch(c){e._checkIsDummy(c)||(h._onDataOperError(c,"invoke"),b({result:null,
error:c}))}};try{f=JSON.stringify(c),d=this._getUrl("InvokeMethod"),k.performAjaxCall(d,f,!0,function(a){n(a);h.isBusy=!1},function(a){n({result:null,error:a});h.isBusy=!1},null)}catch(l){e._checkIsDummy(l)&&e._throwDummy(l),this.isBusy=!1,this._onDataOperError(l,"invoke"),b({result:null,error:l}),e._throwDummy(l)}},_getEventNames:function(){var a=this._super();return["submit_error","define_calc"].concat(a)},_loadFromCache:function(a,c){var b=a._dbSet,h;try{h=b._fillFromCache({isPageChanged:c,fn_beforeFillEnd:null})}catch(f){e._checkIsDummy(f)&&
e._throwDummy(f),this._onDataOperError(f,"load"),e._throwDummy(f)}return h},_loadIncluded:function(a){var c=this;a.included&&0<a.included.length&&a.included.forEach(function(a){c.getDbSet(a.dbSetName).fillItems(a,!0)})},_onLoaded:function(a,c){var b=this,h,f,d;try{if(!a)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_UNEXPECTED_SVC_ERROR,"null result"));h=a.dbSetName;f=this.getDbSet(h);if(!f)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_NAME_INVALID,h));g.checkError(a.error,"load");d=f._fillFromService({res:a,
isPageChanged:c,fn_beforeFillEnd:function(){b._loadIncluded(a)}})}catch(n){e._checkIsDummy(n)&&e._throwDummy(n),this._onDataOperError(n,"load"),e._throwDummy(n)}return d},_dataSaved:function(a){var c=this,b=[],h=[];try{try{g.checkError(a.error,"submit")}catch(f){throw a.dbSets.forEach(function(a){var f=c._dbSets[a.dbSetName];a.rows.forEach(function(a){var c=f.getItemByKey(a.clientKey);if(!c)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_KEY_IS_NOTFOUND,a.clientKey));b.push(c);a.invalid&&(f._setItemInvalid(a),
h.push(c))})}),v.create(f,b,h);}a.dbSets.forEach(function(a){c._dbSets[a.dbSetName]._commitChanges(a.rows)})}catch(d){e._checkIsDummy(d)&&e._throwDummy(d),this._onSubmitError(d),e._throwDummy(d)}},_getChanges:function(){var a={dbSets:[],error:null,trackAssocs:[]};this._arrDbSets.forEach(function(c){c.endEdit();var b=c._getChanges();if(0!==b.length){var h=c._getTrackAssocInfo();a.dbSets.push({dbSetName:c.dbSetName,rows:b});a.trackAssocs=a.trackAssocs.concat(h)}});return a},_getUrl:function(a){var c=
this.service_url;k.str.endsWith(c,"/")||(c+="/");return c+=[a,""].join("/")},_onItemRefreshed:function(a,c){try{if(g.checkError(a.error,"refresh"),a.rowInfo)c._refreshValues(a.rowInfo,2);else throw c._dbSet.removeItem(c),c.destroy(),Error(RIAPP.ERRS.ERR_ITEM_DELETED_BY_ANOTHER_USER);}catch(b){e._checkIsDummy(b)&&e._throwDummy(b),this._onDataOperError(b,"refresh"),e._throwDummy(b)}},_refreshItem:function(a){var c=k.createDeferred(),b=function(b){b?c.resolve(a):c.reject()},h=this._getUrl("RefreshItem"),
f=a._dbSet;this.waitForNotSubmiting(function(){var c=this;f.waitForNotLoading(function(){var d,e=function(){c.isBusy=!1;f.isLoading=!1;a._isRefreshing=!1},n=function(a){e();c._onDataOperError(a,"refresh")};a._isRefreshing=!0;c.isBusy=!0;f.isLoading=!0;try{var g={dbSetName:a._dbSetName,rowInfo:a._getRowInfo(),error:null};a._checkCanRefresh();d=JSON.stringify(g);k.performAjaxCall(h,d,!0,function(h){try{c._onItemRefreshed(h,a),e(),b(!0)}catch(f){n(f),b(!1)}},function(a){e();c._onDataOperError(a,"refresh");
b(!1)},null)}catch(x){n(x),b(!1)}},[],!0,null)},[],null);return c.promise()},_onError:function(a,c){var b=this._super(a,c);return!b?this.app?this.app._onError(a,c):e._onError(a,c):b},_onDataOperError:function(a,c){if(e._checkIsDummy(a))return!0;var b;b=u.isPrototypeOf(a)?a:u.create(a,c);return this._onError(b,this)},_onSubmitError:function(a){var c={error:a,isHandled:!1};this.raiseEvent("submit_error",c);c.isHandled||(this.rejectChanges(),this._onDataOperError(a,"submit"))},_loadChunks:function(a,
c,b,h){var f=this;k.performAjaxCall(a,c,!0,function(d){try{g.checkError(d.error,"load");var e=d.chunksID&&0<d.chunksLeft;b.rows=b.rows.concat(d.rows);d.rows=[];b.included&&0<b.included.length&&b.included.forEach(function(a){var c=d.included.filter(function(c){return c.dbSetName==a.dbSetName});1==c.length&&(a.rows=a.rows.concat(c[0].rows))});e?f._loadChunks(a,c,b,h):h(b,null)}catch(n){h(null,n)}},function(a){h(null,a)},null)},_beforeLoad:function(a,c,b){a&&c!==a&&(b._query=a,b.pageIndex=0);c&&c!==
a&&c.destroy();if(a.pageSize!==b.pageSize){b._ignorePageChanged=!0;try{b.pageIndex=0,b.pageSize=a.pageSize}finally{b._ignorePageChanged=!1}}if(a.pageIndex!==b.pageIndex){b._ignorePageChanged=!0;try{b.pageIndex=a.pageIndex}finally{b._ignorePageChanged=!1}}a.isCacheValid||a._clearCache()},_load:function(a,c){if(!a)throw Error(RIAPP.ERRS.ERR_DB_LOAD_NO_QUERY);var b=this,h=k.createDeferred(),f=function(a,c){a?h.resolve(c):h.reject()},d=a.loadPageCount,e=a.pageIndex,n=a.isPagingEnabled,g=a.dbSetName,l=
this.getDbSet(g);this.waitForNotSubmiting(function(){l.waitForNotLoading(function(){var h=l.query,w=b._getUrl("GetItems"),s,v,m=function(){l.isLoading=!1;b.isBusy=!1},q=function(a){m();f(!0,a)},y=function(a){m();b._onDataOperError(a,"load");f(!1,null)},p;l.isLoading=!0;b.isBusy=!0;try{a.pageIndex=e;b._beforeLoad(a,h,l);var z,h=1;if(1<d&&n){if(a._isPageCached(e)){p=b._loadFromCache(a,c);p.outOfBandData=null;q(p);return}z=a._getCache().getNextRange(e);e=z.start;h=z.cnt}s={dbSetName:g,pageIndex:e,pageSize:a.pageSize,
pageCount:h,isIncludeTotalCount:a.isIncludeTotalCount,filterInfo:a.filterInfo,sortInfo:a.sortInfo,paramInfo:b._getMethodParams(a._queryInfo,a.params).paramInfo,queryName:a.queryName,chunksID:null};v=JSON.stringify(s);k.performAjaxCall(w,v,!0,function(a){try{a.chunksID&&0<a.chunksLeft?(s.chunksID=a.chunksID,s.filterInfo=null,s.sortInfo=null,s.paramInfo=null,v=JSON.stringify(s),b._loadChunks(w,v,a,function(a,h){h?(m(),b._onDataOperError(h,"load"),f(!1,null)):(p=b._onLoaded(a,c),p.outOfBandData=a.extraInfo,
q(p))})):(p=b._onLoaded(a,c),p.outOfBandData=a.extraInfo,q(p))}catch(h){y(h)}},function(a){m();b._onDataOperError(a,"load");f(!1,null)},null)}catch(u){y(u)}},[],!0,c?"paging":null)},[],c?"paging":null);return h.promise()},getDbSet:function(a){if(!this.isInitialized)throw Error(RIAPP.ERRS.ERR_DOMAIN_CONTEXT_NOT_INITIALIZED);var c=this._dbSets[a];if(!c)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_NAME_INVALID,a));return c},getAssociation:function(a){var c=this._assoc[a];if(!c)throw Error(RIAPP.utils.format(RIAPP.ERR_ASSOC_NAME_INVALID,
a));return c()},submitChanges:function(){if(this._pendingSubmit)return this._pendingSubmit.deferred.promise();var a=this,c={deferred:k.createDeferred()},b=function(a){a?c.deferred.resolve():c.deferred.reject()};this._pendingSubmit=c;this.waitForNotBusy(function(){var c,f,d,e=function(){a.isBusy=!1;a.isSubmiting=!1},n=function(c){e();a._onDataOperError(c,"submit");b(!1)};try{if(this.isSubmiting=this.isBusy=!0,this._pendingSubmit=null,c=this._getUrl("SaveChanges"),d=this._getChanges(),0===d.dbSets.length){e();
b(!0);return}}catch(g){n(g);return}try{f=JSON.stringify(d),k.performAjaxCall(c,f,!0,function(c){try{a._dataSaved(c),e(),b(!0)}catch(h){n(h)}},function(c){e();a._onSubmitError(c);b(!1)},null)}catch(l){n(l)}},[]);return c.deferred.promise()},load:function(a){return this._load(a,!1)},acceptChanges:function(){this._arrDbSets.forEach(function(a){a.acceptChanges()})},rejectChanges:function(){this._arrDbSets.forEach(function(a){a.rejectChanges()})},initialize:function(a){if(!this._isInitialized){var c=this;
a=k.extend(!1,{serviceUrl:null,metadata:null},a);this._serviceUrl=a.serviceUrl;if(a.metadata)this._initDbSets(a.metadata);else{a=this._getUrl("GetMetadata");try{this.isBusy=!0,k.performAjaxCall(a,void 0,!0,function(a){try{c._initDbSets(a),c.isBusy=!1}catch(b){c.isBusy=!1,c._onDataOperError(b,"initDbContext"),e._throwDummy(b)}},function(a){c.isBusy=!1;c._onDataOperError(a,"initDbContext")},null)}catch(b){this.isBusy=!1,this._onDataOperError(b,"initDbContext"),e._throwDummy(b)}}}},waitForNotBusy:function(a,
c){this._waitQueue.enQueue({prop:"isBusy",groupName:null,predicate:function(a){return!a},action:a,actionArgs:c})},waitForNotSubmiting:function(a,c,b){this._waitQueue.enQueue({prop:"isSubmiting",predicate:function(a){return!a},action:a,actionArgs:c,groupName:b,lastWins:!!b})},waitForInitialized:function(a,c){this._waitQueue.enQueue({prop:"isInitialized",groupName:"dbContext",predicate:function(a){return!!a},action:a,actionArgs:c})},destroy:function(){this._waitQueue&&(this._waitQueue.destroy(),this._waitQueue=
null,this._arrAssoc.forEach(function(a){a.destroy()}),this._arrAssoc=[],this._assoc={},this._arrDbSets.forEach(function(a){a.destroy()}),this._arrDbSets=[],this._dbSets={},this._svcMethods={},this._queryInf={},this._serviceUrl=null,this._hasChanges=this._isSubmiting=this._isBusy=this._isInitialized=!1,this._super())}},{app:{get:function(){return this._app}},service_url:{get:function(){return this._serviceUrl}},isInitialized:{get:function(){return this._isInitialized}},isBusy:{set:function(a){var c=
0<this._isBusy;a?this._isBusy+=1:(this._isBusy-=1,0>this._isBusy&&(this._isBusy=0));0<this._isBusy!=c&&this.raisePropertyChanged("isBusy")},get:function(){return 0<this._isBusy}},isSubmiting:{set:function(a){this._isSubmiting!==a&&(this._isSubmiting=a,this.raisePropertyChanged("isSubmiting"))},get:function(){return this._isSubmiting}},serverTimezone:{get:function(){return this._serverTimezone}},dbSets:{get:function(){return this._dbSets}},arrDbSets:{get:function(){return this._arrDbSets}},serviceMethods:{get:function(){return this._svcMethods}},
hasChanges:{get:function(){return this._hasChanges}}},function(a){g.DbContext=a;b.registerType("DbContext",a)});var y=l.Collection.extend({_create:function(a){this._super();a=k.extend(!1,{dataSource:null,fn_filter:null,fn_sort:null,fn_itemsProvider:null},a);if(!a.dataSource||!l.Collection.isPrototypeOf(a.dataSource))throw Error(RIAPP.ERRS.ERR_DATAVIEW_DATASRC_INVALID);if(!a.fn_filter||!k.check_is.Function(a.fn_filter))throw Error(RIAPP.ERRS.ERR_DATAVIEW_FILTER_INVALID);this._dataSource=a.dataSource;
this._fn_filter=a.fn_filter;this._fn_sort=a.fn_sort;this._fn_itemsProvider=a.fn_itemsProvider;this._isAddingNew=this._isDSFilling=!1;var c=this,b=this._dataSource;b.getFieldNames().forEach(function(a){c._fieldMap[a]=k.extend(!1,{},b.getFieldInfo(a))});this._bindDS()},_getEventNames:function(){var a=this._super();return["view_refreshed"].concat(a)},_filterForPaging:function(a){var c=0,b=0,h=-1,f=-1,d=[],c=this.pageSize*this.pageIndex,b=this.pageSize;a.forEach(function(a){f+=1;f<c||(h+=1,h<b&&d.push(a))});
return d},_onViewRefreshed:function(a){this.raiseEvent("view_refreshed",a)},_refresh:function(a){var c;if(c=this._dataSource)c=this._fn_itemsProvider?this._fn_itemsProvider(c):c.items,this._fn_filter&&(c=c.filter(this._fn_filter)),this._fn_sort&&(c=c.sort(this._fn_sort)),this._fillItems({items:c,isPageChanged:!!a,clear:!0,isAppend:!1}),this._onViewRefreshed({})},_fillItems:function(a){a=k.extend(!1,{items:[],isPageChanged:!1,clear:!0,isAppend:!1},a);var c,b=[],h=[],f=[];this._onFillStart({isBegin:!0,
rowCount:a.items.length,time:new Date,isPageChanged:a.isPageChanged});try{a.clear&&this.clear(),c=this.isPagingEnabled&&!a.isAppend?this._filterForPaging(a.items):a.items,c.forEach(function(a){var c=this._itemsByKey[a._key];c?f.push(c):(this._itemsByKey[a._key]=a,b.push(a),h.push(this._items.length-1),this._items.push(a),f.push(a))},this),0<b.length&&(this._onItemsChanged({change_type:q.ADDED,items:b,pos:h}),this.raisePropertyChanged("count"))}finally{this._onFillEnd({isBegin:!1,rowCount:f.length,
time:new Date,resetUI:!!a.clear,fetchedItems:f,newItems:b,isPageChanged:a.isPageChanged})}this.totalCount=a.clear?a.items.length:this.totalCount+b.length;this.moveFirst();return b},_onDSCollectionChanged:function(a){var c=this,b;b=a.items;switch(a.change_type){case q.RESET:this._isDSFilling||this._refresh(!1);break;case q.ADDED:!this._isAddingNew&&!this._isDSFilling&&(c._fn_filter&&(b=b.filter(c._fn_filter)),c.appendItems([b]));break;case q.REMOVE:b.forEach(function(a){(a=c._itemsByKey[a._key])&&
c.removeItem(a)});break;case q.REMAP_KEY:if(b=c._itemsByKey[a.old_key])delete c._itemsByKey[a.old_key],c._itemsByKey[a.new_key]=b,this._onItemsChanged(a);break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,a.change_type));}},_onDSFill:function(a){var c=a.fetchedItems;a.isBegin?this._isDSFilling=!0:(this._isDSFilling=!1,a.resetUI?this._refresh(!1):(this._fn_filter&&(c=c.filter(this._fn_filter)),this.appendItems(c)))},_onDSStatusChanged:function(a){var c=a.item,
b=a.oldChangeType,h=!!this._fn_filter;this._itemsByKey[a.key]?(this._onItemStatusChanged(c,b),h&&((a=this._fn_filter(c))||this.removeItem(c))):h&&(a=this._fn_filter(c))&&this.appendItems([c])},_bindDS:function(){var a=this,c=this._dataSource;c&&(c.addHandler("coll_changed",function(b,h){c===b&&a._onDSCollectionChanged(h)},a._objId),c.addHandler("fill",function(b,h){c===b&&a._onDSFill(h)},a._objId),c.addHandler("begin_edit",function(b,h){c===b&&a._itemsByKey[h.item._key]&&a._onEditing(h.item,!0,!1)},
a._objId),c.addHandler("end_edit",function(b,h){if(c===b){var f,d=h.item;f=!!a._fn_filter;a._itemsByKey[d._key]?(a._onEditing(d,!1,h.isCanceled),!h.isCanceled&&f&&((f=a._fn_filter(d))||a.removeItem(d))):!h.isCanceled&&f&&(f=a._fn_filter(d))&&a._appendItems([d])}},a._objId),c.addHandler("errors_changed",function(b,h){c===b&&a._itemsByKey[h.item._key]&&a._onErrorsChanged(h.item)},a._objId),c.addHandler("status_changed",function(b,h){c===b&&a._onDSStatusChanged(h)},a._objId),c.addHandler("item_deleting",
function(b,h){c===b&&a._itemsByKey[h.item._key]&&a._onItemDeleting(h)},a._objId),c.addHandler("item_added",function(b,h){c===b&&a._isAddingNew&&(a._itemsByKey[h.item._key]||a._attach(h.item),a.currentItem=h.item,a._onEditing(h.item,!0,!1),a._onItemAdded(h.item))},a._objId),c.addHandler("item_adding",function(b,h){c===b&&a._isAddingNew&&a._onItemAdding(h.item)},a._objId))},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},appendItems:function(a){return this._isDestroyed?
[]:this._fillItems({items:a,isPageChanged:!1,clear:!1,isAppend:!0})},_getStrValue:function(a,c){return this._dataSource._getStrValue(a,c)},_onCurrentChanging:function(a){var c=this._dataSource;try{c._EditingItem&&a!==c._EditingItem&&c.endEdit()}catch(b){c.cancelEdit(),e.reThrow(b,this._onError(b,this))}},_getErrors:function(a){return this._dataSource._getErrors(a)},_onPageChanged:function(){this._refresh(!0)},getItemsWithErrors:function(){return this._dataSource.getItemsWithErrors()},addNew:function(){var a=
this._dataSource,c;this._isAddingNew=!0;try{c=a.addNew()}finally{this._isAddingNew=!1}return c},removeItem:function(a){if(null===a._key)throw Error(RIAPP.ERRS.ERR_ITEM_IS_DETACHED);if(this._itemsByKey[a._key]){var c=this._items.indexOf(a);if(0>c)throw Error(RIAPP.ERRS.ERR_ITEM_IS_NOTFOUND);this._items.splice(c,1);delete this._itemsByKey[a._key];delete this._errors[a._key];this.totalCount-=1;this._onRemoved(a,c);a=this.getItemByPos(c);var b=this._currentPos;b===c&&(a||(this._currentPos=b-1),this._onCurrentChanged());
b>c&&(this._currentPos=b-1,this._onCurrentChanged())}},sortLocal:function(a,c){var b=1,h=this._app.parser;c&&"DESC"===c.toUpperCase()&&(b=-1);this.fn_sort=function(c,f){var d=0,e,n,g;e=0;for(n=a.length;e<n&&!(g=a[e],d=h.resolvePath(c,g),g=h.resolvePath(f,g),d=d<g?-1*b:d>g?b:0,0!==d);e+=1);return d}},getIsHasErrors:function(){return this._dataSource.getIsHasErrors()},clear:function(){this.cancelEdit();this._EditingItem=null;this._newKey=0;this.currentItem=null;this._items=[];this._itemsByKey={};this._errors=
{};this._onItemsChanged({change_type:q.RESET,items:[]});this.pageIndex=0;this.raisePropertyChanged("count")},refresh:function(){this._refresh(!1)},destroy:function(){this._isDestroyed||(this._unbindDS(),this._fn_sort=this._fn_filter=this._dataSource=null,this._super())}},{isPagingEnabled:{set:function(a){this._options.enablePaging!==a&&(this._options.enablePaging=a,this.raisePropertyChanged("isPagingEnabled"),this._refresh())},get:function(){return this._options.enablePaging}},permissions:{get:function(){return this._dataSource.permissions}},
fn_filter:{set:function(a){this._fn_filter!==a&&(this._fn_filter=a,this._refresh())},get:function(){return this._fn_filter}},fn_sort:{set:function(a){this._fn_sort!==a&&(this._fn_sort=a,this._refresh())},get:function(){return this._fn_sort}},fn_itemsProvider:{set:function(a){this._fn_itemsProvider!==a&&(this._fn_itemsProvider=a,this._refresh())},get:function(){return this._fn_itemsProvider}}},function(a){g.DataView=a;b.registerType("DataView",a)}),z=RIAPP.BaseObject.extend({_app:b,_create:function(a){this._super();
var c=this;this._objId="ass"+this._app.getNewObjectID();a=k.extend(!1,{dbContext:null,parentName:"",childName:"",parentKeyFields:[],childKeyFields:[],parentToChildrenName:null,childToParentName:null,name:this._objId,onDeleteAction:0},a);this._name=a.name;this._dbContext=a.dbContext;this._onDeleteAction=a.onDeleteAction;this._parentDS=a.dbContext.dbSets[a.parentName];this._childDS=a.dbContext.dbSets[a.childName];this._parentFldInfos=a.parentKeyFields.map(function(a){return c._parentDS.getFieldInfo(a)});
this._childFldInfos=a.childKeyFields.map(function(a){return c._childDS.getFieldInfo(a)});this._parentToChildrenName=a.parentToChildrenName;this._childToParentName=a.childToParentName;this._parentMap={};this._childMap={};this._isChildFilling=this._isParentFilling=!1;this._bindParentDS();a=this._mapParentItems(this._parentDS.items);this._bindChildDS();var b=this._mapChildren(this._childDS.items);this._changedTimeout=this._saveChildFKey=this._saveParentFKey=null;this._changed={};c._notifyParentChanged(a);
c._notifyChildrenChanged(b)},_onError:function(a,c){var b=this._super(a,c);return!b?this.app._onError(a,c):b},_bindParentDS:function(){var a=this,c=this._parentDS;c&&(c._addHandler("coll_changed",function(b,h){c===b&&a._onParentCollChanged(h)},a._objId,!0),c._addHandler("fill",function(b,h){c===b&&a._onParentFill(h)},a._objId,!0),c._addHandler("begin_edit",function(b,h){c===b&&a._onParentEdit(h.item,!0,void 0)},a._objId,!0),c._addHandler("end_edit",function(b,h){c===b&&a._onParentEdit(h.item,!1,h.isCanceled)},
a._objId,!0),c._addHandler("item_deleting",function(b,h){if(c===b){var f=a.getChildItems(h.item);switch(a.onDeleteAction){case 0:0<f.length&&(h.isCancel=!0,a._onError(Error(RIAPP.ERRS.ERR_ASSOC_HAS_CHILDREN),a))}}},a._objId,!0),c._addHandler("status_changed",function(b,h){c===b&&a._onParentStatusChanged(h.item,h.oldChangeType)},a._objId,!0),c._addHandler("commit_changes",function(b,h){c===b&&a._onParentCommitChanges(h.item,h.isBegin,h.isRejected,h.changeType)},a._objId,!0))},_bindChildDS:function(){var a=
this,c=this._childDS;c&&(c._addHandler("coll_changed",function(b,h){c===b&&a._onChildCollChanged(h)},a._objId,!0),c._addHandler("fill",function(b,h){c===b&&a._onChildFill(h)},a._objId,!0),c._addHandler("begin_edit",function(b,h){c===b&&a._onChildEdit(h.item,!0,void 0)},a._objId,!0),c._addHandler("end_edit",function(b,h){c===b&&a._onChildEdit(h.item,!1,h.isCanceled)},a._objId,!0),c._addHandler("status_changed",function(b,h){c===b&&a._onChildStatusChanged(h.item,h.oldChangeType)},a._objId,!0),c._addHandler("commit_changes",
function(b,h){c===b&&a._onChildCommitChanges(h.item,h.isBegin,h.isRejected,h.changeType)},a._objId,!0))},_onParentCollChanged:function(a){var c=this,b;b=a.items;var h=[],f={};switch(a.change_type){case q.RESET:c._isParentFilling||(h=c.refreshParentMap());break;case q.ADDED:this._isParentFilling||(h=c._mapParentItems(b));break;case q.REMOVE:b.forEach(function(a){(a=c._unMapParentItem(a))&&(f[a]=null)});h=Object.keys(f);break;case q.REMAP_KEY:if(a.old_key&&(b=this._parentMap[a.old_key]))delete this._parentMap[a.old_key],
h=this._mapParentItems([b]);break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,a.change_type));}c._notifyParentChanged(h)},_onParentFill:function(a){a.isBegin?this._isParentFilling=!0:(this._isParentFilling=!1,a=a.resetUI?this.refreshParentMap():this._mapParentItems(a.newItems),this._notifyParentChanged(a))},_onParentEdit:function(a,c,b){c?this._storeParentFKey(a):b?this._saveParentFKey=null:this._checkParentFKey(a)},_onParentCommitChanges:function(a,c,b,h){c?
b&&h===f.ADDED?(a=this._unMapParentItem(a))&&this._notifyParentChanged([a]):!b&&h===f.DELETED?(a=this._unMapParentItem(a))&&this._notifyParentChanged([a]):this._storeParentFKey(a):this._checkParentFKey(a)},_storeParentFKey:function(a){a=this.getParentFKey(a);null!==a&&this._parentMap[a]&&(this._saveParentFKey=a)},_checkParentFKey:function(a){var c,b=this._saveParentFKey;this._saveParentFKey=null;c=this.getParentFKey(a);c!==b&&(b&&(delete this._parentMap[b],this._notifyChildrenChanged([b]),this._notifyParentChanged([b])),
c&&(this._mapParentItems([a]),this._notifyChildrenChanged([c]),this._notifyParentChanged([c])))},_onParentStatusChanged:function(a,c){var b=this,h,d;if(a._changeType===f.DELETED){d=b.getChildItems(a);h=this._unMapParentItem(a);switch(b.onDeleteAction){case 1:d.forEach(function(a){a.deleteItem()});break;case 2:d.forEach(function(a){var c=a.isEditing;c||a.beginEdit();try{b._childFldInfos.forEach(function(c){a[c.fieldName]=null}),c||a.endEdit()}finally{c||a.cancelEdit()}})}h&&b._notifyParentChanged([h])}},
_onChildCollChanged:function(a){var c=this,b=a.items,h=[],f={};switch(a.change_type){case q.RESET:c._isChildFilling||(h=c.refreshChildMap());break;case q.ADDED:this._isChildFilling||(h=c._mapChildren(b));break;case q.REMOVE:b.forEach(function(a){(a=c._unMapChildItem(a))&&(f[a]=null)});h=Object.keys(f);break;case q.REMAP_KEY:if(a.old_key&&(a=b[0])){if(h=a._getFieldVal(this._childToParentName))delete this._childMap[h],a._clearFieldVal(this._childToParentName);h=this._mapChildren([a])}break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,
a.change_type));}c._notifyChildrenChanged(h)},_notifyChildrenChanged:function(a){this._notifyChanged([],a)},_notifyParentChanged:function(a){this._notifyChanged(a,[])},_notifyChanged:function(a,c){var b=this;if(0<a.length||0<c.length)a.forEach(function(a){var c=b._changed[a];b._changed[a]=c?c|1:1}),c.forEach(function(a){var c=b._changed[a];b._changed[a]=c?c|2:2}),this._changedTimeout||(this._changedTimeout=setTimeout(function(){b._changedTimeout=null;var a=b._changed;b._changed={};Object.keys(a).forEach(function(c){var f=
a[c];1==(f&1)&&b._onParentChanged(c);2==(f&2)&&b._onChildrenChanged(c)})},100))},_onChildFill:function(a){a.isBegin?this._isChildFilling=!0:(this._isChildFilling=!1,a=a.resetUI?this.refreshChildMap():this._mapChildren(a.newItems),this._notifyChildrenChanged(a))},_onChildEdit:function(a,c,b){c?this._storeChildFKey(a):b?this._saveChildFKey=null:this._checkChildFKey(a)},_onChildCommitChanges:function(a,c,b,h){c?b&&h===f.ADDED?(a=this._unMapChildItem(a))&&this._notifyChildrenChanged([a]):!b&&h===f.DELETED?
(a=this._unMapChildItem(a))&&this._notifyChildrenChanged([a]):this._storeChildFKey(a):this._checkChildFKey(a)},_storeChildFKey:function(a){var c=this.getChildFKey(a),b;if(c&&(b=this._childMap[c])&&-1<b.indexOf(a))this._saveChildFKey=c},_checkChildFKey:function(a){var c=this._saveChildFKey,b,h,f;this._saveChildFKey=null;b=this.getChildFKey(a);b!==c&&(c&&(h=this._childMap[c],f=h.indexOf(a),-1<f&&h.splice(f,1),0==h.length&&delete this._childMap[c],this._notifyParentChanged([c]),this._notifyChildrenChanged([c])),
b&&(this._mapChildren([a]),this._notifyParentChanged([b]),this._notifyChildrenChanged([b])))},_onChildStatusChanged:function(a,c){var b=f.DELETED,h=a._changeType,d=this.getChildFKey(a);d&&h===b&&(d=this._unMapChildItem(a))&&this._notifyChildrenChanged([d])},_getItemKey:function(a,c,b){for(var h=[],f,d=0,e=a.length;d<e;d+=1){f=b[a[d].fieldName];f=c._getStrValue(f,a[d]);if(null===f)return null;h.push(f)}return h.join(";")},_resetChildMap:function(){var a=Object.keys(this._childMap);this._childMap={};
this._notifyChildrenChanged(a)},_resetParentMap:function(){var a=Object.keys(this._parentMap);this._parentMap={};this._notifyParentChanged(a)},_unMapChildItem:function(a){var c,b,h=null;if(c=this.getChildFKey(a))if(b=this._childMap[c])a=b.indexOf(a),-1<a&&(b.splice(a,1),0==b.length&&delete this._childMap[c],h=c);return h},_unMapParentItem:function(a){var c=null;if((a=this.getParentFKey(a))&&this._parentMap[a])delete this._parentMap[a],c=a;return c},_mapParentItems:function(a){for(var c,b,h=f.DELETED,
d,e={},n=0,g=a.length;n<g;n+=1)if(c=a[n],b=c._changeType,b!==h&&(b=this.getParentFKey(c)))d=this._parentMap[b],d!==c&&(this._parentMap[b]=c,e[b]=null);return Object.keys(e)},_onChildrenChanged:function(a){a&&this._parentToChildrenName&&(a=this._parentMap[a])&&a.raisePropertyChanged(this._parentToChildrenName)},_onParentChanged:function(a){var c=this;a&&this._childToParentName&&(a=this._childMap[a])&&a.forEach(function(a){a.raisePropertyChanged(c._childToParentName)})},_mapChildren:function(a){for(var c,
b,h,d=f.DELETED,e={},n=0,g=a.length;n<g;n+=1)if(c=a[n],b=c._changeType,b!==d&&(b=this.getChildFKey(c)))h=this._childMap[b],h||(h=[],this._childMap[b]=h),0>h.indexOf(c)&&(h.push(c),e[b]||(e[b]=null));return Object.keys(e)},_unbindParentDS:function(){var a=this.parentDS;a&&a.removeNSHandlers(this._objId)},_unbindChildDS:function(){var a=this.childDS;a&&a.removeNSHandlers(this._objId)},getParentFKey:function(a){return a&&a._isNew?a._key:this._getItemKey(this._parentFldInfos,this._parentDS,a)},getChildFKey:function(a){if(a&&
this._childToParentName){var c=a._getFieldVal(this._childToParentName);if(c)return c}return this._getItemKey(this._childFldInfos,this._childDS,a)},getChildItems:function(a){if(!a)return[];a=this.getParentFKey(a);a=this._childMap[a];return!a?[]:a},getParentItem:function(a){if(!a)return null;a=this.getChildFKey(a);return(a=this._parentMap[a])?a:null},refreshParentMap:function(){this._resetParentMap();return this._mapParentItems(this._parentDS.items)},refreshChildMap:function(){this._resetChildMap();
return this._mapChildren(this._childDS.items)},destroy:function(){this._isDestroying=!0;clearTimeout(this._changedTimeout);this._changedTimeout=null;this._changed={};this._unbindParentDS();this._unbindChildDS();this._childFldInfos=this._parentFldInfos=this._childMap=this._parentMap=null;this._super()},toString:function(){return"Association: "+this._name}},{app:{get:function(){return this._app}},name:{get:function(){return this._name}},parentToChildrenName:{get:function(){return this._parentToChildrenName}},
childToParentName:{get:function(){return this._childToParentName}},parentDS:{get:function(){return this._parentDS}},childDS:{get:function(){return this._childDS}},parentFldInfos:{get:function(){return this._parentFldInfos}},childFldInfos:{get:function(){return this._childFldInfos}},onDeleteAction:{get:function(){return this._onDeleteAction}}},function(a){g.Association=a});y.extend({_create:function(a){this._refreshTimeout=this._parentItem=null;this._association=a.association;a.dataSource=this._association.childDS;
var c=this,b=this._association,h=a.fn_filter;a.fn_filter=function(a){if(!c._parentItem)return!1;var f=b.getParentFKey(c._parentItem);if(!f)return!1;var d=b.getChildFKey(a);return!d||f!==d?!1:h?h(a):!0};this._super(a)},_refresh:function(){var a=this;this._dataSource&&(clearTimeout(a._refreshTimeout),a._refreshTimeout=setTimeout(function(){var c=a._association.getChildItems(a._parentItem);a._fn_filter&&(c=c.filter(a._fn_filter));a._fn_sort&&(c=c.sort(a._fn_sort));a._fillItems({items:c,isPageChanged:!1,
clear:!0,isAppend:!1});a._onViewRefreshed({})},250))},destroy:function(){clearTimeout(this._refreshTimeout);this._association=null;this._super()},toString:function(){return this._association?"ChildDataView for "+this._association.toString():"ChildDataView"}},{parentItem:{set:function(a){this._parentItem!==a&&(this._parentItem=a,this.raisePropertyChanged("parentItem"),0<this.items.length&&(this.clear(),this._onViewRefreshed({})),this._refresh())},get:function(){return this._parentItem}},association:{get:function(){return this._association}}},
function(a){g.ChildDataView=a;b.registerType("ChildDataView",a)})};
RIAPP.Application._coreModules.datadialog=function(b){var g=this,e=b.global,l=e.utils,k=RIAPP.localizable.TEXT,m=b.modules.db,a=b.modules.template.Template,d={DIALOG_ACTION:{Default:0,StayOpen:1}};Object.freeze(d.DIALOG_ACTION);Object.freeze(d);g.consts=d;RIAPP.BaseObject.extend({_app:b,DIALOG_ACTION:d.DIALOG_ACTION,_create:function(a){this._super();var b=this;this._objId="dlg"+this._app.getNewObjectID();a=l.extend(!1,{dataContext:null,dbContext:null,templateID:null,width:500,height:350,title:"data edit dialog",
submitOnOK:!1,canRefresh:!1,canCancel:!0,fn_OnClose:null,fn_OnOK:null,fn_OnCancel:null,fn_OnTemplateCreated:null},a);this._dataContext=a.dataContext;this._dbContext=a.dbContext||this._app.dbContext;this._templateID=a.templateID;this._submitOnOK=a.submitOnOK;this._canRefresh=a.canRefresh;this._canCancel=a.canCancel;this._fn_OnClose=a.fn_OnClose;this._fn_OnOK=a.fn_OnOK;this._fn_OnShow=a.fn_OnShow;this._fn_OnCancel=a.fn_OnCancel;this._fn_OnTemplateCreated=a.fn_OnTemplateCreated;this._isEditable=!1;this._result=
this._$template=this._template=null;this._fn_submitOnOK=function(){var a=b._dbContext;if(!a)return l.createDeferred().resolve();a.addHandler("submit_error",function(a,c){m.SubmitError.isPrototypeOf(c.error)&&0<c.error.notValidated.length&&(c.isHandled=!0)},b._objId);var c=a.submitChanges();c.always(function(){a.removeHandler("submit_error",b._objId)});return c};this._updateIsEditable();this._options={width:a.width,height:a.height,title:a.title,autoOpen:!1,modal:!0,close:function(a,c){b._onClose()},
buttons:b._getButtons()};this._dialogCreated=!1;this._createDialog()},_updateIsEditable:function(){var a=this._dataContext;this._isEditable=a?!!a.endEdit&&!!a.cancelEdit:!1},_createDialog:function(){this._dialogCreated||(this._template=this._createTemplate(this._dataContext),this._$template=e.$(this._template.el),e.document.body.appendChild(this._template.el),this._$template.dialog(this._options),this._dialogCreated=!0,this._fn_OnTemplateCreated&&this._fn_OnTemplateCreated(this._template))},_getEventNames:function(){var a=
this._super();return["close","refresh"].concat(a)},_createTemplate:function(c){var b=a.create(this._templateID);b.isDisabled=!0;b.dataContext=c;return b},_getButtons:function(){var a=this,b=[{id:a._objId+"Refresh",text:k.txtRefresh,"class":"btn btn-info",click:function(){a._onRefresh()}},{id:a._objId+"Ok",text:k.txtOk,"class":"btn btn-info",click:function(){a._onOk()}},{id:a._objId+"Cancel",text:k.txtCancel,"class":"btn btn-info",click:function(){a._onCancel()}}];this.canRefresh||b.shift();this.canCancel||
b.pop();return b},_getOkButton:function(){return $("#"+this._objId+"Ok")},_getCancelButton:function(){return $("#"+this._objId+"Cancel")},_getRefreshButton:function(){return $("#"+this._objId+"Refresh")},_getAllButtons:function(){return[this._getOkButton(),this._getCancelButton(),this._getRefreshButton()]},_disableButtons:function(a){this._getAllButtons().forEach(function(b){b.prop("disabled",!!a)})},_onOk:function(){var a=this,b;b=d.DIALOG_ACTION.Default;this._fn_OnOK&&(b=this._fn_OnOK(this));if(b!=
d.DIALOG_ACTION.StayOpen)if(this._dataContext){if(b=this._isEditable?this._dataContext.endEdit():!0)if(this._submitOnOK){this._disableButtons(!0);var e=this.title;this.title=k.txtSubmitting;b=this._fn_submitOnOK();b.always(function(){a._disableButtons(!1);a.title=e});b.done(function(){a._result="ok";a.hide()});b.fail(function(){a._isEditable&&a._dataContext.beginEdit()})}else a._result="ok",a.hide()}else a.hide()},_onCancel:function(){var a=d.DIALOG_ACTION.Default;this._fn_OnCancel&&(a=this._fn_OnCancel(this));
a!=d.DIALOG_ACTION.StayOpen&&(this._result="cancel",this.hide())},_onRefresh:function(){var a={isHandled:!1};this.raiseEvent("refresh",a);a.isHandled||this._dataContext&&this._dataContext.refresh&&this._dataContext.refresh()},_onClose:function(){try{"ok"!=this._result&&this._dataContext&&(this._isEditable&&this._dataContext.cancelEdit(),this._submitOnOK&&this._dataContext.rejectChanges&&this._dataContext.rejectChanges()),this._fn_OnClose&&this._fn_OnClose(this),this.raiseEvent("close",{})}finally{this._template.isDisabled=
!0}},show:function(){this._result=null;this._$template.dialog("option","buttons",this._getButtons());this._template.isDisabled=!1;this._fn_OnShow&&this._fn_OnShow(this);this._$template.dialog("open")},hide:function(){this._$template.dialog("close")},getOption:function(a){return this._$template.dialog("option",a)},setOption:function(a,b){this._$template.dialog("option",a,b)},destroy:function(){this._dialogCreated&&(this.hide(),this._$template.remove(),this._template.destroy(),this._template=this._$template=
null,this._dialogCreated=!1);this._fn_submitOnOK=this._dbContext=this._dataContext=null;this._super()}},{app:{get:function(){return this._app}},dataContext:{set:function(a){a!==this._dataContext&&(this._dataContext=a,this._template&&(this._template.dataContext=this._dataContext),this._updateIsEditable(),this.raisePropertyChanged("dataContext"))},get:function(){return this._dataContext}},result:{get:function(){return this._result}},template:{get:function(){return this._template}},isSubmitOnOK:{set:function(a){this._submitOnOK!==
a&&(this._submitOnOK=a,this.raisePropertyChanged("isSubmitOnOK"))},get:function(){return this._submitOnOK}},width:{set:function(a){var b=this.getOption("width");a!==b&&(this.setOption("width",a),this.raisePropertyChanged("width"))},get:function(){return this.getOption("width")}},height:{set:function(a){var b=this.getOption("height");a!==b&&(this.setOption("height",a),this.raisePropertyChanged("height"))},get:function(){return this.getOption("height")}},title:{set:function(a){var b=this.getOption("title");
a!==b&&(this.setOption("title",a),this.raisePropertyChanged("title"))},get:function(){return this.getOption("title")}},canRefresh:{set:function(a){a!==this._canRefresh&&(this._canRefresh=a,this.raisePropertyChanged("canRefresh"))},get:function(){return this._canRefresh}},canCancel:{set:function(a){a!==this._canCancel&&(this._canCancel=a,this.raisePropertyChanged("canCancel"))},get:function(){return this._canCancel}}},function(a){g.DataEditDialog=a;b.registerType("DataEditDialog",a)})};
RIAPP.Application._coreModules.datagrid=function(b){var g=this,e=b.global,l=e.utils,k=e.consts,m,a,d,c,f,s,q,p,u,n,v,w,y=b.modules.collection,z=b.modules.datadialog.DataEditDialog,t=b.modules.template.Template,x=RIAPP.localizable.TEXT,r={container:"ria-table-container",dataTable:"ria-data-table",columnInfo:"ria-col-info",column:"ria-ex-column",cellDiv:"cell-div",headerDiv:"ria-table-header",wrapDiv:"ria-table-wrap",dataColumn:"data-column",rowCollapsed:"row-collapsed",rowExpanded:"row-expanded",rowExpander:"row-expander",
columnSelected:"selected",rowSelected:"selected",rowActions:"row-actions",rowDetails:"row-details",rowSelector:"row-selector",rowHighlight:"row-highlight",rowDeleted:"row-deleted",rowError:"row-error",nobr:"ria-nobr",colSortable:"sortable",colSortAsc:"sort-asc",colSortDesc:"sort-desc"};Object.freeze(r);g.css=r;m=RIAPP.BaseObject.extend({_app:b,_create:function(a,c){this._super();this._row=a;this._el=c.td;this._column=c.column;this._div=e.document.createElement("div");var b=e.$(this._div);this._clickTimeOut=
null;b.addClass(r.cellDiv).attr(k.DATA_ATTR.DATA_EVENT_SCOPE,this._column.uniqueID);this._div.cell=this;this._column.options.width&&(this._el.style.width=this._column.options.width);this._init();this._column.options.rowCellCss&&b.addClass(this._column.options.rowCellCss);this._el.appendChild(this._div);this._row.el.appendChild(this._el)},_init:function(){},_onCellClicked:function(){this.grid.currentRow=this._row},_onDblClicked:function(){this.grid.currentRow=this._row;this.grid._onCellDblClicked(this)},
_onError:function(a,c){var b=this._super(a,c);return!b?this.row._onError(a,c):b},scrollIntoView:function(a){this._div.scrollIntoView(!!a)},destroy:function(){this._isDestroyed||(this._isDestroying=!0,e.$(this._div).remove(),this._column=this._el=this._row=this._div=this._div.cell=null,this._super())},toString:function(){return"BaseCell"}},{el:{get:function(){return this._el}},row:{get:function(){return this._row}},column:{get:function(){return this._column}},grid:{get:function(){return this._row.grid}},
app:{get:function(){return this._app}},item:{get:function(){return this._row.item}}},function(a){g.BaseCell=a});c=m.extend({_create:function(a,c){this._stateCss=this._content=null;this._super(a,c)},_init:function(){var a=this._column.options.content;if(!a.fieldInfo&&a.fieldName&&(a.fieldInfo=this.item.getFieldInfo(a.fieldName),!a.fieldInfo))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,"",a.fieldName));a.initContentFn=null;try{var c=this.app._getContentType(a);this.app.modules.content.LookupContent===
c&&(a.initContentFn=this._getInitLookUpFn());this._content=this.app._getContent(c,a,this._div,this.item,this.item.isEditing)}finally{delete a.initContentFn}},_getInitLookUpFn:function(){var a=this;return function(c){c.addHandler("listbox_created",function(c,b){a._column._listBox=b.listBox;b.isCachedExternally=!!a._column._listBox});c.addHandler("need_listbox",function(c,b){b.listBox=a._column._listBox})}},_beginEdit:function(){this._content.isEditing||(this._content.isEditing=!0)},_endEdit:function(a){this._content.isEditing&&
(this._content.isEditing=!1)},_setState:function(a){var c;this._stateCss!==a&&(c=e.$(this._div),this._stateCss&&c.removeClass(this._stateCss),(this._stateCss=a)&&c.addClass(this._stateCss))},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._content&&(this._content.destroy(),this._content=null),this._initLookUpFn=null,this._super())},toString:function(){return"DataCell"}},null,function(a){g.DataCell=a});s=m.extend({_init:function(){var a=e.$(this.el);a.addClass(r.rowCollapsed);a.addClass(r.rowExpander)},
_onCellClicked:function(){this._row&&(this._super(),this._row.isExpanded=!this._row.isExpanded)},_toggleImage:function(){var a=e.$(this.el);this._row.isExpanded?(a.removeClass(r.rowCollapsed),a.addClass(r.rowExpanded)):(a.removeClass(r.rowExpanded),a.addClass(r.rowCollapsed))},toString:function(){return"ExpanderCell"}},null,function(a){g.ExpanderCell=a});q=m.extend({_create:function(a,c){this._isEditing=!1;this._super(a,c)},_init:function(){var a=e.$(this.el),c=e.$(this._div);a.addClass([r.rowActions,
r.cellDiv,r.nobr].join(" "));c.on("mouseenter","img",function(a){a.stopPropagation();$(this).css("opacity",0.5)});c.on("mouseout","img",function(a){a.stopPropagation();$(this).css("opacity",1)});this._createButtons(!1)},destroy:function(){if(!this._isDestroyed){this._isDestroying=!0;for(var a=this._div.getElementsByTagName("img"),c=0,b=a.length;c<b;c+=1)a[c].cell=null;this._super()}},_createButtons:function(a){if(this._el){var c=this,b=e.$,f=e.$(this._div),d={img_ok:"txtOk",img_cancel:"txtCancel",
img_edit:"txtEdit",img_delete:"txtDelete"};f.empty();var n=c._column.options;a?(this._isEditing=!0,a=b('<img name="img_ok" alt="ok"/>&nbsp;<img name="img_cancel" alt="cancel"/>')):(this._isEditing=!1,a=b('<img name="img_edit" alt="edit"/>&nbsp;<img name="img_delete" alt="delete"/>'),c.isCanEdit||(a=a.not('img[name="img_edit"]')),c.isCanDelete||(a=a.not('img[name="img_delete"]')));(function(a){a.each(function(a,f){var h=e.$(f);f.style.cursor="pointer";f.src=n[f.name];f.cell=c;l.addToolTip(h,x[d[f.name]]);
b(f).attr(k.DATA_ATTR.DATA_EVENT_SCOPE,c._column.uniqueID)})})(a.filter("img"));f.append(a)}},update:function(){this._row&&this._isEditing!=this._row.isEditing&&this._createButtons(this._row.isEditing)},toString:function(){return"ActionsCell"}},{isCanEdit:{get:function(){return this.grid.isCanEdit}},isCanDelete:{get:function(){return this.grid.isCanDelete}}},function(a){g.ActionsCell=a});p=m.extend({_init:function(){e.$(this.el).addClass(r.rowSelector);this._content=this.app.modules.content.RowSelectContent.create(this._div,
{bindingInfo:{target:null,source:null,targetPath:null,sourcePath:"isSelected",mode:"TwoWay",converter:null,converterParam:null},displayInfo:null,fieldName:"isSelected"},this.row,!0)},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._content&&(this._content.destroy(),this._content=null),this._super())},toString:function(){return"RowSelectorCell"}},null,function(a){g.RowSelectorCell=a});d=RIAPP.BaseObject.extend({_app:b,_create:function(a,c){this._super();this._row=a;this._el=c.td;
this._isDestroying=!1;this._init(c)},_init:function(a){if(a=a.details_id)this._template=t.create(a),this._el.colSpan=this.grid.columns.length,this._el.appendChild(this._template.el),this._row.el.appendChild(this._el)},destroy:function(){!this._isDestroyed&&this._el&&(this._isDestroying=!0,this._template&&(this._template.destroy(),this._template=null),this._el=this._row=null,this._super())},toString:function(){return"DetailsCell"}},{el:{get:function(){return this._el}},row:{get:function(){return this._row}},
grid:{get:function(){return this._row.grid}},app:{get:function(){return this._app}},item:{set:function(a){this._template.dataContext=a},get:function(){return this._template.dataContext}}},function(a){g.DetailsCell=a});f=RIAPP.BaseObject.extend({_app:b,_create:function(a,c){var b=this;this._super();this._grid=a;this._el=c.tr;this._item=c.item;this._cells=[];this._objId=this._grid.uniqueID+"_"+this._item._key;this._rowSelectorCell=this._actionsCell=this._expanderCell=null;this._isSelected=this._isDeleted=
this._isCurrent=!1;this._createCells();this._item.addOnDestroyed(function(a,c){b._onItemDestroyed(c)},b._objId);this.isDeleted=this._item._isDeleted;var f=function(){var a=b._grid._onRowStateChanged(b,b._item[b._grid._options.rowStateField]);b._setState(a)};this._grid._options.rowStateField&&(this._item.addOnPropertyChange(this._grid._options.rowStateField,function(a,c){f()},this._objId),f())},_onItemDestroyed:function(){this.destroy()},_onError:function(a,c){var b=this._super(a,c);return!b?this.grid._onError(a,
c):b},_createCells:function(){var a=this;this.columns.forEach(function(c){c=a._createCell(c);a._cells.push(c)})},_createCell:function(a){var b=e.document.createElement("td");n.isPrototypeOf(a)?this._expanderCell=a=s.create(this,{td:b,column:a}):v.isPrototypeOf(a)?this._actionsCell=a=q.create(this,{td:b,column:a}):w.isPrototypeOf(a)?this._rowSelectorCell=a=p.create(this,{td:b,column:a}):a=c.create(this,{td:b,column:a});return a},_onBeginEdit:function(){this._cells.forEach(function(a){c.isPrototypeOf(a)&&
a._beginEdit()});this._actionsCell&&this._actionsCell.update()},_onEndEdit:function(a){this._cells.forEach(function(b){c.isPrototypeOf(b)&&b._endEdit(a)});this._actionsCell&&this._actionsCell.update()},beginEdit:function(){return this._item.beginEdit()},endEdit:function(){return this._item.endEdit()},cancelEdit:function(){return this._item.cancelEdit()},destroy:function(){if(!this._isDestroyed){this._isDestroying=!0;var a=this._grid;a&&(this.isExpanded&&a.collapseDetails(),this._cells.forEach(function(a){a.destroy()}),
this._cells=[],a._isClearing||(a._removeRow(this),this._el&&l.removeNode(this._el)));this._item&&this._item.removeNSHandlers(this._objId);this._grid=this._el=this._expanderCell=this._item=null;this._super()}},deleteRow:function(){this._item.deleteItem()},updateErrorState:function(){var a=this._item.getIsHasErrors(),c=e.$(this.el);a?c.addClass(r.rowError):c.removeClass(r.rowError)},scrollIntoView:function(a){0<this._cells.length&&this._cells[0].scrollIntoView(a)},_setState:function(a){this.cells.forEach(function(b){c.isPrototypeOf(b)&&
b._setState(a)})},toString:function(){return"Row"}},{el:{get:function(){return this._el}},grid:{get:function(){return this._grid}},item:{get:function(){return this._item}},cells:{get:function(){return this._cells}},columns:{get:function(){return this._grid.columns}},uniqueID:{get:function(){return this._objId}},itemKey:{get:function(){return!this._item?null:this._item._key}},isCurrent:{set:function(a){if(a!==this._isCurrent){var c=e.$(this._el);(this._isCurrent=a)?c.addClass(r.rowHighlight):c.removeClass(r.rowHighlight);
this.raisePropertyChanged("isCurrent")}},get:function(){return this._isCurrent}},isSelected:{set:function(a){this._isSelected!=a&&(this._isSelected=a,this.raisePropertyChanged("isSelected"),this.grid._onRowSelectionChanged(this))},get:function(){return this._isSelected}},isExpanded:{set:function(a){a!==this.isExpanded&&(!a&&this.isExpanded?this.grid._expandDetails(this,!1):a&&this.grid._expandDetails(this,!0))},get:function(){return this.grid._expandedRow===this}},expanderCell:{get:function(){return this._expanderCell}},
actionsCell:{get:function(){return this._actionsCell}},isDeleted:{set:function(a){this._el&&this._isDeleted!==a&&((this._isDeleted=a)?(this.isExpanded=!1,e.$(this._el).addClass(r.rowDeleted)):e.$(this._el).removeClass(r.rowDeleted))},get:function(){return!this._el?!0:this._isDeleted}},isEditing:{get:function(){return this._item._isEditing}}},function(a){g.Row=a});a=RIAPP.BaseObject.extend({_app:b,_create:function(a,c){this._super();this._grid=a;this._el=c.tr;this._parentRow=this._cell=this._item=
null;this._objId="drow"+this.grid.app.getNewObjectID();this._createCell(c.details_id);this.$el=e.$(this._el);this.$el.addClass(r.rowDetails)},_createCell:function(a){var c=e.document.createElement("td");this._cell=d.create(this,{td:c,details_id:a})},destroy:function(){!this._isDestroyed&&this.el&&(this._isDestroying=!0,l.removeNode(this.el),this._cell&&(this._cell.destroy(),this._cell=null),this._grid=this._el=this._item=null,this._super())},_setParentRow:function(a){var c=this;this._item=null;this._cell.item=
null;l.removeNode(this.el);if(this._parentRow=a)this._item=this._parentRow.item,this._cell.item=this._item,l.insertAfter(this._parentRow.el,this.el),e.$(this._cell._template.el).slideDown("fast",function(){c._parentRow&&c.grid._options.isUseScrollIntoDetails&&c._parentRow.scrollIntoView(!0)})},toString:function(){return"DetailsRow"}},{el:{get:function(){return this._el}},grid:{get:function(){return this._grid}},item:{set:function(a){this._item!==a&&(this._item=a)},get:function(){return this._item}},
cell:{get:function(){return this._cell}},uniqueID:{get:function(){return this._objId}},itemKey:{get:function(){return!this._item?null:this._item._key}},parentRow:{set:function(a){var c=this;if(a!==this._parentRow){var b=e.$(this._cell._template.el);this._parentRow?b.slideUp("fast",function(){c._setParentRow(a)}):c._setParentRow(a)}},get:function(){return this._parentRow}}},function(a){g.DetailsRow=a});m=RIAPP.BaseObject.extend({_app:b,_create:function(a,b){this._super();var f=this;this._grid=a;this._el=
b.th;this._options=b.colinfo;this._isSelected=!1;this._objId="col"+this.app.getNewObjectID();var d=e.$("<div></div>");d.addClass(r.column);this._grid._headerDiv.append(d);this._extcol=d;var n=e.$("<div></div>");n.addClass(r.cellDiv).click(function(c){c.stopPropagation();e.currentSelectable=a;a._setCurrentColumn(f);f._onColumnClicked()});d.append(n);n.get(0).cell=this;this._div=n;e.$(this.grid._tableEl).on("click","div["+k.DATA_ATTR.DATA_EVENT_SCOPE+'="'+this.uniqueID+'"]',function(b){b.stopPropagation();
var d=this.cell;d&&(e.currentSelectable=a,a._setCurrentColumn(f),c.isPrototypeOf(d)?null!==d._clickTimeOut?(clearTimeout(d._clickTimeOut),d._clickTimeOut=null,d._onDblClicked()):(d._onCellClicked(),d._clickTimeOut=setTimeout(function(){d._clickTimeOut=null},350)):d._onCellClicked())});this._options.width&&(this._el.style.width=this._options.width);this._init();this._options.colCellCss&&n.addClass(this._options.colCellCss)},_init:function(){this.title&&this._div.html(this.title)},destroy:function(){!this._isDestroyed&&
this.el&&(this._isDestroying=!0,this._extcol.remove(),this._extcol=null,this._grid=this._el=this._item=this._div=this._div.get(0).cell=null,this._super())},scrollIntoView:function(a){this._div&&this._div.get(0).scrollIntoView(!!a)},_onColumnClicked:function(){},toString:function(){return"BaseColumn"}},{uniqueID:{get:function(){return this._objId}},app:{get:function(){return this._app}},el:{get:function(){return this._el}},$div:{get:function(){return this._div}},$extcol:{get:function(){return this._extcol}},
grid:{get:function(){return this._grid}},options:{get:function(){return this._options}},title:{get:function(){return this._options.title}},isSelected:{set:function(a){this._isSelected!==a&&((this._isSelected=a)?this._div.addClass(r.columnSelected):this._div.removeClass(r.columnSelected))},get:function(){return this._isSelected}}},function(a){g.BaseColumn=a});u=m.extend({_create:function(a,c){this._super(a,c);this._listBox=null;this.$div.addClass(r.dataColumn)},_init:function(){this._super();this.isSortable&&
this.$div.addClass(r.colSortable);this._sortOrder=null},_onColumnClicked:function(){if(this.isSortable&&this.sortMemberName){var a=this._sortOrder;this.grid._resetColumnsSort();this.sortOrder="ASC"==a?"DESC":"ASC";this.grid._sortByColumn(this)}},destroy:function(){!this._isDestroyed&&this.el&&(this._isDestroying=!0,this._listBox&&(this._listBox.destroy(),this._listBox=null),this._super())},toString:function(){return"DataColumn"}},{isSortable:{get:function(){return this._options.sortable}},sortMemberName:{get:function(){return this._options.sortMemberName}},
sortOrder:{set:function(a){var c=this.$div;c.removeClass(r.colSortable).removeClass(r.colSortAsc).removeClass(r.colSortDesc);switch(a){case "ASC":c.addClass(r.colSortAsc);break;case "DESC":c.addClass(r.colSortDesc);break;default:this.isSortable&&c.addClass(r.colSortable)}this._sortOrder=a},get:function(){return this._sortOrder}}},function(a){g.DataColumn=a});n=m.extend({_init:function(){this._super();this.$div.addClass(r.rowExpander)},toString:function(){return"ExpanderColumn"}},null,function(a){g.ExpanderColumn=
a});v=m.extend({_init:function(){this._super();var a=this,c=this.options;this.$div.addClass(r.rowActions);c.img_ok=e.getImagePath(c.img_ok||"ok.png");c.img_cancel=e.getImagePath(c.img_cancel||"cancel.png");c.img_edit=e.getImagePath(c.img_edit||"edit.png");c.img_delete=e.getImagePath(c.img_delete||"delete.png");e.$(this.grid._tableEl).on("click","img["+k.DATA_ATTR.DATA_EVENT_SCOPE+'="'+this.uniqueID+'"]',function(c){c.stopPropagation();c=this.cell;switch(this.name){case "img_ok":a._onOk(c);break;case "img_cancel":a._onCancel(c);
break;case "img_edit":a._onEdit(c);break;case "img_delete":a._onDelete(c)}})},_onOk:function(a){a._row&&(a._row.endEdit(),a.update())},_onCancel:function(a){a._row&&(a._row.cancelEdit(),a.update())},_onDelete:function(a){a._row&&a._row.deleteRow()},_onEdit:function(a){a._row&&(a._row.beginEdit(),a.update(),this.grid.showEditDialog())},toString:function(){return"ActionsColumn"}},null,function(a){g.ActionsColumn=a});w=m.extend({_init:function(){this._super();var a=this;this._val=!1;this.$div.addClass(r.rowSelector);
var c=e.$('<input type="checkbox"/>');this.$div.append(c);this._chk=c;c.click(function(c){c.stopPropagation();a._onCheckBoxClicked(this.checked)});c.on("change",function(c){c.stopPropagation();a.checked=this.checked})},_onCheckBoxClicked:function(a){this.grid._selectRows(a)},toString:function(){return"RowSelectorColumn"}},{checked:{set:function(a){var c=this._chk;null!==a&&(a=!!a);a!==this._val&&(this._val=a,c&&(c[0].checked=!!this._val),this.raisePropertyChanged("checked"))},get:function(){return this._val}}},
function(a){g.RowSelectorColumn=a});RIAPP.BaseObject.extend({_app:b,_create:function(a,c,b){this._super();if(c&&!y.Collection.isPrototypeOf(c))throw Error(RIAPP.ERRS.ERR_GRID_DATASRC_INVALID);this._options=l.extend(!1,{isUseScrollInto:!0,isUseScrollIntoDetails:!0,containerCss:null,wrapCss:null,headerCss:null,rowStateField:null,isCanEdit:null,isCanDelete:null,isHandleAddNew:!1},b);b=e.$(a);this._tableEl=a;this._$tableEl=b;b.addClass(r.dataTable);this._name=b.attr(k.DATA_ATTR.DATA_NAME);this._objId=
"grd"+this._app.getNewObjectID();this._dataSource=c;this._rowMap={};this._rows=[];this._columns=[];this._isDSFilling=this._isClearing=!1;this._editingRow=this._currentColumn=this._rowSelectorCol=this._actionsCol=this._expanderCol=this._details=this._expandedRow=this._currentRow=null;this._isSorting=!1;this._contaner=this._wrapDiv=this._chkWidthInterval=this._headerDiv=this._dialog=null;this._wrapTable();this._createColumns();this._bindDS();this._app._types._registerGrid(this);this._refreshGrid();
this._updateColsDim()},_getEventNames:function(){var a=this._super();return["row_expanded","row_selected","page_changed","row_state_changed","cell_dblclicked"].concat(a)},_setCurrentColumn:function(a){this._currentColumn&&(this._currentColumn.isSelected=!1);if(this._currentColumn=a)this._currentColumn.isSelected=!0},_parseColumnAttr:function(a,c){var b={type:"data",title:null,sortable:!1,sortMemberName:null,content:{}},f=this._app.parser.parseOptions(a),b=0<f.length?l.extend(!0,b,f[0]):b;c&&(b.content=
this._app._parseContentAttr(c),!b.sortMemberName&&b.content.fieldName&&(b.sortMemberName=b.content.fieldName));return b},_findUndeleted:function(a,c){if(!a)return null;if(!a.isDeleted)return a;var b=this.rows.indexOf(a),f=this.rows.length;if(c){b+=1;for(b<f&&(a=this.rows[b]);b<f&&a.isDeleted;)b+=1,b<f&&(a=this.rows[b])}else{b-=1;for(0<=b&&(a=this.rows[b]);0<=b&&a.isDeleted;)b-=1,0<=b&&(a=this.rows[b])}a.isDeleted&&(a=null);return a},_updateCurrent:function(a,c){this.currentRow=a;c&&(a&&!a.isDeleted)&&
this._scrollToCurrent(!0)},_scrollToCurrent:function(a){var c=this.currentRow;c&&c.scrollIntoView(a)},_onRowStateChanged:function(a,c){var b={row:a,val:c,css:null};this.raiseEvent("row_state_changed",b);return b.css},_onCellDblClicked:function(a){this.raiseEvent("cell_dblclicked",{cell:a})},_onError:function(a,c){var b=this._super(a,c);return!b?this._app._onError(a,c):b},_onDSCurrentChanged:function(a){(a=this._dataSource.currentItem)?this._updateCurrent(this._rowMap[a._key],!1):this._updateCurrent(null,
!1)},_onDSCollectionChanged:function(a){var c=this,b;b=y.consts.COLL_CHANGE_TYPE;var f=a.items;switch(a.change_type){case b.RESET:this._isDSFilling||this._refreshGrid();break;case b.ADDED:this._isDSFilling||c._appendItems(a.items,a.pos);break;case b.REMOVE:f.forEach(function(a){(a=c._rowMap[a._key])&&c._removeRow(a)});break;case b.REMAP_KEY:if(b=c._rowMap[a.old_key])delete c._rowMap[a.old_key],c._rowMap[a.new_key]=b;break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,
a.change_type));}},_onDSFill:function(a){var c=this;a.isBegin?(c._isDSFilling=!0,c._isSorting?c._isSorting=!1:a.isPageChanged||c._resetColumnsSort()):(c._isDSFilling=!1,a.resetUI?c._refreshGrid():c._appendItems(a.newItems),a.isPageChanged&&setTimeout(function(){c._onPageChanged()},100),setTimeout(function(){c._updateColsDim()},200))},_onPageChanged:function(){this._rowSelectorCol&&(this._rowSelectorCol.checked=!1);this._scrollToCurrent(!1);this.raiseEvent("page_changed",{})},_onItemEdit:function(a,
c,b){if(a=this._rowMap[a._key])c?(a._onBeginEdit(),this._editingRow=a):(a._onEndEdit(b),this._editingRow=null),this.raisePropertyChanged("editingRow")},_onItemAdded:function(a){var c=this._rowMap[a.item._key];c&&(this._updateCurrent(c,!0),this._options.isHandleAddNew&&!a.isAddNewHandled&&(a.isAddNewHandled=this.showEditDialog()))},_onItemStatusChanged:function(a,c){var b=k.CHANGE_TYPE.DELETED,f=a._changeType,d=this._dataSource,e=this._rowMap[a._key];e&&(f===b?(e.isDeleted=!0,(b=this._findUndeleted(e,
!0))||(b=this._findUndeleted(e,!1)),b&&(d.currentItem=b.item)):c===b&&f!==b&&(e.isDeleted=!1))},_onRowSelectionChanged:function(a){this.raiseEvent("row_selected",{row:a})},_onDSErrorsChanged:function(a){(a=this._rowMap[a._key])&&a.updateErrorState()},_resetColumnsSort:function(){this.columns.forEach(function(a){u.isPrototypeOf(a)&&(a.sortOrder=null)})},_bindDS:function(){var a=this,c=this._dataSource;c&&(c.addHandler("coll_changed",function(b,f){c===b&&a._onDSCollectionChanged(f)},a._objId),c.addHandler("fill",
function(b,f){c===b&&a._onDSFill(f)},a._objId),c.addOnPropertyChange("currentItem",function(b,f){c===b&&a._onDSCurrentChanged(f)},a._objId),c.addHandler("begin_edit",function(b,f){c===b&&a._onItemEdit(f.item,!0,void 0)},a._objId),c.addHandler("end_edit",function(b,f){c===b&&a._onItemEdit(f.item,!1,f.isCanceled)},a._objId),c.addHandler("errors_changed",function(b,f){c===b&&a._onDSErrorsChanged(f.item)},a._objId),c.addHandler("status_changed",function(b,f){c===b&&a._onItemStatusChanged(f.item,f.oldChangeType)},
a._objId),c.addHandler("item_added",function(b,f){c===b&&a._onItemAdded(f)},a._objId))},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},_getLastRow:function(){if(0===this._rows.length)return null;for(var a=this._rows.length-1,c=this._rows[a];c.isDeleted&&0<a;)a-=1,c=this._rows[a];return c.isDeleted?null:c},_removeRow:function(a){this._expandedRow===a&&this.collapseDetails();if(0!==this._rows.length){var c=this._rows.indexOf(a);a=a.itemKey;try{if(-1<c){var b=this._rows[c];
this._rows.splice(c,1);!b._isDestroying&&!b._isDestroyed&&b.destroy()}}finally{this._rowMap[a]&&delete this._rowMap[a]}}},_clearGrid:function(){if(0!==this._rows.length){this._isClearing=!0;try{this.collapseDetails();var a=this._tBodyEl,c=e.document.createElement("tbody");this._tableEl.replaceChild(c,a);var b=this._rows;this._rows=[];this._rowMap={};b.forEach(function(a){a.destroy()})}finally{this._isClearing=!1}this._currentRow=null}},_updateColsDim:function(){if(this._isNotDestroyed()){var a=0,
c=this._headerDiv;this._columns.forEach(function(c){a+=c.el.offsetWidth});c.width(a);this._columns.forEach(function(a){a.$extcol.width(a.el.offsetWidth);a.$extcol.position({my:"left top",at:"left top",of:c,offset:""+a.el.offsetLeft+" 0"})})}},_wrapTable:function(){var a=this._$tableEl,c,b,f,d=this;a.wrap(e.$("<div></div>").addClass(r.wrapDiv));b=a.parent();b.wrap(e.$("<div></div>").addClass(r.container));f=b.parent();c=e.$("<div></div>").addClass(r.headerDiv).insertBefore(b);e.$(this._tHeadRow).addClass(r.columnInfo);
this._wrapDiv=b;this._headerDiv=c;this._contaner=f;this._options.containerCss&&f.addClass(this._options.containerCss);this._options.wrapCss&&b.addClass(this._options.wrapCss);this._options.headerCss&&c.addClass(this._options.headerCss);var n=a.width();this._chkWidthInterval=setInterval(function(){var c=a.width();n!==c&&(n=c,d._updateColsDim())},1E3)},_unWrapTable:function(){var a=this._$tableEl;this._headerDiv&&(clearInterval(this._chkWidthInterval),this._chkWidthInterval=null,this._headerDiv.remove(),
this._headerDiv=null,a.unwrap(),this._wrapDiv=null,a.unwrap(),this._contaner=null)},_createColumns:function(){for(var a=this,c=this._tHeadCells,b=c.length,f=[],d,e,n=0;n<b;n+=1)d=c[n],e=this._parseColumnAttr(d.getAttribute(k.DATA_ATTR.DATA_COLUMN),d.getAttribute(k.DATA_ATTR.DATA_CONTENT)),f.push({th:d,colinfo:e});f.forEach(function(c){(c=a._createColumn(c))&&a._columns.push(c)})},_createColumn:function(a){var c;switch(a.colinfo.type){case "row_expander":this._expanderCol||(this._expanderCol=c=n.create(this,
a));break;case "row_actions":this._actionsCol||(this._actionsCol=c=v.create(this,a));break;case "row_selector":this._rowSelectorCol||(this._rowSelectorCol=c=w.create(this,a));break;case "data":c=u.create(this,a);break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_GRID_COLTYPE_INVALID,a.colinfo.type));}return c},_appendItems:function(a){if(!this._isDestroyed)for(var c,b=this._tBodyEl,f=0,d=a.length;f<d;f+=1)c=a[f],this._rowMap[c._key]||this._createRowForItem(b,c)},_onKeyDown:function(a,c){var b=
this._dataSource,f=k.KEYS;if(b)switch(a){case f.up:c.preventDefault();b.movePrev(!0)&&this.isUseScrollInto&&this._scrollToCurrent(!1);break;case f.down:c.preventDefault();b.moveNext(!0)&&this.isUseScrollInto&&this._scrollToCurrent(!1);break;case f.pageDown:0<b.pageIndex&&(b.pageIndex-=1);break;case f.pageUp:b.pageIndex+=1;break;case f.enter:this._currentRow&&this._actionsCol&&c.preventDefault();break;case f.esc:this._currentRow&&this._actionsCol&&this._currentRow.isEditing&&c.preventDefault();break;
case f.space:this._rowSelectorCol&&(this._currentRow&&!this._currentRow.isEditing)&&c.preventDefault()}},_onKeyUp:function(a,c){var b=k.KEYS;if(this._dataSource)switch(a){case b.enter:this._currentRow&&this._actionsCol&&(this._currentRow.isEditing?this._actionsCol._onOk(this._currentRow.actionsCell):this._actionsCol._onEdit(this._currentRow.actionsCell),c.preventDefault());break;case b.esc:this._currentRow&&this._actionsCol&&this._currentRow.isEditing&&(this._actionsCol._onCancel(this._currentRow.actionsCell),
c.preventDefault());break;case b.space:this._rowSelectorCol&&(this._currentRow&&!this._currentRow.isEditing)&&(c.preventDefault(),this._currentRow.isSelected=!this._currentRow.isSelected)}},_refreshGrid:function(){var a=this,c=this._dataSource;a._clearGrid();if(c){var b=e.document.createDocumentFragment(),f=this._tBodyEl,d=e.document.createElement("tbody");c.items.forEach(function(c,f){a._createRowForItem(b,c,f)});d.appendChild(b);a._tableEl.replaceChild(d,f)}},_createRowForItem:function(a,c){var b=
e.document.createElement("tr"),b=f.create(this,{tr:b,item:c});this._rowMap[c._key]=b;this._rows.push(b);a.appendChild(b.el);return b},_createDetails:function(){var c=this._options.details.templateID,b=e.document.createElement("tr");return a.create(this,{tr:b,details_id:c})},_expandDetails:function(a,c){if(this._options.details){this._details||(this._details=this._createDetails());var b=this._expandedRow;b===a&&b&&c||(this._expandedRow=null,this._details.parentRow=null,c?(this._expandedRow=a,this._details.parentRow=
a,this._expandedRow.expanderCell._toggleImage()):(this._expandedRow=null,this._details.parentRow=null,b&&b.expanderCell._toggleImage()),b!==a&&b&&b.expanderCell._toggleImage(),this.raiseEvent("row_expanded",{old_expandedRow:b,expandedRow:a,isExpanded:c}))}},_sortByColumn:function(a){var c=this._dataSource,b=c.query,f=a.sortMemberName.split(";");if(b){b.clearSort();for(var d=0;d<f.length;d+=1)0==d?b.orderBy(f[d],a.sortOrder):b.thenBy(f[d],a.sortOrder);b.isClearPrevData=!0;b.pageIndex=0;this._isSorting=
!0;c.dbContext.load(b)}else this._isSorting=!0,c.sortLocal(f,a.sortOrder)},_selectRows:function(a){this._rows.forEach(function(c){c.isDeleted||(c.isSelected=a)})},findRowByItem:function(a){a=this._rowMap[a._key];return!a?null:a},collapseDetails:function(){if(this._details){var a=this._expandedRow;a&&(this._expandedRow=null,this._details._setParentRow(null),this.raiseEvent("row_expanded",{old_expandedRow:a,expandedRow:null,isExpanded:!1}))}},getSelectedRows:function(){var a=[];this._rows.forEach(function(c){c.isDeleted||
c.isSelected&&a.push(c)});return a},showEditDialog:function(){if(!this._options.editor||!this._options.editor.templateID||!this._editingRow)return!1;var a,c=this._editingRow.item;c.isEditing||c.beginEdit();this._dialog?this._dialog.dataContext=c:(a=l.extend(!1,{dataContext:c},this._options.editor),this._dialog=z.create(a));this._dialog.canRefresh=!!this.dataSource.permissions.canRefreshRow&&!c._isNew;this._dialog.show();return!0},scrollToCurrent:function(a){this._scrollToCurrent(a)},addNew:function(){var a=
this._dataSource;try{a.addNew(),this.showEditDialog()}catch(c){e.reThrow(c,this._onError(c,this))}},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._details&&(this._details.destroy(),this._details=null),this._dialog&&(this._dialog.destroy(),this._dialog=null),this._clearGrid(),this._app._types._unregisterGrid(this),this._unbindDS(),this._dataSource=null,this._unWrapTable(),this._$tableEl.removeClass(r.dataTable),e.$(this._tHeadRow).removeClass(r.columnInfo),this._$tableEl=this._tableEl=
null,this._super())}},{app:{get:function(){return this._app}},$container:{get:function(){return this._contaner}},_tBodyEl:{get:function(){return this._tableEl.tBodies[0]}},_tHeadEl:{get:function(){return this._tableEl.tHead}},_tFootEl:{get:function(){return this._tableEl.tFoot}},_tHeadRow:{get:function(){if(!this._tHeadEl)return[];var a=this._tHeadEl.rows;return 0===a.length?null:a[0]}},_tHeadCells:{get:function(){var a=this._tHeadRow;return!a?[]:a.cells}},uniqueID:{get:function(){return this._objId}},
name:{get:function(){return this._name}},dataSource:{set:function(a){a!==this._dataSource&&(null!==this._dataSource&&this._unbindDS(),this._clearGrid(),this._dataSource=a,null!==this._dataSource&&this._bindDS(),this.raisePropertyChanged("dataSource"))},get:function(){return this._dataSource}},rows:{get:function(){return this._rows}},columns:{get:function(){return this._columns}},currentRow:{set:function(a){var c=this._dataSource,b=this._currentRow,f=!1;c&&(b!==a&&(this._currentRow=a,b&&(b.isCurrent=
!1),a&&(a.isCurrent=!0),f=!0),a?a.item!==c.currentItem&&(c.currentItem=a.item):c.currentItem=null,f&&this.raisePropertyChanged("currentRow"))},get:function(){return this._currentRow}},editingRow:{get:function(){return this._editingRow}},isCanEdit:{get:function(){if(null!==this._options.isCanEdit)return this._options.isCanEdit;var a=this._dataSource;return!!a&&a.permissions.canEditRow}},isCanDelete:{get:function(){if(null!==this._options.isCanDelete)return this._options.isCanDelete;var a=this._dataSource;
return!!a&&a.permissions.canDeleteRow}},isCanAddNew:{get:function(){var a=this._dataSource;return!!a&&a.permissions.canAddRow}},isUseScrollInto:{set:function(a){this._options.isUseScrollInto=a},get:function(){return this._options.isUseScrollInto}}},function(a){g.DataGrid=a})};
RIAPP.Application._coreModules.pager=function(b){var g=this,e=b.global,l=e.utils,k=b.modules.collection,m={pager:"ria-data-pager",info:"pager-info",currentPage:"pager-current-page",otherPage:"pager-other-page"};Object.freeze(m);g.css=m;var a=RIAPP.localizable.PAGER,d=RIAPP.utils.format;RIAPP.BaseObject.extend({_app:b,_create:function(a,b,d){this._super();this._el=a;this._$el=e.$(this._el);this._objId="pgr"+this._app.getNewObjectID();if(b&&!k.Collection.isPrototypeOf(b))throw Error(RIAPP.ERRS.ERR_PAGER_DATASRC_INVALID);
this._dataSource=b;this._showTip=!0;this._showInfo=!1;this._showFirstAndLast=!0;this._showPreviousAndNext=!1;this._showNumbers=!0;this._rowPerPage=25;this._rowCount=0;this._currentPage=1;this._useSlider=l.check_is.nt(d.useSlider)?!0:!!d.useSlider;this._sliderSize=d.sliderSize||25;this._hideOnSinglePage=l.check_is.nt(d.hideOnSinglePage)?!0:!!d.hideOnSinglePage;this._$el.addClass(m.pager);this._dataSource&&this._bindDS()},_createElement:function(a){return e.$(e.document.createElement(a))},_render:function(){var c=
this._$el,b,e;this._clearContent();if(0!==this.rowPerPage&&(b=this.rowCount,0!=b&&(b=this.currentPage,0!=b)))if(e=this.pageCount,this.hideOnSinglePage&&1==e)c.hide();else{c.show();if(this.showInfo){var g=this._createElement("span"),k=d(a.pageInfo,b,e);g.addClass(m.info).text(k).appendTo(c)}this.showFirstAndLast&&1!=b&&c.append(this._createFirst());this.showPreviousAndNext&&1!=b&&c.append(this._createPrevious());if(this.showNumbers){var g=1,k=e,l=this.sliderSize;this.useSlider&&0<l&&(g=Math.floor((l-
1)/2),k=b+g+(l-1)%2,g=b-g,1>g&&(k+=1-g,g=1),k>e&&(g-=k-e,1>g&&(g=1),k=e));for(;g<=k;g++)g===b?c.append(this._createCurrent()):c.append(this._createOther(g))}this.showPreviousAndNext&&b!=e&&c.append(this._createNext());this.showFirstAndLast&&b!=e&&c.append(this._createLast())}},_setDSPageIndex:function(a){this.dataSource.pageIndex=a-1},_onPageSizeChanged:function(a){this.rowPerPage=a.pageSize},_onPageIndexChanged:function(a){this.currentPage=a.pageIndex+1},_onTotalCountChanged:function(a){this.rowCount=
a.totalCount},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._unbindDS(),this._clearContent(),this._$el.removeClass(m.pager),this._$el=this._el=null,this._super())},_bindDS:function(){var a=this,b=this._dataSource;b&&(b.addOnPropertyChange("pageIndex",function(d,e){b===d&&a._onPageIndexChanged(b)},a._objId),b.addOnPropertyChange("pageSize",function(d,e){b===d&&a._onPageSizeChanged(b)},a._objId),b.addOnPropertyChange("totalCount",function(d,e){b===d&&a._onTotalCountChanged(b)},a._objId),
this._currentPage=b.pageIndex+1,this._rowPerPage=b.pageSize,this._rowCount=b.totalCount,this._render())},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},_clearContent:function(){this._$el.empty()},_createLink:function(a,b,d){var e=this._createElement("a"),g=this;e.text(""+b);e.attr("href","javascript:void(0)");d&&l.addToolTip(e,d);e.click(function(b){b.preventDefault();g._setDSPageIndex(a);g.currentPage=a});return e},_createFirst:function(){var c=this._createElement("span"),
b;this.showTip&&(b=a.firstPageTip);b=this._createLink(1,a.firstText,b);c.addClass(m.otherPage).append(b);return c},_createPrevious:function(){var c=this._createElement("span"),b=this.currentPage-1,e;this.showTip&&(e=d(a.prevPageTip,b));b=this._createLink(b,a.previousText,e);c.addClass(m.otherPage).append(b);return c},_createCurrent:function(){var a=this._createElement("span"),b=this.currentPage;a.text(""+b);this.showTip&&l.addToolTip(a,this._buildTip(b));a.addClass(m.currentPage);return a},_createOther:function(a){var b=
this._createElement("span"),d;this.showTip&&(d=this._buildTip(a));a=this._createLink(a,a,d);b.addClass(m.otherPage);b.append(a);return b},_createNext:function(){var c=this._createElement("span"),b=this.currentPage+1,e;this.showTip&&(e=d(a.nextPageTip,b));b=this._createLink(b,a.nextText,e);c.addClass(m.otherPage).append(b);return c},_createLast:function(){var c=this._createElement("span"),b;this.showTip&&(b=a.lastPageTip);b=this._createLink(this.pageCount,a.lastText,b);c.addClass(m.otherPage).append(b);
return c},_buildTip:function(c){var b=this.rowPerPage,e=this.rowCount,g=(c-1)*b+1,b=c==this.pageCount?e:c*b,k="";return k=c==this.currentPage?d(a.showingTip,g,b,e):d(a.showTip,g,b,e)},toString:function(){return"Pager"}},{el:{get:function(){return this._el}},app:{get:function(){return this._app}},dataSource:{set:function(a){a!==this._dataSource&&(null!==this._dataSource&&this._unbindDS(),this._dataSource=a,null!==this._dataSource&&this._bindDS(),this.raisePropertyChanged("dataSource"))},get:function(){return this._dataSource}},
pageCount:{get:function(){var a=this.rowCount,b=this.rowPerPage;return 0===a||0===b?0:0===a%b?a/b:a=Math.floor(a/b)+1}},rowCount:{set:function(a){this._rowCount!=a&&(this._rowCount=a,this._render(),this.raisePropertyChanged("rowCount"))},get:function(){return this._rowCount}},rowPerPage:{set:function(a){this._rowPerPage!=a&&(this._rowPerPage=a,this._render())},get:function(){return this._rowPerPage}},currentPage:{set:function(a){this._currentPage!=a&&(this._currentPage=a,this._render(),this.raisePropertyChanged("currentPage"))},
get:function(){return this._currentPage}},useSlider:{set:function(a){this._useSlider!=a&&(this._useSlider=a,this._render())},get:function(){return this._useSlider}},sliderSize:{set:function(a){this._sliderSize!=a&&(this._sliderSize=a,this._render())},get:function(){return this._sliderSize}},hideOnSinglePage:{set:function(a){this._hideOnSinglePage!=a&&(this._hideOnSinglePage=a,this._render())},get:function(){return this._hideOnSinglePage}},showTip:{set:function(a){this._showTip!==a&&(this._showTip=
a,this._render())},get:function(){return this._showTip}},showInfo:{set:function(a){this._showInfo!==a&&(this._showInfo=a,this._render())},get:function(){return this._showInfo}},showFirstAndLast:{set:function(a){this._showFirstAndLast!==a&&(this._showFirstAndLast=a,this._render())},get:function(){return this._showFirstAndLast}},showPreviousAndNext:{set:function(a){this._showPreviousAndNext!==a&&(this._showPreviousAndNext=a,this._render())},get:function(){return this._showPreviousAndNext}},showNumbers:{set:function(a){this._showNumbers!==
a&&(this._showNumbers=a,this._render())},get:function(){return this._showNumbers}}},function(a){g.Pager=a})};
RIAPP.Application._coreModules.stackpanel=function(b){var g=this,e=b.global,l=e.utils,k=e.consts,m=b.modules.collection,a=b.modules.template.Template,d={stackpanel:"ria-stackpanel",item:"stackpanel-item",currentItem:"current-item"};Object.freeze(d);g.css=d;RIAPP.BaseObject.extend({_app:b,_create:function(a,b,g){this._super();this._el=a;this._$el=e.$(this._el);this._objId="pnl"+this._app.getNewObjectID();if(b&&!m.Collection.isPrototypeOf(b))throw Error(RIAPP.ERRS.ERR_STACKPNL_DATASRC_INVALID);this._dataSource=
b;this._isDSFilling=!1;this._orientation=g.orientation||"horizontal";this._templateID=g.templateID;this._currentItem=null;this._$el.addClass(d.stackpanel);this._itemMap={};if(!this._templateID)throw Error(RIAPP.ERRS.ERR_STACKPNL_TEMPLATE_INVALID);this._dataSource&&this._bindDS();e._onStackPanelAdded(this)},_getEventNames:function(){var a=this._super();return["item_clicked"].concat(a)},_onKeyDown:function(a,b){var d=this._dataSource,e=k.KEYS;if(d)if("horizontal"==this._orientation)switch(a){case e.left:b.preventDefault();
d.movePrev(!0)&&this.scrollIntoView(d.currentItem);break;case e.right:b.preventDefault(),d.moveNext(!0)&&this.scrollIntoView(d.currentItem)}else switch(a){case e.up:b.preventDefault();d.movePrev(!0)&&this.scrollIntoView(d.currentItem);break;case e.down:b.preventDefault(),d.moveNext(!0)&&this.scrollIntoView(d.currentItem)}},_onKeyUp:function(a,b){},_updateCurrent:function(a,b){var g=this._currentItem;if(g!==a){this._currentItem=a;g&&(g=this._itemMap[g._key])&&e.$(g.div).removeClass(d.currentItem);
if(a&&(g=this._itemMap[a._key]))e.$(g.div).addClass(d.currentItem),b&&g.div.scrollIntoView(!1);this.raisePropertyChanged("currentItem")}},_onDSCurrentChanged:function(a){(a=this._dataSource.currentItem)?this._updateCurrent(a,!0):this._updateCurrent(null,!1)},_onDSCollectionChanged:function(a){var b=this,d=m.consts.COLL_CHANGE_TYPE,e=a.items;switch(a.change_type){case d.RESET:this._isDSFilling||this._refresh();break;case d.ADDED:this._isDSFilling||b._appendItems(e);break;case d.REMOVE:e.forEach(function(a){b._removeItem(a)});
break;case d.REMAP_KEY:if(d=b._itemMap[a.old_key])delete b._itemMap[a.old_key],b._itemMap[a.new_key]=d,d.div.setAttribute(k.DATA_ATTR.DATA_ITEM_KEY,a.new_key);break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,a.change_type));}},_onDSFill:function(a){a.isBegin?this._isDSFilling=!0:(this._isDSFilling=!1,a.resetUI?this._refresh():this._appendItems(a.newItems))},_onItemStatusChanged:function(a,b){var d=k.CHANGE_TYPE.DELETED,g=a._changeType,l=this._itemMap[a._key];
l&&(g===d?e.$(l.div).hide():b===d&&g!==d&&e.$(l.div).show())},_createTemplate:function(c){var b=a.create(this._templateID);b.dataContext=c;return b},_appendItems:function(a){if(!this._isDestroyed){var b=this;a.forEach(function(a){b._itemMap[a._key]||b._appendItem(a)})}},_appendItem:function(a){if(a._key){var b=this,e=b._createElement("div"),g=e.get(0),l=b._createTemplate(a);e.addClass(d.item);e.append(l.el);"horizontal"==this._orientation&&e.css("display","inline-block");b._$el.append(e);e.attr(k.DATA_ATTR.DATA_ITEM_KEY,
a._key);e.click(function(a){a=this.getAttribute(k.DATA_ATTR.DATA_ITEM_KEY);(a=b._itemMap[a])&&b._onItemClicked(a.div,a.item)});b._itemMap[a._key]={div:g,template:l,item:a}}},_bindDS:function(){var a=this,b=this._dataSource;b&&(b.addHandler("coll_changed",function(d,e){b===d&&a._onDSCollectionChanged(e)},a._objId),b.addHandler("fill",function(d,e){b===d&&a._onDSFill(e)},a._objId),b.addOnPropertyChange("currentItem",function(d,e){b===d&&a._onDSCurrentChanged(e)},a._objId),-1<b.getEventNames().indexOf("status_changed")&&
b.addHandler("status_changed",function(d,e){b===d&&a._onItemStatusChanged(e.item,e.oldChangeType)},a._objId),this._refresh())},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},_createElement:function(a){return e.$(e.document.createElement(a))},_onItemClicked:function(a,b){this._updateCurrent(b,!1);this._dataSource.currentItem=b;this.raiseEvent("item_clicked",{item:b})},destroy:function(){this._isDestroyed||(this._isDestroying=!0,e._onStackPanelRemoved(this),this._unbindDS(),
this._clearContent(),this._$el.removeClass(d.stackpanel),this._currentItem=this._$el=this._el=null,this._itemMap={},this._super())},_clearContent:function(){var a=this;a._$el.empty();l.forEachProp(a._itemMap,function(b){a._removeItemByKey(b)})},_removeItemByKey:function(a){var b=this._itemMap[a];b&&(delete this._itemMap[a],b.template.destroy())},_removeItem:function(a){a=a._key;var b=this._itemMap[a];b&&(delete this._itemMap[a],b.template.destroy(),e.$(b.div).remove())},_refresh:function(){var a=
this._dataSource,b=this;this._clearContent();a&&a.forEach(function(a){b._appendItem(a)})},scrollIntoView:function(a){a&&(a=this._itemMap[a._key])&&a.div.scrollIntoView(!1)},getDivElementByItem:function(a){a=this._itemMap[a._key];return!a?null:a.div},toString:function(){return"StackPanel"}},{el:{get:function(){return this._el}},app:{get:function(){return this._app}},dataSource:{set:function(a){a!==this._dataSource&&(null!==this._dataSource&&this._unbindDS(),this._dataSource=a,null!==this._dataSource&&
this._bindDS(),this.raisePropertyChanged("dataSource"))},get:function(){return this._dataSource}},currentItem:{get:function(){return this._currentItem}}},function(a){g.StackPanel=a})};
RIAPP.Application._coreModules.listbox=function(b){var g=this,e=b.global,l=e.utils,k=e.consts,m=b.modules.collection;RIAPP.BaseObject.extend({_app:b,_create:function(a,b,c){var f=this;this._super();this._el=a;this._$el=e.$(this._el);this._objId="lst"+this._app.getNewObjectID();if(b&&!m.Collection.isPrototypeOf(b))throw Error(RIAPP.ERRS.ERR_LISTBOX_DATASRC_INVALID);this._$el.on("change."+this._objId,function(a){a.stopPropagation();f._isRefreshing||f._onChanged()});this._dataSource=null;this._css=c.css;
this._isRefreshing=this._isDSFilling=!1;this._valuePath=c.valuePath;this._textPath=c.textPath;this._saveSelected=this._selectedItem=null;this._keyMap={};this._valMap={};this._saveVal=void 0;this._css&&this._$el.addClass(this._css);this.dataSource=b},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._unbindDS(),this._$el.off("."+this._objId),this._css&&this._$el.removeClass(this._css),this._clear(!0),this._$el=this._el=null,this._super())},_onChanged:function(){var a=null,b;0<=this._el.selectedIndex&&
(a=this._el.options[this._el.selectedIndex],a=a.value,b=this._keyMap[a]);!b&&this._selectedItem?this.selectedItem=null:b.item!==this._selectedItem&&(this.selectedItem=b.item)},_getValue:function(a){a=this._getRealValue(a);return l.check_is.nt(a)?"":a},_getRealValue:function(a){if(!a)return null;if(this._valuePath)return this._app.parser.resolvePath(a,this._valuePath)},_getText:function(a){return!a?"":this._textPath?(a=this._app.parser.resolvePath(a,this._textPath),l.check_is.nt(a)?"":""+a):""+this._getValue(a)},
_onDSCollectionChanged:function(a){var b=this,c=m.consts.COLL_CHANGE_TYPE;switch(a.change_type){case c.RESET:this._isDSFilling||this._refresh();break;case c.ADDED:this._isDSFilling||a.items.forEach(function(a){b._addOption(a,a._isNew)});break;case c.REMOVE:a.items.forEach(function(a){b._removeOption(a)});break;case c.REMAP_KEY:if(c=b._keyMap[a.old_key])delete b._keyMap[a.old_key],b._keyMap[a.new_key]=c,c.op.value=a.new_key}},_onDSFill:function(a){a.isBegin?this._isDSFilling=!0:(this._isDSFilling=
!1,this._refresh())},_onEdit:function(a,b,c){b?this._saveVal=this._getValue(a):(b=this._saveVal,this._saveVal=void 0,c||(c=a._key,(c=this._keyMap[c])?(c.op.text=this._getText(a),a=this._getValue(a),b!==a&&(""!==b&&delete this._valMap[b],""!==a&&(this._valMap[a]=c))):""!==b&&delete this._valMap[b]))},_onStatusChanged:function(a,b){a._changeType===k.CHANGE_TYPE.DELETED&&this._removeOption(a)},_onCommitChanges:function(a,b,c,f){var e=k.CHANGE_TYPE;if(b){if(!(c&&f===e.ADDED)&&(c||f!==e.DELETED))this._saveVal=
this._getValue(a)}else b=this._saveVal,this._saveVal=void 0,c&&f===e.DELETED?this._addOption(a,!0):(c=this._getValue(a),f=this._keyMap[a._key],b!==c&&(""!==b&&delete this._valMap[b],f&&""!==c&&(this._valMap[c]=f)),f&&(f.op.text=this._getText(a)))},_bindDS:function(){var a=this,b=this._dataSource;b&&(b.addHandler("coll_changed",function(c,f){b===c&&a._onDSCollectionChanged(f)},a._objId),b.addHandler("fill",function(c,f){b===c&&a._onDSFill(f)},a._objId),b.addHandler("begin_edit",function(c,f){b===c&&
a._onEdit(f.item,!0,void 0)},a._objId),b.addHandler("end_edit",function(c,f){b===c&&a._onEdit(f.item,!1,f.isCanceled)},a._objId),b.addHandler("status_changed",function(c,f){b===c&&a._onStatusChanged(f.item,f.oldChangeType)},a._objId),b.addHandler("commit_changes",function(c,f){b===c&&a._onCommitChanges(f.item,f.isBegin,f.isRejected,f.changeType)},a._objId))},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},_addOption:function(a,b){if(this._isDestroyed)return null;var c,
f="",g,k;a&&(f=a._key);if(this._keyMap[f])return null;k=this._getText(a);g=this._getValue(a);c=e.document.createElement("option");c.text=k;c.value=f;k={item:a,op:c};this._keyMap[f]=k;""!==g&&(this._valMap[g]=k);b?2>this._el.options.length?this._el.add(c,null):this._el.add(c,this._el.options[1]):this._el.add(c,null);return c},_removeOption:function(a){if(!this._isDestroyed){var b="",c;if(a&&(b=a._key,c=this._keyMap[b]))this._el.remove(c.op.index),c=this._getValue(a),delete this._keyMap[b],""!==c&&
delete this._valMap[c],this._saveSelected===a&&(this._saveSelected=null),this.selectedItem===a&&(this.selectedItem=this._saveSelected)}},_clear:function(a){this._el.options.length=0;this._keyMap={};this._valMap={};this._saveSelected=null;a?this._selectedItem=null:(this._addOption(null,!1),this.selectedItem=null)},clear:function(){this._clear(!1)},_refresh:function(){var a=this,b=this._dataSource,c=this._selectedItem;this._isRefreshing=!0;try{this.clear(),b&&b.forEach(function(b){a._addOption(b,!1)}),
this._el.selectedIndex=this._findItemIndex(c)}finally{this._isRefreshing=!1}this._onChanged()},_findItemIndex:function(a){if(!a)return 0;a=this._keyMap[a._key];return!a?0:a.op.index},findItemByValue:function(a){a=this._valMap[a];return!a?null:a.item},getTextByValue:function(a){return(a=this._valMap[a])?a.op.text:""},_setIsEnabled:function(a,b){a.disabled=!b},_getIsEnabled:function(a){return!a.disabled},toString:function(){return"ListBox"}},{dataSource:{set:function(a){this._dataSource!==a&&(this._dataSource&&
this._unbindDS(),this.clear(),(this._dataSource=a)&&this._bindDS(),this._refresh(),this.raisePropertyChanged("dataSource"))},get:function(){return this._dataSource}},selectedValue:{set:function(a){this.selectedValue!==a&&(this.selectedItem=this.findItemByValue(a))},get:function(){return this._getRealValue(this.selectedItem)}},selectedItem:{set:function(a){this._selectedItem!==a&&(this._selectedItem&&(this._saveSelected=this._selectedItem),this._selectedItem=a,this._el.selectedIndex=this._findItemIndex(this._selectedItem),
this.raisePropertyChanged("selectedItem"),this.raisePropertyChanged("selectedValue"))},get:function(){return this._selectedItem}},valuePath:{set:function(a){a!==this._valuePath&&(this._valuePath=a,this.raisePropertyChanged("valuePath"))},get:function(){return this._valuePath}},textPath:{set:function(a){a!==this._textPath&&(this._textPath=a,this._refresh(),this.raisePropertyChanged("textPath"))},get:function(){return this._textPath}},isEnabled:{set:function(a){a!==this.isEnabled&&(this._setIsEnabled(this.$el,
a),this.raisePropertyChanged("isEnabled"))},get:function(){return this._getIsEnabled(this.$el)}},el:{get:function(){return this._el}}},function(a){g.ListBox=a})};
RIAPP.Application._coreModules.dataform=function(b){var g=this,e=b.global,l=e.utils,k=e.consts,m=b.modules.binding.Binding,a=b.modules.baseElView.BaseElView,d={dataform:"ria-dataform"};Object.freeze(d);g.css=d;RIAPP.BaseObject.extend({_DATA_CONTENT_SELECTOR:"*["+k.DATA_ATTR.DATA_CONTENT+"]:not(["+k.DATA_ATTR.DATA_COLUMN+"])",_app:b,_create:function(a,f){var g=this,k;this._super();this._el=a;this._$el=e.$(this._el);this._objId="frm"+this._app.getNewObjectID();this._css=f.css;this._dataContext=null;
this._$el.addClass(d.dataform);this._css&&this._$el.addClass(this._css);this._isDisabled=this._isEditing=!1;this._content=[];this._lfTime=null;this._supportEdit=this._contentCreated=!1;this._errors=this._parentDataForm=this._collection=null;if(k=this._getParentDataForm(this._el))g._parentDataForm=b.getElementView(k),g._parentDataForm.addOnDestroyed(function(a,b){g.destroy()},g._objId)},_getBindings:function(){if(!this._lfTime)return[];for(var a=this._lfTime.getObjs(),b=[],d=0,e=a.length;d<e;d+=1)m.isPrototypeOf(a[d])&&
b.push(a[d]);return b},_getElViews:function(){if(!this._lfTime)return[];for(var b=this._lfTime.getObjs(),d=[],e=0,g=b.length;e<g;e+=1)a.isPrototypeOf(b[e])&&d.push(b[e]);return d},_updateIsDisabled:function(){var a,b,d,e=this._getBindings(),g=this._getElViews(),l=this._app._getElViewType(k.ELVIEW_NM.DATAFORM);a=0;for(b=e.length;a<b;a+=1)d=e[a],d.isDisabled=this._isDisabled;a=0;for(b=g.length;a<b;a+=1)d=g[a],l.isPrototypeOf(d)&&d.form&&(d.form.isDisabled=this._isDisabled)},_updateContent:function(){var a=
this._dataContext,b,d=this;if(this._contentCreated)this._content.forEach(function(b){b.dataContext=a;b.isEditing=this.isEditing},this),b=this._getBindings(),b.forEach(function(b){b.isSourceFixed||(b.source=a)});else if(a){b=Array.fromList(this._el.querySelectorAll(d._DATA_CONTENT_SELECTOR));var e=this.isEditing;b.forEach(function(b){if(d._getParentDataForm(b)===d._el){var f=b.getAttribute(k.DATA_ATTR.DATA_CONTENT),f=d._app._parseContentAttr(f);if(f.fieldName&&!f.fieldInfo){if(!a.getFieldInfo)throw Error(RIAPP.ERRS.ERR_DCTX_HAS_NO_FIELDINFO);
f.fieldInfo=a.getFieldInfo(f.fieldName);if(!f.fieldInfo)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,"",f.fieldName));}var n=d._app._getContentType(f);(b=d._app._getContent(n,f,b,a,e))&&d._content.push(b)}});this._lfTime=this._app._bindElements(this._el,a,!0);this._contentCreated=!0}},_getParentDataForm:function(a){if(!a)return null;a=a.parentNode;var b=e.document;if(a){if(a===this._el)return this._el;if(a===b)return null;b=a.getAttribute(k.DATA_ATTR.DATA_VIEW);if(!b)return this._getParentDataForm(a);
b=this._app.parser.parseOptions(b);return 0<b.length&&b[0].name==k.ELVIEW_NM.DATAFORM?a:this._getParentDataForm(a)}return null},_onDSErrorsChanged:function(a){this.validationErrors=a?a.getAllErrors():null},_bindDS:function(){var a=this._dataContext,b=this;a&&(a.addOnDestroyed(function(a,c){b.dataContext=null},this._objId),this._supportEdit&&a.addOnPropertyChange("isEditing",function(a,c){b.isEditing=a.isEditing},this._objId),this._collection&&this._collection.addHandler("errors_changed",function(d,
e){e.item===a&&b._onDSErrorsChanged(e.item)},b._objId))},_unbindDS:function(){var a=this._dataContext;this.validationErrors=null;a&&(a._isNotDestroyed()&&a.removeNSHandlers(this._objId),this._collection&&this._collection._isNotDestroyed()&&this._collection.removeNSHandlers(this._objId))},_clearContent:function(){this._content.forEach(function(a){a.destroy()});this._content=[];this._lfTime&&(this._lfTime.destroy(),this._lfTime=null);this._contentCreated=!1},_onError:function(a,b){var d=this._super(a,
b);return!d?this._app._onError(a,b):d},destroy:function(){if(!this._isDestroyed){this._isDestroying=!0;this._clearContent();this._css&&this._$el.removeClass(this._css);this._$el.removeClass(d.dataform);this._$el=this._el=null;this._unbindDS();var a=this._parentDataForm;this._parentDataForm=null;a&&a._isNotDestroyed()&&a.removeNSHandlers(this._objId);this._dataContext=null;this._contentCreated=!1;this._owner=null;this._super()}},toString:function(){return"DataForm"}},{el:{get:function(){return this._el}},
app:{get:function(){return this._app}},dataContext:{set:function(a){var b;try{if(a!==this._dataContext){if(a&&!RIAPP.BaseObject.isPrototypeOf(a))throw Error(RIAPP.ERRS.ERR_DATAFRM_DCTX_INVALID);this._unbindDS();this._supportEdit=!1;this._collection=null;if(b=this._dataContext=a)this._supportEdit=l.hasProp(b,"isEditing")&&!!b.beginEdit,b._collection&&(this._collection=b._collection);this._bindDS();this._updateContent();this.raisePropertyChanged("dataContext");b&&(this._supportEdit&&this._isEditing!==
b.isEditing&&(this.isEditing=b.isEditing),this._collection&&b.getAllErrors&&this._onDSErrorsChanged(b))}}catch(d){e.reThrow(d,this._onError(d,this))}},get:function(){return this._dataContext}},isEditing:{set:function(a){var b=this._dataContext,d=this._isEditing;if(b)if(!this._supportEdit&&a!==d)this._isEditing=a,this._updateContent(),this.raisePropertyChanged("isEditing");else{if(a!==d)try{a?b.beginEdit():b.endEdit()}catch(g){e.reThrow(g,this._onError(g,b))}b.isEditing!==d&&(this._isEditing=b.isEditing,
this._updateContent(),this.raisePropertyChanged("isEditing"))}},get:function(){return this._isEditing}},validationErrors:{set:function(a){a!==this._errors&&(this._errors=a,this.raisePropertyChanged("validationErrors"))},get:function(){return this._errors}},isDisabled:{set:function(a){this._isDisabled!==a&&(this._isDisabled=!!a,this._updateIsDisabled(),this.raisePropertyChanged("isDisabled"))},get:function(){return this._isDisabled}}},function(a){g.DataForm=a})};
RIAPP.Application._coreModules.elview=function(b){var g=this,e=b.global,l=e.utils,k=b.modules.baseElView,m=RIAPP.localizable.VALIDATE,a=b.modules.datagrid,d=b.modules.pager,c=b.modules.stackpanel,f=b.modules.listbox,s=b.modules.dataform,q=k.BaseElView,p=k.css;g.BaseElView=q;var k=q.extend(null,{isEnabled:{set:function(a){a=!!a;a!==this.isEnabled&&(this._setIsEnabled(this.$el,a),this.raisePropertyChanged("isEnabled"))},get:function(){return this._getIsEnabled(this.$el)}}},function(a){g.EditableElView=
a;b.registerType("EditableElView",a)}),u=k.extend({_init:function(a){var b=this;this._super(a);var c=this.$el;c.on("change."+this._objId,function(a){a.stopPropagation();b.raisePropertyChanged("value")});c.on("keypress."+this._objId,function(a){a.stopPropagation();var c={keyCode:a.which,value:a.target.value,isCancel:!1};b.raiseEvent("keypress",c);c.isCancel&&a.preventDefault()});if(a.updateOnKeyUp)c.on("keyup."+this._objId,function(a){a.stopPropagation();b.raisePropertyChanged("value")})},_getEventNames:function(){var a=
this._super();return["keypress"].concat(a)},destroy:function(){this._super()},toString:function(){return"TextBoxElView"}},{value:{set:function(a){if(this._el){var b=this._el,c=b.value;a=null===a?"":""+a;c!==a&&(b.value=a,this.raisePropertyChanged("value"))}},get:function(){var a=this._el;return!a?"":a.value}}},function(a){g.TextBoxElView=a;b.registerType("TextBoxElView",a);b.registerElView("input:text",a)});q.extend({toString:function(){return"HiddenElView"}},{value:{set:function(a){if(this._el){var b=
this._el,c=b.value;a=null===a?"":""+a;c!==a&&(b.value=a,this.raisePropertyChanged("value"))}},get:function(){var a=this._el;return!a?"":a.value}}},function(a){g.HiddenElView=a;b.registerType("HiddenElView",a);b.registerElView("input:hidden",a)});u.extend({_init:function(a){this._super(a);a.rows&&(this.rows=a.rows);a.cols&&(this.cols=a.cols);a.wrap&&(this.wrap=a.wrap)},toString:function(){return"TextAreaElView"}},{rows:{set:function(a){var b=this._el;if(b){var c=b.rows;a=!a?1:a;c!==a&&(b.rows=a,this.raisePropertyChanged("rows"))}},
get:function(){var a=this._el;return!a?1:a.rows}},cols:{set:function(a){var b=this._el;if(b){var c=b.cols;a=!a?1:a;c!==a&&(b.cols=a,this.raisePropertyChanged("cols"))}},get:function(){var a=this._el;return!a?1:a.cols}},wrap:{set:function(a){var b=this._el;if(b){var c=b.wrap;a=!a?"off":a;0>["hard","off","soft"].indexOf(a)&&(a="off");c!==a&&(b.wrap=a,this.raisePropertyChanged("wrap"))}},get:function(){var a=this._el;return!a?"off":a.wrap}}},function(a){g.TextAreaElView=a;b.registerType("TextAreaElView",
a);b.registerElView("textarea",a)});k.extend({_init:function(a){var b=this;this._super(a);this._val=this.el.checked;this.$el.on("change."+this._objId,function(a){a.stopPropagation();b.checked=this.checked})},_setFieldError:function(a){var b=this.$el;a?(a=e.$("<div></div>").addClass(p.fieldError),b.wrap(a)):0<b.parent("."+p.fieldError).length&&b.unwrap()},destroy:function(){this.$el.off("."+this._objId);this._super()},toString:function(){return"CheckBoxElView"}},{checked:{set:function(a){var b=this._el;
null!==a&&(a=!!a);a!==this._val&&(this._val=a,b&&(b.checked=!!this._val),null===this._val?this.$el.css("opacity",0.33):this.$el.css("opacity",1),this.raisePropertyChanged("checked"))},get:function(){return this._val}}},function(a){g.CheckBoxElView=a;b.registerType("CheckBoxElView",a);b.registerElView("input:checkbox",a)});k.extend({_init:function(a){var b=this;this._super(a);this._val=this.el.checked;this.$el.on("change."+this._objId,function(a){a.stopPropagation();b.checked=this.checked;b._updateGroup()})},
_updateGroup:function(){var a=this.el.getAttribute("name");if(a){var b=this.el.parentNode;if(b){var c=this,d=c.el;e.$('input[type="radio"][name="'+a+'"]',b).each(function(a,b){if(d!==this){var e=c.app._getElView(this);e&&(e.checked=this.checked)}})}}},_setFieldError:function(a){var b=this.$el;a?(a=e.$("<div></div>").addClass(p.fieldError),b.wrap(a)):0<b.parent("."+p.fieldError).length&&b.unwrap()},destroy:function(){this.$el.off("."+this._objId);this._super()},toString:function(){return"RadioElView"}},
{checked:{set:function(a){var b=this._el;null!==a&&(a=!!a);a!==this._val&&(this._val=a,b&&(b.checked=!!this._val),null===this._val?this.$el.css("opacity",0.33):this.$el.css("opacity",1),this.raisePropertyChanged("checked"))},get:function(){return this._val}},value:{set:function(a){var b=this._el;if(b){var c=""+a;null===a&&(c="");c!==b.value&&(b.value=c,this.raisePropertyChanged("value"))}},get:function(){return this._el.value}},name:{get:function(){return this._el.name}}},function(a){g.RadioElView=
a;b.registerType("RadioElView",a);b.registerElView("input:radio",a)});u=q.extend({_init:function(a){this._super(a);this._commandParam=this._command=null},destroy:function(){this.commandParam=this.command=null;this._super()},invokeCommand:function(){this.command&&this.command.canExecute(this,this.commandParam)&&this.command.execute(this,this.commandParam)},_onCommandChanged:function(){this.raisePropertyChanged("command")},_setCommand:function(a){var b=this;a!==this._command&&(this._command&&this._command.removeNSHandlers(this._objId),
(this._command=a)?(this._command.addHandler("canExecute_changed",function(a,c){b.isEnabled=a.canExecute(b,b.commandParam)},this._objId),b.isEnabled=this._command.canExecute(b,b.commandParam)):b.isEnabled=!1,this._onCommandChanged())},toString:function(){return"CommandElView"}},{command:{set:function(a){this._setCommand(a)},get:function(){return this._command}},commandParam:{set:function(a){a!==this._commandParam&&(this._commandParam=a,this.raisePropertyChanged("commandParam"))},get:function(){return this._commandParam}}},
function(a){g.CommandElView=a;b.registerType("CommandElView",a)});u.extend({templateLoaded:function(a){var b=this._commandParam;this._commandParam={template:a,isLoaded:!0};this.invokeCommand();this._commandParam=b},templateUnloading:function(a){var b=this._commandParam;this._commandParam={template:a,isLoaded:!1};this.invokeCommand();this._commandParam=b},_setCommand:function(a){this._super(a)},toString:function(){return"TemplateElView"}},{},function(a){g.TemplateElView=a;b.registerType("TemplateElView",
a);b.registerElView("template",a)});u.extend({_init:function(a){this._super(a);var b=this;this.$el.on("click."+this._objId,function(a){b._onClick(a)})},_onClick:function(a){this.invokeCommand()},toString:function(){return"ButtonElView"}},{value:{set:function(a){if(this._el){var b=this.$el.val();a=null===a?"":""+a;b!==a&&(this.$el.val(a),this.raisePropertyChanged("value"))}},get:function(){return!this._el?"":this.$el.val()}},text:{set:function(a){if(this._el){var b=this.$el.text();a=null===a?"":""+
a;b!==a&&(this.$el.text(a),this.raisePropertyChanged("text"))}},get:function(){return!this._el?"":this.$el.text()}},html:{set:function(a){if(this._el){var b=this.$el.html();a=null===a?"":""+a;b!==a&&(this.$el.html(a),this.raisePropertyChanged("html"))}},get:function(){return!this._el?"":this.$el.html()}},isEnabled:{set:function(a){a!==this.isEnabled&&(this._setIsEnabled(this.$el,a),this.raisePropertyChanged("isEnabled"))},get:function(){return this._getIsEnabled(this.$el)}}},function(a){g.ButtonElView=
a;b.registerType("ButtonElView",a);b.registerElView("input:button",a);b.registerElView("input:submit",a);b.registerElView("button",a)});u.extend({_init:function(a){this._super(a);var b=this,c=this.$el;this._image=this._imageSrc=null;a.imageSrc&&(this.imageSrc=a.imageSrc);c.addClass(p.commandLink);c.on("click."+this._objId,function(a){b._onClick(a)})},_onClick:function(a){a.preventDefault();this.invokeCommand()},_updateImage:function(a){var b=this.$el,c=this;this._imageSrc!==a&&(this._imageSrc=a,this._image&&
!a&&(e.$(this._image).remove(),this._image=null),a&&(this._image?this._image.src=a:(c.html=null,a=e.$(new Image).attr("src",a).mouseenter(function(a){c._isEnabled&&e.$(this).css("opacity",0.5)}).mouseout(function(a){c._isEnabled&&e.$(this).css("opacity",1)}).appendTo(b),this._image=a.get(0))))},destroy:function(){this._isDestroyed||(this.$el.removeClass(p.commandLink),this.imageSrc=null,this._super())},toString:function(){return"AncorButtonElView"}},{imageSrc:{set:function(a){this._$el&&this._imageSrc!==
a&&(this._updateImage(a),this.raisePropertyChanged("imageSrc"))},get:function(){return this._imageSrc}},html:{set:function(a){if(this._el){var b=this.$el.html();a=null===a?"":""+a;b!==a&&(this.$el.html(a),this.raisePropertyChanged("html"))}},get:function(){return!this._el?"":this.$el.html()}},text:{set:function(a){if(this._el){var b=this.$el.text();a=null===a?"":""+a;b!==a&&(this.$el.text(a),this.raisePropertyChanged("text"))}},get:function(){return!this._el?"":this.$el.text()}},href:{set:function(a){if(this._el){var b=
this.href;a=null===a?"":""+a;b!==a&&(this.$el.prop("href",a),this.raisePropertyChanged("href"))}},get:function(){return!this._el?"":this.$el.prop("href")}},isEnabled:{set:function(a){a!==this.isEnabled&&(this._setIsEnabled(this.$el,a),this.raisePropertyChanged("isEnabled"))},get:function(){return this._getIsEnabled(this.$el)}}},function(a){g.AncorButtonElView=a;b.registerType("AncorButtonElView",a);b.registerElView("a",a);b.registerElView("abutton",a)}).extend({_init:function(a){this._expandedsrc=
a.expandedsrc||e.getImagePath("collapse.jpg");this._collapsedsrc=a.collapsedsrc||e.getImagePath("expand.jpg");this._isExpanded=!!a.isExpanded;a.imageSrc=this._isExpanded?this._expandedsrc:this._collapsedsrc;this._super(a)},destroy:function(){this._isDestroyed||(this._collapsedsrc=this._expandedsrc=null,this._isExpanded=!1,this._super())},_onCommandChanged:function(){this._super();this.invokeCommand()},_onClick:function(a){this._isExpanded=!this._isExpanded;this._super(a)},invokeCommand:function(){this.imageSrc=
this._isExpanded?this._expandedsrc:this._collapsedsrc;this._super()},toString:function(){return"ExpanderElView"}},{isExpanded:{set:function(a){this._isExpanded!==a&&(this._isExpanded=a,this.invokeCommand(),this.raisePropertyChanged("isExpanded"))},get:function(){return this._isExpanded}}},function(a){g.ExpanderElView=a;b.registerType("ExpanderElView",a);b.registerElView("expander",a)});q.extend({toString:function(){return"SpanElView"}},{value:{set:function(a){this.text=a},get:function(){return this.text}},
text:{set:function(a){var b=this.$el,c=b.text();a=null===a?"":""+a;c!==a&&(b.text(a),this.raisePropertyChanged("text"),this.raisePropertyChanged("value"))},get:function(){return this.$el.text()}},html:{set:function(a){var b=this.el.innerHTML;a=null===a?"":""+a;b!==a&&(this.el.innerHTML=a,this.raisePropertyChanged("html"))},get:function(){return this.el.innerHTML}},color:{set:function(a){var b=this.$el,c=b.css("color");a!==c&&(b.css("color",a),this.raisePropertyChanged("color"))},get:function(){return this.$el.css("color")}},
fontSize:{set:function(a){var b=this.$el,c=b.css("font-size");a!==c&&(b.css("font-size",a),this.raisePropertyChanged("fontSize"))},get:function(){return this.$el.css("font-size")}}},function(a){g.SpanElView=a;b.registerType("SpanElView",a);b.registerElView("span",a)}).extend({toString:function(){return"DivElView"}},{borderColor:{set:function(a){var b=this.$el.css("border-top-color");a!==b&&(this.el.style.borderColor=a,this.raisePropertyChanged("borderColor"))},get:function(){return this.$el.css("border-top-color")}},
borderStyle:{set:function(a){var b=this.$el,c=b.css("border-top-style");a!==c&&(b.css("border-style",a),this.raisePropertyChanged("borderStyle"))},get:function(){return this.$el.css("border-top-style")}},width:{set:function(a){var b=this.$el,c=b.width();a!==c&&(b.width(a),this.raisePropertyChanged("width"))},get:function(){return this.$el.width()}},height:{set:function(a){var b=this.$el,c=b.height();a!==c&&(b.height(a),this.raisePropertyChanged("height"))},get:function(){return this.$el.height()}}},
function(a){g.DivElView=a;b.registerType("DivElView",a);b.registerElView("div",a)});q.extend({_init:function(a){this._super(a)},toString:function(){return"ImgElView"}},{src:{set:function(a){this.$el.prop("src")!==a&&(this.$el.prop("src",a),this.raisePropertyChanged("src"))},get:function(){return this.$el.prop("src")}}},function(a){g.ImgElView=a;b.registerType("ImgElView",a);b.registerElView("img",a)});q.extend({_init:function(a){this._super(a);this._loaderPath=e.getImagePath("loader.gif");this._$loader=
e.$(new Image);this._$loader.css({position:"absolute",display:"none",zIndex:"10000"});this._$loader.attr("src",this._loaderPath);this._$loader.appendTo(this.el);this._isBusy=!1},destroy:function(){this._$loader&&(this._$loader.remove(),this._$loader=null,this._super())},toString:function(){return"BusyElView"}},{isBusy:{set:function(a){a!==this._isBusy&&((this._isBusy=a)?(this._$loader.show(),this._$loader.position({of:e.$(this.el)})):this._$loader.hide())},get:function(){return this._isBusy}}},function(a){g.BusyElView=
a;b.registerType("BusyElView",a);b.registerElView("busy_indicator",a)});q.extend({_init:function(a){this._super(a);this._gridEventCommand=this._grid=this._dataSource=null;this._options=a},destroy:function(){this._dataSource&&(this.dataSource=null);this._gridEventCommand=null;this._super()},_createGrid:function(){this._grid=a.DataGrid.create(this._el,this._dataSource,this._options);this._bindGridEvents()},_bindGridEvents:function(){if(this._grid){var a=this;this._grid.addHandler("row_expanded",function(b,
c){a.invokeGridEvent("row_expanded",c)},this.uniqueID);this._grid.addHandler("row_selected",function(b,c){a.invokeGridEvent("row_selected",c)},this.uniqueID);this._grid.addHandler("page_changed",function(b,c){a.invokeGridEvent("page_changed",c)},this.uniqueID);this._grid.addOnDestroyed(function(b,c){a._grid=null},this.uniqueID)}},invokeGridEvent:function(a,b){var c={eventName:a,args:b};this._gridEventCommand&&this._gridEventCommand.execute(this,c)},toString:function(){return"GridElView"}},{dataSource:{set:function(a){this._dataSource!==
a&&(this._dataSource=a,this._grid&&this._grid._isNotDestroyed()&&(this._grid.destroy(),this._grid=null),this._dataSource&&this._createGrid(),this.invokePropChanged("grid"))},get:function(){return this._dataSource}},grid:{get:function(){return this._grid}},gridEventCommand:{set:function(a){a!==this._gridEventCommand&&(this._gridEventCommand&&this.invokeGridEvent("command_disconnected",{}),(this._gridEventCommand=a)&&this.invokeGridEvent("command_connected",{}))},get:function(){return this._gridEventCommand}}},
function(a){g.GridElView=a;b.registerType("GridElView",a);b.registerElView("table",a)});q.extend({_init:function(a){this._super(a);this._pager=this._dataSource=null;this._options=a},destroy:function(){this._pager&&this._pager._isNotDestroyed()&&this._pager.destroy();this._dataSource=this._pager=null;this._super()},toString:function(){return"PagerElView"}},{dataSource:{set:function(a){var b=this;this._dataSource!==a&&(this._dataSource=a,this._pager&&this._pager.destroy(),this._pager=null,this._dataSource&&
this._dataSource.isPagingEnabled&&(this._pager=d.Pager.create(this._el,this._dataSource,this._options),this._pager.addOnDestroyed(function(){b._pager=null})),b.invokePropChanged("pager"))},get:function(){return this._dataSource}},pager:{get:function(){return this._pager}}},function(a){g.PagerElView=a;b.registerType("PagerElView",a);b.registerElView("pager",a)});q.extend({_init:function(a){this._super(a);this._panel=this._dataSource=null;this._options=a},destroy:function(){this._panel&&this._panel._isNotDestroyed()&&
this._panel.destroy();this._dataSource=this._panel=null;this._super()},toString:function(){return"StackPanelElView"}},{dataSource:{set:function(a){var b=this;this._dataSource!==a&&(this._dataSource=a,this._panel&&this._panel.destroy(),this._panel=null,this._dataSource&&(this._panel=c.StackPanel.create(this._el,this._dataSource,this._options),this._panel.addOnDestroyed(function(){b._panel=null})),b.invokePropChanged("panel"))},get:function(){return this._dataSource}},panel:{get:function(){return this._panel}}},
function(a){g.StackPanelElView=a;b.registerType("StackPanelElView",a);b.registerElView("stackpanel",a)});k.extend({_init:function(a){this._super(a);this._listBox=this._dataSource=null;this._options=a},destroy:function(){this._listBox&&this._listBox._isNotDestroyed()&&this._listBox.destroy();this._dataSource=this._listBox=null;this._super()},toString:function(){return"SelectElView"}},{dataSource:{set:function(a){var b=this;this._dataSource!==a&&(this._dataSource=a,this._listBox&&this._listBox.destroy(),
this._listBox=null,this._dataSource&&(this._listBox=f.ListBox.create(this._el,this._dataSource,this._options),this._listBox.addOnDestroyed(function(){b._listBox=null},this.uniqueID),this._listBox.addOnPropertyChange("*",function(a,c){b.raisePropertyChanged(c.property)},this.uniqueID)),b.invokePropChanged("listBox"))},get:function(){return this._dataSource}},selectedValue:{set:function(a){this._listBox&&this._listBox.selectedValue!==a&&(this._listBox.selectedValue=a)},get:function(){return!this._listBox?
null:this._listBox.selectedValue}},selectedItem:{set:function(a){this._listBox&&(this._listBox.selectedItem=a)},get:function(){return!this._listBox?null:this._listBox.selectedItem}},listBox:{get:function(){return this._listBox}}},function(a){g.SelectElView=a;b.registerType("SelectElView",a);b.registerElView("select",a)});q.extend({_init:function(a){this._super(a);this._form=this._dataContext=null;this._options=a},_getErrorTipInfo:function(a){var b=["<b>",m.errorInfo,"</b>","<ul>"];a.forEach(function(a){var c=
a.fieldName,d="";c&&(d=m.errorField+" "+c);a.errors.forEach(function(a){d=d?d+" -> "+a:a});b.push("<li>"+d+"</li>");d=""});b.push("</ul>");return b.join("")},_updateErrorUI:function(a,b){if(a){var c=this.$el;if(b&&0<b.length){var d,f=e.getImagePath("warning.png");d=e.$('<img name="error_info" alt="error_info" class="error-info" />');c.prepend(d);d.get(0).src=f;l.addToolTip(d,this._getErrorTipInfo(b),p.errorTip);this._setFieldError(!0)}else c.children('img[name="error_info"]').remove(),this._setFieldError(!1)}},
destroy:function(){this._form&&this._form._isNotDestroyed()&&this._form.destroy();this._dataContext=this._form=null;this._super()},toString:function(){return"DataFormElView"}},{dataContext:{set:function(a){var b=this;this._dataContext!==a&&(this._dataContext=a,this._form||(this._form=s.DataForm.create(this._el,this._options)),this._form.dataContext=this._dataContext,this._form.addOnDestroyed(function(){b._form=null}),this.form.addOnPropertyChange("validationErrors",function(a,c){b.validationErrors=
a.validationErrors},this._objId),b.invokePropChanged("form"))},get:function(){return this._dataContext}},form:{get:function(){return this._form}}},function(a){g.DataFormElView=a;b.registerType("DataFormElView",a);b.registerElView(e.consts.ELVIEW_NM.DATAFORM,a)});q.extend({_init:function(a){this._super(a);this._tabsEventCommand=null;this._tabOpts=a},_createTabs:function(){var a=this.$el,b=this,c={select:function(a,c){b.invokeTabsEvent("select",c)},show:function(a,c){b.invokeTabsEvent("show",c)},disable:function(a,
c){b.invokeTabsEvent("disable",c)},enable:function(a,c){b.invokeTabsEvent("enable",c)},add:function(a,c){b.invokeTabsEvent("add",c)},remove:function(a,c){b.invokeTabsEvent("remove",c)},load:function(a,c){b.invokeTabsEvent("load",c)}},c=l.extend(!0,c,b._tabOpts);a.tabs(c)},_destroyTabs:function(){this.$el.tabs("destroy")},invokeTabsEvent:function(a,b){var c={eventName:a,args:b};this._tabsEventCommand&&this._tabsEventCommand.execute(this,c)},destroy:function(){this._tabsEventCommand&&(this._tabsEventCommand=
null,this._destroyTabs(),this._super())},toString:function(){return"TabsElView"}},{tabsEventCommand:{set:function(a){var b=this._tabsEventCommand;a!==b&&(b&&this._destroyTabs(),(this._tabsEventCommand=a)&&this._createTabs())},get:function(){return this._tabsEventCommand}}},function(a){g.TabsElView=a;b.registerType("TabsElView",a);b.registerElView("tabs",a)})};
RIAPP.Application._coreModules.content=function(b){var g=this,e=b.global,l=e.utils,k=b.modules.binding.Binding,m=b.modules.elview,a=e.consts.DATA_TYPE,d=e.consts.KEYS,c=b.modules.baseContent.BindingContent,f=c.extend({_create:function(a,b,c){this._super(a,b,c);this._fn_cleanup=null},_getBindingOption:function(a,c,d,f){a=this._super(a,c,d,f);a.converter=b.getConverter("dateConverter");a.converterParam=e.defaults.dateFormat;return a},_createTargetElement:function(){var a=this._super();if(this.isEditing){var b=
e.$(a);b.datepicker();this._fn_cleanup=function(){b.datepicker("destroy")}}return a},_cleanUp:function(){this._fn_cleanup&&(this._fn_cleanup(),this._fn_cleanup=null);this._super()},toString:function(){return"DateContent"}},null,function(a){g.DateContent=a}),s=c.extend({_init:function(){this._createTargetElement();var a=this._getBindingInfo();a&&(this._updateCss(),this._lfScope=e.utils.LifeTimeScope.create(),a=this._getBindingOption(a,this._tgt,this._dctx,"checked"),a.mode="TwoWay",this._lfScope.addObj(this._app.bind(a)))},
_createCheckBoxView:function(){var a=e.document.createElement("input");a.setAttribute("type","checkbox");return this._app.modules.elview.CheckBoxElView.create(a,{})},_createTargetElement:function(){this._tgt||(this._tgt=this._createCheckBoxView(),this._el=this._tgt.el);this._parentEl.appendChild(this._el)},_updateCss:function(){this._super();this._isEditing&&this._canBeEdited()?this._el.hasAttribute("disabled")&&this._el.removeAttribute("disabled"):this._el.hasAttribute("disabled")||this._el.setAttribute("disabled",
"disabled")},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._lfScope&&(this._lfScope.destroy(),this._lfScope=null),this._tgt&&(this._tgt.destroy(),this._tgt=null),this._super())},_cleanUp:function(){},update:function(){this._cleanUp();this._updateCss()},toString:function(){return"BoolContent"}},null,function(a){g.BoolContent=a});s.extend({_canBeEdited:function(){return!0},toString:function(){return"RowSelectContent"}},null,function(a){g.RowSelectContent=a});var q=c.extend({_getBindingOption:function(c,
d,f,g){c=this._super(c,d,f,g);c.converter=b.getConverter("dateTimeConverter");d=this.getFieldInfo();f=e.defaults;switch(d.dataType){case a.DateTime:c.converterParam=f.dateTimeFormat;break;case a.Time:c.converterParam=f.timeFormat;break;default:c.converterParam=f.dateTimeFormat}return c},toString:function(){return"DateTimeContent"}},null,function(a){g.DateTimeContent=a}),p=c.extend({_allowedKeys:[0,d.backspace,d.del,d.left,d.right,d.end,d.home,d.tab,d.esc,d.enter],_getBindingOption:function(c,d,e,
f){c=this._super(c,d,e,f);switch(this.getFieldInfo().dataType){case a.Integer:c.converter=b.getConverter("integerConverter");break;case a.Decimal:c.converter=b.getConverter("decimalConverter");break;default:c.converter=b.getConverter("floatConverter")}return c},update:function(){this._super();var a=this;m.TextBoxElView.isPrototypeOf(a._tgt)&&a._tgt.addHandler("keypress",function(b,c){c.isCancel=!a._previewKeyPress(c.keyCode,c.value)})},_previewKeyPress:function(a,b){if(-1<this._allowedKeys.indexOf(a))return!0;
if(47===a)return!1;var c={32:" ",44:",",46:"."}[a],d=e.defaults;return c===d.decimalPoint?0===b.length?!1:0>b.indexOf(c):c&&c!==d.thousandSep?!1:!(!c&&(45>a||57<a))},toString:function(){return"NumberContent"}},null,function(a){g.NumberContent=a}),u=c.extend({_allowedKeys:[0,d.backspace,d.del,d.left,d.right,d.end,d.home,d.tab,d.esc,d.enter],update:function(){this._super();var a=this,b=a.getFieldInfo();m.TextBoxElView.isPrototypeOf(a._tgt)&&a._tgt.addHandler("keypress",function(c,d){d.isCancel=!a._previewKeyPress(b,
d.keyCode,d.value)})},_previewKeyPress:function(a,b,c){return!(0<a.maxLength&&c.length>=a.maxLength&&-1===this._allowedKeys.indexOf(b))},toString:function(){return"StringContent"}},null,function(a){g.StringContent=a}),n=c.extend({_allowedKeys:[0,d.backspace,d.del,d.left,d.right,d.end,d.home,d.tab,d.esc,d.enter],update:function(){this._super();var a=this,b=a.getFieldInfo();if(m.TextAreaElView.isPrototypeOf(a._tgt)){a._tgt.addHandler("keypress",function(c,d){d.isCancel=!a._previewKeyPress(b,d.keyCode,
d.value)});var c=this._options.multyline;c&&(c.rows&&(a._tgt.rows=c.rows),c.cols&&(a._tgt.cols=c.cols),c.wrap&&(a._tgt.wrap=c.wrap))}},_createTargetElement:function(){var a;a=this._isEditing&&this._canBeEdited()?e.document.createElement("textarea"):e.document.createElement("div");this._updateCss();return a},_previewKeyPress:function(a,b,c){return!(0<a.maxLength&&c.length>=a.maxLength&&-1===this._allowedKeys.indexOf(b))},toString:function(){return"MultyLineContent"}},null,function(a){g.MultyLineContent=
a}),v=c.extend({_init:function(){this._super();this._listBox=this._valBinding=this._spanView=null;this._isListBoxCachedExternally=!1;this._listBinding=this._valBinding=null},_getEventNames:function(){var a=this._super();return["listbox_created","need_listbox"].concat(a)},_getListBox:function(){if(this._listBox)return this._listBox;var a=this._options.lookup,b={listBox:null,dataSource:a.dataSource};this.raiseEvent("need_listbox",b);if(b.listBox)return this._isListBoxCachedExternally=!0,b.listBox;var b=
this._app,b=b.parser.resolvePath(b,a.dataSource),c={valuePath:a.valuePath,textPath:a.textPath},d=e.document.createElement("select");d.setAttribute("size","1");c=this._getListBoxElView(d,c);c.dataSource=b;b={listBox:c,dataSource:a.dataSource,isCachedExternally:!1};this.raiseEvent("listbox_created",b);this._isListBoxCachedExternally=b.isCachedExternally;return c},_getListBoxElView:function(a,b){var c;return(c=this.app._getElView(a))?c:c=m.SelectElView.create(a,b||{})},_updateTextValue:function(){this._spanView&&
(this._spanView.value=this._getLookupText())},_getLookupText:function(){return this._getListBox().listBox.getTextByValue(this.value)},_createSpanView:function(){var a=e.document.createElement("span"),b=this._getDisplayInfo(),a=m.SpanElView.create(a,{});b&&b.displayCss&&a.$el.addClass(b.displayCss);return a},update:function(){this._cleanUp();this._el=this._createTargetElement();this._parentEl.appendChild(this._el)},_createTargetElement:function(){var a;this._isEditing&&this._canBeEdited()?(this._listBox||
(this._listBox=this._getListBox()),this._listBinding=this._bindToList(),a=this._listBox.el):(this._spanView||(this._spanView=this._createSpanView()),this._valBinding=this._bindToValue(),a=this._spanView.el);this._updateCss();return a},_cleanUp:function(){this._el&&(l.removeNode(this._el),this._el=null);this._listBinding&&(this._listBinding.destroy(),this._listBinding=null);this._valBinding&&(this._valBinding.destroy(),this._valBinding=null);this._listBox&&this._isListBoxCachedExternally&&(this._listBox=
null)},_updateBindingSource:function(){this._valBinding&&(this._valBinding.source=this._dctx);this._listBinding&&(this._listBinding.source=this._dctx)},_bindToValue:function(){return!this._options.fieldName?null:k.create({target:this,source:this._dctx,targetPath:"value",sourcePath:this._options.fieldName,mode:"OneWay",converter:null,converterParam:null,isSourceFixed:!1})},_bindToList:function(){if(!this._options.fieldName)return null;var a={target:this._getListBox(),source:this._dctx,targetPath:"selectedValue",
sourcePath:this._options.fieldName,mode:"TwoWay",converter:null,converterParam:null,isSourceFixed:!1};return k.create(a)},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._cleanUp(),this._listBox&&!this._isListBoxCachedExternally&&this._listBox.destroy(),this._listBox=null,this._spanView&&this._spanView.destroy(),this._spanView=null,this._super())},toString:function(){return"LookupContent"}},{value:{set:function(a){this._value!==a&&(this._value=a,this._updateTextValue(),this.raisePropertyChanged("value"))},
get:function(){return this._value}}},function(a){g.LookupContent=a});g.BindingContentFactory=RIAPP.BaseObject.extend({_app:b,getContentType:function(b){var d=b.fieldInfo;if(b.lookup)return v;switch(d.dataType){case a.None:b=c;break;case a.String:b=b.multyline?n:u;break;case a.Bool:b=s;break;case a.Integer:b=p;break;case a.Decimal:case a.Float:b=p;break;case a.DateTime:case a.Time:b=q;break;case a.Date:b=f;break;case a.Guid:case a.Binary:b=c;break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_FIELD_DATATYPE,
d.dataType));}return b},createContent:function(a,b,c,d){return this.getContentType(b).create(a,b,c,d)},toString:function(){return"Default BindingContentFactory"}},null,null);b.bindingContentFactory=g.BindingContentFactory};
