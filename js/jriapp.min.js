if(!window.RIAPP)var RIAPP={};RIAPP.global=null;RIAPP.Application=null;
RIAPP.utils=function(){Array.clone||(Array.clone=function(a){return 1===a.length?[a[0]]:Array.apply(null,a)});var a={isFunc:function(a){if(!a)return!1;var d=/Function/;return"function"===typeof a?d.test(a.constructor.toString()):!1},endsWith:function(a,d){return a.substr(a.length-d.length)===d},startsWith:function(a,d){return a.substr(0,d.length)===d},fastTrim:function(a){return a.replace(/^\s+|\s+$/g,"")},trim:function(f,d){return!d?a.fastTrim(f):a.ltrim(a.rtrim(f,d),d)},ltrim:function(a,d){return a.replace(RegExp("^["+
(d||"\\s")+"]+","g"),"")},rtrim:function(a,d){return a.replace(RegExp("["+(d||"\\s")+"]+$","g"),"")},isArray:function(a){return!a?!1:"[object Array]"===Object.prototype.toString.call(a)},format:function(){for(var f="",d=arguments,l=d[0],h=0;;){var n=l.indexOf("{",h),m=l.indexOf("}",h);if(0>n&&0>m){f+=l.slice(h);break}if(0<m&&(m<n||0>n)){if("}"!==l.charAt(m+1))throw Error(a.format(RIAPP.ERRS.ERR_STRING_FORMAT_INVALID,l));f+=l.slice(h,m+1);h=m+2}else if(f+=l.slice(h,n),h=n+1,"{"===l.charAt(h))f+="{",
h++;else{if(0>m)throw Error(a.format(RIAPP.ERRS.ERR_STRING_FORMAT_INVALID,l));var n=l.substring(h,m),g=n.indexOf(":"),h=parseInt(0>g?n:n.substring(0,g),10)+1;if(isNaN(h))throw Error(a.format(RIAPP.ERRS.ERR_STRING_FORMAT_INVALID,l));n=0>g?"":n.substring(g+1);h=d[h];if(void 0===h||null===h)h="";f=h.format?f+h.format(n):f+h.toString();h=m+1}}return f}};String.format||(String.format=function(){var f=Array.prototype.slice.call(arguments);return a.format.apply(a,f)});return a}();
RIAPP.BaseObject={_create:function(){this.__events=this._super=null;this._isDestroyCalled=this._isDestroyed=!1},create:function(){var a=Object.create(this);a._create.apply(a,arguments);Object.seal(a);return a},extend:function(a,f,d){var l=f||{},h,n=0,m,g,b=/\._super\s*\(/;Object.getOwnPropertyNames(l).forEach(function(b){b=l[b];void 0===b.enumerable&&(b.enumerable=!0);void 0===b.configurable&&(b.configurable=!1)});l._typeName=Object.getOwnPropertyDescriptor({_typeName:""},"_typeName");l.__eventNames=
Object.getOwnPropertyDescriptor({__eventNames:[]},"__eventNames");if(a){h=Object.getOwnPropertyNames(a);n=0;for(m=h.length;n<m;n+=1)f=h[n],l.hasOwnProperty(f)||(l[f]=Object.getOwnPropertyDescriptor(a,f))}g=Object.create(this,l);Object.getOwnPropertyNames(g).forEach(function(c){var e=Object.getOwnPropertyDescriptor(g,c),k,p,a;e.value&&RIAPP.utils.isFunc(e.value)&&(p=e.value.toString(),k=g[c],b.test(p)?(a=Object.getPrototypeOf(g),e.value="destroy"==c?function(){var b=this._super;this._super=a[c];try{return this._isDestroyCalled=
!0,k.apply(this,arguments)}finally{this._super=b}}:function(){var b=this._super;this._super=a[c];try{return k.apply(this,arguments)}finally{this._super=b}},Object.defineProperty(g,c,e)):"destroy"==c&&(e.value=function(){this._isDestroyCalled=!0;return k.apply(this,arguments)},Object.defineProperty(g,c,e)))});g.__eventNames=g._getEventNames();d&&d(g);return g},_addHandler:function(a,f,d,l){if(!this._isDestroyed){if(!RIAPP.utils.isFunc(f))throw Error(RIAPP.ERRS.ERR_EVENT_INVALID_FUNC);if(!a)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_EVENT_INVALID,
a));null===this.__events&&(this.__events={});var h=this.__events,n="*";d&&(n=""+d);h[a]||(h[a]=[]);a=h[a];a.some(function(a){return a.fn===f&&a.ns==n})||(l?a.unshift({fn:f,ns:n}):a.push({fn:f,ns:n}))}},_removeHandler:function(a,f){var d=this.__events,l="*";if(d){f&&(l=""+f);var h,n,m;if(a){if(d[a])if("*"==l)delete d[a];else{h=d[a];n=h.filter(function(g){return g.ns==l});for(m=h.length;0<m;)m-=1,-1<n.indexOf(h[m])&&h.splice(m,1);0==h.length&&delete d[a]}}else"*"!=l?Object.keys(d).forEach(function(g){var b=
d[g],c=b.filter(function(b){return b.ns==l});for(m=b.length;0<m;)m-=1,-1<c.indexOf(b[m])&&b.splice(m,1);0==b.length&&delete d[g]}):this.__events=null}},_raiseEvent:function(a,f){var d=this,l=d.__events;null!==l&&a&&("0*"!=a&&RIAPP.utils.startsWith(a,"0")&&this._raiseEvent("0*",f),l[a]&&Array.clone(l[a]).forEach(function(a){a.fn.apply(d,[d,f])}))},_onError:function(a,f){if(RIAPP.global&&RIAPP.global._checkIsDummy(a))return!0;a.message||(a=Error(""+a));var d={error:a,source:f,isHandled:!1};this._raiseEvent("error",
d);return d.isHandled},_getEventNames:function(){return["error","destroyed"]},_checkEventName:function(a){if(-1===this.__eventNames.indexOf(a))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_EVENT_INVALID,a));},raisePropertyChanged:function(a){this._raiseEvent("0"+a,{property:a})},addHandler:function(a,f,d){this._checkEventName(a);this._addHandler(a,f,d,!1)},removeHandler:function(a,f){a&&this._checkEventName(a);this._removeHandler(a,f)},addOnDestroyed:function(a,f){this._addHandler("destroyed",a,f,
!1)},removeOnDestroyed:function(a){this._removeHandler("destroyed",a)},removeNSHandlers:function(a){this._removeHandler(void 0,a)},raiseEvent:function(a,f){this._checkEventName(a);this._raiseEvent(a,f)},getEventNames:function(){return this.__eventNames},addOnPropertyChange:function(a,f,d){if(!a)throw Error(RIAPP.ERRS.ERR_PROP_NAME_EMPTY);this._addHandler("0"+a,f,d,!1)},removeOnPropertyChange:function(a,f){a&&(a="0"+a);this._removeHandler(a,f)},destroy:function(){if(!this._isDestroyed){this._isDestroyed=
!0;try{this._raiseEvent("destroyed",{})}finally{this.__events=null}}},toString:function(){return this._typeName?this._typeName:"RIAPP Object"}};RIAPP._glob_modules="array_ext consts errors defaults utils riapp".split(" ");RIAPP._app_modules="converter parser baseElView binding template mvvm collection db listbox datadialog baseContent datagrid pager stackpanel dataform elview content".split(" ");RIAPP.css_riaTemplate="ria-template";
RIAPP.Global=RIAPP.BaseObject.extend({version:"1.2.3.3",_TEMPLATES_SELECTOR:["section.",RIAPP.css_riaTemplate].join(""),_TEMPLATE_SELECTOR:'*[data-role="template"]',__coreModules:{},_create:function(a,f){this._super();if(RIAPP.global)throw Error(RIAPP.ERRS.ERR_GLOBAL_SINGLTON);if(!f)throw Error(RIAPP.ERRS.ERR_APP_NEED_JQUERY);var d,l;this._window=a;this._appInst={};this._$=f;this._modInst={};this._defaults=this._currentSelectable=null;this._userCode={};this._exports={};this._consts=this._utils=null;
this._templateLoaders={};this._promises=[];for(var h=this._nextAppInstanceNum=0;h<RIAPP._glob_modules.length;h+=1)d={},l=RIAPP._glob_modules[h],this._coreModules[l].apply(d,[this]),Object.freeze(d),this._modInst[RIAPP._glob_modules[h]]=d;this._init();Object.freeze(this._coreModules);this._waitQueue=this.utils.WaitQueue.create(this)},_getNextAppNum:function(){return this._nextAppInstanceNum+=1},_init:function(){var a=this;a.$(a.document).ready(function(f){a._processTemplateSections(a.document);a.raiseEvent("load",
{})});a.$(a.document).on("click.global",function(f){f.stopPropagation();a.currentSelectable=null});a.$(a.document).on("keydown.global",function(f){f.stopPropagation();a._currentSelectable&&a._currentSelectable._onKeyDown(f.which,f)});a.$(a.document).on("keyup.global",function(f){f.stopPropagation();a._currentSelectable&&a._currentSelectable._onKeyUp(f.which,f)});a.$(a.window).unload(function(){a.raiseEvent("unload",{})});a.window.onerror=function(a,d,l){if(a&&-1<a.indexOf("DUMMY_ERROR"))return!0;
alert("Error message: "+a+"\nURL: "+d+"\nLine Number: "+l);return!1}},_getEventNames:function(){var a=this._super();return["load","unload"].concat(a)},_onGridAdded:function(a){var f=this,d=f.utils,l=a.$container;l.on("click."+a.uniqueID,function(h){h.stopPropagation();d.isContained(h.target,l.get(0))&&(f.currentSelectable=a)})},_onGridRemoved:function(a){a.$container.off("click."+a.uniqueID);this.currentSelectable===a&&(this.currentSelectable=null)},_onStackPanelAdded:function(a){var f=this,d=f.utils,
l=a._$el;l.on("click."+a.uniqueID,function(h){h.stopPropagation();d.isContained(h.target,l.get(0))&&(f.currentSelectable=a)})},_onStackPanelRemoved:function(a){a._$el.off("click."+a.uniqueID);this.currentSelectable===a&&(this.currentSelectable=null)},_registerApp:function(a){this._appInst[a.appName]||(this._appInst[a.appName]=a)},_unregisterApp:function(a){this._appInst[a.appName]&&(delete this._appInst[a.appName],delete this._templateLoaders[a.appName])},_destroyApps:function(){var a=this;this.utils.forEachProp(this._appInst,
function(f){a._appInst[f].destroy()})},_throwDummy:function(a){var f=this.modules.errors;if(f&&a&&!a.isDummy)throw f.DummyError.create(a);throw a;},_checkIsDummy:function(a){return!!a.isDummy},_registerType:function(a,f,d){var l=f.split(".");a=a._exports;var h;for(h=0;h<l.length-1;h+=1)a[l[h]]||(a[l[h]]={}),a=a[l[h]];l=l[l.length-1];if(a[l])throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_TYPE_ALREDY_REGISTERED,f));d._typeName=f;a[l]=d;return a},_getType:function(a,f){var d=f.split("."),l=a._exports,
h;for(h=0;h<d.length;h+=1){if(!l[d[h]])return null;l=l[d[h]]}return l},_processTemplateSections:function(a){var f=this;Array.fromList(a.querySelectorAll(f._TEMPLATES_SELECTOR)).forEach(function(a){f._processTemplateSection(a,null);f.utils.removeNode(a)})},_processTemplateSection:function(a,f){var d=this;Array.fromList(a.querySelectorAll(d._TEMPLATE_SELECTOR)).forEach(function(a){var h=d.document.createElement("div"),n=a.getAttribute("id"),m=d.utils.createDeferred();a.removeAttribute("id");h.appendChild(a);
m.resolve(h.innerHTML);f&&(n=f.appName+"."+n);d._registerTemplateLoader(n,function(){return m.promise()})})},_registerTemplateLoader:function(a,f){if(!this.utils.check_is.Function(f))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_ASSERTION_FAILED,"fn_loader is Function"));var d=a.split("."),l=this._templateLoaders,h;for(h=0;h<d.length-1;h+=1)l[d[h]]||(l[d[h]]={}),l=l[d[h]];d=d[d.length-1];if(l[d])throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_TEMPLATE_ALREDY_REGISTERED,a));l[d]=f;return l},_getTemplateLoader:function(a){a=
a.split(".");var f=this._templateLoaders,d;for(d=0;d<a.length;d+=1){if(!f[a[d]])return null;f=f[a[d]]}return f},_waitForNotLoading:function(a,f){this._waitQueue.enQueue({prop:"isLoading",groupName:null,predicate:function(a){return!a},action:a,actionArgs:f})},_loadTemplatesAsync:function(a,f){var d=this,l=a(),h=d.isLoading;d._promises.push(l);d.isLoading!==h&&d.raisePropertyChanged("isLoading");l.done(function(a){d.utils.removeFromArray(d._promises,l);try{var m=d.document.createElement("div");m.innerHTML=
a;d._processTemplateSection(m,f)}catch(g){d._onError(g,d)}d.isLoading||d.raisePropertyChanged("isLoading")});l.fail(function(a){d.utils.removeFromArray(d._promises,l);d.isLoading||d.raisePropertyChanged("isLoading");a&&a.message?d._onError(a,d):a&&a.responseText?d._onError(Error(a.responseText),d):d._onError(Error("Failed to load templates"),d)})},reThrow:function(a,f){if(f)this._throwDummy(a);else throw a;},findApp:function(a){return this._appInst[a]},destroy:function(){this._isDestroyed||(this._waitQueue&&
(this._waitQueue.destroy(),this._waitQueue=null),this._promises=[],this.removeHandler(),this._destroyApps(),this._modInst={},this._exports={},this._templateLoaders={},this.$(this.document).off(".global"),RIAPP.Application=null,RIAPP.global=null,this.window.onerror=null,this._super())},registerType:function(a,f){return this._registerType(this,a,f)},getType:function(a){return this._getType(this,a)},getImagePath:function(a){return this.defaults.imagesPath+a},loadTemplates:function(a){var f=this;this._loadTemplatesAsync(function(){return f.utils.performAjaxGet(a)},
null)},toString:function(){return"Global"}},{_coreModules:{get:function(){return this.__coreModules}},isLoading:{get:function(){return 0<this._promises.length}},$:{get:function(){return this._$}},modules:{get:function(){return this._modInst}},window:{get:function(){return this._window}},document:{get:function(){return this._window.document}},currentSelectable:{set:function(a){this._currentSelectable!==a&&(this._currentSelectable=a,this.raisePropertyChanged("currentSelectable"))},get:function(){return this._currentSelectable}},
defaults:{set:function(a){this._defaults!==a&&(this._defaults=a,this.raisePropertyChanged("defaults"))},get:function(){return this._defaults}},consts:{set:function(a){if(this._consts)throw Error("Global consts already initialized");this._consts=a},get:function(){return this._consts}},utils:{set:function(a){if(this._utils)throw Error("Global utils already initialized");this._utils=a},get:function(){return this._utils}},UC:{get:function(){return this._userCode}}},null);
RIAPP.Global._coreModules.array_ext=function(a){Array.prototype.distinct=function(){var a={},d,l=this.length,h=[];for(d=0;d<l;d+=1)a[this[d]]=this[d];var n=Object.keys(a);d=0;for(l=n.length;d<l;d+=1)h.push(a[n[d]]);return h};Array.prototype.intersect=function(a){return this.filter(function(d){return-1<a.indexOf(d)})};Array.fromList=function(a){for(var d=Array(a.length),l=0,h=a.length;l<h;l++)d[l]=a[l];return d}};
RIAPP.Global._coreModules.consts=function(a){var f={};this.CHUNK_SEP="$&@";f.DATA_ATTR={EL_VIEW_KEY:"data-elvwkey",DATA_BIND:"data-bind",DATA_VIEW:"data-view",DATA_APP:"data-app",DATA_EVENT_SCOPE:"data-scope",DATA_ITEM_KEY:"data-key",DATA_CONTENT:"data-content",DATA_COLUMN:"data-column",DATA_NAME:"data-name"};f.DATA_TYPE={None:0,String:1,Bool:2,Integer:3,Decimal:4,Float:5,DateTime:6,Date:7,Time:8,Guid:9,Binary:10};f.CHANGE_TYPE={NONE:0,ADDED:1,UPDATED:2,DELETED:3};f.KEYS={backspace:8,tab:9,enter:13,
esc:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,del:127};f.ELVIEW_NM={DATAFORM:"dataform",DYNACONT:"dynacontent"};Object.getOwnPropertyNames(f).forEach(function(a){Object.freeze(f[a])});Object.freeze(f);this.consts=f;a.consts=this.consts};
RIAPP.Global._coreModules.errors=function(a){var f=this;RIAPP.BaseObject.extend({_create:function(a){this._super();this._message=a;this._isDummy=!1;this._origError=null},toString:function(){return this._message}},{message:{set:function(a){this._message=a},get:function(){return this._message}},isDummy:{set:function(a){this._isDummy=a},get:function(){return this._isDummy}},origError:{set:function(a){this._origError=a},get:function(){return this._origError}}},function(a){f.BaseError=a}).extend({_create:function(a){this._super("DUMMY_ERROR");
this._origError=a;this._isDummy=!0}},null,function(a){f.DummyError=a})};
RIAPP.Global._coreModules.defaults=function(a){var f=this,d=RIAPP.BaseObject.extend({_create:function(){this._super();this._datepickerRegional=this._imagesPath="";if(!a.$.datepicker)throw Error(RIAPP.ERRS.ERR_JQUERY_DATEPICKER_NOTFOUND);this._datepickerDefaults=a.$.datepicker.regional[this._datepickerRegional];this._dateTimeFormat="dd.MM.yyyy HH:mm:ss";this._timeFormat="HH:mm:ss";this._decimalPoint=",";this._thousandSep=" ";this._decPrecision=2;this._ajaxTimeOut=600},destroy:function(){this._super()},
_setDatePickerRegion:function(d){this.datepickerDefaults=d?a.$.datepicker.regional[d]:a.$.datepicker.regional[""]},toString:function(){return"Defaults"}},{ajaxTimeOut:{set:function(a){this._ajaxTimeOut!==a&&(this._ajaxTimeOut=a,this.raisePropertyChanged("ajaxTimeOut"))},get:function(){return this._ajaxTimeOut}},dateFormat:{set:function(d){this._datepickerDefaults.dateFormat!==d&&(this._datepickerDefaults.dateFormat=d,a.$.datepicker.setDefaults(this._datepickerDefaults),this.raisePropertyChanged("dateFormat"))},
get:function(){return this._datepickerDefaults.dateFormat}},timeFormat:{set:function(a){this._timeFormat!==a&&(this._timeFormat=a,this.raisePropertyChanged("timeFormat"))},get:function(){return this._timeFormat}},dateTimeFormat:{set:function(a){this._dateTimeFormat!==a&&(this._dateTimeFormat=a,this.raisePropertyChanged("timeFormat"))},get:function(){return this._dateTimeFormat}},datepickerDefaults:{set:function(d){d||(d=a.$.datepicker.regional[this._datepickerRegional]);var h=this._datepickerDefaults;
this._datepickerDefaults=d;a.$.datepicker.setDefaults(d);h.dateFormat!==d.dateFormat&&this.raisePropertyChanged("dateFormat")},get:function(){return this._datepickerDefaults}},datepickerRegional:{set:function(a){a||(a="");this._datepickerRegional!==a&&(this._datepickerRegional=a,this._setDatePickerRegion(a),this.raisePropertyChanged("datepickerRegional"))},get:function(){return this._datepickerRegional}},imagesPath:{set:function(a){a||(a="");this._imagesPath!==a&&(RIAPP.utils.endsWith(a,"/")?this._imagesPath=
a:this._imagesPath=a+"/",this.raisePropertyChanged("imagesPath"))},get:function(){return this._imagesPath}},decimalPoint:{set:function(a){this._decimalPoint!==a&&(this._decimalPoint=a,this.raisePropertyChanged("decimalPoint"))},get:function(){return this._decimalPoint}},thousandSep:{set:function(a){this._thousandSep!==a&&(this._thousandSep=a,this.raisePropertyChanged("thousandSep"))},get:function(){return this._thousandSep}},decPrecision:{set:function(a){this._decPrecision!==a&&(this._decPrecision=
a,this.raisePropertyChanged("decPrecision"))},get:function(){return this._decPrecision}}},function(a){f.Defaults=a});a.defaults=d.create();a.defaults.dateFormat="dd.mm.yy";a.defaults.imagesPath="/Scripts/jriapp/img/"};
RIAPP.Global._coreModules.utils=function(a){var f=this,d=RIAPP.utils,l=0,h={Null:function(b){return null===b},Undefined:function(b){return void 0===b},nt:function(b){return null===b||void 0===b},Function:d.isFunc,String:function(b){if(h.nt(b))return!1;var c=/string/i;return"string"===typeof b?!0:"object"===typeof b?c.test(b.constructor.toString()):!1},Array:d.isArray,Boolean:function(b){if(h.nt(b))return!1;var c=/boolean/i;return"boolean"===typeof b?!0:"object"===typeof b?c.test(b.constructor.toString()):
!1},Date:function(b){if(h.nt(b))return!1;var c=/date/i;return"date"===typeof b?!0:"object"===typeof b?c.test(b.constructor.toString()):!1},HTML:function(b){if(h.nt(b))return!1;var c=/html/i;return"object"===typeof b?c.test(b.constructor.toString()):!1},Number:function(b){if(h.nt(b))return!1;var c=/Number/;return"number"===typeof b?!0:"object"===typeof b?c.test(b.constructor.toString()):!1},Object:function(b){if(h.nt(b))return!1;var c=/object/i;return"object"===typeof b?c.test(b.constructor.toString()):
!1},SimpleObject:function(b){return h.nt(b)?!1:h.Object(b)&&Object.prototype===Object.getPrototypeOf(b)},RegExp:function(b){if(h.nt(b))return!1;var c=/regexp/i;return"function"===typeof b?c.test(b.constructor.toString()):!1},Numeric:function(b){return h.Number(b)||h.String(b)&&!isNaN(Number(b))},BoolString:function(b){return h.nt(b)?!1:"true"==b||"false"==b}},n={checkNumRange:function(b,c){var e=c.split(",");if(e[0]&&b<parseFloat(e[0]))throw Error(String.format(RIAPP.ERRS.ERR_FIELD_RANGE,b,c));if(e[1]&&
b>parseFloat(e[1]))throw Error(String.format(RIAPP.ERRS.ERR_FIELD_RANGE,b,c));},_dtRangeToDate:function(b){b=b.split("-");return new Date(parseInt(b[0],10),parseInt(b[1],10)-1,b[2])},checkDateRange:function(b,c){var e=c.split(",");if(e[0]&&b<n._dtRangeToDate(e[0]))throw Error(String.format(RIAPP.ERRS.ERR_FIELD_RANGE,b,c));if(e[1]&&b>n._dtRangeToDate(e[1]))throw Error(String.format(RIAPP.ERRS.ERR_FIELD_RANGE,b,c));}},m={str:{endsWith:d.endsWith,startsWith:d.startsWith,trim:d.trim,formatNumber:function(b,
c,e,g){b=(b+"").replace(/[^0-9+-Ee.]/g,"");var p=!isFinite(+b)?0:+b;b=!isFinite(+c)?0:Math.abs(c);g=void 0===g?",":g;e=void 0===e?".":e;var a="",a=function(b,c){var e=Math.pow(10,c);return""+Math.round(b*e)/e};m.check_is.nt(c)?(a=(""+p).split("."),b=2):a=(b?a(p,b):""+Math.round(p)).split(".");var p="",d=a[0].length;if(3<d){for(c=0;c<d;c+=1)p+=a[0].charAt(c),c<d-1&&0===(d-c-1)%3&&(p+=g);a[0]=p}if((a[1]||"").length<b)a[1]=a[1]||"",a[1]+=Array(b-a[1].length+1).join("0");return a.join(e)},stripNonNumeric:function(b){b+=
"";for(var c=/^\d|\.|-$/,e="",a=0;a<b.length;a++)c.test(b.charAt(a))&&("."==b.charAt(a)&&-1!=e.indexOf(".")||"-"==b.charAt(a)&&0!=e.length||(e+=b.charAt(a)));return e}},check_is:h,validation:n,getNewID:function(){var b=l;l+=1;return b},isContained:function(b,c){if(!b)return!1;for(;b=b.parentNode;)if(b===c)return!0;return!1},slice:Array.prototype.slice,get_timeZoneOffset:function(){var b=(new Date).getTimezoneOffset();return function(){return b}}(),parseBool:function(b){var c=d.trim(b).toLowerCase();
if("false"===c)return!1;if("true"===c)return!0;throw Error(m.format(RIAPP.ERRS.ERR_PARAM_INVALID,"bool_value",b));},round:function(b,c){return parseFloat(b.toFixed(c))},performAjaxCall:function(b,c,e,g,p,u){var d=new XMLHttpRequest;d.open("POST",b,e);var h=m.createDeferred();d.responseType="text";d.onload=function(b){200==this.status&&h.resolve(this.response)};d.onerror=function(b){h.reject(Error(b.target.status))};d.ontimeout=function(){h.reject(Error("The request for "+b+" timed out."))};d.timeout=
1E3*a.defaults.ajaxTimeOut;d.setRequestHeader("Content-Type","application/json; charset=utf-8");d.send(c);c=h.promise();g&&c.done(function(b){g.call(u,b)});p&&c.fail(function(b){p.call(u,b)});return c},performAjaxGet:function(b){var c=new XMLHttpRequest;c.open("GET",b,!0);var e=m.createDeferred();c.responseType="text";c.onload=function(b){200==this.status&&e.resolve(this.response)};c.onerror=function(b){e.reject(Error(b.target.status))};c.ontimeout=function(){e.reject(Error("The request for "+b+" timed out."))};
c.timeout=1E3*a.defaults.ajaxTimeOut;c.send(null);return e.promise()},format:d.format,extend:function(b,c,e){return b?m.cloneObj(e,c):m.mergeObj(e,c)},removeNode:function(b){if(b){var c=b.parentNode;c&&c.removeChild(b)}},insertAfter:function(b,c){var e=b.parentNode;e.lastChild===b?e.appendChild(c):e.insertBefore(c,b.nextSibling)},getProps:function(b){return Object.getOwnPropertyNames(b)},forEachProp:function(b,c){Object.getOwnPropertyNames(b).forEach(c)},addToolTip:function(b,c,e){e={content:{text:c},
style:{classes:e?e:null},position:{my:"top left",at:"bottom right",target:b,viewport:$(a.window),adjust:{method:"flip none",x:0,y:0}},hide:{fixed:!0,delay:250}};b.data("qtip")?c?b.qtip("option","content.text",c):b.qtip("destroy"):c&&b.qtip(e)},hasProp:function(b,c){if(!b)return!1;if(b.hasOwnProperty(c))return!0;if(Object===b)return!1;var e=Object.getPrototypeOf(b);return m.hasProp(e,c)},createDeferred:function(){return a.$.Deferred()},cloneObj:function(b,c){var e,a,p;if(!b)return b;if(h.Array(b)){p=
b.length;e=Array(p);for(a=0;a<p;a+=1)e[a]=m.cloneObj(b[a],null)}else if(h.SimpleObject(b)){e=c||{};var g,d=Object.getOwnPropertyNames(b);p=d.length;for(a=0;a<p;a+=1)g=d[a],e[g]=m.cloneObj(b[g],null)}else return b;return e},shallowCopy:function(b){return m.mergeObj(b,{})},mergeObj:function(b,c){c||(c={});if(!b)return c;for(var e=Object.getOwnPropertyNames(b),a,p=0,g=e.length;p<g;p+=1)a=e[p],c[a]=b[a];return c},removeFromArray:function(b,c){var e=b.indexOf(c);-1<e&&b.splice(e,1);return e},insertIntoArray:function(b,
c,e){b.splice(e,0,c)},destroyJQueryPlugin:function(b,c){if(b.data(c))b[c]("destroy")},uuid:function(){var b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");return function(c,e){var a,p=[],g=Math.random;e=e||b.length;if(c)for(a=0;a<c;a+=1)p[a]=b[0|g()*e];else{var d;p[8]=p[13]=p[18]=p[23]="-";p[14]="4";for(a=0;36>a;a+=1)p[a]||(d=0|16*g(),p[a]=b[19==a?d&3|8:d&15])}return p.join("")}}()},g=RIAPP.BaseObject.extend({_cnt:0,_create:function(){this._super();this._objs=[];g._cnt+=
1;this._cnt=g._cnt},addObj:function(b){0>this._objs.indexOf(b)&&this._objs.push(b)},removeObj:function(b){m.removeFromArray(this._objs,b)},getObjs:function(){return this._objs},destroy:function(){this._objs.forEach(function(b){b._isDestroyCalled||b.destroy()});this._objs=[];this._super()},toString:function(){return"LifeTimeScope "+this._cnt}},null,function(b){f.LifeTimeScope=b});f.PropWatcher=RIAPP.BaseObject.extend({_create:function(){this._super();this._objId="prw"+m.getNewID();this._objs=[]},addPropWatch:function(b,
c,e){b.addOnPropertyChange(c,function(b,c){e(c.property)},this.uniqueID);0>this._objs.indexOf(b)&&this._objs.push(b)},addWatch:function(b,c,e){b.addOnPropertyChange("*",function(b,p){-1<c.indexOf(p.property)&&e(p.property)},this.uniqueID);0>this._objs.indexOf(b)&&this._objs.push(b)},removeWatch:function(b){b.removeNSHandlers(this.uniqueID)},destroy:function(){var b=this;this._objs.forEach(function(c){b.removeWatch(c)});this._objs=[];this._super()},toString:function(){return"PropWatcher "+this._objId}},
{uniqueID:{get:function(){return this._objId}}},function(b){a.registerType("PropWatcher",b)});f.WaitQueue=RIAPP.BaseObject.extend({_create:function(b){this._super();this._objId="wq"+m.getNewID();this._owner=b;this._queue={}},_checkQueue:function(b,c){if(this._owner&&!this._owner._isDestroyCalled){var e=this,a=this._queue[b],p;if(a&&0!=a.length){var g,d,m=null,h=[],f=[],n=[];for(g=0;g<a.length;g+=1)if(p=a[g],p.predicate(c))if(!p.group&&0==h.length){d=p;break}else p.group&&(m||(m=p.group),m===p.group&&
h.push(p));if(d)f.push(d),n.push(d);else for(;0<h.length;)p=h.pop(),d||(d=p),d.lastWins?0==f.length&&f.push(p):f.push(p),n.push(p);try{if(0<f.length){for(g=a.length;0<g;)g-=1,-1<n.indexOf(a[g])&&a.splice(g,1);f.forEach(function(r){try{r.action.apply(e._owner,r.args)}catch(b){e._owner._onError(b,e)}})}}finally{0==a.length&&(delete this._queue[b],this._owner.removeOnPropertyChange(b,this.uniqueID))}}}},enQueue:function(b){b=m.extend(!1,{prop:"",groupName:null,predicate:null,action:null,actionArgs:[],
lastWins:!1,syncCheck:!1},b);var c=this;if(this._owner){var e=b.prop,a=this._queue[e];a||(a=[],this._queue[e]=a,this._owner.addOnPropertyChange(e,function(b,a){setTimeout(function(){c._isDestroyCalled||c._checkQueue(e,c._owner[e])},0)},c.uniqueID));a.push({predicate:b.predicate,action:b.action,group:b.groupName,lastWins:b.lastWins,args:!b.actionArgs?[]:b.actionArgs});b.syncCheck?c._checkQueue(e,c._owner[e]):setTimeout(function(){c._isDestroyCalled||c._checkQueue(e,c._owner[e])},0)}},destroy:function(){this._owner.removeOnPropertyChange(null,
this.uniqueID);this._queue={};this._owner=null;this._super()},toString:function(){return"WaitQueue "+this._objId}},{uniqueID:{get:function(){return this._objId}},owner:{get:function(){return this._owner}}},null);m.mergeObj(m,f);a.utils=f};
RIAPP.Global._coreModules.riapp=function(a){var f=this,d=a.utils,l=a.consts,h={},n={},m=RIAPP.BaseObject.extend({_DATA_BIND_SELECTOR:["*[",l.DATA_ATTR.DATA_BIND,"]"].join(""),_TEMPLATES_DATA_BIND_SELECTOR:["section.",RIAPP.css_riaTemplate," *[",l.DATA_ATTR.DATA_BIND,"]"].join(""),registerModule:function(a,b){if(n[a])throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_MODULE_ALREDY_REGISTERED,a));n[a]=b},_create:function(g){this._super();g=d.extend(!1,{app_name:"default",service_url:"",metadata:null,createDbContext:!0,
moduleNames:[]},g);var b=g.app_name;if(a.findApp(b))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_APP_NAME_NOT_UNIQUE,b));Object.freeze(g);this._options=g;this._parser=null;this._converters={};this._lftmBind=this._dbContext=null;this._instanceNum=a._getNextAppNum();this._ELV_STORE_KEY=l.DATA_ATTR.EL_VIEW_KEY+this._instanceNum;this._bindingContentFactory=null;this._modInst={};this._exports={};this._elViews={};this._elViewStore={};this._global=a;this._nextElViewStoreKey=0;this._userCode={};this._viewModels=
{};var c,e;c=0;for(e=RIAPP._app_modules.length;c<e;c+=1)b={},h[RIAPP._app_modules[c]].apply(b,[this]),Object.freeze(b),this._modInst[RIAPP._app_modules[c]]=b;g=d.check_is.Array(g.moduleNames)&&0<g.moduleNames.length?g.moduleNames:[];c=0;for(e=g.length;c<e;c+=1){if(!n[g[c]])throw Error(String.format(RIAPP.ERRS.ERR_MODULE_UNDEFINED,g[c]));b={};n[g[c]].apply(b,[this]);Object.freeze(b);this._modInst[g[c]]=b}a._registerApp(this)},destroy:function(){this._isDestroyed||(a._unregisterApp(this),this._destroyBindings(),
this._dbContext&&(this._dbContext.destroy(),this._dbContext=null),this._elViews={},this._exports={},this._parser=this._options=this._global=null,this._converters={},this._elViewStore={},this._userCode={},this._viewModels={},this._modInst={},this._bindingContentFactory=null,this._super())},_getEventNames:function(){var a=this._super();return["define_calc"].concat(a)},_onError:function(g,b){if(a._checkIsDummy(g))return!0;var c=this._super(g,b);return!c?a._onError(g,b):c},_onGetCalcField:function(a){this.raiseEvent("define_calc",
a)},_getBindingOption:function(a,b,c){var e={mode:this.modules.binding.BINDING_MODE[1],converterParam:null,converter:null,targetPath:null,sourcePath:null,target:null,source:null,isSourceFixed:!1},k=a.source,p=a.target;!a.sourcePath&&a.to?e.sourcePath=a.to:a.sourcePath&&(e.sourcePath=a.sourcePath);a.targetPath&&(e.targetPath=a.targetPath);a.converterParam&&(e.converterParam=a.converterParam);a.mode&&(e.mode=a.mode);a.converter&&(d.check_is.String(a.converter)?e.converter=this.getConverter(a.converter):
e.converter=a.converter);p?d.check_is.String(p)?e.target="this"==p?b:this.parser.resolveBindingSource(this,this.parser._getPathParts(p)):e.target=p:e.target=b;k?(e.isSourceFixed=!0,d.check_is.String(k)?e.source="this"==k?b:this.parser.resolveBindingSource(this,this.parser._getPathParts(k)):e.source=k):e.source=c;return e},_getElViewType:function(a){return this._elViews[a]},_getElView:function(a){return(a=a.getAttribute(this._ELV_STORE_KEY))?this._elViewStore[a]:null},_setElView:function(a,b){var c=
a.getAttribute(this._ELV_STORE_KEY);c?b?this._elViewStore[c]=b:(a.removeAttribute(this._ELV_STORE_KEY),delete this._elViewStore[c]):b&&(c="s_"+this._nextElViewStoreKey,this._nextElViewStoreKey+=1,a.setAttribute(this._ELV_STORE_KEY,c),this._elViewStore[c]=b)},_isDataForm:function(a){if(!a)return!1;a=a.getAttribute(l.DATA_ATTR.DATA_VIEW);if(!a)return!1;a=this.parser.parseOptions(a);return 0<a.length&&a[0].name===l.ELVIEW_NM.DATAFORM},_isInsideDataForm:function(a){return!a?!1:(a=a.parentElement)?this._isDataForm(a)?
!0:this._isInsideDataForm(a):!1},_bindTemplateElements:function(a){var b=this,c=Array.fromList(a.querySelectorAll(b._DATA_BIND_SELECTOR)),e=d.LifeTimeScope.create();a.hasAttribute(l.DATA_ATTR.DATA_BIND)&&c.push(a);c.forEach(function(c){var p,a,g,d,m;if(!b._isInsideDataForm(c)){d=c.getAttribute(l.DATA_ATTR.DATA_BIND);c.removeAttribute(l.DATA_ATTR.DATA_BIND);d=b.parser.parseOptions(d);m=b.getElementView(c);e.addObj(m);p=0;for(a=d.length;p<a;p+=1)c=b._getBindingOption(d[p],m,null),g=b.bind(c),c.target=
null,e.addObj(g)}});return e},_bindElements:function(g,b,c){var e=this;g=g||a.document;g=Array.fromList(g.querySelectorAll(e._DATA_BIND_SELECTOR));var k=d.LifeTimeScope.create();g.forEach(function(p){var a,g;if(c||!e._isInsideDataForm(p)){if(!c&&(p.hasAttribute(l.DATA_ATTR.DATA_APP)&&(a=p.getAttribute(l.DATA_ATTR.DATA_APP)),a&&e.appName!==a||!a&&"default"!==e.appName))return;a=p.getAttribute(l.DATA_ATTR.DATA_BIND);p=e.getElementView(p);k.addObj(p);a=e.parser.parseOptions(a);for(var d=0,m=a.length;d<
m;d+=1)g=e._getBindingOption(a[d],p,b),g=e.bind(g),k.addObj(g)}});return k},_getContent:function(a,b,c,e,d){if(b.templateInfo)a=a.create(c,b.templateInfo,e,d);else if(b.bindingInfo)a=a.create(c,b,e,d);else throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"options","bindingInfo"));return a},_getContentType:function(a){if(a.templateInfo)a=this.modules.baseContent.TemplateContent;else if(a.bindingInfo)a=this.bindingContentFactory.getContentType(a);else throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,
"options","bindingInfo"));return a},_parseContentAttr:function(a){var b={templateInfo:null,bindingInfo:null,displayInfo:null,fieldName:null};a=this.parser.parseOptions(a);if(0===a.length)return b;a=a[0];!a.template&&a.fieldName?(a.bindingInfo={target:null,source:null,targetPath:null,sourcePath:a.fieldName,mode:"OneWay",converter:null,converterParam:null},a.displayInfo=a.css):a.template&&(a.templateInfo=a.template,delete a.template);return d.extend(!1,b,a)},_destroyBindings:function(){this._lftmBind&&
(this._lftmBind.destroy(),this._lftmBind=null)},getNewObjectID:function(){return d.getNewID()},setUpBindings:function(){var g=a.document;this._destroyBindings();this._lftmBind=this._bindElements(g,this,!1)},registerElView:function(a,b){this._elViews[a]||(this._elViews[a]=b)},getElementView:function(a){var b,c,e;if(c=this._getElView(a))return c;if(a.hasAttribute(l.DATA_ATTR.DATA_VIEW)&&(c=a.getAttribute(l.DATA_ATTR.DATA_VIEW),(c=this.parser.parseOptions(c))&&0<c.length)){c=c[0];if(c.name&&"default"!==
c.name&&(b=this._getElViewType(c.name),!b))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_ELVIEW_NOT_REGISTERED,c.name));c.options&&(e=c.options)}if(!b){c=a.nodeName.toLowerCase();switch(c){case "input":b=a.getAttribute("type");c=c+":"+b;b=this._getElViewType(c);break;default:b=this._getElViewType(c)}if(!b)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_ELVIEW_NOT_CREATED,c));}return c=b.create(a,e||{})},registerConverter:function(a,b){if(this._converters[a])throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_TYPE_ALREDY_REGISTERED,
a));this._converters[a]=b},getConverter:function(a){var b=this._converters[a];if(!b)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CONVERTER_NOTREGISTERED,a));return b},registerType:function(g,b){return a._registerType(this,g,b)},getType:function(g){var b=a._getType(this,g);b||(b=a._getType(this.global,g));return b},bind:function(a){return this.getType("Binding").create(a)},startUp:function(g){var b=this,c=function(){g.apply(b,[b]);b.setUpBindings()};try{if(!d.check_is.Function(g))throw Error(RIAPP.ERRS.ERR_APP_SETUP_INVALID);
b.options.createDbContext?(b._dbContext=b.getType("DbContext").create(),b._dbContext.addHandler("define_calc",function(c,e){b._onGetCalcField(e)}),b._dbContext.initialize({serviceUrl:b.options.service_url,metadata:b.options.metadata}),a._waitForNotLoading(function(){b._dbContext.waitForInitialized(c,null)},null)):a._waitForNotLoading(c,null)}catch(e){a.reThrow(e,b._onError(e,b))}},loadTemplates:function(g){this.loadTemplatesAsync(function(){return a.utils.performAjaxGet(g)})},loadTemplatesAsync:function(g){a._loadTemplatesAsync(g,
this)},registerTemplateLoader:function(g,b){a._registerTemplateLoader(this.appName+"."+g,b)},getTemplateLoader:function(g){var b=a._getTemplateLoader(this.appName+"."+g);b||(b=a._getTemplateLoader(g));return b},toString:function(){return"Application"+this._instanceNum}},{_coreModules:{get:function(){return h}},bindingContentFactory:{get:function(){return this._bindingContentFactory},set:function(a){this._bindingContentFactory=a}},options:{get:function(){return this._options}},modules:{get:function(){return this._modInst}},
parser:{get:function(){return this._parser}},instanceNum:{get:function(){return this._instanceNum}},appName:{get:function(){return this.options.app_name}},global:{get:function(){return this._global}},dbContext:{get:function(){return this._dbContext}},UC:{get:function(){return this._userCode}},VM:{get:function(){return this._viewModels}},app:{get:function(){return this}},localizable:{get:function(){return RIAPP.localizable}}},function(g){f.Application=g;a.registerType("Application",g)});RIAPP.Application=
m};RIAPP.global=RIAPP.Global.create(window,jQuery,[]);
RIAPP.Application._coreModules.converter=function(a){var f=a.global,d=f.utils,l=d.str,h=RIAPP.BaseObject.extend({convertToSource:function(a,g,b){return a},convertToTarget:function(a,g,b){return d.check_is.nt(a)?null:a}},null,function(d){a.registerType("BaseConverter",d);a.registerConverter("BaseConverter",d)});h.extend({convertToSource:function(a,g,b){return!a?null:f.$.datepicker.parseDate(g,a)},convertToTarget:function(a,g,b){return d.check_is.nt(a)?"":f.$.datepicker.formatDate(g,a)},toString:function(){return"DateConverter"}},
null,function(d){a.registerConverter("dateConverter",d)});h.extend({convertToSource:function(a,g,b){if(!a)return null;g=Date.parseExact(a,g);if(!g)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CONV_INVALID_DATE,a));return g},convertToTarget:function(a,g,b){return d.check_is.nt(a)?"":a.toString(g)},toString:function(){return"DateTimeConverter"}},null,function(d){a.registerConverter("dateTimeConverter",d)});var n=h.extend({convertToSource:function(a,g,b){if(d.check_is.nt(a))return null;b=f.defaults;
var c=b.decimalPoint,e=4,k=a.replace(b.thousandSep,""),k=k.replace(c,"."),k=l.stripNonNumeric(k);if(""===k)return null;c=null;switch(g){case 4:c=parseInt(k,10);break;case 1:c=parseInt(k,10);break;case 2:e=b.decPrecision;c=d.round(parseFloat(k),e);break;case 3:c=parseFloat(k);break;default:c=Number(k)}if(!d.check_is.Number(c))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CONV_INVALID_NUM,a));return c},convertToTarget:function(a,g,b){if(d.check_is.nt(a))return"";var c=f.defaults;b=c.decimalPoint;var e=
c.thousandSep;switch(g){case 1:return l.formatNumber(a,0,b,e);case 2:return g=c.decPrecision,l.formatNumber(a,g,b,e);case 4:return l.formatNumber(a,0,b,"");case 3:return l.formatNumber(a,null,b,e);default:return l.formatNumber(a,null,b,e)}},toString:function(){return"NumberConverter"}},null,function(d){a.registerConverter("numberConverter",d)});h.extend({convertToSource:function(a,g,b){return n.convertToSource(a,1,b)},convertToTarget:function(a,g,b){return n.convertToTarget(a,1,b)},toString:function(){return"IntegerConverter"}},
null,function(d){a.registerConverter("integerConverter",d)});h.extend({convertToSource:function(a,g,b){return n.convertToSource(a,4,b)},convertToTarget:function(a,g,b){return n.convertToTarget(a,4,b)},toString:function(){return"SmallIntConverter"}},null,function(d){a.registerConverter("smallIntConverter",d)});h.extend({convertToSource:function(a,g,b){return n.convertToSource(a,2,b)},convertToTarget:function(a,g,b){return n.convertToTarget(a,2,b)},toString:function(){return"DecimalConverter"}},null,
function(d){a.registerConverter("decimalConverter",d)});h.extend({convertToSource:function(a,g,b){return n.convertToSource(a,3,b)},convertToTarget:function(a,g,b){return n.convertToTarget(a,3,b)},toString:function(){return"FloatConverter"}},null,function(d){a.registerConverter("floatConverter",d)})};
RIAPP.Application._coreModules.parser=function(a){var f=a.global.utils,d=f.str,l=RIAPP.BaseObject.extend({__trimOuterBracesRX:/^([{]){0,1}|([}]){0,1}$/g,__trimQuotsRX:/^(['"])+|(['"])+$/g,__trimBracketsRX:/^(\[)+|(\])+$/g,__indexedPropRX:/(^\w+)\s*\[\s*['"]?\s*([^'"]+)\s*['",]?\s*\]/i,__valueDelimeter1:":",__valueDelimeter2:"=",__keyValDelimeter:",",_getPathParts:function(a){var d=this,m=[];(!a?[]:a.split(".")).forEach(function(a){var b;(b=a.match(d.__indexedPropRX))?(a=b[1],b=b[2],m.push(a),m.push("["+
b+"]")):m.push(a)});return m},_resolveProp:function(h,f){var m;return!f?h:d.startsWith(f,"[")?(m=a.modules.collection,f=this.trimQuotes(this.trimBrackets(f)),m.Dictionary.isPrototypeOf(h)?h.getItemByKey(f):m.Collection.isPrototypeOf(h)?h.getItemByPos(parseInt(f,10)):RIAPP.utils.isArray(h)?h[parseInt(f,10)]:h[f]):h[f]},_resolvePath:function(a,d){return!a?void 0:0===d.length?a:1===d.length?this._resolveProp(a,d[0]):this._resolvePath(this._resolveProp(a,d[0]),d.slice(1))},_setPropertyValue:function(a,
d,f){RIAPP.utils.startsWith(d,"[")?(d=this.trimQuotes(this.trimBrackets(d)),RIAPP.utils.isArray(a)?a[parseInt(d,10)]=f:a[d]=f):a[d]=f},_getKeyVals:function(a){var n,m,g,b=[],c={key:"",val:""},e=!0,k=this.__valueDelimeter1,p=this.__valueDelimeter2,u=this.__keyValDelimeter,v=function(c){c.val&&(f.check_is.Numeric(c.val)?c.val=Number(c.val):f.check_is.BoolString(c.val)&&(c.val=f.parseBool(c.val)));b.push(c)};for(n=0;n<a.length;n+=1){m=a.charAt(n);if("'"===m||'"'===m)g?g===m&&(g=null):g=m;!g&&"{"===m&&
!e?(m=a.substr(n),m=this.getBraceParts(m,!0)[0],c.val+=m,n+=m.length-1):!g&&m===u?c.key&&(v(c),c={key:"",val:""},e=!0):!g&&(m===k||m===p)?e=!1:e?c.key+=m:c.val+=m}c.key&&v(c);b.forEach(function(b){b.key=d.trim(b.key);f.check_is.String(b.val)&&(b.val=d.trim(b.val));""===b.val&&d.startsWith(b.key,"this.")&&(b.val=b.key.substr(5),b.key="targetPath")});return b=b.filter(function(b){return""!==b.val})},resolveBindingSource:function(a,d){if(a){if(0===d.length)return a;if(0<d.length)return this.resolveBindingSource(this._resolveProp(a,
d[0]),d.slice(1));throw Error("Invalid operation");}},resolvePath:function(a,d){if(!d)return a;var f=this._getPathParts(d);return this._resolvePath(a,f)},getBraceParts:function(a,d){var f,g="",b,c,e=0,k=[];for(f=0;f<a.length;f+=1){b=a.charAt(f);if("'"===b||'"'===b)c?c===b&&(c=null):c=b;if(!c&&"{"===b)e+=1,g+=b;else if(!c&&"}"===b){if(e-=1,g+=b,0===e&&(k.push(g),g="",d))break}else 0<e&&(g+=b)}return k},trimOuterBraces:function(a){return d.trim(a.replace(this.__trimOuterBracesRX,""))},trimQuotes:function(a){return d.trim(a.replace(this.__trimQuotsRX,
""))},trimBrackets:function(a){return d.trim(a.replace(this.__trimBracketsRX,""))},isWithOuterBraces:function(a){return d.startsWith(a,"{")&&d.endsWith(a,"}")},parseOption:function(a){var n={},m=this;a=d.trim(a);m.isWithOuterBraces(a)&&(a=m.trimOuterBraces(a));m._getKeyVals(a).forEach(function(a){var b=f.check_is.String(a.val);b&&m.isWithOuterBraces(a.val)?n[a.key]=m.parseOption(a.val):n[a.key]=b?m.trimQuotes(a.val):a.val});return n},parseOptions:function(a){var f=[],m=this;a=d.trim(a);var g=[a];
m.isWithOuterBraces(a)&&(g=m.getBraceParts(a,!1));g.forEach(function(b){f.push(m.parseOption(b))});return f},toString:function(){return"Parser"}},null);a._parser=l.create()};
RIAPP.Application._coreModules.baseElView=function(a){var f=this,d=a.global,l=d.utils,h=d.consts,n=RIAPP.localizable.VALIDATE,m=f.css={fieldError:"ria-field-error",errorTip:"ui-tooltip-red",commandLink:"ria-command-link"};Object.freeze(m);var g=RIAPP.BaseObject.extend({_app:a,_create:function(b,a){this._super();this._el=b;this._oldDisplay=this._$el=null;this._objId="elv"+this._app.getNewObjectID();this._propChangedCommand=null;this._app._setElView(this._el,this);this._errors=null;this._toolTip=a.tip;
this._css=a.css;this._init(a);this._applyToolTip()},_applyToolTip:function(){this._toolTip&&this._setToolTip(this.$el,this._toolTip)},_init:function(b){this._css&&this.$el.addClass(this._css)},_createElement:function(b){return d.$(d.document.createElement(b))},_setIsEnabled:function(b,a){b.prop("disabled",!a);a?b.removeClass("disabled"):b.addClass("disabled")},_getIsEnabled:function(b){return!b.prop("disabled")},destroy:function(){if(!this._isDestroyed){var b=this._$el,a=this._el;b&&b.off("."+this._objId);
try{this._$el=this._el=this.toolTip=this.validationErrors=this._propChangedCommand=null}finally{this._app._setElView(a,null)}this._super()}},invokePropChanged:function(b){b={property:b};this._propChangedCommand&&this._propChangedCommand.execute(this,b)},_getErrorTipInfo:function(b){var a=["<b>",n.errorInfo,"</b>","<br/>"];b.forEach(function(b){var d="";b.errors.forEach(function(b){d=d+" "+b});a.push(d);d=""});return a.join("")},_setFieldError:function(b){var a=this.$el;b?a.addClass(m.fieldError):
a.removeClass(m.fieldError)},_updateErrorUI:function(b,a){if(b){var e=this.$el;a&&0<a.length?(l.addToolTip(e,this._getErrorTipInfo(a),m.errorTip),this._setFieldError(!0)):(this._setToolTip(e,this.toolTip),this._setFieldError(!1))}},_onError:function(b,a){var e=this._super(b,a);return!e?this._app._onError(b,a):e},_setToolTip:function(b,a,e){l.addToolTip(b,a,e)},toString:function(){return"BaseElView"}},{app:{get:function(){return this._app}},$el:{get:function(){this._el&&!this._$el&&(this._$el=d.$(this._el));
return this._$el}},el:{get:function(){return this._el}},uniqueID:{get:function(){return this._objId}},isVisible:{set:function(b){b=!!b;b!==this.isVisible&&(b?this.el.style.display=this._oldDisplay?this._oldDisplay:"":(this._oldDisplay=this.el.style.display,this.el.style.display="none"),this.raisePropertyChanged("isVisible"))},get:function(){return"none"!==this.el.style.display}},propChangedCommand:{set:function(b){b!==this._propChangedCommand&&(this._propChangedCommand=b,this.invokePropChanged("*"))},
get:function(){return this._propChangedCommand}},validationErrors:{set:function(b){b!==this._errors&&(this._errors=b,this.raisePropertyChanged("validationErrors"),this._updateErrorUI(this._el,this._errors))},get:function(){return this._errors}},dataNameAttr:{get:function(){return this._el.getAttribute(h.DATA_ATTR.DATA_NAME)}},toolTip:{set:function(b){this._toolTip!=b&&(this._toolTip=b,this._setToolTip(this.$el,b),this.raisePropertyChanged("toolTip"))},get:function(){return this._toolTip}},css:{set:function(b){var a=
this.$el;this._css!=b&&(this._css&&a.removeClass(this._css),(this._css=b)&&a.addClass(this._css),this.raisePropertyChanged("css"))},get:function(){return this._css}}},function(b){f.BaseElView=b;a.registerType("BaseElView",b)});g.extend(null,{isEnabled:{set:function(b){b=!!b;b!==this.isEnabled&&(this._setIsEnabled(this.$el,b),this.raisePropertyChanged("isEnabled"))},get:function(){return this._getIsEnabled(this.$el)}}},function(b){f.EditableElView=b;a.registerType("EditableElView",b)});g.extend({_init:function(b){this._super(b);
this._commandParam=this._command=null},destroy:function(){this.commandParam=this.command=null;this._super()},invokeCommand:function(){var b=this,a=b.command,e=b.commandParam;a&&a.canExecute(b,e)&&setTimeout(function(){a.execute(b,e)},0)},_onCommandChanged:function(){this.raisePropertyChanged("command")},_setCommand:function(b){var a=this;b!==this._command&&(this._command&&this._command.removeNSHandlers(this._objId),(this._command=b)?(this._command.addHandler("canExecute_changed",function(b,d){a.isEnabled=
b.canExecute(a,a.commandParam)},this._objId),a.isEnabled=this._command.canExecute(a,a.commandParam)):a.isEnabled=!1,this._onCommandChanged())},toString:function(){return"CommandElView"}},{isEnabled:{set:function(b){b!==this.isEnabled&&(this._setIsEnabled(this.$el,b),this.raisePropertyChanged("isEnabled"))},get:function(){return this._getIsEnabled(this.$el)}},command:{set:function(b){this._setCommand(b)},get:function(){return this._command}},commandParam:{set:function(b){b!==this._commandParam&&(this._commandParam=
b,this.raisePropertyChanged("commandParam"))},get:function(){return this._commandParam}}},function(b){f.CommandElView=b;a.registerType("CommandElView",b)})};
RIAPP.Application._coreModules.binding=function(a){var f=this,d=a.global,l=d.utils,h=d.modules.errors,n=a.modules.baseElView.BaseElView,m=["OneTime","OneWay","TwoWay"];f.BINDING_MODE=m;f.ValidationError=h.BaseError.extend({_create:function(a,b){var c=RIAPP.ERRS.ERR_VALIDATION+"\r\n",e=0;a.forEach(function(b){0<e&&(c+="\r\n");c=b.fieldName?c+" "+RIAPP.localizable.TEXT.txtField+": "+b.fieldName+" -> "+b.errors.join(", "):c+b.errors.join(", ");e+=1});this._super(c);this._errors=a;this._item=b}},{item:{get:function(){return this._item}},
errors:{get:function(){return this._errors}}},function(d){a.registerType("ValidationError",d)});f.Binding=RIAPP.BaseObject.extend({_app:a,_create:function(a){this._super();a=l.extend(!1,{target:null,source:null,targetPath:null,sourcePath:null,mode:m[1],converter:null,converterParam:null,isSourceFixed:!1},a);if(!a.target)throw Error(RIAPP.ERRS.ERR_BIND_TARGET_EMPTY);if(!l.check_is.String(a.targetPath))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_BIND_TGTPATH_INVALID,a.targetPath));if(0>m.indexOf(a.mode))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_BIND_MODE_INVALID,
a.mode));if(!RIAPP.BaseObject.isPrototypeOf(a.target))throw Error(RIAPP.ERRS.ERR_BIND_TARGET_INVALID);this._state=null;this._mode=a.mode;this._converter=a.converter||this._app.getConverter("BaseConverter");this._converterParam=a.converterParam;this._srcPath=this._app.parser._getPathParts(a.sourcePath);this._tgtPath=this._app.parser._getPathParts(a.targetPath);if(1>this._tgtPath.length)throw Error(String.format(RIAPP.ERRS.ERR_BIND_TGTPATH_INVALID,a.targetPath));this._isSourceFixed=!!a.isSourceFixed;
this._bounds={};this._objId="bnd"+this._app.getNewObjectID();this._ignoreTgtChange=this._ignoreSrcChange=!1;this._target=this._source=this._targetObj=this._sourceObj=null;this.target=a.target;this.source=a.source;this._sourceObj&&(this._sourceObj.addOnItemErrorsChanged&&this._sourceObj.getIsHasErrors())&&this._onSrcErrorsChanged()},_getOnTgtDestroyedProxy:function(){var a=this;return function(b,c){a._onTgtDestroyed()}},_getOnSrcDestroyedProxy:function(){var a=this;return function(b,c){a._onSrcDestroyed()}},
_getUpdTgtProxy:function(){var a=this;return function(){a._updateTarget()}},_getUpdSrcProxy:function(){var a=this;return function(){a._updateSource()}},_getSrcErrChangedProxy:function(){var a=this;return function(b,c){a._onSrcErrorsChanged()}},_onSrcErrorsChanged:function(){var a=[],b=this._targetObj,c=this._sourceObj,e=this._srcPath;b&&n.isPrototypeOf(b)&&(c&&0<e.length&&(a=c.getFieldErrors(e[e.length-1])),b.validationErrors=a)},_onError:function(a,b){var c=this._super(a,b);return!c?this._app._onError(a,
b):c},_getTgtChangedFn:function(a,b,c,e,d){return function(p,u){var f=a._app.parser._resolveProp(b,c);0<e.length&&a._checkBounded(null,"target",d,e);a._parseTgtPath(f,e,d)}},_getSrcChangedFn:function(a,b,c,e,d){return function(p,u){var f=a._app.parser._resolveProp(b,c);0<e.length&&a._checkBounded(null,"source",d,e);a._parseSrcPath(f,e,d)}},_parseSrcPath:function(a,b,c){this._sourceObj=null;0===b.length?this._sourceObj=a:this._parseSrcPath2(a,b,c);this._targetObj&&this._updateTarget()},_parseSrcPath2:function(a,
b,c){var e=RIAPP.BaseObject;if(e=!!a&&e.isPrototypeOf(a))a.addOnDestroyed(this._getOnSrcDestroyedProxy(),this._objId),this._checkBounded(a,"source",c,b);1<b.length?(e&&a.addOnPropertyChange(b[0],this._getSrcChangedFn(this,a,b[0],b.slice(1),c+1),this._objId),a&&(a=this._app.parser._resolveProp(a,b[0]))&&this._parseSrcPath2(a,b.slice(1),c+1)):a&&1===b.length&&((this._mode===m[1]||this._mode===m[2])&&e&&a.addOnPropertyChange(b[0],this._getUpdTgtProxy(),this._objId),a&&a.addOnItemErrorsChanged&&a.addOnItemErrorsChanged(this._getSrcErrChangedProxy(),
this._objId),this._sourceObj=a)},_parseTgtPath:function(a,b,c){this._targetObj=null;0===b.length?this._targetObj=a:this._parseTgtPath2(a,b,c);this._targetObj&&this._updateTarget()},_parseTgtPath2:function(a,b,c){var e=RIAPP.BaseObject;if(e=!!a&&e.isPrototypeOf(a))a.addOnDestroyed(this._getOnTgtDestroyedProxy(),this._objId),this._checkBounded(a,"target",c,b);1<b.length?(e&&a.addOnPropertyChange(b[0],this._getTgtChangedFn(this,a,b[0],b.slice(1),c+1),this._objId),a&&(a=this._app.parser._resolveProp(a,
b[0]))&&this._parseTgtPath2(a,b.slice(1),c+1)):a&&1===b.length&&(this._mode===m[2]&&e&&a.addOnPropertyChange(b[0],this._getUpdSrcProxy(),this._objId),this._targetObj=a)},_checkBounded:function(a,b,c,e){var d,p;if("source"===b)p="s"+c;else if("target"===b)p="t"+c;else throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"to",b));if(d=this._bounds[p])d.removeNSHandlers(this._objId),delete this._bounds[p];0<e.length&&this._checkBounded(null,b,c+1,e.slice(1));a&&(this._bounds[p]=a)},_onTgtDestroyed:function(a,
b){this._isDestroyCalled||(this.target=null)},_onSrcDestroyed:function(a,b){var c=this;c._isDestroyCalled||(a===c.source?c.source=null:(c._checkBounded(null,"source",0,c._srcPath),setTimeout(function(){c._isDestroyCalled||c._bindToSource()},0)))},_bindToSource:function(){this._parseSrcPath(this.source,this._srcPath,0)},_bindToTarget:function(){this._parseTgtPath(this.target,this._tgtPath,0)},_updateTarget:function(){if(!this._ignoreSrcChange){this._ignoreTgtChange=!0;try{var a=this._converter.convertToTarget(this.sourceValue,
this._converterParam,this._sourceObj);void 0!==a&&(this.targetValue=a)}catch(b){d.reThrow(b,this._onError(b,this))}finally{this._ignoreTgtChange=!1}}},_updateSource:function(){if(!this._ignoreTgtChange){this._ignoreSrcChange=!0;try{var a=this._converter.convertToSource(this.targetValue,this._converterParam,this._sourceObj);void 0!==a&&(this.sourceValue=a)}catch(b){if(!f.ValidationError.isPrototypeOf(b)||!n.isPrototypeOf(this._targetObj))if(this._updateTarget(),!this._onError(b,this))throw b;}finally{this._ignoreSrcChange=
!1}}},destroy:function(){if(!this._isDestroyed){var a=this;l.forEachProp(this._bounds,function(b){a._bounds[b].removeNSHandlers(a._objId)});this._bounds={};this._target=this._source=this._targetObj=this._sourceObj=this._tgtPath=this._srcPath=this._converterParam=this._converter=this._state=this.target=this.source=null;this._super()}},toString:function(){return"Binding"}},{bindingID:{get:function(){return this._objId}},target:{set:function(a){if(this._state)this._state.target=a;else if(this._target!==
a){var b=this._targetObj;if(b&&!b._isDestroyCalled){this._ignoreTgtChange=!0;try{this.targetValue=null}finally{this._ignoreTgtChange=!1}}this._checkBounded(null,"target",0,this._tgtPath);if(a&&!RIAPP.BaseObject.isPrototypeOf(a))throw Error(RIAPP.ERRS.ERR_BIND_TARGET_INVALID);this._target=a;this._bindToTarget();if(this._target&&!this._targetObj)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_BIND_TGTPATH_INVALID,this._tgtPath.join(".")));}},get:function(){return this._target}},source:{set:function(a){this._state?
this._state.source=a:this._source!==a&&(this._checkBounded(null,"source",0,this._srcPath),this._source=a,this._bindToSource())},get:function(){return this._source}},targetPath:{get:function(){return this._tgtPath}},sourcePath:{get:function(){return this._srcPath}},sourceValue:{set:function(a){0===this._srcPath.length||null===this._sourceObj||this._app.parser._setPropertyValue(this._sourceObj,this._srcPath[this._srcPath.length-1],a)},get:function(){return 0===this._srcPath.length?this._sourceObj:null===
this._sourceObj?null:this._app.parser._resolveProp(this._sourceObj,this._srcPath[this._srcPath.length-1])}},targetValue:{set:function(a){null!==this._targetObj&&this._app.parser._setPropertyValue(this._targetObj,this._tgtPath[this._tgtPath.length-1],a)},get:function(){return null===this._targetObj?null:this._app.parser._resolveProp(this._targetObj,this._tgtPath[this._tgtPath.length-1])}},mode:{get:function(){return this._mode}},converter:{set:function(a){this._converter=a},get:function(){return this._converter}},
converterParam:{set:function(a){this._converterParam=a},get:function(){return this._converterParam}},isSourceFixed:{get:function(){return this._isSourceFixed}},isDisabled:{set:function(a){a=!!a;if(this.isDisabled!=a)if(a){a={source:this._source,target:this._target};try{this.source=this.target=null}finally{this._state=a}}else a=this._state,this._state=null,this.target=a.target,this.source=a.source},get:function(){return!!this._state}}},function(d){a.registerType("Binding",d)})};
RIAPP.Application._coreModules.template=function(a){var f=a.global,d=f.utils,l=f.consts,h=a.modules.binding.Binding,n=a.modules.baseElView.BaseElView;this.Template=RIAPP.BaseObject.extend({_app:a,_create:function(a){this._super();this._el=this._dctxt=null;this._isDisabled=!1;this._lfTime=null;this._templateID=a;this._templElView=void 0;this._promise=null;this._templateID&&this._loadTemplate()},_getBindings:function(){if(!this._lfTime)return[];for(var a=this._lfTime.getObjs(),d=[],b=0,c=a.length;b<
c;b+=1)h.isPrototypeOf(a[b])&&d.push(a[b]);return d},_getElViews:function(){if(!this._lfTime)return[];for(var a=this._lfTime.getObjs(),d=[],b=0,c=a.length;b<c;b+=1)n.isPrototypeOf(a[b])&&d.push(a[b]);return d},_getTemplateElView:function(){if(!this._lfTime||null===this._templElView)return null;if(this._templElView)return this._templElView;for(var a=null,d=this._app.modules.elview.TemplateElView,b=this._getElViews(),c=0,e=b.length;c<e;c+=1)if(d.isPrototypeOf(b[c])){a=b[c];break}return this._templElView=
a},_loadTemplateElAsync:function(a){if(a=this._app.getTemplateLoader(a))return a().then(function(a){return f.$(a).get(0)});a=d.createDeferred();a.reject(Error(String.format(RIAPP.ERRS.ERR_TEMPLATE_ID_INVALID,this._templateID)));return a.promise()},_loadTemplate:function(){var a=this,g=a._templateID;a._unloadTemplate();g&&(g=a._loadTemplateElAsync(g),"pending"==g.state()&&(a._el=f.document.createElement("div"),a._promise=d.createDeferred(),g.then(function(){a._promise.resolve()}),g=f.$.when(g,a._promise)),
g.then(function(b){if(!a._isDestroyCalled){var c=!!a._promise;a._promise=null;b?(c&&a._el.appendChild(b),a._el=b,a._lfTime=a._app._bindTemplateElements(a._el),(b=a._getTemplateElView())&&b.templateLoaded(a),a._updateBindingSource()):a._unloadTemplate()}},function(b){a._isDestroyCalled||(a._promise=null,"cancel"!=b&&(b&&b.message?a._app._onError(b,a):a._app._onError(Error(String.format(RIAPP.ERRS.ERR_TEMPLATE_ID_INVALID,a._templateID)),a)))}))},_updateBindingSource:function(){var a,d,b,c=this._getBindings();
a=0;for(d=c.length;a<d;a+=1)b=c[a],b.isDisabled=this._isDisabled,b.isSourceFixed||(b.source=this._dctxt)},_updateIsDisabled:function(){var a,d,b,c=this._getBindings(),e=this._getElViews(),k=this._app._getElViewType(l.ELVIEW_NM.DATAFORM);a=0;for(d=c.length;a<d;a+=1)b=c[a],b.isDisabled=this._isDisabled;a=0;for(d=e.length;a<d;a+=1)b=e[a],k.isPrototypeOf(b)&&b.form&&(b.form.isDisabled=this._isDisabled)},_unloadTemplate:function(){try{if(this._el){var a=this._templElView;this._templElView=void 0;a&&a.templateUnloading(this)}}finally{this._lfTime&&
(this._lfTime.destroy(),this._lfTime=null),this._el&&f.$(this._el).remove(),this._el=null}},destroy:function(){this._isDestroyed||(this._promise&&(this._promise.reject("cancel"),this._promise=null),this._dctxt=null,this._unloadTemplate(),this._templateID=null,this._templElView=void 0,this._super())},findElByDataName:function(a){return f.$(this._el).find(["*[",l.DATA_ATTR.DATA_NAME,'="',a,'"]'].join("")).toArray()},findElViewsByDataName:function(a){var d=this,b=[];this.findElByDataName(a).forEach(function(a){(a=
d._app._getElView(a))&&b.push(a)});return b},toString:function(){return"Template"}},{dataContext:{set:function(a){this._dctxt!==a&&(this._dctxt=a,this.raisePropertyChanged("dataContext"),this._updateBindingSource())},get:function(){return this._dctxt}},templateID:{set:function(a){this._templateID!==a&&(this._promise&&(this._promise.reject("cancel"),this._promise=null),this._templateID=a,this._loadTemplate(),this.raisePropertyChanged("templateID"))},get:function(){return this._templateID}},el:{get:function(){return this._el}},
isDisabled:{set:function(a){this._isDisabled!==a&&(this._isDisabled=!!a,this._updateIsDisabled(),this.raisePropertyChanged("isDisabled"))},get:function(){return this._isDisabled}}},function(d){a.registerType("Template",d)})};
RIAPP.Application._coreModules.mvvm=function(a){this.Command=RIAPP.BaseObject.extend({_app:a,_create:function(a,d,l){this._super();this._action=a;this._thisObj=d;this._canExecute=l;this._isEnabled=!0;this._objId="cmd"+this._app.getNewObjectID()},_getEventNames:function(){var a=this._super();return["canExecute_changed"].concat(a)},canExecute:function(a,d){return!this._canExecute?!0:this._canExecute.apply(this._thisObj,[a,d])},execute:function(a,d){this._isEnabled&&this._action&&this._action.apply(this._thisObj,
[a,d])},destroy:function(){this._isDestroyed||(this._canExecute=this._thisObj=this._action=null,this._super())},raiseCanExecuteChanged:function(){this.raiseEvent("canExecute_changed",{})},toString:function(){return"Command"}},{app:{get:function(){return this._app}}},function(f){a.registerType("Command",f)});this.BaseViewModel=RIAPP.BaseObject.extend({_app:a,_create:function(){this._super();this._objId="vm"+this._app.getNewObjectID()},_onError:function(a,d){var l=this._super(a,d);return!l?this._app._onError(a,
d):l},toString:function(){return this._typeName?this._super():"BaseViewModel"}},{uniqueID:{get:function(){return this._objId}},app:{get:function(){return this._app}},$:{get:function(){return this._app.global.$}}},function(f){a.registerType("BaseViewModel",f)})};
RIAPP.Application._coreModules.baseContent=function(a){var f=a.global,d=a.modules.template.Template,l=a.modules.binding.Binding,h=this.css={content:"ria-content-field",required:"ria-required-field"};Object.freeze(h);this.BindingContent=RIAPP.BaseObject.extend({_app:a,_create:function(a,d,g,b){this._super();this._parentEl=a;this._el=null;this._options=d;this._isReadOnly=!!this._options.readOnly;this._isEditing=!!b;this._dctx=g;this._tgt=this._lfScope=null;f.$(this._parentEl).addClass(h.content);d.initContentFn&&
d.initContentFn(this);this._init();this.update()},_init:function(){},_updateCss:function(){var a=this._getDisplayInfo(),d=f.$(this._parentEl),g=this.getFieldInfo();this._isEditing&&this._canBeEdited()?(a&&(a.editCss&&d.addClass(a.editCss),a.displayCss&&d.removeClass(a.displayCss)),g&&!g.isNullable&&d.addClass(h.required)):a&&(a.displayCss&&d.addClass(a.displayCss),a.editCss&&d.removeClass(a.editCss),g&&!g.isNullable&&d.removeClass(h.required))},_canBeEdited:function(){if(this._isReadOnly)return!1;
var a=this.getFieldInfo();return!a?!1:!!this._dctx&&!!this._dctx.beginEdit&&!a.isReadOnly&&!a.isCalculated},_createTargetElement:function(){var a;a=f.document;this._isEditing&&this._canBeEdited()?(a=a.createElement("input"),a.setAttribute("type","text")):a=a.createElement("span");this._updateCss();return a},_getBindingOption:function(a,d,f,b){a=this._app._getBindingOption(a,d,f);this.isEditing&&this._canBeEdited()?a.mode="TwoWay":a.mode="OneWay";b&&(a.targetPath=b);return a},_getBindings:function(){if(!this._lfScope)return[];
for(var a=this._lfScope.getObjs(),d=[],f=0,b=a.length;f<b;f+=1)l.isPrototypeOf(a[f])&&d.push(a[f]);return d},_updateBindingSource:function(){var a,d,f,b=this._getBindings();a=0;for(d=b.length;a<d;a+=1)f=b[a],f.isSourceFixed||(f.source=this._dctx)},_cleanUp:function(){this._lfScope&&(this._lfScope.destroy(),this._lfScope=null);this._el&&(f.$(this._el).remove(),this._el=null);this._tgt=null},getFieldInfo:function(){return this._options.fieldInfo},_getBindingInfo:function(){return this._options.bindingInfo},
_getDisplayInfo:function(){return this._options.displayInfo},_getElementView:function(a){return this._app.getElementView(a)},update:function(){this._cleanUp();var a=this._getBindingInfo();a&&(this._el=this._createTargetElement(),this._tgt=this._getElementView(this._el),this._lfScope=f.utils.LifeTimeScope.create(),this._lfScope.addObj(this._tgt),a=this._getBindingOption(a,this._tgt,this._dctx,"value"),this._parentEl.appendChild(this._el),this._lfScope.addObj(this._app.bind(a)))},destroy:function(){if(!this._isDestroyed){var a=
this._getDisplayInfo(),d=f.$(this._parentEl);d.removeClass(h.content);d.removeClass(h.required);a&&a.displayCss&&d.removeClass(a.displayCss);a&&a.editCss&&d.removeClass(a.editCss);this._cleanUp();this._options=this._dctx=this._parentEl=null;this._super()}},toString:function(){return"BindingContent"}},{parentEl:{get:function(){return this._parentEl}},target:{get:function(){return this._tgt}},isEditing:{set:function(a){this._isEditing!==a&&(this._isEditing=a,this.update())},get:function(){return this._isEditing}},
dataContext:{set:function(a){this._dctx!==a&&(this._dctx=a,this._updateBindingSource())},get:function(){return this._dctx}},app:{get:function(){return this._app}}},null);this.TemplateContent=RIAPP.BaseObject.extend({_app:a,_create:function(a,d,g,b){this._super();this._parentEl=a;this._isEditing=!!b;this._dctx=g;this._templateInfo=d;this._template=null;f.$(this._parentEl).addClass(h.content);this.update()},_createTemplate:function(){var a=this._templateInfo,f=a.displayID;this._isEditing?a.editID&&
(f=a.editID):f||(f=a.editID);if(!f)throw Error(RIAPP.ERRS.ERR_TEMPLATE_ID_INVALID);return d.create(f)},update:function(){this._cleanUp();var a;this._templateInfo&&(this._template=a=this._createTemplate(),this._parentEl.appendChild(a.el),a.dataContext=this._dctx)},_cleanUp:function(){this._template&&(this._template.destroy(),this._template=null)},destroy:function(){this._isDestroyed||(f.$(this._parentEl).removeClass(h.content),this._cleanUp(),this._templateInfo=this._dctx=this._parentEl=null,this._super())},
toString:function(){return"TemplateContent"}},{parentEl:{get:function(){return this._parentEl}},template:{get:function(){return this._template}},isEditing:{set:function(a){this._isEditing!==a&&(this._isEditing=a,this.update())},get:function(){return this._isEditing}},dataContext:{set:function(a){this._dctx!==a&&(this._dctx=a,this._template&&(this._template.dataContext=this._dctx))},get:function(){return this._dctx}},app:{get:function(){return this._app}}},null)};
RIAPP.Application._coreModules.collection=function(a){var f=this,d=a.global,l=d.utils,h,n,m,g=d.consts.DATA_TYPE,b={REMOVE:"0",ADDED:"1",RESET:"2",REMAP_KEY:"3"},c={};c.DATA_TYPE=g;c.SORT_ORDER={ASC:0,DESC:1};c.COLL_CHANGE_TYPE=b;c.DATE_CONVERSION={None:0,ServerLocalToClientLocal:1,UtcToClientLocal:2};f.consts=c;Object.freeze(c);var e=a.modules.binding.ValidationError,k={valueToDate:function(a,b,e){if(!a)return null;a=""+a;var d=a.split("&");if(7!=d.length)throw Error(base_utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,
"val",a));a=new Date(parseInt(d[0],10),parseInt(d[1],10)-1,parseInt(d[2],10),parseInt(d[3],10),parseInt(d[4],10),parseInt(d[5],10),parseInt(d[6],10));var d=c.DATE_CONVERSION,k=l.get_timeZoneOffset();switch(b){case d.None:break;case d.ServerLocalToClientLocal:a.setMinutes(a.getMinutes()+e);a.setMinutes(a.getMinutes()-k);break;case d.UtcToClientLocal:a.setMinutes(a.getMinutes()-k);break;default:throw Error(base_utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"dtcnv",b));}return a},dateToValue:function(a,
b,e){if(null===a)return null;if(!l.check_is.Date(a))throw Error(base_utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"dt",a));var d=c.DATE_CONVERSION,k=l.get_timeZoneOffset();switch(b){case d.None:break;case d.ServerLocalToClientLocal:a.setMinutes(a.getMinutes()+k);a.setMinutes(a.getMinutes()-e);break;case d.UtcToClientLocal:a.setMinutes(a.getMinutes()+k);break;default:throw Error(l.format(RIAPP.ERRS.ERR_PARAM_INVALID,"dtcnv",b));}return""+a.getFullYear()+"&"+(a.getMonth()+1)+"&"+a.getDate()+"&"+a.getHours()+
"&"+a.getMinutes()+"&"+a.getSeconds()+"&"+a.getMilliseconds()},compareVals:function(a,b,c){if(null===a&&null!==b||null!==a&&null===b)return!1;switch(c){case g.DateTime:case g.Date:case g.Time:return l.check_is.Date(a)&&l.check_is.Date(b)?a.getTime()===b.getTime():!1;default:return a===b}},stringifyValue:function(a,b,c){return l.check_is.nt(a)?null:l.check_is.Date(a)?k.dateToValue(a,b,c):""+a},parseValue:function(a,b,c,e){var d=null;if(void 0===a||null===a)return d;switch(b){case g.None:d=a;break;
case g.String:d=a;break;case g.Bool:d=l.parseBool(a);break;case g.Integer:d=parseInt(a,10);break;case g.Decimal:case g.Float:d=parseFloat(a);break;case g.DateTime:case g.Date:case g.Time:d=k.valueToDate(a,c,e);break;case g.Guid:case g.Binary:d=a;break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"dataType",b));}return d}};f.valueUtils=k;n=RIAPP.BaseObject.extend({_app:a,_create:function(){this._super();this._fkey=null;this._isEditing=!1;this._saveVals=null;this._vals={};this._notEdited=
!0},_getEventNames:function(){var a=this._super();return["errors_changed"].concat(a)},_onError:function(a,b){var c=this._super(a,b);return!c?this._collection._onError(a,b):c},_beginEdit:function(){var a=this._collection;if(a.isEditing){var b=a._EditingItem;if(b===this)return!1;try{b.endEdit(),b.getIsHasErrors()&&(this._onError(e.create(b.getAllErrors(),b),b),b.cancelEdit())}catch(c){a=this._onError(c,b),b.cancelEdit(),d.reThrow(c,a)}}this._isEditing=!0;this._saveVals=l.shallowCopy(this._vals);this._collection.currentItem=
this;return!0},_endEdit:function(){if(!this._isEditing)return!1;var a,b=this._collection;if(this.getIsHasErrors())return!1;b._removeAllErrors(this);a=this._validateAll();0<a.length&&b._addErrors(this,a);if(this.getIsHasErrors())return!1;this._isEditing=!1;this._saveVals=null;return!0},_validate:function(){return this._collection._validateItem(this)},_skipValidate:function(a,b){return!1},_validateField:function(a){var b,c=this.getFieldInfo(a),e=null;try{b=this._vals[a];if(this._skipValidate(c,b))return e;
if(this._isNew){if(null===b&&!c.isNullable&&!c.isReadOnly&&!c.isAutoGenerated)throw Error(RIAPP.ERRS.ERR_FIELD_ISNOT_NULLABLE);}else if(null===b&&!c.isNullable&&!c.isReadOnly)throw Error(RIAPP.ERRS.ERR_FIELD_ISNOT_NULLABLE);}catch(d){e={fieldName:a,errors:[d.message]}}a=this._collection._validateItemField(this,a);e&&a?e.errors=e.errors.concat(a.errors):a&&(e=a);return e},_validateAll:function(){var a=this,b=[];this.getFieldNames().forEach(function(c){(c=a._validateField(c))&&b.push(c)});var c=a._validate();
c&&b.push(c);return b},_checkVal:function(a,b){var c=b,e=RIAPP.ERRS;if(this._skipValidate(a,b))return c;if(a.isReadOnly&&(!a.allowClientDefault||!this._isNew))throw Error(e.ERR_FIELD_READONLY);if((null===b||l.check_is.String(b)&&!b)&&!a.isNullable)throw Error(e.ERR_FIELD_ISNOT_NULLABLE);if(null===b)return b;switch(a.dataType){case g.None:break;case g.Guid:case g.Binary:case g.String:if(!l.check_is.String(b))throw Error(String.format(e.ERR_FIELD_WRONG_TYPE,b,"String"));if(0<a.maxLength&&b.length>a.maxLength)throw Error(String.format(e.ERR_FIELD_MAXLEN,
a.maxLength));a.isNullable&&""===b&&(c=null);if(a.regex&&!RegExp(a.regex,"i").test(b))throw Error(String.format(e.ERR_FIELD_REGEX,b));break;case g.Bool:if(!l.check_is.Boolean(b))throw Error(String.format(e.ERR_FIELD_WRONG_TYPE,b,"Boolean"));break;case g.Integer:case g.Decimal:case g.Float:if(!l.check_is.Number(b))throw Error(String.format(e.ERR_FIELD_WRONG_TYPE,b,"Number"));a.range&&l.validation.checkNumRange(Number(b),a.range);break;case g.DateTime:case g.Date:if(!l.check_is.Date(b))throw Error(String.format(e.ERR_FIELD_WRONG_TYPE,
b,"Date"));a.range&&l.validation.checkDateRange(b,a.range);break;case g.Time:if(!l.check_is.Date(b))throw Error(String.format(e.ERR_FIELD_WRONG_TYPE,b,"Time"));break;default:throw Error(String.format(e.ERR_PARAM_INVALID,"dataType",a.dataType));}return c},_onErrorsChanged:function(a){this.raiseEvent("errors_changed",a)},_resetIsNew:function(){},getFieldInfo:function(a){return this._collection.getFieldInfo(a)},getFieldNames:function(){return this._collection.getFieldNames()},addOnItemErrorsChanged:function(a,
b){this.addHandler("errors_changed",a,b)},getFieldErrors:function(a){var b=this._collection._getErrors(this);if(!b)return[];var c=a;a||(a="*");if(!b[a])return[];"*"===a&&(c=null);return[{fieldName:c,errors:b[a]}]},getAllErrors:function(){var a=this._collection._getErrors(this);if(!a)return[];var b=[];l.forEachProp(a,function(c){var e=null;"*"!==c&&(e=c);b.push({fieldName:e,errors:a[c]})});return b},getErrorString:function(){var a=this._collection._getErrors(this);if(!a)return"";var b=[];l.forEachProp(a,
function(c){b.push(String.format("{0}: {1}",c,a[c]))});return b.join("|")},_onAttaching:function(){},_onAttach:function(){},beginEdit:function(){var a=this._collection;if(!this._beginEdit())return!1;a._onEditing(this,!0,!1);this.raisePropertyChanged("isEditing");return!0},endEdit:function(){var a=this._collection;if(!this._endEdit())return!1;a._onEditing(this,!1,!1);this._notEdited=!1;this.raisePropertyChanged("isEditing");return!0},cancelEdit:function(){if(!this._isEditing)return!1;var a=this._collection,
b=this._isNew,c=this._saveVals;this._vals=this._saveVals;this._saveVals=null;a._removeAllErrors(this);a.getFieldNames().forEach(function(a){c[a]!==this._vals[a]&&this.raisePropertyChanged(a)},this);b&&this._notEdited&&a.removeItem(this);this._isEditing=!1;a._onEditing(this,!1,!0);this.raisePropertyChanged("isEditing");return!0},deleteItem:function(){var a=this._collection;if(null===this._key||!a._onItemDeleting(this))return!1;a.removeItem(this);return!0},getIsNew:function(){return this._isNew},getIsDeleted:function(){return this._isDeleted},
getKey:function(){return this._key},getCollection:function(){return this._collection},getIsEditing:function(){return this._isEditing},getIsHasErrors:function(){return!!this._collection._getErrors(this)},destroy:function(){this._saveVals=this._fkey=null;this._vals={};this._isEditing=!1;this._super()},toString:function(){return"CollectionItem"}},{_isNew:{get:function(){return!1}},_isDeleted:{get:function(){return!1}},_key:{set:function(a){null!==a&&(a=""+a);this._fkey=a},get:function(){return this._fkey}},
_collection:{get:function(){return null}},_isUpdating:{get:function(){var a=this._collection;return!a?!1:a.isUpdating}},isEditing:{get:function(){return this._isEditing}}},function(a){f.CollectionItem=a});h=RIAPP.BaseObject.extend({_app:a,_create:function(){this._super();this._options={};this._isLoading=!1;this._options.enablePaging=!1;this._options.pageSize=10;this._EditingItem=null;this._perms={canAddRow:!0,canEditRow:!0,canDeleteRow:!0,canRefreshRow:!1};this._pageIndex=this._totalCount=0;this._items=
[];this._itemsByKey={};this._currentPos=-1;this._newKey=0;this._fieldMap={};this._errors={};this._ignoreChangeErrors=!1;this._pkInfo=null;this._isUpdating=!1;this._waitQueue=d.utils.WaitQueue.create(this)},_getEventNames:function(){var a=this._super();return"begin_edit end_edit fill coll_changed item_deleting item_adding item_added validate current_changing page_changing errors_changed status_changed clearing cleared commit_changes".split(" ").concat(a)},_getStrValue:function(a,b){var c=b.dateConversion,
e=l.get_timeZoneOffset();return k.stringifyValue(a,c,e)},_getPKFieldInfos:function(){if(this._pkInfo)return this._pkInfo;var a=this._fieldMap,b=[];l.forEachProp(a,function(c){0<a[c].isPrimaryKey&&b.push(a[c])});b.sort(function(a,b){return a.isPrimaryKey-b.isPrimaryKey});return this._pkInfo=b},_onError:function(a,b){var c=this._super(a,b);return!c?this._app._onError(a,b):c},_onCurrentChanging:function(a){try{this.endEdit()}catch(b){d.reThrow(b,this._onError(b,this))}this.raiseEvent("current_changing",
{newCurrent:a})},_onCurrentChanged:function(){this.raisePropertyChanged("currentItem")},_onEditing:function(a,b,c){this._isUpdating||(b?(this._EditingItem=a,this.raiseEvent("begin_edit",{item:a})):(this._EditingItem=null,this.raiseEvent("end_edit",{item:a,isCanceled:c})))},_onCommitChanges:function(a,b,c,e){this.raiseEvent("commit_changes",{item:a,isBegin:b,isRejected:c,changeType:e})},_onItemStatusChanged:function(a,b){this.raiseEvent("status_changed",{item:a,oldChangeType:b,key:a._key})},_validateItem:function(a){a=
{item:a,fieldName:null,errors:[]};this.raiseEvent("validate",a);return a.errors&&0<a.errors.length?{fieldName:null,errors:a.errors}:null},_validateItemField:function(a,b){var c={item:a,fieldName:b,errors:[]};this.raiseEvent("validate",c);return c.errors&&0<c.errors.length?{fieldName:b,errors:c.errors}:null},_addErrors:function(a,b){var c=this;this._ignoreChangeErrors=!0;try{b.forEach(function(b){c._addError(a,b.fieldName,b.errors)})}finally{this._ignoreChangeErrors=!1}this._onErrorsChanged(a)},_addError:function(a,
b,c){b||(b="*");l.check_is.Array(c)&&0<c.length?(this._errors[a._key]||(this._errors[a._key]={}),this._errors[a._key][b]=c,this._ignoreChangeErrors||this._onErrorsChanged(a)):this._removeError(a,b)},_removeError:function(a,b){var c=this._errors[a._key];c&&(b||(b="*"),c[b]&&(delete c[b],0===l.getProps(c).length&&delete this._errors[a._key],this._onErrorsChanged(a)))},_removeAllErrors:function(a){this._errors[a._key]&&(delete this._errors[a._key],this._onErrorsChanged(a))},_getErrors:function(a){return this._errors[a._key]},
_onErrorsChanged:function(a){var b={item:a};this.raiseEvent("errors_changed",b);a._onErrorsChanged(b)},_onItemDeleting:function(a){a={item:a,isCancel:!1};this.raiseEvent("item_deleting",a);return!a.isCancel},_onFillStart:function(a){this.raiseEvent("fill",a)},_onFillEnd:function(a){this.raiseEvent("fill",a)},_onItemsChanged:function(a){this.raiseEvent("coll_changed",a)},_onItemAdding:function(a){a={item:a,isCancel:!1};this.raiseEvent("item_adding",a);a.isCancel&&d._throwDummy(Error("operation canceled"))},
_onItemAdded:function(a){this.raiseEvent("item_added",{item:a,isAddNewHandled:!1})},_createNew:function(){throw Error("Not implemented");},_attach:function(a,c){if(this._itemsByKey[a._key])throw Error(RIAPP.ERRS.ERR_ITEM_IS_ATTACHED);try{this.endEdit()}catch(e){d.reThrow(e,this._onError(e,this))}var k;a._onAttaching();l.check_is.nt(c)?(k=this._items.length,this._items.push(a)):(k=c,l.insertIntoArray(this._items,a,k));this._itemsByKey[a._key]=a;this._onItemsChanged({change_type:b.ADDED,items:[a],pos:[k]});
a._onAttach();this.raisePropertyChanged("count");this._onCurrentChanging(a);this._currentPos=k;this._onCurrentChanged();return k},_onRemoved:function(a,c){try{this._onItemsChanged({change_type:b.REMOVE,items:[a],pos:[c]})}finally{this.raisePropertyChanged("count")}},_onPageSizeChanged:function(){},_onPageChanging:function(){var a={page:this.pageIndex,isCancel:!1};this._raiseEvent("page_changing",a);if(!a.isCancel)try{this.endEdit()}catch(b){d.reThrow(b,this._onError(b,this))}return!a.isCancel},_onPageChanged:function(){},
_setCurrentItem:function(a){var b=this._currentPos;if(a){if(null===a._key)throw Error(RIAPP.ERRS.ERR_ITEM_IS_DETACHED);var c,e;if(!this.getItemByKey(a._key))throw Error(RIAPP.ERRS.ERR_ITEM_IS_NOTFOUND);c=this.getItemByPos(b);e=this._items.indexOf(a);if(0>e)throw Error(RIAPP.ERRS.ERR_ITEM_IS_NOTFOUND);if(b!==e||c!==a)this._onCurrentChanging(a),this._currentPos=e,this._onCurrentChanged()}else-1!==b&&(this._onCurrentChanging(null),this._currentPos=-1,this._onCurrentChanged())},_destroyItems:function(){this._items.forEach(function(a){a.destroy()})},
getFieldInfo:function(a){return this._fieldMap[a]},getFieldNames:function(){return l.getProps(this._fieldMap)},cancelEdit:function(){this.isEditing&&this._EditingItem.cancelEdit()},endEdit:function(){var a;this.isEditing&&(a=this._EditingItem,!a.endEdit()&&a.getIsHasErrors()&&(this._onError(e.create(a.getAllErrors(),a),a),this.cancelEdit()))},getItemsWithErrors:function(){var a=this,b=[];l.forEachProp(this._errors,function(c){c=a.getItemByKey(c);b.push(c)});return b},addNew:function(){var a,b;a=this._createNew();
this._onItemAdding(a);this._attach(a,null);try{this.currentItem=a,a.beginEdit(),this._onItemAdded(a)}catch(c){b=this._onError(c,this),a.cancelEdit(),d.reThrow(c,b)}return a},getItemByPos:function(a){return 0>a||a>=this._items.length?null:this._items[a]},getItemByKey:function(a){if(!a)throw Error(RIAPP.ERRS.ERR_KEY_IS_EMPTY);return this._itemsByKey[""+a]},findByPK:function(){if(0===arguments.length)return null;var a=l.slice.call(arguments),b=this._getPKFieldInfos(),c=[];1===a.length&&l.check_is.Array(a[0])&&
(a=a[0]);if(a.length!==b.length)return null;for(var e=0,d=b.length;e<d;e+=1)c.push(this._getStrValue(a[e],b[e]));a=c.join(";");return this.getItemByKey(a)},moveFirst:function(a){if(0===this._currentPos)return!1;var b=this.getItemByPos(0);if(!b)return!1;if(a&&b._isDeleted)return this.moveNext(!0);this._onCurrentChanging(b);this._currentPos=0;this._onCurrentChanged();return!0},movePrev:function(a){var b=-1,c=this._currentPos,e=this.getItemByPos(c);e&&(b=c-1);e=this.getItemByPos(b);if(!e)return!1;if(a&&
e._isDeleted)return this._currentPos=b,this.movePrev(!0);this._onCurrentChanging(e);this._currentPos=b;this._onCurrentChanged();return!0},moveNext:function(a){var b=-1,c=this._currentPos,e=this.getItemByPos(c);e&&(b=c+1);e=this.getItemByPos(b);if(!e)return!1;if(a&&e._isDeleted)return this._currentPos=b,this.moveNext(!0);this._onCurrentChanging(e);this._currentPos=b;this._onCurrentChanged();return!0},moveLast:function(a){var b=this._items.length-1;if(this._currentPos===b)return!1;var c=this.getItemByPos(b);
if(!c)return!1;if(a&&c._isDeleted)return this.movePrev(!0);this._onCurrentChanging(c);this._currentPos=b;this._onCurrentChanged();return!0},goTo:function(a){if(this._currentPos===a)return!1;var b=this.getItemByPos(a);if(!b)return!1;this._onCurrentChanging(b);this._currentPos=a;this._onCurrentChanged();return!0},forEach:function(a,b){this._items.forEach(a,b)},removeItem:function(a){if(null===a._key)throw Error(RIAPP.ERRS.ERR_ITEM_IS_DETACHED);if(this._itemsByKey[a._key]){var b=l.removeFromArray(this._items,
a);if(0>b)throw Error(RIAPP.ERRS.ERR_ITEM_IS_NOTFOUND);delete this._itemsByKey[a._key];delete this._errors[a._key];this._onRemoved(a,b);a._key=null;a.removeHandler(null,null);a=this.getItemByPos(b);var c=this._currentPos;c===b&&(a||(this._currentPos=c-1),this._onCurrentChanged());c>b&&(this._currentPos=c-1,this._onCurrentChanged())}},getIsHasErrors:function(){return!this._errors?!1:0<l.getProps(this._errors).length},sortLocal:function(a,b){var c=1;b&&"DESC"===b.toUpperCase()&&(c=-1);this.sortLocalByFunc(function(b,
e){var d=0,k,r,x;k=0;for(r=a.length;k<r&&!(x=a[k],d=b[x],x=e[x],d=d<x?-1*c:d>x?c:0,0!==d);k+=1);return d})},sortLocalByFunc:function(a){this.waitForNotLoading(function(){var c=this.currentItem;this.isLoading=!0;try{this._items.sort(a),this._onItemsChanged({change_type:b.RESET,items:[]})}finally{this.isLoading=!1}this.currentItem=null;this.currentItem=c},[],!1,null)},clear:function(){this.raiseEvent("clearing",{});this.cancelEdit();this._EditingItem=null;this._newKey=0;this.currentItem=null;this._destroyItems();
this._items=[];this._itemsByKey={};this._errors={};this._onItemsChanged({change_type:b.RESET,items:[]});this.raiseEvent("cleared",{});this.raisePropertyChanged("count")},destroy:function(){this._waitQueue&&(this._waitQueue.destroy(),this._waitQueue=null,this.clear(),this._fieldMap={},this._super())},waitForNotLoading:function(a,b,c,e){this._waitQueue.enQueue({prop:"isLoading",groupName:null,predicate:function(a){return!a},action:a,actionArgs:b,lastWins:!!e,syncCheck:!!c})},toString:function(){return"Collection"}},
{app:{get:function(){return this._app}},options:{get:function(){return this._options}},currentItem:{set:function(a){this._setCurrentItem(a)},get:function(){return this.getItemByPos(this._currentPos)}},count:{get:function(){return this._items.length}},totalCount:{set:function(a){a!=this._totalCount&&(this._totalCount=a,this.raisePropertyChanged("totalCount"),this.raisePropertyChanged("pageCount"))},get:function(){return this._totalCount}},pageSize:{set:function(a){this._options.pageSize!==a&&(this._options.pageSize=
a,this.raisePropertyChanged("pageSize"),this._onPageSizeChanged())},get:function(){return this._options.pageSize}},pageIndex:{set:function(a){a!==this._pageIndex&&this.isPagingEnabled&&!(0>a)&&this._onPageChanging()&&(this._pageIndex=a,this._onPageChanged(),this.raisePropertyChanged("pageIndex"))},get:function(){return this._pageIndex}},items:{get:function(){return this._items}},isPagingEnabled:{get:function(){return this._options.enablePaging}},permissions:{get:function(){return this._perms}},isEditing:{get:function(){return!!this._EditingItem}},
isLoading:{set:function(a){this._isLoading!==a&&(this._isLoading=a,this.raisePropertyChanged("isLoading"))},get:function(){return this._isLoading}},isUpdating:{set:function(a){this._isUpdating!==a&&(this._isUpdating=a,this.raisePropertyChanged("isUpdating"))},get:function(){return this._isUpdating}},pageCount:{get:function(){var a=this.totalCount,b=this.pageSize;return 0===a||0===b?0:0===a%b?a/b:a=Math.floor(a/b)+1}}},function(a){f.Collection=a});h.getEmptyFieldInfo=function(a){return{isPrimaryKey:0,
isRowTimeStamp:!1,dataType:g.NONE,isNullable:!0,maxLength:-1,isReadOnly:!1,isAutoGenerated:!1,allowClientDefault:!1,dateConversion:c.DATE_CONVERSION.NONE,isClientOnly:!0,isCalculated:!1,isNeedOriginal:!1,dependentOn:null,range:null,regex:null,isNavigation:!1,fieldName:a}};m=n.extend({_create:function(a){this._super();this.__isNew=!a;a&&(this._vals=a);a||this._collection.getFieldNames().forEach(function(a){this._vals[a]=null},this)},_setProp:function(a,b){var c,d=this._collection;if(this._vals[a]!==
b)try{if(this._vals[a]=b,this.raisePropertyChanged(a),d._removeError(this,a),c=this._validateField(a))throw e.create([c],this);}catch(k){throw c=e.isPrototypeOf(k)?k:e.create([{fieldName:a,errors:[k.message]}],this),d._addError(this,a,c.errors[0].errors),c;}},_getProp:function(a){return this._vals[a]},_resetIsNew:function(){this.__isNew=!1},toString:function(){return"ListItem"}},{_isNew:{get:function(){return this.__isNew}},_collection:{get:function(){return this.__coll}}},function(a){f.ListItem=
a});h.extend({_create:function(a,b){this._super();this._type_name=a;if(RIAPP.utils.isArray(b)){this._props=b;if(0===this._props.length)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"properties",b));this._initFieldMap(!1,b)}else if(n.isPrototypeOf(b))this._props=b.getFieldNames(),this._initFieldMap(!0,b);else if(b)this._props=Object.keys(b),this._initFieldMap(!1,b);else throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"properties",b));this._itemType=null;this._createItemType()},
_initFieldMap:function(a,b){var c=this;a?this._props.forEach(function(a){c._fieldMap[a]=l.extend(!1,{},b.getFieldInfo(a))}):this._props.forEach(function(a){c._fieldMap[a]=h.getEmptyFieldInfo(a)})},_attach:function(a){try{this.endEdit()}catch(b){d.reThrow(b,this._onError(b,this))}return this._super(a)},_createNew:function(){var a=this._itemType.create(null);a._key=this._getNewKey(null);return a},_createItemType:function(){var a={};this.getFieldNames().forEach(function(b){a[b]={set:function(a){this._setProp(b,
a)},get:function(){return this._getProp(b)}}},this);a._collection={get:function(){return this.__coll}};var b=this._type_name;this._itemType=m.extend({__coll:this},a,function(a){a._typeName=b+"Item"})},_getNewKey:function(a){a="clkey_"+this._newKey;this._newKey+=1;return a},fillItems:function(a,c){var e=[],d=[],k=[];this._onFillStart({isBegin:!0,rowCount:a.length,time:new Date,isPageChanged:!1});try{c&&this.clear(),a.forEach(function(a){a=this._itemType.create(a);a._key=this._getNewKey(a);var b=this._itemsByKey[a._key];
b?k.push(b):(this._items.push(a),this._itemsByKey[a._key]=a,e.push(a),d.push(this._items.length-1),k.push(a))},this),0<e.length&&(this._onItemsChanged({change_type:b.ADDED,items:e,pos:d}),this.raisePropertyChanged("count"))}finally{this._onFillEnd({isBegin:!1,rowCount:k.length,time:new Date,resetUI:!!c,fetchedItems:k,newItems:e,isPageChanged:!1})}this.moveFirst()},getNewObjects:function(){return this._items.filter(function(a){return a._isNew})},resetNewObjects:function(){this._items.forEach(function(a){a._resetIsNew()})},
toString:function(){return"List"}},null,function(b){f.List=b;a.registerType("List",b)}).extend({_create:function(a,b,c){if(!c)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"keyName",c));this._keyName=c;this._super(a,b);a=this.getFieldInfo(c);if(!a)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DICTKEY_IS_NOTFOUND,c));a.isPrimaryKey=1},_getNewKey:function(a){if(!a)return this._super(null);a=a[this._keyName];if(l.check_is.nt(a))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DICTKEY_IS_EMPTY,
this._keyName));return""+a},toString:function(){return"Dictionary"}},null,function(b){f.Dictionary=b;a.registerType("Dictionary",b)})};
RIAPP.Application._coreModules.db=function(a){var f=this,d=a.global,l=a.modules.collection,h=d.utils,n,m,g,b=d.consts.DATA_TYPE,c=d.consts.CHANGE_TYPE,e=l.valueUtils,k=l.consts.COLL_CHANGE_TYPE,p=l.consts.SORT_ORDER,u=d.modules.errors.BaseError.extend({_create:function(a,b){var c;a&&(c=a.message);c||(c=""+a);this._super(c);this._origError=a;this._operationName=b}},{operationName:{get:function(){return this._operationName}}},function(b){f.DataOperationError=b;a.registerType("DataOperationError",b)}),
v=a.modules.binding.ValidationError;f.AccessDeniedError=u.extend(null,null,function(b){a.registerType("AccessDeniedError",b)});f.ConcurrencyError=u.extend(null,null,function(b){a.registerType("ConcurrencyError",b)});f.SvcValidationError=u.extend(null,null,function(b){a.registerType("SvcValidationError",b)});var y=f.SubmitError=u.extend({_create:function(a,b,c){var e=a.message||""+a;this._super(e,"submit");this._origError=a;this._allSubmitted=b||[];this._notValidated=c||[];if(0<this._notValidated.length){var d=
[e+":"];this._notValidated.forEach(function(a){d.push(String.format("item key:{0} errors:{1}",a._key,a.getErrorString()))});this._message=d.join("\r\n")}}},{allSubmitted:{get:function(){return this._allSubmitted}},notValidated:{get:function(){return this._notValidated}}},function(b){a.registerType("SubmitError",b)});f.checkError=function(a,b){if(a)switch(a.name){case "AccessDeniedException":throw f.AccessDeniedError.create(RIAPP.ERRS.ERR_ACCESS_DENIED,b);case "ConcurrencyException":throw f.ConcurrencyError.create(RIAPP.ERRS.ERR_CONCURRENCY,
b);case "ValidationException":throw f.SvcValidationError.create(h.format(RIAPP.ERRS.ERR_VALIDATION,a.message),b);case "DomainServiceException":throw u.create(h.format(RIAPP.ERRS.ERR_SVC_ERROR,a.message),b);default:throw u.create(h.format(RIAPP.ERRS.ERR_UNEXPECTED_SVC_ERROR,a.message),b);}};var w=RIAPP.BaseObject.extend({_create:function(a){this._super();this._query=a;this._cache=[];this._totalCount=0;this._itemsByKey={}},getCachedPage:function(a){var b=this._cache.filter(function(b){return b.pageIndex===
a});if(0==b.length)return null;if(1!=b.length)throw Error(String.format(RIAPP.ERRS.ERR_ASSERTION_FAILED,"res.length == 1"));return b[0]},reindexCache:function(){this._itemsByKey={};for(var a=0;a<this._cache.length;a+=1)this._cache[a].items.forEach(function(a){this._itemsByKey[a._key]=a},this)},getPrevCachedPageIndex:function(a){for(var b=-1,c,e=0;e<this._cache.length;e+=1)c=this._cache[e].pageIndex,c>b&&c<a&&(b=c);return b},getNextRange:function(a){var b=Math.floor((this.loadPageCount-1)/2),c=a+b+
(this.loadPageCount-1)%2,b=a-b;a=this.getPrevCachedPageIndex(a);0>b&&(c+=0-b,b=0);b<=a&&(c+=a-b+1,b+=a-b+1);this._pageCount>this.loadPageCount&&c>this._pageCount-1&&(b-=c-(this._pageCount-1),0>b&&(b=0),c=this._pageCount-1);b<=a&&(c+=a-b+1,b+=a-b+1);a=c-b+1;a<this.loadPageCount&&(c+=this.loadPageCount-a,a=c-b+1);return{start:b,end:c,cnt:a}},fillCache:function(a,b){var c,e=this._itemsByKey,d,q,k=b.length,f,g=this.pageSize;for(d=0;d<this.loadPageCount;d+=1){q=a+d;f=this.getCachedPage(q);f||(f={items:[],
pageIndex:q},this._cache.push(f));for(q=0;q<g;q+=1)if(c=d*g+q,c<k)c=b[c],e[c._key]||(f.items.push(c),e[c._key]=c,c._isCached=!0);else return}},clear:function(){var a,b,c,e,d=this._query.dbSet;for(a=0;a<this._cache.length;a+=1){c=this._cache[a].items;for(b=0;b<c.length;b+=1)if((e=c[b])&&null!==e._key)e._isCached=!1,d.getItemByKey(e._key)||e.destroy()}this._cache=[];this._itemsByKey={}},clearCacheForPage:function(a){var b=this.getCachedPage(a);a=this._query.dbSet;if(b){var c,e,d=this._cache.indexOf(b);
c=b.items;for(b=0;b<c.length;b+=1)if((e=c[b])&&null!==e._key)delete this._itemsByKey[e._key],e._isCached=!1,a.getItemByKey(e._key)||e.destroy();this._cache.splice(d,1)}},hasPage:function(a){for(var b=0;b<this._cache.length;b+=1)if(this._cache[b].pageIndex===a)return!0;return!1},getItemByKey:function(a){return this._itemsByKey[a]},getPageByItem:function(a){a=this._itemsByKey[a._key];if(!a)return-1;for(var b=0;b<this._cache.length;b+=1)if(-1<this._cache[b].items.indexOf(a))return this._cache[b].pageIndex;
return-1},destroy:function(){this.clear();this._super()},toString:function(){return"DataCache"}},{_pageCount:{get:function(){var a=this.totalCount,b=this.pageSize;return 0===a||0===b?0:0===a%b?a/b:a=Math.floor(a/b)+1}},pageSize:{get:function(){return this._query.pageSize}},loadPageCount:{get:function(){return this._query.loadPageCount}},totalCount:{set:function(a){h.check_is.nt(a)&&(a=0);a!==this._totalCount&&(this._totalCount=a,this.raisePropertyChanged("totalCount"))},get:function(){return this._totalCount}},
cacheSize:{get:function(){return this._cache.length}}},function(a){f.DataCache=a});m=RIAPP.BaseObject.extend({_app:a,_create:function(a,b){this._super();this._dbSet=a;this.__queryInfo=b;this._filterInfo={filterItems:[]};this._sortInfo={sortItems:[]};this._isClearPrevData=this._isIncludeTotalCount=!0;this._pageSize=a.pageSize;this._pageIndex=a.pageIndex;this._params={};this._loadPageCount=1;this._isClearCacheOnEveryLoad=!0;this._dataCache=null;this._cacheInvalidated=!1},getFieldInfo:function(a){return this._dbSet.getFieldInfo(a)},
getFieldNames:function(){return h.getProps(this._dbSet._fieldMap)},_addSort:function(a,b){var c=p.ASC,e=this._sortInfo;b&&"d"===b.toLowerCase().substr(0,1)&&(c=p.DESC);e.sortItems.push({fieldName:a,sortOrder:c});this._cacheInvalidated=!0},_addFilterItem:function(a,b,c){var d=0,d=this.getFieldInfo(a);if(!d)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,this.dbSetName,a));var k=this._serverTimezone,q=d.dateConversion,t=c;h.check_is.Array(t)||(t=[c]);t=Array.clone(t).map(function(a){return e.stringifyValue(a,
q,k)});switch(b.toLowerCase()){case "equals":case "=":d=0;break;case "noteq":case "!=":case "<>":d=9;break;case "between":d=1;if(2!=c.length)throw Error(RIAPP.ERRS.ERR_QUERY_BETWEEN);break;case "startswith":d=2;break;case "endswith":d=3;break;case "contains":d=4;break;case "gt":case ">":d=5;break;case "gteq":case ">=":d=7;break;case "lt":case "<":d=6;break;case "lteq":case "<=":d=8;break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_QUERY_OPERATOR_INVALID,b));}this._filterInfo.filterItems.push({fieldName:a,
kind:d,values:t});this._cacheInvalidated=!0},where:function(a,b,c){this._addFilterItem(a,b,c);return this},and:function(a,b,c){this._addFilterItem(a,b,c);return this},orderBy:function(a,b){this._addSort(a,b);return this},thenBy:function(a,b){this._addSort(a,b);return this},clearSort:function(){this._sortInfo.sortItems=[];this._cacheInvalidated=!0;return this},clearFilter:function(){this._filterInfo.filterItems=[];this._cacheInvalidated=!0;return this},clearParams:function(){this._params={};this._cacheInvalidated=
!0;return this},_clearCache:function(){this._dataCache&&(this._dataCache.destroy(),this._dataCache=null);this._resetCacheInvalidated()},_getCache:function(){this._dataCache||(this._dataCache=w.create(this));return this._dataCache},_reindexCache:function(){this._dataCache&&this._dataCache.reindexCache()},_isPageCached:function(a){return!this._dataCache?!1:this._dataCache.hasPage(a)},_resetCacheInvalidated:function(){this._cacheInvalidated=!1},destroy:function(){this._clearCache();this._super()},toString:function(){return"DataQuery"}},
{_queryInfo:{get:function(){return this.__queryInfo}},_serverTimezone:{get:function(){return this._dbSet.dbContext.serverTimezone}},entityType:{get:function(){return this._dbSet.entityType}},dbSet:{get:function(){return this._dbSet}},dbSetName:{get:function(){return this._dbSet.dbSetName}},queryName:{get:function(){return this.__queryInfo.methodName}},filterInfo:{get:function(){return this._filterInfo}},sortInfo:{get:function(){return this._sortInfo}},isIncludeTotalCount:{set:function(a){this._isIncludeTotalCount=
a},get:function(){return this._isIncludeTotalCount}},isClearPrevData:{set:function(a){this._isClearPrevData=a},get:function(){return this._isClearPrevData}},pageSize:{set:function(a){this._pageSize!=a&&(this._pageSize=a)},get:function(){return this._pageSize}},pageIndex:{set:function(a){this._pageIndex!=a&&(this._pageIndex=a)},get:function(){return this._pageIndex}},params:{set:function(a){this._params!==a&&(this._params=a,this._cacheInvalidated=!0)},get:function(){return this._params}},isPagingEnabled:{get:function(){return this._dbSet.isPagingEnabled}},
loadPageCount:{set:function(a){1>a&&(a=1);this._loadPageCount!=a&&(this._loadPageCount=a,1===a&&this._clearCache(),this.raisePropertyChanged("loadPageCount"))},get:function(){return this._loadPageCount}},isClearCacheOnEveryLoad:{set:function(a){this._isClearCacheOnEveryLoad!=a&&(this._isClearCacheOnEveryLoad=a,this.raisePropertyChanged("isClearCacheOnEveryLoad"))},get:function(){return this._isClearCacheOnEveryLoad}},isCacheValid:{get:function(){return!!this._dataCache&&!this._cacheInvalidated}}},
function(a){f.DataQuery=a});n=l.CollectionItem.extend({_create:function(a,b){this._super();this.__changeType=c.NONE;this._saveChangeType=this._origVals=this._srvRowKey=null;this.__isCached=this.__isRefreshing=!1;this.getFieldNames().forEach(function(a){this._vals[a]=null},this);this._initRowInfo(a,b)},_initRowInfo:function(a,b){if(a){var c=this,d=c._serverTimezone;this._key=this._srvRowKey=a.key;a.values.forEach(function(a,r){var k=b[r],f=c.getFieldInfo(k);if(!f)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,
c._dbSetName,k));k=e.parseValue(a,f.dataType,f.dateConversion,d);c._vals[f.fieldName]=k})}},_checkCanRefresh:function(){if(null===this._key||this._changeType===c.ADDED)throw Error(RIAPP.ERRS.ERR_OPER_REFRESH_INVALID);},_refreshValue:function(a,b,c){var d=this.getFieldInfo(b);if(!d)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,this._dbSetName,b));var k,q,t=d.dataType;a=e.parseValue(a,t,d.dateConversion,this._serverTimezone);k=this._vals[b];switch(c){case 3:e.compareVals(a,k,
t)||(this._vals[b]=a,this._onFieldChanged(d));break;case 1:this._origVals&&(this._origVals[b]=a);this._saveVals&&(this._saveVals[b]=a);e.compareVals(a,k,t)||(this._vals[b]=a,this._onFieldChanged(d));break;case 2:this._origVals&&(q=this._origVals[b],this._origVals[b]=a);if((void 0===q||e.compareVals(q,k,t))&&!e.compareVals(a,k,t))this._vals[b]=a,this._onFieldChanged(d);break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"refreshMode",c));}},_refreshValues:function(a,b){var e=
this,d=this._changeType;this._isDestroyed||(b||(b=1),a.values.forEach(function(a){4===(a.flags&4)&&e._refreshValue(a.val,a.fieldName,b)}),d===c.UPDATED&&0===this._getStrValues(!0).length&&(this._origVals=null,this._changeType=c.NONE))},_onFieldChanged:function(a){this.raisePropertyChanged(a.fieldName);a.dependents&&0<a.dependents.length&&a.dependents.forEach(function(a){this.raisePropertyChanged(a)},this)},_getStrValues:function(a){var b=this.getFieldNames(),c=this._dbSet;return b.map(function(a){var b=
this.getFieldInfo(a);if(b.isClientOnly)return null;var e=c._getStrValue(this._vals[a],b),r=null===this._origVals?e:c._getStrValue(this._origVals[a],b);return r!==e?{val:e,orig:r,fieldName:a,flags:3}:0<b.isPrimaryKey||b.isRowTimeStamp||b.isNeedOriginal?{val:e,orig:r,fieldName:a,flags:2}:{val:null,orig:null,fieldName:a,flags:0}},this).filter(function(b){return!b?!1:a?1===(b.flags&1):!0})},_getRowInfo:function(){return{values:this._getStrValues(!1),changeType:this._changeType,serverKey:this._srvKey,
clientKey:this._key,error:null}},_fldChanging:function(a,b,c){this._origVals||(this._origVals=h.shallowCopy(this._vals));return!0},_fldChanged:function(a,b,e){if(!a.isClientOnly)switch(this._changeType){case c.NONE:this._changeType=c.UPDATED}this._onFieldChanged(a);return!0},_clearFieldVal:function(a){this._vals[a]=null},_skipValidate:function(a,b){var c=this._dbSet._trackAssocMap[a.fieldName],e=!1;if(c&&null===b)for(var d=0,q=c.length;d<q&&!(e=!!this._getFieldVal(c[d]));d+=1);return e},_getFieldVal:function(a){return this._vals[a]},
_setFieldVal:function(a,b){var c,e=this._dbSetName,d=this._collection,q=RIAPP.ERRS,k=this._vals[a],f=b,g=this.getFieldInfo(a);if(!g)throw Error(String.format(q.ERR_DBSET_INVALID_FIELDNAME,e,a));!this._isEditing&&!this._isUpdating&&this.beginEdit();try{if(f=this._checkVal(g,f),k!=f&&this._fldChanging(g,k,f)&&(this._vals[a]=f,this._fldChanged(g,k,f)),d._removeError(this,a),c=this._validateField(a))throw v.create([c],this);}catch(p){throw c=v.isPrototypeOf(p)?p:v.create([{fieldName:a,errors:[p.message]}],
this),d._addError(this,a,c.errors[0].errors),c;}return!0},_onAttaching:function(){this._super();this.__changeType=c.ADDED},_onAttach:function(){this._super();if(null===this._key)throw Error(RIAPP.ERRS.ERR_ITEM_IS_DETACHED);this._dbSet._addToChanged(this)},_beginEdit:function(){if(!this._super())return!1;this._saveChangeType=this._changeType;return!0},_endEdit:function(){if(!this._super())return!1;this._saveChangeType=null;return!0},deleteItem:function(){return this.deleteOnSubmit()},deleteOnSubmit:function(){var a=
this._changeType,b=this._dbSet;if(!b._onItemDeleting(this)||null===this._key)return!1;if(a===c.ADDED)return b.removeItem(this),!0;this._changeType=c.DELETED;return!0},acceptChanges:function(a){var b=this._changeType,e=this._dbSet;null!==this._key&&b!==c.NONE&&(e._onCommitChanges(this,!0,!1,b),b===c.DELETED?e.removeItem(this):(this._origVals=null,this._saveVals&&(this._saveVals=h.shallowCopy(this._vals)),this._changeType=c.NONE,e._removeAllErrors(this),a&&this._refreshValues(a,3),e._onCommitChanges(this,
!1,!1,b)))},rejectChanges:function(){var a=this._changeType,b=this._dbSet;if(null!==this._key&&a!==c.NONE)if(b._onCommitChanges(this,!0,!0,a),a===c.ADDED)b.removeItem(this);else{var e=this._getStrValues(!0);this._origVals&&(this._vals=h.shallowCopy(this._origVals),this._origVals=null,this._saveVals&&(this._saveVals=h.shallowCopy(this._vals)));this._changeType=c.NONE;b._removeAllErrors(this);e.forEach(function(a){this._onFieldChanged(b.getFieldInfo(a.fieldName))},this);b._onCommitChanges(this,!1,!0,
a)}},refresh:function(){return this._dbSet.dbContext._refreshItem(this)},cancelEdit:function(){if(!this._isEditing)return!1;var a=this._getStrValues(!0),b=this._isNew,c=this._dbSet;this._isEditing=!1;this._vals=this._saveVals;this._saveVals=null;this._changeType=this._saveChangeType;this._saveChangeType=null;c._removeAllErrors(this);a.forEach(function(a){this.raisePropertyChanged(a.fieldName)},this);b&&this._notEdited&&c.removeItem(this);c._onEditing(this,!1,!0);this.raisePropertyChanged("isEditing");
return!0},getDbContext:function(){return this._dbSet.dbContext},toString:function(){return"Entity: "+this._typeName},destroy:function(){this._saveChangeType=this._origVals=this._srvRowKey=null;this.__isCached=this.__isRefreshing=!1;this._super()}},{_isNew:{get:function(){return this._changeType===c.ADDED}},_isDeleted:{get:function(){return this._changeType===c.DELETED}},_entityType:{get:function(){return this._dbSet.entityType}},_srvKey:{get:function(){return this._srvRowKey}},_dbSetName:{get:function(){return this._dbSet.dbSetName}},
_changeType:{set:function(a){if(this.__changeType!==a){var b=this.__changeType;this.__changeType=a;a!==c.NONE?this._dbSet._addToChanged(this):this._dbSet._removeFromChanged(this._key);this._dbSet._onItemStatusChanged(this,b)}},get:function(){return this.__changeType}},_serverTimezone:{get:function(){return this.getDbContext().serverTimezone}},_collection:{get:function(){return this._dbSet}},_isRefreshing:{set:function(a){this.__isRefreshing!==a&&(this.__isRefreshing=a,this.raisePropertyChanged("_isRefreshing"))},
get:function(){return this.__isRefreshing}},_isCached:{set:function(a){this.__isCached=a},get:function(){return this.__isCached}},isHasChanges:{get:function(){return this._changeType!==c.NONE}}},function(a){f.Entity=a});g=l.Collection.extend({_create:function(a){this._super();a=h.extend(!1,{dbContext:null,dbSetInfo:null,childAssoc:[],parentAssoc:[]},a);var b=a.dbSetInfo;this._dbContext=a.dbContext;this._options.dbSetName=b.dbSetName;this._options.enablePaging=b.enablePaging;this._options.pageSize=
b.pageSize;this._perms=h.extend(!1,{},b.permissions);this._entityType=this._query=null;this._isSubmitOnDelete=!1;this._trackAssoc={};this._trackAssocMap={};this._childAssocMap={};this._parentAssocMap={};this._changeCount=0;this._changeCache={};this._ignorePageChanged=!1;Object.freeze(this._perms);this._createEntityType(b.dbSetName,b.fieldInfos,a.childAssoc,a.parentAssoc)},getFieldInfo:function(a){var b,c=a.split(".");if(1==c.length)return this._fieldMap[a];if(1<c.length&&(b=this._childAssocMap[c[0]]))return b=
this.dbContext.getDbSet(b.parentDbSetName),a=c.slice(1).join("."),b.getFieldInfo(a);throw Error(String.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,this.dbSetName,a));},_onError:function(a,b){return this.dbContext._onError(a,b)},_mapAssocFields:function(){for(var a=this._trackAssoc,b,c=Object.keys(a),e,d=this._trackAssocMap,q=0,k=c.length;q<k;q+=1){b=a[c[q]];for(var f=0,g=b.fieldRels.length;f<g;f+=1)e=b.fieldRels[f],d[e.childField]?d[e.childField].push(b.childToParentName):d[e.childField]=[b.childToParentName]}},
_getStrValue:function(a,b){return e.stringifyValue(a,b.dateConversion,this.dbContext.serverTimezone)},_createEntityType:function(a,b,c,e){var d=this,q={};if(!h.check_is.Array(b))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID_TYPE,"fldInfos","Array"));b.forEach(function(a){var b=h.extend(!1,{},a);b.dependents=[];d._fieldMap[a.fieldName]=b},this);var k=function(a){a.dependentOn.split(",").forEach(function(b){var c=d._fieldMap[b];if(!c)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CALC_FIELD_DEFINE,
b));if(a.fieldName===b)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CALC_FIELD_SELF_DEPEND,b));0>c.dependents.indexOf(a.fieldName)&&c.dependents.push(a.fieldName)})},f=function(a){var b=d._fieldMap[a.fieldName],r=!0,k=c.filter(function(b){return b.childToParentName==a.fieldName});0===k.length&&(k=e.filter(function(b){return b.parentToChildrenName==a.fieldName}),r=!1);if(1!=k.length)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID_TYPE,"assocs","Array"));b.isClientOnly=!0;b.isReadOnly=
!0;var f=function(){throw Error("getFunc is not emplemented!");},t,x=k[0].name;r?(b.isReadOnly=!1,d._childAssocMap[k[0].childToParentName]=k[0],k[0].fieldRels.forEach(function(a){a=d._fieldMap[a.childField];!b.isReadOnly&&a.isReadOnly&&(b.isReadOnly=!0)}),f=function(){return d.dbContext.getAssociation(x).getParentItem(this)},b.isReadOnly||(d._trackAssoc[x]=k[0],t=function(b){var c,e,r=d.dbContext.getAssociation(x);if(b&&!r.parentDS.entityType.isPrototypeOf(b))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID_TYPE,
"value",r.parentDS.entityType._typeName));if(b&&b._isNew)this._setFieldVal(a.fieldName,b._key);else if(b){c=0;for(e=r.childFldInfos.length;c<e;c+=1)this[r.childFldInfos[c].fieldName]=b[r.parentFldInfos[c].fieldName]}else{this._getFieldVal(a.fieldName)&&this._setFieldVal(a.fieldName,null);c=0;for(e=r.childFldInfos.length;c<e;c+=1)this[r.childFldInfos[c].fieldName]=null}})):(d._parentAssocMap[k[0].parentToChildrenName]=k[0],f=function(){return d.dbContext.getAssociation(x).getChildItems(this)});q[a.fieldName]=
{set:t,get:f}},g=function(a){q[a.fieldName]={set:function(b){this._setFieldVal(a.fieldName,b)},get:function(){return this._getFieldVal(a.fieldName)}}};b.forEach(function(b){if(h.hasProp(n,b.fieldName))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_ITEM_NAME_COLLISION,a,b.fieldName));if(b.isCalculated){var c=d.getFieldInfo(b.fieldName);c.isClientOnly=!0;c.isReadOnly=!0;c={dbSetName:a,fieldName:b.fieldName,getFunc:null};d.dbContext._onGetCalcField(c);h.check_is.Function(c.getFunc)&&(b.dependentOn&&k(b),
q[b.fieldName]={get:c.getFunc})}else b.isNavigation?f(b):g(b)});q._dbSet={get:function(){return this.__dbSet}};this._entityType=n.extend({__dbSet:d},q,function(b){b._typeName=a+"Entity"});this._mapAssocFields()},_fillFromService:function(a){a=h.extend(!1,{res:{names:[],rows:[],pageIndex:null,pageCount:null,dbSetName:this.dbSetName,totalCount:null},isPageChanged:!1,fn_beforeFillEnd:null,restOfRows:[]},a);var b=this,c=a.res,e=c.names,d=[],q=0,f=this._entityType,g=[],p=[],l=[],m=[],u=this.isPagingEnabled,
w=this.query,n=!0,v;d.push(c.rows);d=d.concat(a.restOfRows);d.forEach(function(a){q+=a.length});this._onFillStart({isBegin:!0,rowCount:q,time:new Date,isPageChanged:a.isPageChanged});try{w&&(n=w.isClearPrevData,w.isClearCacheOnEveryLoad&&w._clearCache(),n&&this.clear(),w._reindexCache(),1<w.loadPageCount&&u&&(v=w._getCache(),w.isIncludeTotalCount&&!h.check_is.nt(c.totalCount)&&(v.totalCount=c.totalCount)));d.forEach(function(a){a=a.map(function(a){var c=a.key;if(!c)throw Error(RIAPP.ERRS.ERR_KEY_IS_EMPTY);
var r=b._itemsByKey[c];r?a.values.forEach(function(a,b){r._refreshValue(a,e[b],1)}):(v&&(r=v.getItemByKey(c)),r?a.values.forEach(function(a,b){r._refreshValue(a,e[b],1)}):r=f.create(a,e));return r});l=l.concat(a)});if(w&&(w.isIncludeTotalCount&&!h.check_is.nt(c.totalCount)&&(this.totalCount=c.totalCount),1<w.loadPageCount&&u)){v.fillCache(c.pageIndex,l);var z=v.getCachedPage(w.pageIndex),l=z?z.items:[]}l.forEach(function(a){var b=this._itemsByKey[a._key];b?m.push(b):(this._items.push(a),this._itemsByKey[a._key]=
a,g.push(a),p.push(this._items.length-1),m.push(a))},this);0<g.length&&(this._onItemsChanged({change_type:k.ADDED,items:g,pos:p}),this.raisePropertyChanged("count"));a.fn_beforeFillEnd&&a.fn_beforeFillEnd()}finally{this._onFillEnd({isBegin:!1,rowCount:m.length,time:new Date,resetUI:n,fetchedItems:m,newItems:g,isPageChanged:a.isPageChanged})}this.moveFirst();return{fetchedItems:m,newItems:g,isPageChanged:a.isPageChanged}},_fillFromCache:function(a){a=h.extend(!1,{isPageChanged:!1,fn_beforeFillEnd:null},
a);var b=[],c=[],e=this.query;if(!e)throw Error(String.format(RIAPP.ERRS.ERR_ASSERTION_FAILED,"query is not null"));e=e._getCache().getCachedPage(e.pageIndex);e=!e?[]:e.items;this._onFillStart({isBegin:!0,rowCount:e.length,time:new Date,isPageChanged:a.isPageChanged});try{this.clear(),this._items=e,e.forEach(function(a,e){this._itemsByKey[a._key]=a;b.push(e);c.push(a)},this),a.fn_beforeFillEnd&&a.fn_beforeFillEnd(),0<c.length&&(this._onItemsChanged({change_type:k.ADDED,items:c,pos:b}),this.raisePropertyChanged("count"))}finally{this._onFillEnd({isBegin:!1,
rowCount:c.length,time:new Date,resetUI:!0,fetchedItems:c,newItems:c,isPageChanged:a.isPageChanged})}this.moveFirst();return{fetchedItems:c,newItems:c,isPageChanged:a.isPageChanged}},_commitChanges:function(a){var b=this;a.forEach(function(a){var e=a.clientKey,r=b._itemsByKey[e];if(!r)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_KEY_IS_NOTFOUND,e));var d=r._changeType;r.acceptChanges(a);d===c.ADDED&&(delete b._itemsByKey[e],r._srvRowKey=a.serverKey,r._key=r._srvRowKey,b._itemsByKey[r._key]=r,b._onItemsChanged({change_type:k.REMAP_KEY,
items:[r],old_key:e,new_key:r._key}))})},_setItemInvalid:function(a){var b=this._itemsByKey[a.clientKey],c={};a.invalid.forEach(function(a){a.fieldName||(a.fieldName="*");c[a.fieldName]?c[a.fieldName].push(a.message):c[a.fieldName]=[a.message]});var e=[];h.forEachProp(c,function(a){e.push({fieldName:a,errors:c[a]})});this._addErrors(b,e);return b},_getChanges:function(){var a=[],b=this._changeCache;h.forEachProp(b,function(c){a.push(b[c]._getRowInfo())});return a},_getTrackAssocInfo:function(){var a=
this,b=[],c=this._changeCache,e=Object.keys(a._trackAssoc);h.forEachProp(c,function(d){var q=c[d];e.forEach(function(c){var e=q._getFieldVal(a._trackAssoc[c].childToParentName),d=q._key;e&&d&&b.push({assocName:c,parentKey:e,childKey:d})})});return b},_getNewKey:function(a){a="clkey_"+this._newKey;this._newKey+=1;return a},_createNew:function(){var a=this._entityType.create(null,null);a._key=this._getNewKey(a);return a},_addToChanged:function(a){null!==a._key&&!this._changeCache[a._key]&&(this._changeCache[a._key]=
a,this._changeCount+=1,1===this._changeCount&&this.raisePropertyChanged("hasChanges"))},_removeFromChanged:function(a){null!==a&&this._changeCache[a]&&(delete this._changeCache[a],this._changeCount-=1,0===this._changeCount&&this.raisePropertyChanged("hasChanges"))},_clearChangeCache:function(){var a=this._changeCount;this._changeCache={};this._changeCount=0;a!==this._changeCount&&this.raisePropertyChanged("hasChanges")},_onItemStatusChanged:function(a,b){this._super(a,b);a._isDeleted&&this.isSubmitOnDelete&&
this.dbContext.submitChanges()},_onRemoved:function(a,b){this._removeFromChanged(a._key);this._super(a,b)},_onPageChanging:function(){var a=this._super();if(!a)return a;this.hasChanges&&this.rejectChanges();return a},_onPageChanged:function(){this.cancelEdit();this._super();this._ignorePageChanged||(this.query.pageIndex=this.pageIndex,this.dbContext._load(this.query,!0))},_onPageSizeChanged:function(){this._super();this._query&&(this._query.pageSize=this.pageSize)},_destroyItems:function(){this._items.forEach(function(a){a._isCached?
a.removeHandler(null,null):a.destroy()})},fillItems:function(a){a={res:h.extend(!1,{names:[],rows:[],pageIndex:this.query?this.query.pageIndex:null,pageCount:null,dbSetName:this.dbSetName,totalCount:null},a),isPageChanged:!1,fn_beforeFillEnd:null};this._fillFromService(a)},acceptChanges:function(){var a=this._changeCache;h.forEachProp(a,function(b){a[b].acceptChanges(null)});this._changeCount=0},rejectChanges:function(){var a=this._changeCache;h.forEachProp(a,function(b){a[b].rejectChanges()})},deleteOnSubmit:function(a){a.deleteOnSubmit()},
clear:function(){this._clearChangeCache();this._super()},createQuery:function(a){var b=this.dbContext._getQueryInfo(a);if(!b)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_QUERY_NAME_NOTFOUND,a));return m.create(this,b)},clearCache:function(){var a=this._query;a&&a._clearCache()()},destroy:function(){var a=this._query;this._query=null;a&&a.destroy();this._super()},toString:function(){return"DbSet:"+this._options.dbSetName}},{dbContext:{get:function(){return this._dbContext}},dbSetName:{get:function(){return this._options.dbSetName}},
entityType:{get:function(){return this._entityType}},query:{get:function(){return this._query}},hasChanges:{get:function(){return 0<this._changeCount}},cacheSize:{get:function(){var a=this._query;return a&&a.isCacheValid?(a=a._getCache(),a.cacheSize):0}},isSubmitOnDelete:{set:function(a){this._isSubmitOnDelete!==a&&(this._isSubmitOnDelete=!!a,this.raisePropertyChanged("isSubmitOnDelete"))},get:function(){return this._isSubmitOnDelete}}},function(a){f.DbSet=a});RIAPP.BaseObject.extend({_app:a,_create:function(){this._super();
this._isInitialized=!1;this._dbSets={};this._arrDbSets=[];this._svcMethods={};this._assoc={};this._arrAssoc=[];this._queryInf={};this._serviceUrl=null;this._isBusy=0;this._hasChanges=this._isSubmiting=!1;this._pendingSubmit=null;this._serverTimezone=h.get_timeZoneOffset();this._waitQueue=h.WaitQueue.create(this)},_onGetCalcField:function(a){this.raiseEvent("define_calc",a)},_getQueryInfo:function(a){return this._queryInf[a]},_initDbSets:function(a){if(this._isInitialized)throw Error(RIAPP.ERRS.ERR_DOMAIN_CONTEXT_INITIALIZED);
var b=this,c=this._dbSets;if(!h.check_is.Array(a.dbSets))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID_TYPE,"metadata.dbSets","Array"));this._serverTimezone=a.serverTimezone;a.dbSets.forEach(function(e){var d=e.dbSetName,q;q=a.associations.filter(function(a){return e.dbSetName==a.childDbSetName});var k=a.associations.filter(function(a){return e.dbSetName==a.parentDbSetName});q=g.create({dbContext:b,dbSetInfo:e,childAssoc:q,parentAssoc:k});b._arrDbSets.push(q);q.addOnPropertyChange("hasChanges",
function(a,c){b._onDbSetHasChangesChanged(a)},null);c[d]=q});a.associations.forEach(function(a){b._initAssociation(a)});a.methods.forEach(function(a){a.isQuery?b._queryInf[a.methodName]=a:b._initMethod(a)});Object.freeze(this._dbSets);Object.freeze(this._svcMethods);Object.freeze(this._queryInf);this._isInitialized=!0;this.raisePropertyChanged("isInitialized")},_onDbSetHasChangesChanged:function(a){var b=this._hasChanges;this._hasChanges=!1;if(a.hasChanges)this._hasChanges=!0;else for(var c=0,e=this._arrDbSets.length;c<
e;c+=1)if(a=this._arrDbSets[c],a.hasChanges){this._hasChanges=!0;break}this._hasChanges!==b&&this.raisePropertyChanged("hasChanges")},_initAssociation:function(a){var b=this,c={dbContext:b,parentName:a.parentDbSetName,childName:a.childDbSetName,onDeleteAction:a.onDeleteAction,parentKeyFields:a.fieldRels.map(function(a){return a.parentField}),childKeyFields:a.fieldRels.map(function(a){return a.childField}),parentToChildrenName:a.parentToChildrenName,childToParentName:a.childToParentName,name:a.name};
this._assoc[a.name]=function(){var e=A.create(c);b._arrAssoc.push(e);b._assoc[a.name]=function(){return e};return e}},_initMethod:function(a){var b=this;this._svcMethods[a.methodName]=function(c){var e=h.createDeferred(),k=function(a){a.error?e.reject():e.resolve(a.result)};try{var q=b._getMethodParams(a,c);b._invokeMethod(a,q,k)}catch(f){d._checkIsDummy(f)||(b._onError(f,b),k({result:null,error:f}))}return e.promise()}},_getMethodParams:function(a,c){var d={methodName:a.methodName,paramInfo:{parameters:[]}},
k,f=a.parameters,q=f.length,t,g,p;c||(c={});for(k=0;k<q;k+=1){t=f[k];g=c[t.name];if(!t.isNullable&&!t.isArray&&t.dataType!==b.String&&h.check_is.nt(g))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_SVC_METH_PARAM_INVALID,t.name,g,a.methodName));if(h.check_is.Function(g))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_SVC_METH_PARAM_INVALID,t.name,g,a.methodName));t.isArray&&(!h.check_is.nt(g)&&!h.check_is.Array(g))&&(g=[g]);p=null;h.check_is.Array(g)?(p=[],g.forEach(function(a){p.push(e.stringifyValue(a,
t.dateConversion,self._serverTimezone))}),p=JSON.stringify(p)):p=e.stringifyValue(g,t.dateConversion,self._serverTimezone);d.paramInfo.parameters.push({name:t.name,value:p})}return d},_invokeMethod:function(a,b,c){var e=this,k,q;this.isBusy=!0;var t=function(a){try{if(!a)throw Error(h.format(RIAPP.ERRS.ERR_UNEXPECTED_SVC_ERROR,"operation result is undefined"));f.checkError(a.error,"invoke");c({result:a.result,error:null})}catch(b){d._checkIsDummy(b)||(e._onDataOperError(b,"invoke"),c({result:null,
error:b}))}};try{k=JSON.stringify(b),q=this._getUrl("InvokeMethod"),h.performAjaxCall(q,k,!0,function(a){t(JSON.parse(a));e.isBusy=!1},function(a){t({result:null,error:a});e.isBusy=!1},null)}catch(g){d._checkIsDummy(g)&&d._throwDummy(g),this.isBusy=!1,this._onDataOperError(g,"invoke"),c({result:null,error:g}),d._throwDummy(g)}},_getEventNames:function(){var a=this._super();return["submit_error","define_calc"].concat(a)},_loadFromCache:function(a,b){var c=a._dbSet,e;try{e=c._fillFromCache({isPageChanged:b,
fn_beforeFillEnd:null})}catch(k){d._checkIsDummy(k)&&d._throwDummy(k),this._onDataOperError(k,"load"),d._throwDummy(k)}return e},_loadIncluded:function(a){var b=this;a.included&&0<a.included.length&&a.included.forEach(function(a){b.getDbSet(a.dbSetName).fillItems(a,!0)})},_onLoaded:function(a,b,c){var e=this,k,q,t;try{if(!a)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_UNEXPECTED_SVC_ERROR,"null result"));k=a.dbSetName;q=this.getDbSet(k);if(!q)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_NAME_INVALID,
k));f.checkError(a.error,"load");t=q._fillFromService({res:a,isPageChanged:b,fn_beforeFillEnd:function(){e._loadIncluded(a)},restOfRows:c})}catch(g){d._checkIsDummy(g)&&d._throwDummy(g),this._onDataOperError(g,"load"),d._throwDummy(g)}return t},_dataSaved:function(a){var b=this,c=[],e=[];try{try{f.checkError(a.error,"submit")}catch(k){throw a.dbSets.forEach(function(a){var d=b._dbSets[a.dbSetName];a.rows.forEach(function(a){var b=d.getItemByKey(a.clientKey);if(!b)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_KEY_IS_NOTFOUND,
a.clientKey));c.push(b);a.invalid&&(d._setItemInvalid(a),e.push(b))})}),y.create(k,c,e);}a.dbSets.forEach(function(a){b._dbSets[a.dbSetName]._commitChanges(a.rows)})}catch(q){d._checkIsDummy(q)&&d._throwDummy(q),this._onSubmitError(q),d._throwDummy(q)}},_getChanges:function(){var a={dbSets:[],error:null,trackAssocs:[]};this._arrDbSets.forEach(function(b){b.endEdit();var c=b._getChanges();if(0!==c.length){var e=b._getTrackAssocInfo();a.dbSets.push({dbSetName:b.dbSetName,rows:c});a.trackAssocs=a.trackAssocs.concat(e)}});
return a},_getUrl:function(a){var b=this.service_url;h.str.endsWith(b,"/")||(b+="/");return b+=[a,""].join("/")},_onItemRefreshed:function(a,b){try{if(f.checkError(a.error,"refresh"),a.rowInfo)b._refreshValues(a.rowInfo,2);else throw b._dbSet.removeItem(b),b.destroy(),Error(RIAPP.ERRS.ERR_ITEM_DELETED_BY_ANOTHER_USER);}catch(c){d._checkIsDummy(c)&&d._throwDummy(c),this._onDataOperError(c,"refresh"),d._throwDummy(c)}},_refreshItem:function(a){var b=h.createDeferred(),c=function(c){c?b.resolve(a):b.reject()},
e=this._getUrl("RefreshItem"),d=a._dbSet;this.waitForNotSubmiting(function(){var b=this;d.waitForNotLoading(function(){var k,f=function(){b.isBusy=!1;d.isLoading=!1;a._isRefreshing=!1},g=function(a){f();b._onDataOperError(a,"refresh")};a._isRefreshing=!0;b.isBusy=!0;d.isLoading=!0;try{var p={dbSetName:a._dbSetName,rowInfo:a._getRowInfo(),error:null};a._checkCanRefresh();k=JSON.stringify(p);h.performAjaxCall(e,k,!0,function(e){try{var d=JSON.parse(e);b._onItemRefreshed(d,a);f();c(!0)}catch(k){g(k),
c(!1)}},function(a){f();b._onDataOperError(a,"refresh");c(!1)},null)}catch(x){g(x),c(!1)}},[],!0,null)},[],null);return b.promise()},_onError:function(a,b){var c=this._super(a,b);return!c?this.app?this.app._onError(a,b):d._onError(a,b):c},_onDataOperError:function(a,b){if(d._checkIsDummy(a))return!0;var c;c=u.isPrototypeOf(a)?a:u.create(a,b);return this._onError(c,this)},_onSubmitError:function(a){var b={error:a,isHandled:!1};this.raiseEvent("submit_error",b);b.isHandled||(this.rejectChanges(),this._onDataOperError(a,
"submit"))},_beforeLoad:function(a,b,c){a&&b!==a&&(c._query=a,c.pageIndex=0);b&&b!==a&&b.destroy();if(a.pageSize!==c.pageSize){c._ignorePageChanged=!0;try{c.pageIndex=0,c.pageSize=a.pageSize}finally{c._ignorePageChanged=!1}}if(a.pageIndex!==c.pageIndex){c._ignorePageChanged=!0;try{c.pageIndex=a.pageIndex}finally{c._ignorePageChanged=!1}}a.isCacheValid||a._clearCache()},_load:function(a,b){if(!a)throw Error(RIAPP.ERRS.ERR_DB_LOAD_NO_QUERY);var c=this,e=h.createDeferred(),k=a.loadPageCount,q=a.pageIndex,
f=a.isPagingEnabled,g=a.dbSetName,p=this.getDbSet(g);this.waitForNotSubmiting(function(){p.waitForNotLoading(function(){var l=p.query,m=c._getUrl("GetItems"),w,u,n=function(){p.isLoading=!1;c.isBusy=!1},v=function(a){n();e.resolve(a)},z=function(a){n();c._onDataOperError(a,"load");e.reject()},A;p.isLoading=!0;c.isBusy=!0;try{a.pageIndex=q;c._beforeLoad(a,l,p);var y,l=1;if(1<k&&f){if(a._isPageCached(q)){A=c._loadFromCache(a,b);A.outOfBandData=null;v(A);return}y=a._getCache().getNextRange(q);q=y.start;
l=y.cnt}w={dbSetName:g,pageIndex:q,pageSize:a.pageSize,pageCount:l,isIncludeTotalCount:a.isIncludeTotalCount,filterInfo:a.filterInfo,sortInfo:a.sortInfo,paramInfo:c._getMethodParams(a._queryInfo,a.params).paramInfo,queryName:a.queryName};u=JSON.stringify(w);h.performAjaxCall(m,u,!0,function(a){var e=[],q,k=[],r;try{q=a.indexOf(d.modules.consts.CHUNK_SEP),-1<q?(e.push(a.substr(0,q)),e.push(a.substr(q+d.modules.consts.CHUNK_SEP.length))):e.push(a),e=e.map(function(a){return JSON.parse(a)}),r=e[0],1<
e.length&&(k=e.slice(1)),A=c._onLoaded(r,b,k),A.outOfBandData=a.extraInfo,v(A)}catch(f){z(f)}},function(a){n();c._onDataOperError(a,"load");e.reject()},null)}catch(D){z(D)}},[],!0,b?"paging":null)},[],b?"paging":null);return e.promise()},getDbSet:function(a){if(!this.isInitialized)throw Error(RIAPP.ERRS.ERR_DOMAIN_CONTEXT_NOT_INITIALIZED);var b=this._dbSets[a];if(!b)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_NAME_INVALID,a));return b},getAssociation:function(a){var b=this._assoc[a];if(!b)throw Error(RIAPP.utils.format(RIAPP.ERR_ASSOC_NAME_INVALID,
a));return b()},submitChanges:function(){if(this._pendingSubmit)return this._pendingSubmit.deferred.promise();var a=this,b={deferred:h.createDeferred()},c=function(a){a?b.deferred.resolve():b.deferred.reject()};this._pendingSubmit=b;this.waitForNotBusy(function(){var b,e,d,k=function(){a.isBusy=!1;a.isSubmiting=!1},f=function(b){k();a._onDataOperError(b,"submit");c(!1)};try{if(this.isSubmiting=this.isBusy=!0,this._pendingSubmit=null,b=this._getUrl("SaveChanges"),d=this._getChanges(),0===d.dbSets.length){k();
c(!0);return}}catch(g){f(g);return}try{e=JSON.stringify(d),h.performAjaxCall(b,e,!0,function(b){try{a._dataSaved(JSON.parse(b)),k(),c(!0)}catch(e){f(e)}},function(b){k();a._onSubmitError(b);c(!1)},null)}catch(p){f(p)}},[]);return b.deferred.promise()},load:function(a){return this._load(a,!1)},acceptChanges:function(){this._arrDbSets.forEach(function(a){a.acceptChanges()})},rejectChanges:function(){this._arrDbSets.forEach(function(a){a.rejectChanges()})},initialize:function(a){if(!this._isInitialized){var b=
this;a=h.extend(!1,{serviceUrl:null,metadata:null},a);this._serviceUrl=a.serviceUrl;if(a.metadata)this._initDbSets(a.metadata);else{a=this._getUrl("GetMetadata");try{this.isBusy=!0,h.performAjaxCall(a,void 0,!0,function(a){try{b._initDbSets(JSON.parse(a)),b.isBusy=!1}catch(c){b.isBusy=!1,b._onDataOperError(c,"initDbContext"),d._throwDummy(c)}},function(a){b.isBusy=!1;b._onDataOperError(a,"initDbContext")},null)}catch(c){this.isBusy=!1,this._onDataOperError(c,"initDbContext"),d._throwDummy(c)}}}},
waitForNotBusy:function(a,b){this._waitQueue.enQueue({prop:"isBusy",groupName:null,predicate:function(a){return!a},action:a,actionArgs:b})},waitForNotSubmiting:function(a,b,c){this._waitQueue.enQueue({prop:"isSubmiting",predicate:function(a){return!a},action:a,actionArgs:b,groupName:c,lastWins:!!c})},waitForInitialized:function(a,b){this._waitQueue.enQueue({prop:"isInitialized",groupName:"dbContext",predicate:function(a){return!!a},action:a,actionArgs:b})},destroy:function(){this._waitQueue&&(this._waitQueue.destroy(),
this._waitQueue=null,this._arrAssoc.forEach(function(a){a.destroy()}),this._arrAssoc=[],this._assoc={},this._arrDbSets.forEach(function(a){a.destroy()}),this._arrDbSets=[],this._dbSets={},this._svcMethods={},this._queryInf={},this._serviceUrl=null,this._hasChanges=this._isSubmiting=this._isBusy=this._isInitialized=!1,this._super())}},{app:{get:function(){return this._app}},service_url:{get:function(){return this._serviceUrl}},isInitialized:{get:function(){return this._isInitialized}},isBusy:{set:function(a){var b=
0<this._isBusy;a?this._isBusy+=1:(this._isBusy-=1,0>this._isBusy&&(this._isBusy=0));0<this._isBusy!=b&&this.raisePropertyChanged("isBusy")},get:function(){return 0<this._isBusy}},isSubmiting:{set:function(a){this._isSubmiting!==a&&(this._isSubmiting=a,this.raisePropertyChanged("isSubmiting"))},get:function(){return this._isSubmiting}},serverTimezone:{get:function(){return this._serverTimezone}},dbSets:{get:function(){return this._dbSets}},arrDbSets:{get:function(){return this._arrDbSets}},serviceMethods:{get:function(){return this._svcMethods}},
hasChanges:{get:function(){return this._hasChanges}}},function(b){f.DbContext=b;a.registerType("DbContext",b)});var z=l.Collection.extend({_create:function(a){this._super();a=h.extend(!1,{dataSource:null,fn_filter:null,fn_sort:null,fn_itemsProvider:null},a);if(!a.dataSource||!l.Collection.isPrototypeOf(a.dataSource))throw Error(RIAPP.ERRS.ERR_DATAVIEW_DATASRC_INVALID);if(!a.fn_filter||!h.check_is.Function(a.fn_filter))throw Error(RIAPP.ERRS.ERR_DATAVIEW_FILTER_INVALID);this._dataSource=a.dataSource;
this._fn_filter=a.fn_filter;this._fn_sort=a.fn_sort;this._fn_itemsProvider=a.fn_itemsProvider;this._isAddingNew=this._isDSFilling=!1;var b=this,c=this._dataSource;c.getFieldNames().forEach(function(a){b._fieldMap[a]=h.extend(!1,{},c.getFieldInfo(a))});this._bindDS()},_getEventNames:function(){var a=this._super();return["view_refreshed"].concat(a)},_filterForPaging:function(a){var b=0,c=0,e=-1,d=-1,q=[],b=this.pageSize*this.pageIndex,c=this.pageSize;a.forEach(function(a){d+=1;d<b||(e+=1,e<c&&q.push(a))});
return q},_onViewRefreshed:function(a){this.raiseEvent("view_refreshed",a)},_refresh:function(a){var b;if(b=this._dataSource)b=this._fn_itemsProvider?this._fn_itemsProvider(b):b.items,this._fn_filter&&(b=b.filter(this._fn_filter)),this._fn_sort&&(b=b.sort(this._fn_sort)),this._fillItems({items:b,isPageChanged:!!a,clear:!0,isAppend:!1}),this._onViewRefreshed({})},_fillItems:function(a){a=h.extend(!1,{items:[],isPageChanged:!1,clear:!0,isAppend:!1},a);var b,c=[],e=[],d=[];this._onFillStart({isBegin:!0,
rowCount:a.items.length,time:new Date,isPageChanged:a.isPageChanged});try{a.clear&&this.clear(),b=this.isPagingEnabled&&!a.isAppend?this._filterForPaging(a.items):a.items,b.forEach(function(a){var b=this._itemsByKey[a._key];b?d.push(b):(this._itemsByKey[a._key]=a,c.push(a),e.push(this._items.length-1),this._items.push(a),d.push(a))},this),0<c.length&&(this._onItemsChanged({change_type:k.ADDED,items:c,pos:e}),this.raisePropertyChanged("count"))}finally{this._onFillEnd({isBegin:!1,rowCount:d.length,
time:new Date,resetUI:!!a.clear,fetchedItems:d,newItems:c,isPageChanged:a.isPageChanged})}this.totalCount=a.clear?a.items.length:this.totalCount+c.length;this.moveFirst();return c},_onDSCollectionChanged:function(a){var b=this,c;c=a.items;switch(a.change_type){case k.RESET:this._isDSFilling||this._refresh(!1);break;case k.ADDED:!this._isAddingNew&&!this._isDSFilling&&(b._fn_filter&&(c=c.filter(b._fn_filter)),b.appendItems([c]));break;case k.REMOVE:c.forEach(function(a){(a=b._itemsByKey[a._key])&&
b.removeItem(a)});break;case k.REMAP_KEY:if(c=b._itemsByKey[a.old_key])delete b._itemsByKey[a.old_key],b._itemsByKey[a.new_key]=c,this._onItemsChanged(a);break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,a.change_type));}},_onDSFill:function(a){var b=a.fetchedItems;a.isBegin?this._isDSFilling=!0:(this._isDSFilling=!1,a.resetUI?this._refresh(!1):(this._fn_filter&&(b=b.filter(this._fn_filter)),this.appendItems(b)))},_onDSStatusChanged:function(a){var b=a.item,
c=a.oldChangeType,e=!!this._fn_filter;this._itemsByKey[a.key]?(this._onItemStatusChanged(b,c),e&&((a=this._fn_filter(b))||this.removeItem(b))):e&&(a=this._fn_filter(b))&&this.appendItems([b])},_bindDS:function(){var a=this,b=this._dataSource;b&&(b.addHandler("coll_changed",function(c,e){b===c&&a._onDSCollectionChanged(e)},a._objId),b.addHandler("fill",function(c,e){b===c&&a._onDSFill(e)},a._objId),b.addHandler("begin_edit",function(c,e){b===c&&a._itemsByKey[e.item._key]&&a._onEditing(e.item,!0,!1)},
a._objId),b.addHandler("end_edit",function(c,e){if(b===c){var d,q=e.item;d=!!a._fn_filter;a._itemsByKey[q._key]?(a._onEditing(q,!1,e.isCanceled),!e.isCanceled&&d&&((d=a._fn_filter(q))||a.removeItem(q))):!e.isCanceled&&d&&(d=a._fn_filter(q))&&a.appendItems([q])}},a._objId),b.addHandler("errors_changed",function(c,e){b===c&&a._itemsByKey[e.item._key]&&a._onErrorsChanged(e.item)},a._objId),b.addHandler("status_changed",function(c,e){b===c&&a._onDSStatusChanged(e)},a._objId),b.addHandler("item_deleting",
function(c,e){b===c&&a._itemsByKey[e.item._key]&&a._onItemDeleting(e)},a._objId),b.addHandler("item_added",function(c,e){b===c&&a._isAddingNew&&(a._itemsByKey[e.item._key]||a._attach(e.item),a.currentItem=e.item,a._onEditing(e.item,!0,!1),a._onItemAdded(e.item))},a._objId),b.addHandler("item_adding",function(c,e){b===c&&a._isAddingNew&&a._onItemAdding(e.item)},a._objId))},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},appendItems:function(a){return this._isDestroyed?
[]:this._fillItems({items:a,isPageChanged:!1,clear:!1,isAppend:!0})},_getStrValue:function(a,b){return this._dataSource._getStrValue(a,b)},_onCurrentChanging:function(a){var b=this._dataSource;try{b._EditingItem&&a!==b._EditingItem&&b.endEdit()}catch(c){b.cancelEdit(),d.reThrow(c,this._onError(c,this))}},_getErrors:function(a){return this._dataSource._getErrors(a)},_onPageChanged:function(){this._refresh(!0)},getItemsWithErrors:function(){return this._dataSource.getItemsWithErrors()},addNew:function(){var a=
this._dataSource,b;this._isAddingNew=!0;try{b=a.addNew()}finally{this._isAddingNew=!1}return b},removeItem:function(a){if(null===a._key)throw Error(RIAPP.ERRS.ERR_ITEM_IS_DETACHED);if(this._itemsByKey[a._key]){var b=h.removeFromArray(this._items,a);if(0>b)throw Error(RIAPP.ERRS.ERR_ITEM_IS_NOTFOUND);delete this._itemsByKey[a._key];delete this._errors[a._key];this.totalCount-=1;this._onRemoved(a,b);a=this.getItemByPos(b);var c=this._currentPos;c===b&&(a||(this._currentPos=c-1),this._onCurrentChanged());
c>b&&(this._currentPos=c-1,this._onCurrentChanged())}},sortLocal:function(a,b){var c=1,e=this._app.parser;b&&"DESC"===b.toUpperCase()&&(c=-1);this.fn_sort=function(b,d){var k=0,f,g,p;f=0;for(g=a.length;f<g&&!(p=a[f],k=e.resolvePath(b,p),p=e.resolvePath(d,p),k=k<p?-1*c:k>p?c:0,0!==k);f+=1);return k}},getIsHasErrors:function(){return this._dataSource.getIsHasErrors()},clear:function(){this.cancelEdit();this._EditingItem=null;this._newKey=0;this.currentItem=null;this._items=[];this._itemsByKey={};this._errors=
{};this._onItemsChanged({change_type:k.RESET,items:[]});this.pageIndex=0;this.raisePropertyChanged("count")},refresh:function(){this._refresh(!1)},destroy:function(){this._isDestroyed||(this._unbindDS(),this._fn_sort=this._fn_filter=this._dataSource=null,this._super())}},{isPagingEnabled:{set:function(a){this._options.enablePaging!==a&&(this._options.enablePaging=a,this.raisePropertyChanged("isPagingEnabled"),this._refresh())},get:function(){return this._options.enablePaging}},permissions:{get:function(){return this._dataSource.permissions}},
fn_filter:{set:function(a){this._fn_filter!==a&&(this._fn_filter=a,this._refresh())},get:function(){return this._fn_filter}},fn_sort:{set:function(a){this._fn_sort!==a&&(this._fn_sort=a,this._refresh())},get:function(){return this._fn_sort}},fn_itemsProvider:{set:function(a){this._fn_itemsProvider!==a&&(this._fn_itemsProvider=a,this._refresh())},get:function(){return this._fn_itemsProvider}}},function(b){f.DataView=b;a.registerType("DataView",b)}),A=RIAPP.BaseObject.extend({_app:a,_create:function(a){this._super();
var b=this;this._objId="ass"+this._app.getNewObjectID();a=h.extend(!1,{dbContext:null,parentName:"",childName:"",parentKeyFields:[],childKeyFields:[],parentToChildrenName:null,childToParentName:null,name:this._objId,onDeleteAction:0},a);this._name=a.name;this._dbContext=a.dbContext;this._onDeleteAction=a.onDeleteAction;this._parentDS=a.dbContext.dbSets[a.parentName];this._childDS=a.dbContext.dbSets[a.childName];this._parentFldInfos=a.parentKeyFields.map(function(a){return b._parentDS.getFieldInfo(a)});
this._childFldInfos=a.childKeyFields.map(function(a){return b._childDS.getFieldInfo(a)});this._parentToChildrenName=a.parentToChildrenName;this._childToParentName=a.childToParentName;this._parentMap={};this._childMap={};this._isChildFilling=this._isParentFilling=!1;this._bindParentDS();a=this._mapParentItems(this._parentDS.items);this._bindChildDS();var c=this._mapChildren(this._childDS.items);this._changedTimeout=this._saveChildFKey=this._saveParentFKey=null;this._changed={};b._notifyParentChanged(a);
b._notifyChildrenChanged(c)},_onError:function(a,b){var c=this._super(a,b);return!c?this.app._onError(a,b):c},_bindParentDS:function(){var a=this,b=this._parentDS;b&&(b._addHandler("coll_changed",function(c,e){b===c&&a._onParentCollChanged(e)},a._objId,!0),b._addHandler("fill",function(c,e){b===c&&a._onParentFill(e)},a._objId,!0),b._addHandler("begin_edit",function(c,e){b===c&&a._onParentEdit(e.item,!0,void 0)},a._objId,!0),b._addHandler("end_edit",function(c,e){b===c&&a._onParentEdit(e.item,!1,e.isCanceled)},
a._objId,!0),b._addHandler("item_deleting",function(a,b){},a._objId,!0),b._addHandler("status_changed",function(c,e){b===c&&a._onParentStatusChanged(e.item,e.oldChangeType)},a._objId,!0),b._addHandler("commit_changes",function(c,e){b===c&&a._onParentCommitChanges(e.item,e.isBegin,e.isRejected,e.changeType)},a._objId,!0))},_bindChildDS:function(){var a=this,b=this._childDS;b&&(b._addHandler("coll_changed",function(c,e){b===c&&a._onChildCollChanged(e)},a._objId,!0),b._addHandler("fill",function(c,e){b===
c&&a._onChildFill(e)},a._objId,!0),b._addHandler("begin_edit",function(c,e){b===c&&a._onChildEdit(e.item,!0,void 0)},a._objId,!0),b._addHandler("end_edit",function(c,e){b===c&&a._onChildEdit(e.item,!1,e.isCanceled)},a._objId,!0),b._addHandler("status_changed",function(c,e){b===c&&a._onChildStatusChanged(e.item,e.oldChangeType)},a._objId,!0),b._addHandler("commit_changes",function(c,e){b===c&&a._onChildCommitChanges(e.item,e.isBegin,e.isRejected,e.changeType)},a._objId,!0))},_onParentCollChanged:function(a){var b=
this,c;c=a.items;var e=[],d={};switch(a.change_type){case k.RESET:b._isParentFilling||(e=b.refreshParentMap());break;case k.ADDED:this._isParentFilling||(e=b._mapParentItems(c));break;case k.REMOVE:c.forEach(function(a){(a=b._unMapParentItem(a))&&(d[a]=null)});e=Object.keys(d);break;case k.REMAP_KEY:if(a.old_key&&(c=this._parentMap[a.old_key]))delete this._parentMap[a.old_key],e=this._mapParentItems([c]);break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,a.change_type));
}b._notifyParentChanged(e)},_onParentFill:function(a){a.isBegin?this._isParentFilling=!0:(this._isParentFilling=!1,a=a.resetUI?this.refreshParentMap():this._mapParentItems(a.newItems),this._notifyParentChanged(a))},_onParentEdit:function(a,b,c){b?this._storeParentFKey(a):c?this._saveParentFKey=null:this._checkParentFKey(a)},_onParentCommitChanges:function(a,b,e,d){b?e&&d===c.ADDED?(a=this._unMapParentItem(a))&&this._notifyParentChanged([a]):!e&&d===c.DELETED?(a=this._unMapParentItem(a))&&this._notifyParentChanged([a]):
this._storeParentFKey(a):this._checkParentFKey(a)},_storeParentFKey:function(a){a=this.getParentFKey(a);null!==a&&this._parentMap[a]&&(this._saveParentFKey=a)},_checkParentFKey:function(a){var b,c=this._saveParentFKey;this._saveParentFKey=null;b=this.getParentFKey(a);b!==c&&(c&&(delete this._parentMap[c],this._notifyChildrenChanged([c]),this._notifyParentChanged([c])),b&&(this._mapParentItems([a]),this._notifyChildrenChanged([b]),this._notifyParentChanged([b])))},_onParentStatusChanged:function(a,
b){var e=this,d,k;if(a._changeType===c.DELETED){k=e.getChildItems(a);d=this._unMapParentItem(a);switch(e.onDeleteAction){case 1:k.forEach(function(a){a.deleteItem()});break;case 2:k.forEach(function(a){var b=a.isEditing;b||a.beginEdit();try{e._childFldInfos.forEach(function(b){a[b.fieldName]=null}),b||a.endEdit()}finally{b||a.cancelEdit()}})}d&&e._notifyParentChanged([d])}},_onChildCollChanged:function(a){var b=this,c=a.items,e=[],d={};switch(a.change_type){case k.RESET:b._isChildFilling||(e=b.refreshChildMap());
break;case k.ADDED:this._isChildFilling||(e=b._mapChildren(c));break;case k.REMOVE:c.forEach(function(a){(a=b._unMapChildItem(a))&&(d[a]=null)});e=Object.keys(d);break;case k.REMAP_KEY:if(a.old_key&&(a=c[0])){if(e=a._getFieldVal(this._childToParentName))delete this._childMap[e],a._clearFieldVal(this._childToParentName);e=this._mapChildren([a])}break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,a.change_type));}b._notifyChildrenChanged(e)},_notifyChildrenChanged:function(a){this._notifyChanged([],
a)},_notifyParentChanged:function(a){this._notifyChanged(a,[])},_notifyChanged:function(a,b){var c=this;if(0<a.length||0<b.length)a.forEach(function(a){var b=c._changed[a];c._changed[a]=b?b|1:1}),b.forEach(function(a){var b=c._changed[a];c._changed[a]=b?b|2:2}),this._changedTimeout||(this._changedTimeout=setTimeout(function(){if(!c._isDestroyCalled){c._changedTimeout=null;var a=c._changed;c._changed={};Object.keys(a).forEach(function(b){var e=a[b];1==(e&1)&&c._onParentChanged(b);2==(e&2)&&c._onChildrenChanged(b)})}},
50))},_onChildFill:function(a){a.isBegin?this._isChildFilling=!0:(this._isChildFilling=!1,a=a.resetUI?this.refreshChildMap():this._mapChildren(a.newItems),this._notifyChildrenChanged(a))},_onChildEdit:function(a,b,c){b?this._storeChildFKey(a):c?this._saveChildFKey=null:this._checkChildFKey(a)},_onChildCommitChanges:function(a,b,e,d){b?e&&d===c.ADDED?(a=this._unMapChildItem(a))&&this._notifyChildrenChanged([a]):!e&&d===c.DELETED?(a=this._unMapChildItem(a))&&this._notifyChildrenChanged([a]):this._storeChildFKey(a):
this._checkChildFKey(a)},_storeChildFKey:function(a){var b=this.getChildFKey(a),c;if(b&&(c=this._childMap[b])&&-1<c.indexOf(a))this._saveChildFKey=b},_checkChildFKey:function(a){var b=this._saveChildFKey,c,e;this._saveChildFKey=null;c=this.getChildFKey(a);c!==b&&(b&&(e=this._childMap[b],h.removeFromArray(e,a),0==e.length&&delete this._childMap[b],this._notifyParentChanged([b]),this._notifyChildrenChanged([b])),c&&(this._mapChildren([a]),this._notifyParentChanged([c]),this._notifyChildrenChanged([c])))},
_onChildStatusChanged:function(a,b){var e=c.DELETED,d=a._changeType,k=this.getChildFKey(a);k&&d===e&&(k=this._unMapChildItem(a))&&this._notifyChildrenChanged([k])},_getItemKey:function(a,b,c){for(var e=[],d,q=0,k=a.length;q<k;q+=1){d=c[a[q].fieldName];d=b._getStrValue(d,a[q]);if(null===d)return null;e.push(d)}return e.join(";")},_resetChildMap:function(){var a=Object.keys(this._childMap);this._childMap={};this._notifyChildrenChanged(a)},_resetParentMap:function(){var a=Object.keys(this._parentMap);
this._parentMap={};this._notifyParentChanged(a)},_unMapChildItem:function(a){var b,c,e=null;if(b=this.getChildFKey(a))if(c=this._childMap[b])a=h.removeFromArray(c,a),-1<a&&(0==c.length&&delete this._childMap[b],e=b);return e},_unMapParentItem:function(a){var b=null;if((a=this.getParentFKey(a))&&this._parentMap[a])delete this._parentMap[a],b=a;return b},_mapParentItems:function(a){for(var b,e,d=c.DELETED,k,q={},f=0,g=a.length;f<g;f+=1)if(b=a[f],e=b._changeType,e!==d&&(e=this.getParentFKey(b)))k=this._parentMap[e],
k!==b&&(this._parentMap[e]=b,q[e]=null);return Object.keys(q)},_onChildrenChanged:function(a){a&&this._parentToChildrenName&&(a=this._parentMap[a])&&a.raisePropertyChanged(this._parentToChildrenName)},_onParentChanged:function(a){var b=this;a&&this._childToParentName&&(a=this._childMap[a])&&a.forEach(function(a){a.raisePropertyChanged(b._childToParentName)})},_mapChildren:function(a){for(var b,e,d,k=c.DELETED,q={},f=0,g=a.length;f<g;f+=1)if(b=a[f],e=b._changeType,e!==k&&(e=this.getChildFKey(b)))d=
this._childMap[e],d||(d=[],this._childMap[e]=d),0>d.indexOf(b)&&(d.push(b),q[e]||(q[e]=null));return Object.keys(q)},_unbindParentDS:function(){var a=this.parentDS;a&&a.removeNSHandlers(this._objId)},_unbindChildDS:function(){var a=this.childDS;a&&a.removeNSHandlers(this._objId)},getParentFKey:function(a){return a&&a._isNew?a._key:this._getItemKey(this._parentFldInfos,this._parentDS,a)},getChildFKey:function(a){if(a&&this._childToParentName){var b=a._getFieldVal(this._childToParentName);if(b)return b}return this._getItemKey(this._childFldInfos,
this._childDS,a)},getChildItems:function(a){if(!a)return[];a=this.getParentFKey(a);a=this._childMap[a];return!a?[]:a},getParentItem:function(a){if(!a)return null;a=this.getChildFKey(a);return(a=this._parentMap[a])?a:null},refreshParentMap:function(){this._resetParentMap();return this._mapParentItems(this._parentDS.items)},refreshChildMap:function(){this._resetChildMap();return this._mapChildren(this._childDS.items)},destroy:function(){clearTimeout(this._changedTimeout);this._changedTimeout=null;this._changed=
{};this._unbindParentDS();this._unbindChildDS();this._childFldInfos=this._parentFldInfos=this._childMap=this._parentMap=null;this._super()},toString:function(){return"Association: "+this._name}},{app:{get:function(){return this._app}},name:{get:function(){return this._name}},parentToChildrenName:{get:function(){return this._parentToChildrenName}},childToParentName:{get:function(){return this._childToParentName}},parentDS:{get:function(){return this._parentDS}},childDS:{get:function(){return this._childDS}},
parentFldInfos:{get:function(){return this._parentFldInfos}},childFldInfos:{get:function(){return this._childFldInfos}},onDeleteAction:{get:function(){return this._onDeleteAction}}},function(a){f.Association=a});z.extend({_create:function(a){this._refreshTimeout=this._parentItem=null;this._association=a.association;a.dataSource=this._association.childDS;var b=this,c=this._association,e=a.fn_filter;a.fn_filter=function(a){if(!b._parentItem)return!1;var d=c.getParentFKey(b._parentItem);if(!d)return!1;
var k=c.getChildFKey(a);return!k||d!==k?!1:e?e(a):!0};this._super(a)},_refresh:function(){var a=this;this._dataSource&&(clearTimeout(a._refreshTimeout),a._refreshTimeout=setTimeout(function(){if(!a._isDestroyCalled){var b=a._association.getChildItems(a._parentItem);a._fn_filter&&(b=b.filter(a._fn_filter));a._fn_sort&&(b=b.sort(a._fn_sort));a._fillItems({items:b,isPageChanged:!1,clear:!0,isAppend:!1});a._onViewRefreshed({})}},250))},destroy:function(){clearTimeout(this._refreshTimeout);this._association=
null;this._super()},toString:function(){return this._association?"ChildDataView for "+this._association.toString():"ChildDataView"}},{parentItem:{set:function(a){this._parentItem!==a&&(this._parentItem=a,this.raisePropertyChanged("parentItem"),0<this.items.length&&(this.clear(),this._onViewRefreshed({})),this._refresh())},get:function(){return this._parentItem}},association:{get:function(){return this._association}}},function(b){f.ChildDataView=b;a.registerType("ChildDataView",b)})};
RIAPP.Application._coreModules.datadialog=function(a){var f=this,d=a.global,l=d.utils,h=RIAPP.localizable.TEXT,n=a.modules.db,m=a.modules.template.Template,g={DIALOG_ACTION:{Default:0,StayOpen:1}};Object.freeze(g.DIALOG_ACTION);Object.freeze(g);f.consts=g;RIAPP.BaseObject.extend({_app:a,DIALOG_ACTION:g.DIALOG_ACTION,_create:function(a){this._super();var c=this;this._objId="dlg"+this._app.getNewObjectID();a=l.extend(!1,{dataContext:null,dbContext:null,templateID:null,width:500,height:350,title:"data edit dialog",
submitOnOK:!1,canRefresh:!1,canCancel:!0,fn_OnClose:null,fn_OnOK:null,fn_OnCancel:null,fn_OnTemplateCreated:null},a);this._dataContext=a.dataContext;this._dbContext=a.dbContext||this._app.dbContext;this._templateID=a.templateID;this._submitOnOK=a.submitOnOK;this._canRefresh=a.canRefresh;this._canCancel=a.canCancel;this._fn_OnClose=a.fn_OnClose;this._fn_OnOK=a.fn_OnOK;this._fn_OnShow=a.fn_OnShow;this._fn_OnCancel=a.fn_OnCancel;this._fn_OnTemplateCreated=a.fn_OnTemplateCreated;this._isEditable=!1;this._result=
this._$template=this._template=null;this._fn_submitOnOK=function(){var a=c._dbContext;if(!a)return l.createDeferred().resolve();a.addHandler("submit_error",function(a,b){n.SubmitError.isPrototypeOf(b.error)&&0<b.error.notValidated.length&&(b.isHandled=!0)},c._objId);var b=a.submitChanges();b.always(function(){a.removeHandler("submit_error",c._objId)});return b};this._updateIsEditable();this._options={width:a.width,height:a.height,title:a.title,autoOpen:!1,modal:!0,close:function(a,b){c._onClose()},
buttons:c._getButtons()};this._dialogCreated=!1;this._createDialog()},_updateIsEditable:function(){var a=this._dataContext;this._isEditable=a?!!a.endEdit&&!!a.cancelEdit:!1},_createDialog:function(){this._dialogCreated||(this._template=this._createTemplate(this._dataContext),this._$template=d.$(this._template.el),d.document.body.appendChild(this._template.el),this._$template.dialog(this._options),this._dialogCreated=!0,this._fn_OnTemplateCreated&&this._fn_OnTemplateCreated(this._template))},_getEventNames:function(){var a=
this._super();return["close","refresh"].concat(a)},_createTemplate:function(a){var c=m.create(this._templateID);c.isDisabled=!0;c.dataContext=a;return c},_getButtons:function(){var a=this,c=[{id:a._objId+"Refresh",text:h.txtRefresh,"class":"btn btn-info",click:function(){a._onRefresh()}},{id:a._objId+"Ok",text:h.txtOk,"class":"btn btn-info",click:function(){a._onOk()}},{id:a._objId+"Cancel",text:h.txtCancel,"class":"btn btn-info",click:function(){a._onCancel()}}];this.canRefresh||c.shift();this.canCancel||
c.pop();return c},_getOkButton:function(){return $("#"+this._objId+"Ok")},_getCancelButton:function(){return $("#"+this._objId+"Cancel")},_getRefreshButton:function(){return $("#"+this._objId+"Refresh")},_getAllButtons:function(){return[this._getOkButton(),this._getCancelButton(),this._getRefreshButton()]},_disableButtons:function(a){this._getAllButtons().forEach(function(c){c.prop("disabled",!!a)})},_onOk:function(){var a=this,c;c=g.DIALOG_ACTION.Default;this._fn_OnOK&&(c=this._fn_OnOK(this));if(c!=
g.DIALOG_ACTION.StayOpen)if(this._dataContext){if(c=this._isEditable?this._dataContext.endEdit():!0)if(this._submitOnOK){this._disableButtons(!0);var e=this.title;this.title=h.txtSubmitting;c=this._fn_submitOnOK();c.always(function(){a._disableButtons(!1);a.title=e});c.done(function(){a._result="ok";a.hide()});c.fail(function(){a._isEditable&&a._dataContext.beginEdit()})}else a._result="ok",a.hide()}else a.hide()},_onCancel:function(){var a=g.DIALOG_ACTION.Default;this._fn_OnCancel&&(a=this._fn_OnCancel(this));
a!=g.DIALOG_ACTION.StayOpen&&(this._result="cancel",this.hide())},_onRefresh:function(){var a={isHandled:!1};this.raiseEvent("refresh",a);a.isHandled||this._dataContext&&this._dataContext.refresh&&this._dataContext.refresh()},_onClose:function(){try{"ok"!=this._result&&this._dataContext&&(this._isEditable&&this._dataContext.cancelEdit(),this._submitOnOK&&this._dataContext.rejectChanges&&this._dataContext.rejectChanges()),this._fn_OnClose&&this._fn_OnClose(this),this.raiseEvent("close",{})}finally{this._template.isDisabled=
!0}},show:function(){this._result=null;this._$template.dialog("option","buttons",this._getButtons());this._template.isDisabled=!1;this._fn_OnShow&&this._fn_OnShow(this);this._$template.dialog("open")},hide:function(){this._$template.dialog("close")},getOption:function(a){return this._$template.dialog("option",a)},setOption:function(a,c){this._$template.dialog("option",a,c)},destroy:function(){this._dialogCreated&&(this.hide(),this._$template.remove(),this._template.destroy(),this._template=this._$template=
null,this._dialogCreated=!1);this._fn_submitOnOK=this._dbContext=this._dataContext=null;this._super()}},{app:{get:function(){return this._app}},dataContext:{set:function(a){a!==this._dataContext&&(this._dataContext=a,this._template&&(this._template.dataContext=this._dataContext),this._updateIsEditable(),this.raisePropertyChanged("dataContext"))},get:function(){return this._dataContext}},result:{get:function(){return this._result}},template:{get:function(){return this._template}},isSubmitOnOK:{set:function(a){this._submitOnOK!==
a&&(this._submitOnOK=a,this.raisePropertyChanged("isSubmitOnOK"))},get:function(){return this._submitOnOK}},width:{set:function(a){var c=this.getOption("width");a!==c&&(this.setOption("width",a),this.raisePropertyChanged("width"))},get:function(){return this.getOption("width")}},height:{set:function(a){var c=this.getOption("height");a!==c&&(this.setOption("height",a),this.raisePropertyChanged("height"))},get:function(){return this.getOption("height")}},title:{set:function(a){var c=this.getOption("title");
a!==c&&(this.setOption("title",a),this.raisePropertyChanged("title"))},get:function(){return this.getOption("title")}},canRefresh:{set:function(a){a!==this._canRefresh&&(this._canRefresh=a,this.raisePropertyChanged("canRefresh"))},get:function(){return this._canRefresh}},canCancel:{set:function(a){a!==this._canCancel&&(this._canCancel=a,this.raisePropertyChanged("canCancel"))},get:function(){return this._canCancel}}},function(b){f.DataEditDialog=b;a.registerType("DataEditDialog",b)})};
RIAPP.Application._coreModules.datagrid=function(a){var f=this,d=a.global,l=d.utils,h=d.consts,n,m,g,b,c,e,k,p,u,v,y,w,z,A=a.modules.baseElView.BaseElView,r=a.modules.collection,x=a.modules.datadialog.DataEditDialog,B=a.modules.template.Template,C=RIAPP.localizable.TEXT,s={container:"ria-table-container",dataTable:"ria-data-table",columnInfo:"ria-col-info",column:"ria-ex-column",cellDiv:"cell-div",headerDiv:"ria-table-header",wrapDiv:"ria-table-wrap",dataColumn:"data-column",rowCollapsed:"row-collapsed",
rowExpanded:"row-expanded",rowExpander:"row-expander",columnSelected:"selected",rowSelected:"selected",rowActions:"row-actions",rowDetails:"row-details",rowSelector:"row-selector",rowHighlight:"row-highlight",rowDeleted:"row-deleted",rowError:"row-error",nobr:"ria-nobr",colSortable:"sortable",colSortAsc:"sort-asc",colSortDesc:"sort-desc"};Object.freeze(s);f.css=s;n=RIAPP.BaseObject.extend({_app:a,_create:function(a,b){this._super();this._row=a;this._el=b.td;this._column=b.column;this._div=d.document.createElement("div");
var c=d.$(this._div);this._clickTimeOut=null;c.addClass(s.cellDiv).attr(h.DATA_ATTR.DATA_EVENT_SCOPE,this._column.uniqueID);this._div.cell=this;this._column.options.width&&(this._el.style.width=this._column.options.width);this._init();this._column.options.rowCellCss&&c.addClass(this._column.options.rowCellCss);this._el.appendChild(this._div);this._row.el.appendChild(this._el)},_init:function(){},_onCellClicked:function(){this.grid.currentRow=this._row},_onDblClicked:function(){this.grid.currentRow=
this._row;this.grid._onCellDblClicked(this)},_onError:function(a,b){var c=this._super(a,b);return!c?this.row._onError(a,b):c},scrollIntoView:function(a){this._div.scrollIntoView(!!a)},destroy:function(){this._isDestroyed||(this._clickTimeOut&&(clearTimeout(this._clickTimeOut),this._clickTimeOut=null),d.$(this._div).remove(),this._column=this._el=this._row=this._div=this._div.cell=null,this._super())},toString:function(){return"BaseCell"}},{el:{get:function(){return this._el}},row:{get:function(){return this._row}},
column:{get:function(){return this._column}},grid:{get:function(){return this._row.grid}},app:{get:function(){return this._app}},item:{get:function(){return this._row.item}}},function(a){f.BaseCell=a});b=n.extend({_create:function(a,b){this._stateCss=this._content=null;this._super(a,b)},_init:function(){var a=this._column.options.content;if(!a.fieldInfo&&a.fieldName&&(a.fieldInfo=this.item.getFieldInfo(a.fieldName),!a.fieldInfo))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,
"",a.fieldName));a.initContentFn=null;try{var b=this.app._getContentType(a);this.app.modules.content.LookupContent===b&&(a.initContentFn=this._getInitLookUpFn());this._content=this.app._getContent(b,a,this._div,this.item,this.item.isEditing)}finally{delete a.initContentFn}},_getInitLookUpFn:function(){var a=this;return function(b){b.addHandler("listbox_created",function(b,c){a._column._listBox=c.listBox;c.isCachedExternally=!!a._column._listBox});b.addHandler("need_listbox",function(b,c){c.listBox=
a._column._listBox})}},_beginEdit:function(){this._content.isEditing||(this._content.isEditing=!0)},_endEdit:function(a){this._content.isEditing&&(this._content.isEditing=!1)},_setState:function(a){var b;this._stateCss!==a&&(b=d.$(this._div),this._stateCss&&b.removeClass(this._stateCss),(this._stateCss=a)&&b.addClass(this._stateCss))},destroy:function(){this._isDestroyed||(this._content&&(this._content.destroy(),this._content=null),this._super())},toString:function(){return"DataCell"}},null,function(a){f.DataCell=
a});k=n.extend({_init:function(){var a=d.$(this.el);a.addClass(s.rowCollapsed);a.addClass(s.rowExpander)},_onCellClicked:function(){this._row&&(this._super(),this._row.isExpanded=!this._row.isExpanded)},_toggleImage:function(){var a=d.$(this.el);this._row.isExpanded?(a.removeClass(s.rowCollapsed),a.addClass(s.rowExpanded)):(a.removeClass(s.rowExpanded),a.addClass(s.rowCollapsed))},toString:function(){return"ExpanderCell"}},null,function(a){f.ExpanderCell=a});p=n.extend({_create:function(a,b){this._isEditing=
!1;this._super(a,b)},_init:function(){var a=d.$(this.el),b=d.$(this._div);a.addClass([s.rowActions,s.cellDiv,s.nobr].join(" "));b.on("mouseenter","img",function(a){a.stopPropagation();$(this).css("opacity",0.5)});b.on("mouseout","img",function(a){a.stopPropagation();$(this).css("opacity",1)});this._createButtons(!1)},destroy:function(){if(!this._isDestroyed){for(var a=this._div.getElementsByTagName("img"),b=0,c=a.length;b<c;b+=1)a[b].cell=null;this._super()}},_createButtons:function(a){if(this._el){var b=
this,c=d.$,e=d.$(this._div),k={img_ok:"txtOk",img_cancel:"txtCancel",img_edit:"txtEdit",img_delete:"txtDelete"};e.empty();var f=b._column.options;a?(this._isEditing=!0,a=c('<img name="img_ok" alt="ok"/>&nbsp;<img name="img_cancel" alt="cancel"/>')):(this._isEditing=!1,a=c('<img name="img_edit" alt="edit"/>&nbsp;<img name="img_delete" alt="delete"/>'),b.isCanEdit||(a=a.not('img[name="img_edit"]')),b.isCanDelete||(a=a.not('img[name="img_delete"]')));(function(a){a.each(function(a,e){var q=d.$(e);e.style.cursor=
"pointer";e.src=f[e.name];e.cell=b;l.addToolTip(q,C[k[e.name]]);c(e).attr(h.DATA_ATTR.DATA_EVENT_SCOPE,b._column.uniqueID)})})(a.filter("img"));e.append(a)}},update:function(){this._row&&this._isEditing!=this._row.isEditing&&this._createButtons(this._row.isEditing)},toString:function(){return"ActionsCell"}},{isCanEdit:{get:function(){return this.grid.isCanEdit}},isCanDelete:{get:function(){return this.grid.isCanDelete}}},function(a){f.ActionsCell=a});u=n.extend({_init:function(){d.$(this.el).addClass(s.rowSelector);
this._content=this.app.modules.content.RowSelectContent.create(this._div,{bindingInfo:{target:null,source:null,targetPath:null,sourcePath:"isSelected",mode:"TwoWay",converter:null,converterParam:null},displayInfo:null,fieldName:"isSelected"},this.row,!0)},destroy:function(){this._isDestroyed||(this._content&&(this._content.destroy(),this._content=null),this._super())},toString:function(){return"RowSelectorCell"}},null,function(a){f.RowSelectorCell=a});g=RIAPP.BaseObject.extend({_app:a,_create:function(a,
b){this._super();this._row=a;this._el=b.td;this._init(b)},_init:function(a){if(a=a.details_id)this._template=B.create(a),this._el.colSpan=this.grid.columns.length,this._el.appendChild(this._template.el),this._row.el.appendChild(this._el)},destroy:function(){this._isDestroyed||(this._template&&(this._template.destroy(),this._template=null),this._el=this._row=null,this._super())},toString:function(){return"DetailsCell"}},{el:{get:function(){return this._el}},row:{get:function(){return this._row}},grid:{get:function(){return this._row.grid}},
app:{get:function(){return this._app}},item:{set:function(a){this._template.dataContext=a},get:function(){return this._template.dataContext}}},function(a){f.DetailsCell=a});c=RIAPP.BaseObject.extend({_app:a,_create:function(a,b){var c=this;this._super();this._grid=a;this._el=b.tr;this._item=b.item;this._cells=[];this._objId=this._grid.uniqueID+"_"+this._item._key;this._rowSelectorCell=this._actionsCell=this._expanderCell=null;this._isSelected=this._isDeleted=this._isCurrent=!1;this._createCells();
this._item.addOnDestroyed(function(a,b){c._onItemDestroyed(b)},c._objId);this.isDeleted=this._item._isDeleted;var e=function(){var a=c._grid._onRowStateChanged(c,c._item[c._grid._options.rowStateField]);c._setState(a)};this._grid._options.rowStateField&&(this._item.addOnPropertyChange(this._grid._options.rowStateField,function(a,b){e()},this._objId),e())},_onItemDestroyed:function(){this.destroy()},_onError:function(a,b){var c=this._super(a,b);return!c?this.grid._onError(a,b):c},_createCells:function(){var a=
this;this.columns.forEach(function(b){b=a._createCell(b);a._cells.push(b)})},_createCell:function(a){var c=d.document.createElement("td");y.isPrototypeOf(a)?this._expanderCell=a=k.create(this,{td:c,column:a}):w.isPrototypeOf(a)?this._actionsCell=a=p.create(this,{td:c,column:a}):z.isPrototypeOf(a)?this._rowSelectorCell=a=u.create(this,{td:c,column:a}):a=b.create(this,{td:c,column:a});return a},_onBeginEdit:function(){this._cells.forEach(function(a){b.isPrototypeOf(a)&&a._beginEdit()});this._actionsCell&&
this._actionsCell.update()},_onEndEdit:function(a){this._cells.forEach(function(c){b.isPrototypeOf(c)&&c._endEdit(a)});this._actionsCell&&this._actionsCell.update()},beginEdit:function(){return this._item.beginEdit()},endEdit:function(){return this._item.endEdit()},cancelEdit:function(){return this._item.cancelEdit()},destroy:function(){if(!this._isDestroyed){var a=this._grid;a&&(this.isExpanded&&a.collapseDetails(),this._cells.forEach(function(a){a.destroy()}),this._cells=[],a._isClearing||(a._removeRow(this),
this._el&&d.$(this._el).remove()));this._item&&this._item.removeNSHandlers(this._objId);this._grid=this._el=this._expanderCell=this._item=null;this._super()}},deleteRow:function(){this._item.deleteItem()},updateErrorState:function(){var a=this._item.getIsHasErrors(),b=d.$(this.el);a?b.addClass(s.rowError):b.removeClass(s.rowError)},scrollIntoView:function(a){0<this._cells.length&&this._cells[0].scrollIntoView(a)},_setState:function(a){this.cells.forEach(function(c){b.isPrototypeOf(c)&&c._setState(a)})},
toString:function(){return"Row"}},{el:{get:function(){return this._el}},grid:{get:function(){return this._grid}},item:{get:function(){return this._item}},cells:{get:function(){return this._cells}},columns:{get:function(){return this._grid.columns}},uniqueID:{get:function(){return this._objId}},itemKey:{get:function(){return!this._item?null:this._item._key}},isCurrent:{set:function(a){if(a!==this._isCurrent){var b=d.$(this._el);(this._isCurrent=a)?b.addClass(s.rowHighlight):b.removeClass(s.rowHighlight);
this.raisePropertyChanged("isCurrent")}},get:function(){return this._isCurrent}},isSelected:{set:function(a){this._isSelected!=a&&(this._isSelected=a,this.raisePropertyChanged("isSelected"),this.grid._onRowSelectionChanged(this))},get:function(){return this._isSelected}},isExpanded:{set:function(a){a!==this.isExpanded&&(!a&&this.isExpanded?this.grid._expandDetails(this,!1):a&&this.grid._expandDetails(this,!0))},get:function(){return this.grid._expandedRow===this}},expanderCell:{get:function(){return this._expanderCell}},
actionsCell:{get:function(){return this._actionsCell}},isDeleted:{set:function(a){this._el&&this._isDeleted!==a&&((this._isDeleted=a)?(this.isExpanded=!1,d.$(this._el).addClass(s.rowDeleted)):d.$(this._el).removeClass(s.rowDeleted))},get:function(){return!this._el?!0:this._isDeleted}},isEditing:{get:function(){return this._item._isEditing}}},function(a){f.Row=a});m=RIAPP.BaseObject.extend({_app:a,_create:function(a,b){this._super();this._grid=a;this._el=b.tr;this._parentRow=this._cell=this._item=
null;this._objId="drow"+this.grid.app.getNewObjectID();this._createCell(b.details_id);this.$el=d.$(this._el);this.$el.addClass(s.rowDetails)},_createCell:function(a){var b=d.document.createElement("td");this._cell=g.create(this,{td:b,details_id:a})},destroy:function(){this._isDestroyed||(this._cell&&(this._cell.destroy(),this._cell=null),d.$(this._el).remove(),this._grid=this._el=this._item=null,this._super())},_setParentRow:function(a){var b=this;this._item=null;this._cell.item=null;l.removeNode(this.el);
!a||a._isDestroyCalled?this._parentRow=null:(this._parentRow=a,this._item=a.item,this._cell.item=this._item,l.insertAfter(a.el,this.el),d.$(this._cell._template.el).slideDown("fast",function(){var a=b._parentRow;a&&!a._isDestroyCalled&&b.grid._options.isUseScrollIntoDetails&&a.scrollIntoView(!0)}))},toString:function(){return"DetailsRow"}},{el:{get:function(){return this._el}},grid:{get:function(){return this._grid}},item:{set:function(a){this._item!==a&&(this._item=a)},get:function(){return this._item}},
cell:{get:function(){return this._cell}},uniqueID:{get:function(){return this._objId}},itemKey:{get:function(){return!this._item?null:this._item._key}},parentRow:{set:function(a){var b=this;if(a!==this._parentRow){var c=d.$(this._cell._template.el);b._parentRow?c.slideUp("fast",function(){b._setParentRow(a)}):b._setParentRow(a)}},get:function(){return this._parentRow}}},function(a){f.DetailsRow=a});n=RIAPP.BaseObject.extend({_app:a,_create:function(a,c){this._super();var e=this;this._grid=a;this._el=
c.th;this._options=c.colinfo;this._isSelected=!1;this._objId="col"+this.app.getNewObjectID();var k=d.$("<div></div>");k.addClass(s.column);this._grid._headerDiv.append(k);this._extcol=k;var f=d.$("<div></div>");f.addClass(s.cellDiv).click(function(b){b.stopPropagation();d.currentSelectable=a;a._setCurrentColumn(e);e._onColumnClicked()});k.append(f);f.get(0).cell=this;this._div=f;d.$(this.grid._tableEl).on("click","div["+h.DATA_ATTR.DATA_EVENT_SCOPE+'="'+this.uniqueID+'"]',function(c){c.stopPropagation();
var k=this.cell;k&&(d.currentSelectable=a,a._setCurrentColumn(e),b.isPrototypeOf(k)?k._clickTimeOut?(clearTimeout(k._clickTimeOut),k._clickTimeOut=null,k._onDblClicked()):(k._onCellClicked(),k._clickTimeOut=setTimeout(function(){k._clickTimeOut=null},350)):k._onCellClicked())});this._options.width&&(this._el.style.width=this._options.width);this._init();this._options.colCellCss&&f.addClass(this._options.colCellCss)},_init:function(){this.title&&this._div.html(this.title)},destroy:function(){this._isDestroyed||
(this._extcol.remove(),this._extcol=null,this._grid=this._el=this._item=this._div=this._div.get(0).cell=null,this._super())},scrollIntoView:function(a){this._div&&this._div.get(0).scrollIntoView(!!a)},_onColumnClicked:function(){},toString:function(){return"BaseColumn"}},{uniqueID:{get:function(){return this._objId}},app:{get:function(){return this._app}},el:{get:function(){return this._el}},$div:{get:function(){return this._div}},$extcol:{get:function(){return this._extcol}},grid:{get:function(){return this._grid}},
options:{get:function(){return this._options}},title:{get:function(){return this._options.title}},isSelected:{set:function(a){this._isSelected!==a&&((this._isSelected=a)?this._div.addClass(s.columnSelected):this._div.removeClass(s.columnSelected))},get:function(){return this._isSelected}}},function(a){f.BaseColumn=a});v=n.extend({_create:function(a,b){this._super(a,b);this._listBox=null;this.$div.addClass(s.dataColumn)},_init:function(){this._super();this.isSortable&&this.$div.addClass(s.colSortable);
this._sortOrder=null},_onColumnClicked:function(){if(this.isSortable&&this.sortMemberName){var a=this._sortOrder;this.grid._resetColumnsSort();this.sortOrder="ASC"==a?"DESC":"ASC";this.grid._sortByColumn(this)}},destroy:function(){this._isDestroyed||(this._listBox&&(this._listBox.destroy(),this._listBox=null),this._super())},toString:function(){return"DataColumn"}},{isSortable:{get:function(){return this._options.sortable}},sortMemberName:{get:function(){return this._options.sortMemberName}},sortOrder:{set:function(a){var b=
this.$div;b.removeClass(s.colSortable).removeClass(s.colSortAsc).removeClass(s.colSortDesc);switch(a){case "ASC":b.addClass(s.colSortAsc);break;case "DESC":b.addClass(s.colSortDesc);break;default:this.isSortable&&b.addClass(s.colSortable)}this._sortOrder=a},get:function(){return this._sortOrder}}},function(a){f.DataColumn=a});y=n.extend({_init:function(){this._super();this.$div.addClass(s.rowExpander)},toString:function(){return"ExpanderColumn"}},null,function(a){f.ExpanderColumn=a});w=n.extend({_init:function(){this._super();
var a=this,b=this.options;this.$div.addClass(s.rowActions);b.img_ok=d.getImagePath(b.img_ok||"ok.png");b.img_cancel=d.getImagePath(b.img_cancel||"cancel.png");b.img_edit=d.getImagePath(b.img_edit||"edit.png");b.img_delete=d.getImagePath(b.img_delete||"delete.png");d.$(this.grid._tableEl).on("click","img["+h.DATA_ATTR.DATA_EVENT_SCOPE+'="'+this.uniqueID+'"]',function(b){b.stopPropagation();b=this.cell;switch(this.name){case "img_ok":a._onOk(b);break;case "img_cancel":a._onCancel(b);break;case "img_edit":a._onEdit(b);
break;case "img_delete":a._onDelete(b)}})},_onOk:function(a){a._row&&(a._row.endEdit(),a.update())},_onCancel:function(a){a._row&&(a._row.cancelEdit(),a.update())},_onDelete:function(a){a._row&&a._row.deleteRow()},_onEdit:function(a){a._row&&(a._row.beginEdit(),a.update(),this.grid.showEditDialog())},toString:function(){return"ActionsColumn"}},null,function(a){f.ActionsColumn=a});z=n.extend({_init:function(){this._super();var a=this;this._val=!1;this.$div.addClass(s.rowSelector);var b=d.$('<input type="checkbox"/>');
this.$div.append(b);this._chk=b;b.click(function(b){b.stopPropagation();a._onCheckBoxClicked(this.checked)});b.on("change",function(b){b.stopPropagation();a.checked=this.checked})},_onCheckBoxClicked:function(a){this.grid._selectRows(a)},toString:function(){return"RowSelectorColumn"}},{checked:{set:function(a){var b=this._chk;null!==a&&(a=!!a);a!==this._val&&(this._val=a,b&&(b[0].checked=!!this._val),this.raisePropertyChanged("checked"))},get:function(){return this._val}}},function(a){f.RowSelectorColumn=
a});e=RIAPP.BaseObject.extend({_app:a,_create:function(a,b,c){this._super();if(b&&!r.Collection.isPrototypeOf(b))throw Error(RIAPP.ERRS.ERR_GRID_DATASRC_INVALID);this._options=l.extend(!1,{isUseScrollInto:!0,isUseScrollIntoDetails:!0,containerCss:null,wrapCss:null,headerCss:null,rowStateField:null,isCanEdit:null,isCanDelete:null,isHandleAddNew:!1},c);c=d.$(a);this._tableEl=a;this._$tableEl=c;c.addClass(s.dataTable);this._name=c.attr(h.DATA_ATTR.DATA_NAME);this._objId="grd"+this._app.getNewObjectID();
this._dataSource=b;this._rowMap={};this._rows=[];this._columns=[];this._isDSFilling=this._isClearing=!1;this._editingRow=this._currentColumn=this._rowSelectorCol=this._actionsCol=this._expanderCol=this._details=this._expandedRow=this._currentRow=null;this._isSorting=!1;this._contaner=this._wrapDiv=this._chkWidthInterval=this._headerDiv=this._dialog=null;this._wrapTable();this._createColumns();this._bindDS();this._refreshGrid();this._updateColsDim();this._onDSCurrentChanged()},_getEventNames:function(){var a=
this._super();return["row_expanded","row_selected","page_changed","row_state_changed","cell_dblclicked"].concat(a)},_setCurrentColumn:function(a){this._currentColumn&&(this._currentColumn.isSelected=!1);if(this._currentColumn=a)this._currentColumn.isSelected=!0},_parseColumnAttr:function(a,b){var c={type:"data",title:null,sortable:!1,sortMemberName:null,content:{}},e=this._app.parser.parseOptions(a),c=0<e.length?l.extend(!1,c,e[0]):c;b&&(c.content=this._app._parseContentAttr(b),!c.sortMemberName&&
c.content.fieldName&&(c.sortMemberName=c.content.fieldName));return c},_findUndeleted:function(a,b){if(!a)return null;if(!a.isDeleted)return a;var c=this.rows.indexOf(a),e=this.rows.length;if(b){c+=1;for(c<e&&(a=this.rows[c]);c<e&&a.isDeleted;)c+=1,c<e&&(a=this.rows[c])}else{c-=1;for(0<=c&&(a=this.rows[c]);0<=c&&a.isDeleted;)c-=1,0<=c&&(a=this.rows[c])}a.isDeleted&&(a=null);return a},_updateCurrent:function(a,b){this.currentRow=a;b&&(a&&!a.isDeleted)&&this._scrollToCurrent(!0)},_scrollToCurrent:function(a){var b=
this.currentRow;b&&b.scrollIntoView(a)},_onRowStateChanged:function(a,b){var c={row:a,val:b,css:null};this.raiseEvent("row_state_changed",c);return c.css},_onCellDblClicked:function(a){this.raiseEvent("cell_dblclicked",{cell:a})},_onError:function(a,b){var c=this._super(a,b);return!c?this._app._onError(a,b):c},_onDSCurrentChanged:function(){var a=this._dataSource,b;a&&(b=a.currentItem);b?this._updateCurrent(this._rowMap[b._key],!1):this._updateCurrent(null,!1)},_onDSCollectionChanged:function(a){var b=
this,c;c=r.consts.COLL_CHANGE_TYPE;var e=a.items;switch(a.change_type){case c.RESET:this._isDSFilling||this._refreshGrid();break;case c.ADDED:this._isDSFilling||b._appendItems(a.items,a.pos);break;case c.REMOVE:e.forEach(function(a){(a=b._rowMap[a._key])&&b._removeRow(a)});break;case c.REMAP_KEY:if(c=b._rowMap[a.old_key])delete b._rowMap[a.old_key],b._rowMap[a.new_key]=c;break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,a.change_type));}},_onDSFill:function(a){var b=
this;a.isBegin?(b._isDSFilling=!0,b._isSorting?b._isSorting=!1:a.isPageChanged||b._resetColumnsSort()):(b._isDSFilling=!1,a.resetUI?b._refreshGrid():b._appendItems(a.newItems),a.isPageChanged&&setTimeout(function(){b._isDestroyCalled||b._onPageChanged()},100),setTimeout(function(){b._isDestroyCalled||b._updateColsDim()},200))},_onPageChanged:function(){this._rowSelectorCol&&(this._rowSelectorCol.checked=!1);this._scrollToCurrent(!1);this.raiseEvent("page_changed",{})},_onItemEdit:function(a,b,c){if(a=
this._rowMap[a._key])b?(a._onBeginEdit(),this._editingRow=a):(a._onEndEdit(c),this._editingRow=null),this.raisePropertyChanged("editingRow")},_onItemAdded:function(a){var b=this._rowMap[a.item._key];b&&(this._updateCurrent(b,!0),this._options.isHandleAddNew&&!a.isAddNewHandled&&(a.isAddNewHandled=this.showEditDialog()))},_onItemStatusChanged:function(a,b){var c=h.CHANGE_TYPE.DELETED,e=a._changeType,d=this._dataSource,k=this._rowMap[a._key];k&&(e===c?(k.isDeleted=!0,(c=this._findUndeleted(k,!0))||
(c=this._findUndeleted(k,!1)),c&&(d.currentItem=c.item)):b===c&&e!==c&&(k.isDeleted=!1))},_onRowSelectionChanged:function(a){this.raiseEvent("row_selected",{row:a})},_onDSErrorsChanged:function(a){(a=this._rowMap[a._key])&&a.updateErrorState()},_resetColumnsSort:function(){this.columns.forEach(function(a){v.isPrototypeOf(a)&&(a.sortOrder=null)})},_bindDS:function(){var a=this,b=this._dataSource;b&&(b.addHandler("coll_changed",function(c,e){b===c&&a._onDSCollectionChanged(e)},a._objId),b.addHandler("fill",
function(c,e){b===c&&a._onDSFill(e)},a._objId),b.addOnPropertyChange("currentItem",function(c,e){b===c&&a._onDSCurrentChanged()},a._objId),b.addHandler("begin_edit",function(c,e){b===c&&a._onItemEdit(e.item,!0,void 0)},a._objId),b.addHandler("end_edit",function(c,e){b===c&&a._onItemEdit(e.item,!1,e.isCanceled)},a._objId),b.addHandler("errors_changed",function(c,e){b===c&&a._onDSErrorsChanged(e.item)},a._objId),b.addHandler("status_changed",function(c,e){b===c&&a._onItemStatusChanged(e.item,e.oldChangeType)},
a._objId),b.addHandler("item_added",function(c,e){b===c&&a._onItemAdded(e)},a._objId))},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},_getLastRow:function(){if(0===this._rows.length)return null;for(var a=this._rows.length-1,b=this._rows[a];b.isDeleted&&0<a;)a-=1,b=this._rows[a];return b.isDeleted?null:b},_removeRow:function(a){this._expandedRow===a&&this.collapseDetails();if(0!==this._rows.length){var b=a.itemKey,c=l.removeFromArray(this._rows,a);try{-1<c&&(a._isDestroyCalled||
a.destroy())}finally{this._rowMap[b]&&delete this._rowMap[b]}}},_clearGrid:function(){if(0!==this._rows.length){this._isClearing=!0;try{this.collapseDetails();var a=this._tBodyEl,b=d.document.createElement("tbody");this._tableEl.replaceChild(b,a);var c=this._rows;this._rows=[];this._rowMap={};c.forEach(function(a){a.destroy()})}finally{this._isClearing=!1}this._currentRow=null}},_updateColsDim:function(){var a=0,b=this._headerDiv;this._columns.forEach(function(b){a+=b.el.offsetWidth});b.width(a);
this._columns.forEach(function(a){a.$extcol.width(a.el.offsetWidth);a.$extcol.position({my:"left top",at:"left top",of:b,offset:""+a.el.offsetLeft+" 0"})})},_wrapTable:function(){var a=this._$tableEl,b,c,e,k=this;a.wrap(d.$("<div></div>").addClass(s.wrapDiv));c=a.parent();c.wrap(d.$("<div></div>").addClass(s.container));e=c.parent();b=d.$("<div></div>").addClass(s.headerDiv).insertBefore(c);d.$(this._tHeadRow).addClass(s.columnInfo);this._wrapDiv=c;this._headerDiv=b;this._contaner=e;this._options.containerCss&&
e.addClass(this._options.containerCss);this._options.wrapCss&&c.addClass(this._options.wrapCss);this._options.headerCss&&b.addClass(this._options.headerCss);var f=a.width();this._chkWidthInterval=setInterval(function(){var b=a.width();f!==b&&(f=b,k._updateColsDim())},1E3)},_unWrapTable:function(){var a=this._$tableEl;this._headerDiv&&(clearInterval(this._chkWidthInterval),this._chkWidthInterval=null,this._headerDiv.remove(),this._headerDiv=null,a.unwrap(),this._wrapDiv=null,a.unwrap(),this._contaner=
null)},_createColumns:function(){for(var a=this,b=this._tHeadCells,c=b.length,e=[],d,k,f=0;f<c;f+=1)d=b[f],k=this._parseColumnAttr(d.getAttribute(h.DATA_ATTR.DATA_COLUMN),d.getAttribute(h.DATA_ATTR.DATA_CONTENT)),e.push({th:d,colinfo:k});e.forEach(function(b){(b=a._createColumn(b))&&a._columns.push(b)})},_createColumn:function(a){var b;switch(a.colinfo.type){case "row_expander":this._expanderCol||(this._expanderCol=b=y.create(this,a));break;case "row_actions":this._actionsCol||(this._actionsCol=b=
w.create(this,a));break;case "row_selector":this._rowSelectorCol||(this._rowSelectorCol=b=z.create(this,a));break;case "data":b=v.create(this,a);break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_GRID_COLTYPE_INVALID,a.colinfo.type));}return b},_appendItems:function(a){if(!this._isDestroyCalled)for(var b,c=this._tBodyEl,e=0,d=a.length;e<d;e+=1)b=a[e],this._rowMap[b._key]||this._createRowForItem(c,b)},_onKeyDown:function(a,b){var c=this._dataSource,e=h.KEYS;if(c)switch(a){case e.up:b.preventDefault();
c.movePrev(!0)&&this.isUseScrollInto&&this._scrollToCurrent(!1);break;case e.down:b.preventDefault();c.moveNext(!0)&&this.isUseScrollInto&&this._scrollToCurrent(!1);break;case e.pageDown:0<c.pageIndex&&(c.pageIndex-=1);break;case e.pageUp:c.pageIndex+=1;break;case e.enter:this._currentRow&&this._actionsCol&&b.preventDefault();break;case e.esc:this._currentRow&&this._actionsCol&&this._currentRow.isEditing&&b.preventDefault();break;case e.space:this._rowSelectorCol&&(this._currentRow&&!this._currentRow.isEditing)&&
b.preventDefault()}},_onKeyUp:function(a,b){var c=h.KEYS;if(this._dataSource)switch(a){case c.enter:this._currentRow&&this._actionsCol&&(this._currentRow.isEditing?this._actionsCol._onOk(this._currentRow.actionsCell):this._actionsCol._onEdit(this._currentRow.actionsCell),b.preventDefault());break;case c.esc:this._currentRow&&this._actionsCol&&this._currentRow.isEditing&&(this._actionsCol._onCancel(this._currentRow.actionsCell),b.preventDefault());break;case c.space:this._rowSelectorCol&&(this._currentRow&&
!this._currentRow.isEditing)&&(b.preventDefault(),this._currentRow.isSelected=!this._currentRow.isSelected)}},_refreshGrid:function(){var a=this,b=this._dataSource;a._clearGrid();if(b){var c=d.document.createDocumentFragment(),e=this._tBodyEl,k=d.document.createElement("tbody");b.items.forEach(function(b,e){a._createRowForItem(c,b,e)});k.appendChild(c);a._tableEl.replaceChild(k,e)}},_createRowForItem:function(a,b){var e=d.document.createElement("tr"),e=c.create(this,{tr:e,item:b});this._rowMap[b._key]=
e;this._rows.push(e);a.appendChild(e.el);return e},_createDetails:function(){var a=this._options.details.templateID,b=d.document.createElement("tr");return m.create(this,{tr:b,details_id:a})},_expandDetails:function(a,b){if(this._options.details){this._details||(this._details=this._createDetails());var c=this._expandedRow;c===a&&c&&b||(this._expandedRow=null,this._details.parentRow=null,b?(this._expandedRow=a,this._details.parentRow=a,this._expandedRow.expanderCell._toggleImage()):(this._expandedRow=
null,this._details.parentRow=null,c&&c.expanderCell._toggleImage()),c!==a&&c&&c.expanderCell._toggleImage(),this.raiseEvent("row_expanded",{old_expandedRow:c,expandedRow:a,isExpanded:b}))}},_sortByColumn:function(a){var b=this._dataSource,c=b.query,e=a.sortMemberName.split(";");if(c){c.clearSort();for(var d=0;d<e.length;d+=1)0==d?c.orderBy(e[d],a.sortOrder):c.thenBy(e[d],a.sortOrder);c.isClearPrevData=!0;c.pageIndex=0;this._isSorting=!0;b.dbContext.load(c)}else this._isSorting=!0,b.sortLocal(e,a.sortOrder)},
_selectRows:function(a){this._rows.forEach(function(b){b.isDeleted||(b.isSelected=a)})},findRowByItem:function(a){a=this._rowMap[a._key];return!a?null:a},collapseDetails:function(){if(this._details){var a=this._expandedRow;a&&(this._expandedRow=null,this._details._setParentRow(null),this.raiseEvent("row_expanded",{old_expandedRow:a,expandedRow:null,isExpanded:!1}))}},getSelectedRows:function(){var a=[];this._rows.forEach(function(b){b.isDeleted||b.isSelected&&a.push(b)});return a},showEditDialog:function(){if(!this._options.editor||
!this._options.editor.templateID||!this._editingRow)return!1;var a,b=this._editingRow.item;b.isEditing||b.beginEdit();this._dialog?this._dialog.dataContext=b:(a=l.extend(!1,{dataContext:b},this._options.editor),this._dialog=x.create(a));this._dialog.canRefresh=!!this.dataSource.permissions.canRefreshRow&&!b._isNew;this._dialog.show();return!0},scrollToCurrent:function(a){this._scrollToCurrent(a)},addNew:function(){var a=this._dataSource;try{a.addNew(),this.showEditDialog()}catch(b){d.reThrow(b,this._onError(b,
this))}},destroy:function(){this._isDestroyed||(this._details&&(this._details.destroy(),this._details=null),this._dialog&&(this._dialog.destroy(),this._dialog=null),this._clearGrid(),this._unbindDS(),this._dataSource=null,this._unWrapTable(),this._$tableEl.removeClass(s.dataTable),d.$(this._tHeadRow).removeClass(s.columnInfo),this._$tableEl=this._tableEl=null,this._super())}},{app:{get:function(){return this._app}},$container:{get:function(){return this._contaner}},_tBodyEl:{get:function(){return this._tableEl.tBodies[0]}},
_tHeadEl:{get:function(){return this._tableEl.tHead}},_tFootEl:{get:function(){return this._tableEl.tFoot}},_tHeadRow:{get:function(){if(!this._tHeadEl)return[];var a=this._tHeadEl.rows;return 0===a.length?null:a[0]}},_tHeadCells:{get:function(){var a=this._tHeadRow;return!a?[]:a.cells}},uniqueID:{get:function(){return this._objId}},name:{get:function(){return this._name}},dataSource:{set:function(a){a!==this._dataSource&&(null!==this._dataSource&&this._unbindDS(),this._clearGrid(),this._dataSource=
a,null!==this._dataSource&&this._bindDS(),this.raisePropertyChanged("dataSource"))},get:function(){return this._dataSource}},rows:{get:function(){return this._rows}},columns:{get:function(){return this._columns}},currentRow:{set:function(a){var b=this._dataSource,c=this._currentRow,e=!1;b&&(c!==a&&(this._currentRow=a,c&&(c.isCurrent=!1),a&&(a.isCurrent=!0),e=!0),a?a.item!==b.currentItem&&(b.currentItem=a.item):b.currentItem=null,e&&this.raisePropertyChanged("currentRow"))},get:function(){return this._currentRow}},
editingRow:{get:function(){return this._editingRow}},isCanEdit:{get:function(){if(null!==this._options.isCanEdit)return this._options.isCanEdit;var a=this._dataSource;return!!a&&a.permissions.canEditRow}},isCanDelete:{get:function(){if(null!==this._options.isCanDelete)return this._options.isCanDelete;var a=this._dataSource;return!!a&&a.permissions.canDeleteRow}},isCanAddNew:{get:function(){var a=this._dataSource;return!!a&&a.permissions.canAddRow}},isUseScrollInto:{set:function(a){this._options.isUseScrollInto=
a},get:function(){return this._options.isUseScrollInto}}},function(a){f.DataGrid=a});A.extend({_init:function(a){this._super(a);this._gridEventCommand=this._grid=this._dataSource=null;this._options=a},destroy:function(){this._dataSource&&(this.dataSource=null);this._gridEventCommand=null;this._super()},_createGrid:function(){this._grid=e.create(this._el,this._dataSource,this._options);this._bindGridEvents()},_bindGridEvents:function(){if(this._grid){var a=this;this._grid.addHandler("row_expanded",
function(b,c){a.invokeGridEvent("row_expanded",c)},this.uniqueID);this._grid.addHandler("row_selected",function(b,c){a.invokeGridEvent("row_selected",c)},this.uniqueID);this._grid.addHandler("page_changed",function(b,c){a.invokeGridEvent("page_changed",c)},this.uniqueID);this._grid.addOnDestroyed(function(b,c){a._grid=null},this.uniqueID)}},invokeGridEvent:function(a,b){var c={eventName:a,args:b};this._gridEventCommand&&this._gridEventCommand.execute(this,c)},toString:function(){return"GridElView"}},
{dataSource:{set:function(a){this._dataSource!==a&&(this._dataSource=a,this._grid&&!this._grid._isDestroyCalled&&(this._grid.destroy(),this._grid=null),this._dataSource&&this._createGrid(),this.invokePropChanged("grid"))},get:function(){return this._dataSource}},grid:{get:function(){return this._grid}},gridEventCommand:{set:function(a){a!==this._gridEventCommand&&(this._gridEventCommand&&this.invokeGridEvent("command_disconnected",{}),(this._gridEventCommand=a)&&this.invokeGridEvent("command_connected",
{}))},get:function(){return this._gridEventCommand}}},function(b){f.GridElView=b;a.registerType("GridElView",b);a.registerElView("table",b)})};
RIAPP.Application._coreModules.pager=function(a){var f=this,d=a.global,l=d.utils,h=a.modules.collection,n=a.modules.baseElView.BaseElView,m={pager:"ria-data-pager",info:"pager-info",currentPage:"pager-current-page",otherPage:"pager-other-page"};Object.freeze(m);f.css=m;var g=RIAPP.localizable.PAGER,b=RIAPP.utils.format,c=RIAPP.BaseObject.extend({_app:a,_create:function(a,b,c){this._super();this._el=a;this._$el=d.$(this._el);this._objId="pgr"+this._app.getNewObjectID();if(b&&!h.Collection.isPrototypeOf(b))throw Error(RIAPP.ERRS.ERR_PAGER_DATASRC_INVALID);
this._dataSource=b;this._showTip=!0;this._showInfo=!1;this._showFirstAndLast=!0;this._showPreviousAndNext=!1;this._showNumbers=!0;this._rowPerPage=25;this._rowCount=0;this._currentPage=1;this._useSlider=l.check_is.nt(c.useSlider)?!0:!!c.useSlider;this._sliderSize=c.sliderSize||25;this._hideOnSinglePage=l.check_is.nt(c.hideOnSinglePage)?!0:!!c.hideOnSinglePage;this._$el.addClass(m.pager);this._dataSource&&this._bindDS()},_createElement:function(a){return d.$(d.document.createElement(a))},_render:function(){var a=
this._$el,c,d;this._clearContent();if(0!==this.rowPerPage&&(c=this.rowCount,0!=c&&(c=this.currentPage,0!=c)))if(d=this.pageCount,this.hideOnSinglePage&&1==d)a.hide();else{a.show();if(this.showInfo){var f=this._createElement("span"),h=b(g.pageInfo,c,d);f.addClass(m.info).text(h).appendTo(a)}this.showFirstAndLast&&1!=c&&a.append(this._createFirst());this.showPreviousAndNext&&1!=c&&a.append(this._createPrevious());if(this.showNumbers){var f=1,h=d,l=this.sliderSize;this.useSlider&&0<l&&(f=Math.floor((l-
1)/2),h=c+f+(l-1)%2,f=c-f,1>f&&(h+=1-f,f=1),h>d&&(f-=h-d,1>f&&(f=1),h=d));for(;f<=h;f++)f===c?a.append(this._createCurrent()):a.append(this._createOther(f))}this.showPreviousAndNext&&c!=d&&a.append(this._createNext());this.showFirstAndLast&&c!=d&&a.append(this._createLast())}},_setDSPageIndex:function(a){this.dataSource.pageIndex=a-1},_onPageSizeChanged:function(a){this.rowPerPage=a.pageSize},_onPageIndexChanged:function(a){this.currentPage=a.pageIndex+1},_onTotalCountChanged:function(a){this.rowCount=
a.totalCount},destroy:function(){this._isDestroyed||(this._unbindDS(),this._clearContent(),this._$el.removeClass(m.pager),this._$el=this._el=null,this._super())},_bindDS:function(){var a=this,b=this._dataSource;b&&(b.addOnPropertyChange("pageIndex",function(c,d){b===c&&a._onPageIndexChanged(b)},a._objId),b.addOnPropertyChange("pageSize",function(c,d){b===c&&a._onPageSizeChanged(b)},a._objId),b.addOnPropertyChange("totalCount",function(c,d){b===c&&a._onTotalCountChanged(b)},a._objId),this._currentPage=
b.pageIndex+1,this._rowPerPage=b.pageSize,this._rowCount=b.totalCount,this._render())},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},_clearContent:function(){this._$el.empty()},_createLink:function(a,b,c){var d=this._createElement("a"),f=this;d.text(""+b);d.attr("href","javascript:void(0)");c&&l.addToolTip(d,c);d.click(function(b){b.preventDefault();f._setDSPageIndex(a);f.currentPage=a});return d},_createFirst:function(){var a=this._createElement("span"),b;this.showTip&&
(b=g.firstPageTip);b=this._createLink(1,g.firstText,b);a.addClass(m.otherPage).append(b);return a},_createPrevious:function(){var a=this._createElement("span"),c=this.currentPage-1,d;this.showTip&&(d=b(g.prevPageTip,c));c=this._createLink(c,g.previousText,d);a.addClass(m.otherPage).append(c);return a},_createCurrent:function(){var a=this._createElement("span"),b=this.currentPage;a.text(""+b);this.showTip&&l.addToolTip(a,this._buildTip(b));a.addClass(m.currentPage);return a},_createOther:function(a){var b=
this._createElement("span"),c;this.showTip&&(c=this._buildTip(a));a=this._createLink(a,a,c);b.addClass(m.otherPage);b.append(a);return b},_createNext:function(){var a=this._createElement("span"),c=this.currentPage+1,d;this.showTip&&(d=b(g.nextPageTip,c));c=this._createLink(c,g.nextText,d);a.addClass(m.otherPage).append(c);return a},_createLast:function(){var a=this._createElement("span"),b;this.showTip&&(b=g.lastPageTip);b=this._createLink(this.pageCount,g.lastText,b);a.addClass(m.otherPage).append(b);
return a},_buildTip:function(a){var c=this.rowPerPage,d=this.rowCount,f=(a-1)*c+1,c=a==this.pageCount?d:a*c,h="";return h=a==this.currentPage?b(g.showingTip,f,c,d):b(g.showTip,f,c,d)},toString:function(){return"Pager"}},{el:{get:function(){return this._el}},app:{get:function(){return this._app}},dataSource:{set:function(a){a!==this._dataSource&&(null!==this._dataSource&&this._unbindDS(),this._dataSource=a,null!==this._dataSource&&this._bindDS(),this.raisePropertyChanged("dataSource"))},get:function(){return this._dataSource}},
pageCount:{get:function(){var a=this.rowCount,b=this.rowPerPage;return 0===a||0===b?0:0===a%b?a/b:a=Math.floor(a/b)+1}},rowCount:{set:function(a){this._rowCount!=a&&(this._rowCount=a,this._render(),this.raisePropertyChanged("rowCount"))},get:function(){return this._rowCount}},rowPerPage:{set:function(a){this._rowPerPage!=a&&(this._rowPerPage=a,this._render())},get:function(){return this._rowPerPage}},currentPage:{set:function(a){this._currentPage!=a&&(this._currentPage=a,this._render(),this.raisePropertyChanged("currentPage"))},
get:function(){return this._currentPage}},useSlider:{set:function(a){this._useSlider!=a&&(this._useSlider=a,this._render())},get:function(){return this._useSlider}},sliderSize:{set:function(a){this._sliderSize!=a&&(this._sliderSize=a,this._render())},get:function(){return this._sliderSize}},hideOnSinglePage:{set:function(a){this._hideOnSinglePage!=a&&(this._hideOnSinglePage=a,this._render())},get:function(){return this._hideOnSinglePage}},showTip:{set:function(a){this._showTip!==a&&(this._showTip=
a,this._render())},get:function(){return this._showTip}},showInfo:{set:function(a){this._showInfo!==a&&(this._showInfo=a,this._render())},get:function(){return this._showInfo}},showFirstAndLast:{set:function(a){this._showFirstAndLast!==a&&(this._showFirstAndLast=a,this._render())},get:function(){return this._showFirstAndLast}},showPreviousAndNext:{set:function(a){this._showPreviousAndNext!==a&&(this._showPreviousAndNext=a,this._render())},get:function(){return this._showPreviousAndNext}},showNumbers:{set:function(a){this._showNumbers!==
a&&(this._showNumbers=a,this._render())},get:function(){return this._showNumbers}}},function(a){f.Pager=a});n.extend({_init:function(a){this._super(a);this._pager=this._dataSource=null;this._options=a},destroy:function(){this._pager&&!this._pager._isDestroyCalled&&this._pager.destroy();this._dataSource=this._pager=null;this._super()},toString:function(){return"PagerElView"}},{dataSource:{set:function(a){var b=this;this._dataSource!==a&&(this._dataSource=a,this._pager&&this._pager.destroy(),this._pager=
null,this._dataSource&&this._dataSource.isPagingEnabled&&(this._pager=c.create(this._el,this._dataSource,this._options),this._pager.addOnDestroyed(function(){b._pager=null})),b.invokePropChanged("pager"))},get:function(){return this._dataSource}},pager:{get:function(){return this._pager}}},function(b){f.PagerElView=b;a.registerType("PagerElView",b);a.registerElView("pager",b)})};
RIAPP.Application._coreModules.stackpanel=function(a){var f=this,d=a.global,l=d.utils,h=d.consts,n=a.modules.collection,m=a.modules.template.Template,g=a.modules.baseElView.BaseElView,b={stackpanel:"ria-stackpanel",item:"stackpanel-item",currentItem:"current-item"};Object.freeze(b);f.css=b;var c=RIAPP.BaseObject.extend({_app:a,_create:function(a,c,f){this._super();this._el=a;this._$el=d.$(this._el);this._objId="pnl"+this._app.getNewObjectID();if(c&&!n.Collection.isPrototypeOf(c))throw Error(RIAPP.ERRS.ERR_STACKPNL_DATASRC_INVALID);
this._dataSource=c;this._isDSFilling=!1;this._orientation=f.orientation||"horizontal";this._templateID=f.templateID;this._currentItem=null;this._$el.addClass(b.stackpanel);this._itemMap={};if(!this._templateID)throw Error(RIAPP.ERRS.ERR_STACKPNL_TEMPLATE_INVALID);this._dataSource&&this._bindDS();d._onStackPanelAdded(this)},_getEventNames:function(){var a=this._super();return["item_clicked"].concat(a)},_onKeyDown:function(a,b){var c=this._dataSource,d=h.KEYS;if(c)if("horizontal"==this._orientation)switch(a){case d.left:b.preventDefault();
c.movePrev(!0)&&this.scrollIntoView(c.currentItem);break;case d.right:b.preventDefault(),c.moveNext(!0)&&this.scrollIntoView(c.currentItem)}else switch(a){case d.up:b.preventDefault();c.movePrev(!0)&&this.scrollIntoView(c.currentItem);break;case d.down:b.preventDefault(),c.moveNext(!0)&&this.scrollIntoView(c.currentItem)}},_onKeyUp:function(a,b){},_updateCurrent:function(a,c){var f=this._currentItem;if(f!==a){this._currentItem=a;f&&(f=this._itemMap[f._key])&&d.$(f.div).removeClass(b.currentItem);
if(a&&(f=this._itemMap[a._key]))d.$(f.div).addClass(b.currentItem),c&&f.div.scrollIntoView(!1);this.raisePropertyChanged("currentItem")}},_onDSCurrentChanged:function(a){(a=this._dataSource.currentItem)?this._updateCurrent(a,!0):this._updateCurrent(null,!1)},_onDSCollectionChanged:function(a){var b=this,c=n.consts.COLL_CHANGE_TYPE,d=a.items;switch(a.change_type){case c.RESET:this._isDSFilling||this._refresh();break;case c.ADDED:this._isDSFilling||b._appendItems(d);break;case c.REMOVE:d.forEach(function(a){b._removeItem(a)});
break;case c.REMAP_KEY:if(c=b._itemMap[a.old_key])delete b._itemMap[a.old_key],b._itemMap[a.new_key]=c,c.div.setAttribute(h.DATA_ATTR.DATA_ITEM_KEY,a.new_key);break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,a.change_type));}},_onDSFill:function(a){a.isBegin?this._isDSFilling=!0:(this._isDSFilling=!1,a.resetUI?this._refresh():this._appendItems(a.newItems))},_onItemStatusChanged:function(a,b){var c=h.CHANGE_TYPE.DELETED,f=a._changeType,g=this._itemMap[a._key];
g&&(f===c?d.$(g.div).hide():b===c&&f!==c&&d.$(g.div).show())},_createTemplate:function(a){var b=m.create(this._templateID);b.dataContext=a;return b},_appendItems:function(a){if(!this._isDestroyCalled){var b=this;a.forEach(function(a){b._itemMap[a._key]||b._appendItem(a)})}},_appendItem:function(a){if(a._key){var c=this,d=c._createElement("div"),f=d.get(0),g=c._createTemplate(a);d.addClass(b.item);d.append(g.el);"horizontal"==this._orientation&&d.css("display","inline-block");c._$el.append(d);d.attr(h.DATA_ATTR.DATA_ITEM_KEY,
a._key);d.click(function(a){a=this.getAttribute(h.DATA_ATTR.DATA_ITEM_KEY);(a=c._itemMap[a])&&c._onItemClicked(a.div,a.item)});c._itemMap[a._key]={div:f,template:g,item:a}}},_bindDS:function(){var a=this,b=this._dataSource;b&&(b.addHandler("coll_changed",function(c,d){b===c&&a._onDSCollectionChanged(d)},a._objId),b.addHandler("fill",function(c,d){b===c&&a._onDSFill(d)},a._objId),b.addOnPropertyChange("currentItem",function(c,d){b===c&&a._onDSCurrentChanged(d)},a._objId),-1<b.getEventNames().indexOf("status_changed")&&
b.addHandler("status_changed",function(c,d){b===c&&a._onItemStatusChanged(d.item,d.oldChangeType)},a._objId),this._refresh())},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},_createElement:function(a){return d.$(d.document.createElement(a))},_onItemClicked:function(a,b){this._updateCurrent(b,!1);this._dataSource.currentItem=b;this.raiseEvent("item_clicked",{item:b})},destroy:function(){this._isDestroyed||(d._onStackPanelRemoved(this),this._unbindDS(),this._clearContent(),
this._$el.removeClass(b.stackpanel),this._currentItem=this._$el=this._el=null,this._itemMap={},this._super())},_clearContent:function(){var a=this;a._$el.empty();l.forEachProp(a._itemMap,function(b){a._removeItemByKey(b)})},_removeItemByKey:function(a){var b=this._itemMap[a];b&&(delete this._itemMap[a],b.template.destroy())},_removeItem:function(a){a=a._key;var b=this._itemMap[a];b&&(delete this._itemMap[a],b.template.destroy(),d.$(b.div).remove())},_refresh:function(){var a=this._dataSource,b=this;
this._clearContent();a&&a.forEach(function(a){b._appendItem(a)})},scrollIntoView:function(a){a&&(a=this._itemMap[a._key])&&a.div.scrollIntoView(!1)},getDivElementByItem:function(a){a=this._itemMap[a._key];return!a?null:a.div},toString:function(){return"StackPanel"}},{el:{get:function(){return this._el}},app:{get:function(){return this._app}},dataSource:{set:function(a){a!==this._dataSource&&(null!==this._dataSource&&this._unbindDS(),this._dataSource=a,null!==this._dataSource&&this._bindDS(),this.raisePropertyChanged("dataSource"))},
get:function(){return this._dataSource}},currentItem:{get:function(){return this._currentItem}}},function(a){f.StackPanel=a});g.extend({_init:function(a){this._super(a);this._panel=this._dataSource=null;this._options=a},destroy:function(){this._panel&&!this._panel._isDestroyCalled&&this._panel.destroy();this._dataSource=this._panel=null;this._super()},toString:function(){return"StackPanelElView"}},{dataSource:{set:function(a){var b=this;this._dataSource!==a&&(this._dataSource=a,this._panel&&this._panel.destroy(),
this._panel=null,this._dataSource&&(this._panel=c.create(this._el,this._dataSource,this._options),this._panel.addOnDestroyed(function(){b._panel=null})),b.invokePropChanged("panel"))},get:function(){return this._dataSource}},panel:{get:function(){return this._panel}}},function(b){f.StackPanelElView=b;a.registerType("StackPanelElView",b);a.registerElView("stackpanel",b)})};
RIAPP.Application._coreModules.listbox=function(a){var f=this,d=a.global,l=d.utils,h=d.consts,n=a.modules.collection,m=a.modules.baseElView.EditableElView,g=RIAPP.BaseObject.extend({_app:a,_create:function(a,c,e){var f=this;this._super();this._el=a;this._$el=d.$(this._el);this._objId="lst"+this._app.getNewObjectID();if(c&&!n.Collection.isPrototypeOf(c))throw Error(RIAPP.ERRS.ERR_LISTBOX_DATASRC_INVALID);this._$el.on("change."+this._objId,function(a){a.stopPropagation();f._isRefreshing||f._onChanged()});
this._dataSource=null;this._css=e.css;this._isRefreshing=this._isDSFilling=!1;this._valuePath=e.valuePath;this._textPath=e.textPath;this._saveSelected=this._selectedItem=null;this._keyMap={};this._valMap={};this._saveVal=void 0;this._css&&this._$el.addClass(this._css);this.dataSource=c},destroy:function(){this._isDestroyed||(this._unbindDS(),this._$el.off("."+this._objId),this._css&&this._$el.removeClass(this._css),this._clear(!0),this._$el=this._el=null,this._super())},_onChanged:function(){var a=
null,c;0<=this._el.selectedIndex&&(a=this._el.options[this._el.selectedIndex],a=a.value,c=this._keyMap[a]);!c&&this._selectedItem?this.selectedItem=null:c.item!==this._selectedItem&&(this.selectedItem=c.item)},_getValue:function(a){a=this._getRealValue(a);return l.check_is.nt(a)?"":a},_getRealValue:function(a){if(!a)return null;if(this._valuePath)return this._app.parser.resolvePath(a,this._valuePath)},_getText:function(a){return!a?"":this._textPath?(a=this._app.parser.resolvePath(a,this._textPath),
l.check_is.nt(a)?"":""+a):""+this._getValue(a)},_onDSCollectionChanged:function(a){var c=this,e=n.consts.COLL_CHANGE_TYPE;switch(a.change_type){case e.RESET:this._isDSFilling||this._refresh();break;case e.ADDED:this._isDSFilling||a.items.forEach(function(a){c._addOption(a,a._isNew)});break;case e.REMOVE:a.items.forEach(function(a){c._removeOption(a)});break;case e.REMAP_KEY:if(e=c._keyMap[a.old_key])delete c._keyMap[a.old_key],c._keyMap[a.new_key]=e,e.op.value=a.new_key}},_onDSFill:function(a){a.isBegin?
this._isDSFilling=!0:(this._isDSFilling=!1,this._refresh())},_onEdit:function(a,c,e){c?this._saveVal=this._getValue(a):(c=this._saveVal,this._saveVal=void 0,e||(e=a._key,(e=this._keyMap[e])?(e.op.text=this._getText(a),a=this._getValue(a),c!==a&&(""!==c&&delete this._valMap[c],""!==a&&(this._valMap[a]=e))):""!==c&&delete this._valMap[c]))},_onStatusChanged:function(a,c){a._changeType===h.CHANGE_TYPE.DELETED&&this._removeOption(a)},_onCommitChanges:function(a,c,e,d){var f=h.CHANGE_TYPE;if(c){if(!(e&&
d===f.ADDED)&&(e||d!==f.DELETED))this._saveVal=this._getValue(a)}else c=this._saveVal,this._saveVal=void 0,e&&d===f.DELETED?this._addOption(a,!0):(e=this._getValue(a),d=this._keyMap[a._key],c!==e&&(""!==c&&delete this._valMap[c],d&&""!==e&&(this._valMap[e]=d)),d&&(d.op.text=this._getText(a)))},_bindDS:function(){var a=this,c=this._dataSource;c&&(c.addHandler("coll_changed",function(e,d){c===e&&a._onDSCollectionChanged(d)},a._objId),c.addHandler("fill",function(e,d){c===e&&a._onDSFill(d)},a._objId),
c.addHandler("begin_edit",function(e,d){c===e&&a._onEdit(d.item,!0,void 0)},a._objId),c.addHandler("end_edit",function(e,d){c===e&&a._onEdit(d.item,!1,d.isCanceled)},a._objId),c.addHandler("status_changed",function(e,d){c===e&&a._onStatusChanged(d.item,d.oldChangeType)},a._objId),c.addHandler("commit_changes",function(e,d){c===e&&a._onCommitChanges(d.item,d.isBegin,d.isRejected,d.changeType)},a._objId))},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},_addOption:function(a,
c){if(this._isDestroyCalled)return null;var e,f="",g,h;a&&(f=a._key);if(this._keyMap[f])return null;h=this._getText(a);g=this._getValue(a);e=d.document.createElement("option");e.text=h;e.value=f;h={item:a,op:e};this._keyMap[f]=h;""!==g&&(this._valMap[g]=h);c?2>this._el.options.length?this._el.add(e,null):this._el.add(e,this._el.options[1]):this._el.add(e,null);return e},_removeOption:function(a){if(!this._isDestroyCalled){var c="",e;if(a&&(c=a._key,e=this._keyMap[c]))this._el.remove(e.op.index),e=
this._getValue(a),delete this._keyMap[c],""!==e&&delete this._valMap[e],this._saveSelected===a&&(this._saveSelected=null),this.selectedItem===a&&(this.selectedItem=this._saveSelected)}},_clear:function(a){this._el.options.length=0;this._keyMap={};this._valMap={};this._saveSelected=null;a?this._selectedItem=null:(this._addOption(null,!1),this.selectedItem=null)},clear:function(){this._clear(!1)},_refresh:function(){var a=this,c=this._dataSource,e=this._selectedItem;this._isRefreshing=!0;try{this.clear(),
c&&c.forEach(function(c){a._addOption(c,!1)}),this._el.selectedIndex=this._findItemIndex(e)}finally{this._isRefreshing=!1}this._onChanged()},_findItemIndex:function(a){if(!a)return 0;a=this._keyMap[a._key];return!a?0:a.op.index},findItemByValue:function(a){a=this._valMap[a];return!a?null:a.item},getTextByValue:function(a){return(a=this._valMap[a])?a.op.text:""},_setIsEnabled:function(a,c){a.disabled=!c},_getIsEnabled:function(a){return!a.disabled},toString:function(){return"ListBox"}},{dataSource:{set:function(a){this._dataSource!==
a&&(this._dataSource&&this._unbindDS(),this.clear(),(this._dataSource=a)&&this._bindDS(),this._refresh(),this.raisePropertyChanged("dataSource"))},get:function(){return this._dataSource}},selectedValue:{set:function(a){this.selectedValue!==a&&(this.selectedItem=this.findItemByValue(a))},get:function(){return this._getRealValue(this.selectedItem)}},selectedItem:{set:function(a){this._selectedItem!==a&&(this._selectedItem&&(this._saveSelected=this._selectedItem),this._selectedItem=a,this._el.selectedIndex=
this._findItemIndex(this._selectedItem),this.raisePropertyChanged("selectedItem"),this.raisePropertyChanged("selectedValue"))},get:function(){return this._selectedItem}},valuePath:{set:function(a){a!==this._valuePath&&(this._valuePath=a,this.raisePropertyChanged("valuePath"))},get:function(){return this._valuePath}},textPath:{set:function(a){a!==this._textPath&&(this._textPath=a,this._refresh(),this.raisePropertyChanged("textPath"))},get:function(){return this._textPath}},isEnabled:{set:function(a){a!==
this.isEnabled&&(this._setIsEnabled(this.$el,a),this.raisePropertyChanged("isEnabled"))},get:function(){return this._getIsEnabled(this.$el)}},el:{get:function(){return this._el}}},function(a){f.ListBox=a});m.extend({_init:function(a){this._super(a);this._listBox=this._dataSource=null;this._options=a},destroy:function(){this._listBox&&!this._listBox._isDestroyCalled&&this._listBox.destroy();this._dataSource=this._listBox=null;this._super()},toString:function(){return"SelectElView"}},{dataSource:{set:function(a){var c=
this;this._dataSource!==a&&(this._dataSource=a,this._listBox&&this._listBox.destroy(),this._listBox=null,this._dataSource&&(this._listBox=g.create(this._el,this._dataSource,this._options),this._listBox.addOnDestroyed(function(){c._listBox=null},this.uniqueID),this._listBox.addOnPropertyChange("*",function(a,b){c.raisePropertyChanged(b.property)},this.uniqueID)),c.invokePropChanged("listBox"))},get:function(){return this._dataSource}},selectedValue:{set:function(a){this._listBox&&this._listBox.selectedValue!==
a&&(this._listBox.selectedValue=a)},get:function(){return!this._listBox?null:this._listBox.selectedValue}},selectedItem:{set:function(a){this._listBox&&(this._listBox.selectedItem=a)},get:function(){return!this._listBox?null:this._listBox.selectedItem}},listBox:{get:function(){return this._listBox}}},function(b){f.SelectElView=b;a.registerType("SelectElView",b);a.registerElView("select",b)})};
RIAPP.Application._coreModules.dataform=function(a){var f=this,d=a.global,l=d.utils,h=d.consts,n=a.modules.binding.Binding,m=a.modules.baseElView.BaseElView,g={dataform:"ria-dataform"},b=RIAPP.localizable.VALIDATE;Object.freeze(g);f.css=g;var c=RIAPP.BaseObject.extend({_DATA_CONTENT_SELECTOR:"*["+h.DATA_ATTR.DATA_CONTENT+"]:not(["+h.DATA_ATTR.DATA_COLUMN+"])",_app:a,_create:function(b,c){var f=this,h;this._super();this._el=b;this._$el=d.$(this._el);this._objId="frm"+this._app.getNewObjectID();this._css=
c.css;this._dataContext=null;this._$el.addClass(g.dataform);this._css&&this._$el.addClass(this._css);this._isDisabled=this._isEditing=!1;this._content=[];this._lfTime=null;this._supportEdit=this._contentCreated=!1;this._errors=this._parentDataForm=this._collection=null;if(h=this._getParentDataForm(this._el))f._parentDataForm=a.getElementView(h),f._parentDataForm.addOnDestroyed(function(a,b){f.destroy()},f._objId)},_getBindings:function(){if(!this._lfTime)return[];for(var a=this._lfTime.getObjs(),
b=[],c=0,d=a.length;c<d;c+=1)n.isPrototypeOf(a[c])&&b.push(a[c]);return b},_getElViews:function(){if(!this._lfTime)return[];for(var a=this._lfTime.getObjs(),b=[],c=0,d=a.length;c<d;c+=1)m.isPrototypeOf(a[c])&&b.push(a[c]);return b},_updateIsDisabled:function(){var a,b,c,d=this._getBindings(),f=this._getElViews(),g=this._app._getElViewType(h.ELVIEW_NM.DATAFORM);a=0;for(b=d.length;a<b;a+=1)c=d[a],c.isDisabled=this._isDisabled;a=0;for(b=f.length;a<b;a+=1)c=f[a],g.isPrototypeOf(c)&&c.form&&(c.form.isDisabled=
this._isDisabled)},_updateContent:function(){var a=this._dataContext,b,c=this;if(this._contentCreated)this._content.forEach(function(b){b.dataContext=a;b.isEditing=this.isEditing},this),b=this._getBindings(),b.forEach(function(b){b.isSourceFixed||(b.source=a)});else if(a){b=Array.fromList(this._el.querySelectorAll(c._DATA_CONTENT_SELECTOR));var d=this.isEditing;b.forEach(function(b){if(c._getParentDataForm(b)===c._el){var f=b.getAttribute(h.DATA_ATTR.DATA_CONTENT),f=c._app._parseContentAttr(f);if(f.fieldName&&
!f.fieldInfo){if(!a.getFieldInfo)throw Error(RIAPP.ERRS.ERR_DCTX_HAS_NO_FIELDINFO);f.fieldInfo=a.getFieldInfo(f.fieldName);if(!f.fieldInfo)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,"",f.fieldName));}var g=c._app._getContentType(f);(b=c._app._getContent(g,f,b,a,d))&&c._content.push(b)}});this._lfTime=this._app._bindElements(this._el,a,!0);this._contentCreated=!0}},_getParentDataForm:function(a){if(!a)return null;a=a.parentElement;var b=d.document;if(a){if(a===this._el)return this._el;
if(a===b)return null;b=a.getAttribute(h.DATA_ATTR.DATA_VIEW);if(!b)return this._getParentDataForm(a);b=this._app.parser.parseOptions(b);return 0<b.length&&b[0].name==h.ELVIEW_NM.DATAFORM?a:this._getParentDataForm(a)}return null},_onDSErrorsChanged:function(a){this.validationErrors=a?a.getAllErrors():null},_bindDS:function(){var a=this._dataContext,b=this;a&&(a.addOnDestroyed(function(a,c){b.dataContext=null},this._objId),this._supportEdit&&a.addOnPropertyChange("isEditing",function(a,c){b.isEditing=
a.isEditing},this._objId),this._collection&&this._collection.addHandler("errors_changed",function(c,d){d.item===a&&b._onDSErrorsChanged(d.item)},b._objId))},_unbindDS:function(){var a=this._dataContext,b=this._collection;this.validationErrors=null;a&&!a._isDestroyCalled&&a.removeNSHandlers(this._objId);b&&!b._isDestroyCalled&&b.removeNSHandlers(this._objId)},_clearContent:function(){this._content.forEach(function(a){a.destroy()});this._content=[];this._lfTime&&(this._lfTime.destroy(),this._lfTime=
null);this._contentCreated=!1},_onError:function(a,b){var c=this._super(a,b);return!c?this._app._onError(a,b):c},destroy:function(){if(!this._isDestroyed){this._clearContent();this._css&&this._$el.removeClass(this._css);this._$el.removeClass(g.dataform);this._$el=this._el=null;this._unbindDS();var a=this._parentDataForm;this._parentDataForm=null;a&&!a._isDestroyCalled&&a.removeNSHandlers(this._objId);this._dataContext=null;this._contentCreated=!1;this._super()}},toString:function(){return"DataForm"}},
{el:{get:function(){return this._el}},app:{get:function(){return this._app}},dataContext:{set:function(a){var b;try{if(a!==this._dataContext){if(a&&!RIAPP.BaseObject.isPrototypeOf(a))throw Error(RIAPP.ERRS.ERR_DATAFRM_DCTX_INVALID);this._unbindDS();this._supportEdit=!1;this._collection=null;if(b=this._dataContext=a)this._supportEdit=l.hasProp(b,"isEditing")&&!!b.beginEdit,b._collection&&(this._collection=b._collection);this._bindDS();this._updateContent();this.raisePropertyChanged("dataContext");
b&&(this._supportEdit&&this._isEditing!==b.isEditing&&(this.isEditing=b.isEditing),this._collection&&b.getAllErrors&&this._onDSErrorsChanged(b))}}catch(c){d.reThrow(c,this._onError(c,this))}},get:function(){return this._dataContext}},isEditing:{set:function(a){var b=this._dataContext,c=this._isEditing;if(b)if(!this._supportEdit&&a!==c)this._isEditing=a,this._updateContent(),this.raisePropertyChanged("isEditing");else{if(a!==c)try{a?b.beginEdit():b.endEdit()}catch(f){d.reThrow(f,this._onError(f,b))}b.isEditing!==
c&&(this._isEditing=b.isEditing,this._updateContent(),this.raisePropertyChanged("isEditing"))}},get:function(){return this._isEditing}},validationErrors:{set:function(a){a!==this._errors&&(this._errors=a,this.raisePropertyChanged("validationErrors"))},get:function(){return this._errors}},isDisabled:{set:function(a){this._isDisabled!==a&&(this._isDisabled=!!a,this._updateIsDisabled(),this.raisePropertyChanged("isDisabled"))},get:function(){return this._isDisabled}}},function(a){f.DataForm=a});m.extend({_init:function(a){this._super(a);
this._form=this._dataContext=null;this._options=a},_getErrorTipInfo:function(a){var c=["<b>",b.errorInfo,"</b>","<ul>"];a.forEach(function(a){var e=a.fieldName,d="";e&&(d=b.errorField+" "+e);a.errors.forEach(function(a){d=d?d+" -> "+a:a});c.push("<li>"+d+"</li>");d=""});c.push("</ul>");return c.join("")},_updateErrorUI:function(a,b){if(a){var c=this.$el;if(b&&0<b.length){var f,h=d.getImagePath("warning.png");f=d.$('<img name="error_info" alt="error_info" class="error-info" />');c.prepend(f);f.get(0).src=
h;l.addToolTip(f,this._getErrorTipInfo(b),g.errorTip);this._setFieldError(!0)}else c.children('img[name="error_info"]').remove(),this._setFieldError(!1)}},destroy:function(){this._form&&!this._form._isDestroyCalled&&this._form.destroy();this._dataContext=this._form=null;this._super()},toString:function(){return"DataFormElView"}},{dataContext:{set:function(a){var b=this;this._dataContext!==a&&(this._dataContext=a,this._form||(this._form=c.create(this._el,this._options)),this._form.dataContext=this._dataContext,
this._form.addOnDestroyed(function(){b._form=null}),this.form.addOnPropertyChange("validationErrors",function(a,c){b.validationErrors=a.validationErrors},this._objId),b.invokePropChanged("form"))},get:function(){return this._dataContext}},form:{get:function(){return this._form}}},function(b){f.DataFormElView=b;a.registerType("DataFormElView",b);a.registerElView(d.consts.ELVIEW_NM.DATAFORM,b)})};
RIAPP.Application._coreModules.elview=function(a){var f=this,d=a.global,l=d.utils,h=a.modules.baseElView,n=h.BaseElView,m=h.EditableElView,g=h.CommandElView,b=h.css;f.BaseElView=n;f.EditableElView=m;f.CommandElView=g;n.extend({_init:function(a){this._super(a);this._someProp=null}},{someProp:{set:function(a){if(a!==this._someProp){debugger;this._someProp=a;this.raisePropertyChanged("someProp");this.$el.html(""+this._someProp)}},get:function(){return this._someProp}}},function(b){f.DebuggerElView=b;
a.registerType("DebuggerElView",b);a.registerElView("debugger",b)});h=m.extend({_init:function(a){var b=this;this._super(a);var d=this.$el;d.on("change."+this._objId,function(a){a.stopPropagation();b.raisePropertyChanged("value")});d.on("keypress."+this._objId,function(a){a.stopPropagation();var c={keyCode:a.which,value:a.target.value,isCancel:!1};b.raiseEvent("keypress",c);c.isCancel&&a.preventDefault()});if(a.updateOnKeyUp)d.on("keyup."+this._objId,function(a){a.stopPropagation();b.raisePropertyChanged("value")})},
_getEventNames:function(){var a=this._super();return["keypress"].concat(a)},toString:function(){return"TextBoxElView"}},{value:{set:function(a){if(this._el){var b=this._el,d=b.value;a=null===a?"":""+a;d!==a&&(b.value=a,this.raisePropertyChanged("value"))}},get:function(){var a=this._el;return!a?"":a.value}}},function(b){f.TextBoxElView=b;a.registerType("TextBoxElView",b);a.registerElView("input:text",b)});n.extend({toString:function(){return"HiddenElView"}},{value:{set:function(a){if(this._el){var b=
this._el,d=b.value;a=null===a?"":""+a;d!==a&&(b.value=a,this.raisePropertyChanged("value"))}},get:function(){var a=this._el;return!a?"":a.value}}},function(b){f.HiddenElView=b;a.registerType("HiddenElView",b);a.registerElView("input:hidden",b)});h.extend({_init:function(a){this._super(a);a.rows&&(this.rows=a.rows);a.cols&&(this.cols=a.cols);a.wrap&&(this.wrap=a.wrap)},toString:function(){return"TextAreaElView"}},{rows:{set:function(a){var b=this._el;if(b){var d=b.rows;a=!a?1:a;d!==a&&(b.rows=a,this.raisePropertyChanged("rows"))}},
get:function(){var a=this._el;return!a?1:a.rows}},cols:{set:function(a){var b=this._el;if(b){var d=b.cols;a=!a?1:a;d!==a&&(b.cols=a,this.raisePropertyChanged("cols"))}},get:function(){var a=this._el;return!a?1:a.cols}},wrap:{set:function(a){var b=this._el;if(b){var d=b.wrap;a=!a?"off":a;0>["hard","off","soft"].indexOf(a)&&(a="off");d!==a&&(b.wrap=a,this.raisePropertyChanged("wrap"))}},get:function(){var a=this._el;return!a?"off":a.wrap}}},function(b){f.TextAreaElView=b;a.registerType("TextAreaElView",
b);a.registerElView("textarea",b)});m.extend({_init:function(a){var b=this;this._super(a);this._val=this.el.checked;this.$el.on("change."+this._objId,function(a){a.stopPropagation();b.checked=this.checked})},_setFieldError:function(a){var e=this.$el;a?(a=d.$("<div></div>").addClass(b.fieldError),e.wrap(a)):0<e.parent("."+b.fieldError).length&&e.unwrap()},destroy:function(){this.$el.off("."+this._objId);this._super()},toString:function(){return"CheckBoxElView"}},{checked:{set:function(a){var b=this._el;
null!==a&&(a=!!a);a!==this._val&&(this._val=a,b&&(b.checked=!!this._val),null===this._val?this.$el.css("opacity",0.33):this.$el.css("opacity",1),this.raisePropertyChanged("checked"))},get:function(){return this._val}}},function(b){f.CheckBoxElView=b;a.registerType("CheckBoxElView",b);a.registerElView("input:checkbox",b)});m.extend({_init:function(a){var b=this;this._super(a);this._val=this.el.checked;this.$el.on("change."+this._objId,function(a){a.stopPropagation();b.checked=this.checked;b._updateGroup()})},
_updateGroup:function(){var a=this.el.getAttribute("name");if(a){var b=this.el.parentElement;if(b){var f=this,g=f.el;d.$('input[type="radio"][name="'+a+'"]',b).each(function(a,b){if(g!==this){var c=f.app._getElView(this);c&&(c.checked=this.checked)}})}}},_setFieldError:function(a){var e=this.$el;a?(a=d.$("<div></div>").addClass(b.fieldError),e.wrap(a)):0<e.parent("."+b.fieldError).length&&e.unwrap()},toString:function(){return"RadioElView"}},{checked:{set:function(a){var b=this._el;null!==a&&(a=!!a);
a!==this._val&&(this._val=a,b&&(b.checked=!!this._val),null===this._val?this.$el.css("opacity",0.33):this.$el.css("opacity",1),this.raisePropertyChanged("checked"))},get:function(){return this._val}},value:{set:function(a){var b=this._el;if(b){var d=""+a;null===a&&(d="");d!==b.value&&(b.value=d,this.raisePropertyChanged("value"))}},get:function(){return this._el.value}},name:{get:function(){return this._el.name}}},function(b){f.RadioElView=b;a.registerType("RadioElView",b);a.registerElView("input:radio",
b)});g.extend({_init:function(a){this._super(a);this._template=null;this._isEnabled=!0},templateLoaded:function(a){var b=this._commandParam;this._template=a;this._template.isDisabled=!this._isEnabled;this._commandParam={template:a,isLoaded:!0};this.invokeCommand();this._commandParam=b;this.raisePropertyChanged("template")},templateUnloading:function(a){var b=this._commandParam;try{this._commandParam={template:a,isLoaded:!1},this.invokeCommand()}finally{this._commandParam=b,this._template=null}this.raisePropertyChanged("template")},
toString:function(){return"TemplateElView"}},{isEnabled:{set:function(a){this._isEnabled!==a&&(this._isEnabled=a,this._template&&(this._template.isDisabled=!this._isEnabled),this.raisePropertyChanged("isEnabled"))},get:function(){return this._isEnabled}},template:{get:function(){return this._template}}},function(b){f.TemplateElView=b;a.registerType("TemplateElView",b);a.registerElView("template",b)});g.extend({_init:function(a){this._super(a);var b=this;this.$el.on("click."+this._objId,function(a){b._onClick(a)})},
_onClick:function(a){this.invokeCommand()},toString:function(){return"ButtonElView"}},{value:{set:function(a){if(this._el){var b=this.$el.val();a=null===a?"":""+a;b!==a&&(this.$el.val(a),this.raisePropertyChanged("value"))}},get:function(){return!this._el?"":this.$el.val()}},text:{set:function(a){if(this._el){var b=this.$el.text();a=null===a?"":""+a;b!==a&&(this.$el.text(a),this.raisePropertyChanged("text"))}},get:function(){return!this._el?"":this.$el.text()}},html:{set:function(a){if(this._el){var b=
this.$el.html();a=null===a?"":""+a;b!==a&&(this.$el.html(a),this.raisePropertyChanged("html"))}},get:function(){return!this._el?"":this.$el.html()}}},function(b){f.ButtonElView=b;a.registerType("ButtonElView",b);a.registerElView("input:button",b);a.registerElView("input:submit",b);a.registerElView("button",b)});g.extend({_init:function(a){this._super(a);var d=this,f=this.$el;this._image=this._imageSrc=null;a.imageSrc&&(this.imageSrc=a.imageSrc);f.addClass(b.commandLink);f.on("click."+this._objId,
function(a){d._onClick(a)})},_onClick:function(a){a.preventDefault();this.invokeCommand()},_updateImage:function(a){var b=this.$el,f=this;this._imageSrc!==a&&(this._imageSrc=a,this._image&&!a&&(d.$(this._image).remove(),this._image=null),a&&(this._image?this._image.src=a:(f.html=null,a=d.$(new Image).attr("src",a).mouseenter(function(a){f._isEnabled&&d.$(this).css("opacity",0.5)}).mouseout(function(a){f._isEnabled&&d.$(this).css("opacity",1)}).appendTo(b),this._image=a.get(0))))},destroy:function(){this._isDestroyed||
(this.$el.removeClass(b.commandLink),this.imageSrc=null,this._super())},toString:function(){return"AncorButtonElView"}},{imageSrc:{set:function(a){this._$el&&this._imageSrc!==a&&(this._updateImage(a),this.raisePropertyChanged("imageSrc"))},get:function(){return this._imageSrc}},html:{set:function(a){if(this._el){var b=this.$el.html();a=null===a?"":""+a;b!==a&&(this.$el.html(a),this.raisePropertyChanged("html"))}},get:function(){return!this._el?"":this.$el.html()}},text:{set:function(a){if(this._el){var b=
this.$el.text();a=null===a?"":""+a;b!==a&&(this.$el.text(a),this.raisePropertyChanged("text"))}},get:function(){return!this._el?"":this.$el.text()}},href:{set:function(a){if(this._el){var b=this.href;a=null===a?"":""+a;b!==a&&(this.$el.prop("href",a),this.raisePropertyChanged("href"))}},get:function(){return!this._el?"":this.$el.prop("href")}}},function(b){f.AncorButtonElView=b;a.registerType("AncorButtonElView",b);a.registerElView("a",b);a.registerElView("abutton",b)}).extend({_init:function(a){this._expandedsrc=
a.expandedsrc||d.getImagePath("collapse.jpg");this._collapsedsrc=a.collapsedsrc||d.getImagePath("expand.jpg");this._isExpanded=!!a.isExpanded;a.imageSrc=this._isExpanded?this._expandedsrc:this._collapsedsrc;this._super(a)},destroy:function(){this._isDestroyed||(this._collapsedsrc=this._expandedsrc=null,this._isExpanded=!1,this._super())},_onCommandChanged:function(){this._super();this.invokeCommand()},_onClick:function(a){this._isExpanded=!this._isExpanded;this._super(a)},invokeCommand:function(){this.imageSrc=
this._isExpanded?this._expandedsrc:this._collapsedsrc;this._super()},toString:function(){return"ExpanderElView"}},{isExpanded:{set:function(a){this._isExpanded!==a&&(this._isExpanded=a,this.invokeCommand(),this.raisePropertyChanged("isExpanded"))},get:function(){return this._isExpanded}}},function(b){f.ExpanderElView=b;a.registerType("ExpanderElView",b);a.registerElView("expander",b)});n.extend({toString:function(){return"SpanElView"}},{value:{set:function(a){this.text=a},get:function(){return this.text}},
text:{set:function(a){var b=this.$el,d=b.text();a=null===a?"":""+a;d!==a&&(b.text(a),this.raisePropertyChanged("text"),this.raisePropertyChanged("value"))},get:function(){return this.$el.text()}},html:{set:function(a){var b=this.el.innerHTML;a=null===a?"":""+a;b!==a&&(this.el.innerHTML=a,this.raisePropertyChanged("html"))},get:function(){return this.el.innerHTML}},color:{set:function(a){var b=this.$el,d=b.css("color");a!==d&&(b.css("color",a),this.raisePropertyChanged("color"))},get:function(){return this.$el.css("color")}},
fontSize:{set:function(a){var b=this.$el,d=b.css("font-size");a!==d&&(b.css("font-size",a),this.raisePropertyChanged("fontSize"))},get:function(){return this.$el.css("font-size")}}},function(b){f.SpanElView=b;a.registerType("SpanElView",b);a.registerElView("span",b)}).extend({toString:function(){return"DivElView"}},{borderColor:{set:function(a){var b=this.$el.css("border-top-color");a!==b&&(this.el.style.borderColor=a,this.raisePropertyChanged("borderColor"))},get:function(){return this.$el.css("border-top-color")}},
borderStyle:{set:function(a){var b=this.$el,d=b.css("border-top-style");a!==d&&(b.css("border-style",a),this.raisePropertyChanged("borderStyle"))},get:function(){return this.$el.css("border-top-style")}},width:{set:function(a){var b=this.$el,d=b.width();a!==d&&(b.width(a),this.raisePropertyChanged("width"))},get:function(){return this.$el.width()}},height:{set:function(a){var b=this.$el,d=b.height();a!==d&&(b.height(a),this.raisePropertyChanged("height"))},get:function(){return this.$el.height()}}},
function(b){f.DivElView=b;a.registerType("DivElView",b);a.registerElView("div",b)});n.extend({_init:function(a){this._super(a)},toString:function(){return"ImgElView"}},{src:{set:function(a){this.$el.prop("src")!==a&&(this.$el.prop("src",a),this.raisePropertyChanged("src"))},get:function(){return this.$el.prop("src")}}},function(b){f.ImgElView=b;a.registerType("ImgElView",b);a.registerElView("img",b)});n.extend({_init:function(a){this._super(a);this._loaderPath=d.getImagePath("loader.gif");this._$loader=
d.$(new Image);this._$loader.css({position:"absolute",display:"none",zIndex:"10000"});this._$loader.attr("src",this._loaderPath);this._$loader.appendTo(this.el);this._isBusy=!1},destroy:function(){this._$loader&&(this._$loader.remove(),this._$loader=null,this._super())},toString:function(){return"BusyElView"}},{isBusy:{set:function(a){a!==this._isBusy&&((this._isBusy=a)?(this._$loader.show(),this._$loader.position({of:d.$(this.el)})):this._$loader.hide())},get:function(){return this._isBusy}}},function(b){f.BusyElView=
b;a.registerType("BusyElView",b);a.registerElView("busy_indicator",b)});n.extend({_init:function(a){this._super(a);this._tabsEventCommand=null;this._tabOpts=a},_createTabs:function(){var a=this.$el,b=this,d={select:function(a,c){b.invokeTabsEvent("select",c)},show:function(a,c){b.invokeTabsEvent("show",c)},disable:function(a,c){b.invokeTabsEvent("disable",c)},enable:function(a,c){b.invokeTabsEvent("enable",c)},add:function(a,c){b.invokeTabsEvent("add",c)},remove:function(a,c){b.invokeTabsEvent("remove",
c)},load:function(a,c){b.invokeTabsEvent("load",c)}},d=l.extend(!1,d,b._tabOpts);a.tabs(d)},_destroyTabs:function(){l.destroyJQueryPlugin(this.$el,"tabs")},invokeTabsEvent:function(a,b){var d={eventName:a,args:b};this._tabsEventCommand&&this._tabsEventCommand.execute(this,d)},destroy:function(){this._isDestroyed||(this._tabsEventCommand=null,this._destroyTabs(),this._super())},toString:function(){return"TabsElView"}},{tabsEventCommand:{set:function(a){var b=this._tabsEventCommand;a!==b&&(b&&this._destroyTabs(),
(this._tabsEventCommand=a)&&this._createTabs())},get:function(){return this._tabsEventCommand}}},function(b){f.TabsElView=b;a.registerType("TabsElView",b);a.registerElView("tabs",b)});n.extend({_init:function(a){this._super(a);this._template=this._dataContext=null},_templateChanged:function(){this.raisePropertyChanged("templateID");this._template&&this.$el.empty().append(this._template.el)},updateTemplate:function(a){var b=this;try{if(!a&&this._template){this._template.destroy();this._template=null;
b._templateChanged();return}}catch(f){this._onError(f,this),d._throwDummy(f)}try{this._template?this._template.templateID=a:(this._template=this._app.getType("Template").create(a),this._template.dataContext=this._dataContext,this._template.addOnPropertyChange("templateID",function(a,c){b._templateChanged()},this._objId),b._templateChanged())}catch(g){this._onError(g,this),d._throwDummy(g)}},destroy:function(){this._template&&(this._template.destroy(),this._template=null);this._dataContext=null;this._super()}},
{templateID:{set:function(a){this.updateTemplate(a)},get:function(){return!this._template?null:this._template.templateID}},template:{get:function(){return this._template}},dataContext:{set:function(a){this._dataContext!==a&&(this._dataContext=a,this._template&&(this._template.dataContext=this._dataContext))},get:function(){return this._dataContext}}},function(b){f.DynaContentElView=b;a.registerType("DynaContentElView",b);a.registerElView(d.consts.ELVIEW_NM.DYNACONT,b)})};
RIAPP.Application._coreModules.content=function(a){var f=this,d=a.global,l=d.utils,h=a.modules.binding.Binding,n=a.modules.elview,m=d.consts.DATA_TYPE,g=d.consts.KEYS,b=a.modules.baseContent.BindingContent,c=b.extend({_create:function(a,b,c){this._super(a,b,c);this._fn_cleanup=null},_getBindingOption:function(b,c,e,f){b=this._super(b,c,e,f);b.converter=a.getConverter("dateConverter");b.converterParam=d.defaults.dateFormat;return b},_createTargetElement:function(){var a=this._super();if(this.isEditing){var b=
d.$(a);b.datepicker();this._fn_cleanup=function(){l.destroyJQueryPlugin(b,"datepicker")}}return a},_cleanUp:function(){this._fn_cleanup&&(this._fn_cleanup(),this._fn_cleanup=null);this._super()},toString:function(){return"DateContent"}},null,function(a){f.DateContent=a}),e=b.extend({_init:function(){this._createTargetElement();var a=this._getBindingInfo();a&&(this._updateCss(),this._lfScope=d.utils.LifeTimeScope.create(),a=this._getBindingOption(a,this._tgt,this._dctx,"checked"),a.mode="TwoWay",this._lfScope.addObj(this._app.bind(a)))},
_createCheckBoxView:function(){var a=d.document.createElement("input");a.setAttribute("type","checkbox");return this._app.modules.elview.CheckBoxElView.create(a,{})},_createTargetElement:function(){this._tgt||(this._tgt=this._createCheckBoxView(),this._el=this._tgt.el);this._parentEl.appendChild(this._el)},_updateCss:function(){this._super();this._isEditing&&this._canBeEdited()?this._el.hasAttribute("disabled")&&this._el.removeAttribute("disabled"):this._el.hasAttribute("disabled")||this._el.setAttribute("disabled",
"disabled")},destroy:function(){this._isDestroyed||(this._lfScope&&(this._lfScope.destroy(),this._lfScope=null),this._tgt&&(this._tgt.destroy(),this._tgt=null),this._super())},_cleanUp:function(){},update:function(){this._cleanUp();this._updateCss()},toString:function(){return"BoolContent"}},null,function(a){f.BoolContent=a});e.extend({_canBeEdited:function(){return!0},toString:function(){return"RowSelectContent"}},null,function(a){f.RowSelectContent=a});var k=b.extend({_getBindingOption:function(b,
c,e,f){b=this._super(b,c,e,f);b.converter=a.getConverter("dateTimeConverter");c=this.getFieldInfo();e=d.defaults;switch(c.dataType){case m.DateTime:b.converterParam=e.dateTimeFormat;break;case m.Time:b.converterParam=e.timeFormat;break;default:b.converterParam=e.dateTimeFormat}return b},toString:function(){return"DateTimeContent"}},null,function(a){f.DateTimeContent=a}),p=b.extend({_allowedKeys:[0,g.backspace,g.del,g.left,g.right,g.end,g.home,g.tab,g.esc,g.enter],_getBindingOption:function(b,c,d,
e){b=this._super(b,c,d,e);switch(this.getFieldInfo().dataType){case m.Integer:b.converter=a.getConverter("integerConverter");break;case m.Decimal:b.converter=a.getConverter("decimalConverter");break;default:b.converter=a.getConverter("floatConverter")}return b},update:function(){this._super();var a=this;n.TextBoxElView.isPrototypeOf(a._tgt)&&a._tgt.addHandler("keypress",function(b,c){c.isCancel=!a._previewKeyPress(c.keyCode,c.value)})},_previewKeyPress:function(a,b){if(-1<this._allowedKeys.indexOf(a))return!0;
if(47===a)return!1;var c={32:" ",44:",",46:"."}[a],e=d.defaults;return c===e.decimalPoint?0===b.length?!1:0>b.indexOf(c):c&&c!==e.thousandSep?!1:!(!c&&(45>a||57<a))},toString:function(){return"NumberContent"}},null,function(a){f.NumberContent=a}),u=b.extend({_allowedKeys:[0,g.backspace,g.del,g.left,g.right,g.end,g.home,g.tab,g.esc,g.enter],update:function(){this._super();var a=this,b=a.getFieldInfo();n.TextBoxElView.isPrototypeOf(a._tgt)&&a._tgt.addHandler("keypress",function(c,d){d.isCancel=!a._previewKeyPress(b,
d.keyCode,d.value)})},_previewKeyPress:function(a,b,c){return!(0<a.maxLength&&c.length>=a.maxLength&&-1===this._allowedKeys.indexOf(b))},toString:function(){return"StringContent"}},null,function(a){f.StringContent=a}),v=b.extend({_allowedKeys:[0,g.backspace,g.del,g.left,g.right,g.end,g.home,g.tab,g.esc,g.enter],update:function(){this._super();var a=this,b=a.getFieldInfo();if(n.TextAreaElView.isPrototypeOf(a._tgt)){a._tgt.addHandler("keypress",function(c,d){d.isCancel=!a._previewKeyPress(b,d.keyCode,
d.value)});var c=this._options.multyline;c&&(c.rows&&(a._tgt.rows=c.rows),c.cols&&(a._tgt.cols=c.cols),c.wrap&&(a._tgt.wrap=c.wrap))}},_createTargetElement:function(){var a;a=this._isEditing&&this._canBeEdited()?d.document.createElement("textarea"):d.document.createElement("div");this._updateCss();return a},_previewKeyPress:function(a,b,c){return!(0<a.maxLength&&c.length>=a.maxLength&&-1===this._allowedKeys.indexOf(b))},toString:function(){return"MultyLineContent"}},null,function(a){f.MultyLineContent=
a}),y=b.extend({_init:function(){this._super();this._listBox=this._valBinding=this._spanView=null;this._isListBoxCachedExternally=!1;this._listBinding=this._valBinding=null},_getEventNames:function(){var a=this._super();return["listbox_created","need_listbox"].concat(a)},_getListBox:function(){if(this._listBox)return this._listBox;var a=this._options.lookup,b={listBox:null,dataSource:a.dataSource};this.raiseEvent("need_listbox",b);if(b.listBox)return this._isListBoxCachedExternally=!0,b.listBox;var b=
this._app,b=b.parser.resolvePath(b,a.dataSource),c={valuePath:a.valuePath,textPath:a.textPath},e=d.document.createElement("select");e.setAttribute("size","1");c=this._getListBoxElView(e,c);c.dataSource=b;b={listBox:c,dataSource:a.dataSource,isCachedExternally:!1};this.raiseEvent("listbox_created",b);this._isListBoxCachedExternally=b.isCachedExternally;return c},_getListBoxElView:function(a,b){var c;return(c=this.app._getElView(a))?c:c=this.app.getType("SelectElView").create(a,b||{})},_updateTextValue:function(){this._spanView&&
(this._spanView.value=this._getLookupText())},_getLookupText:function(){return this._getListBox().listBox.getTextByValue(this.value)},_createSpanView:function(){var a=d.document.createElement("span"),b=this._getDisplayInfo(),a=n.SpanElView.create(a,{});b&&b.displayCss&&a.$el.addClass(b.displayCss);return a},update:function(){this._cleanUp();this._el=this._createTargetElement();this._parentEl.appendChild(this._el)},_createTargetElement:function(){var a;this._isEditing&&this._canBeEdited()?(this._listBox||
(this._listBox=this._getListBox()),this._listBinding=this._bindToList(),a=this._listBox.el):(this._spanView||(this._spanView=this._createSpanView()),this._valBinding=this._bindToValue(),a=this._spanView.el);this._updateCss();return a},_cleanUp:function(){this._el&&(d.$(this._el).remove(),this._el=null);this._listBinding&&(this._listBinding.destroy(),this._listBinding=null);this._valBinding&&(this._valBinding.destroy(),this._valBinding=null);this._listBox&&this._isListBoxCachedExternally&&(this._listBox=
null)},_updateBindingSource:function(){this._valBinding&&(this._valBinding.source=this._dctx);this._listBinding&&(this._listBinding.source=this._dctx)},_bindToValue:function(){return!this._options.fieldName?null:h.create({target:this,source:this._dctx,targetPath:"value",sourcePath:this._options.fieldName,mode:"OneWay",converter:null,converterParam:null,isSourceFixed:!1})},_bindToList:function(){if(!this._options.fieldName)return null;var a={target:this._getListBox(),source:this._dctx,targetPath:"selectedValue",
sourcePath:this._options.fieldName,mode:"TwoWay",converter:null,converterParam:null,isSourceFixed:!1};return h.create(a)},destroy:function(){this._isDestroyed||(this._cleanUp(),this._listBox&&!this._isListBoxCachedExternally&&this._listBox.destroy(),this._listBox=null,this._spanView&&this._spanView.destroy(),this._spanView=null,this._super())},toString:function(){return"LookupContent"}},{value:{set:function(a){this._value!==a&&(this._value=a,this._updateTextValue(),this.raisePropertyChanged("value"))},
get:function(){return this._value}}},function(a){f.LookupContent=a});f.BindingContentFactory=RIAPP.BaseObject.extend({_app:a,getContentType:function(a){var d=a.fieldInfo;if(a.lookup)return y;switch(d.dataType){case m.None:a=b;break;case m.String:a=a.multyline?v:u;break;case m.Bool:a=e;break;case m.Integer:a=p;break;case m.Decimal:case m.Float:a=p;break;case m.DateTime:case m.Time:a=k;break;case m.Date:a=c;break;case m.Guid:case m.Binary:a=b;break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_FIELD_DATATYPE,
d.dataType));}return a},createContent:function(a,b,c,d){return this.getContentType(b).create(a,b,c,d)},toString:function(){return"Default BindingContentFactory"}},null,null);a.bindingContentFactory=f.BindingContentFactory};
