if(!window.RIAPP)var RIAPP={};
RIAPP.utils=function(){Array.clone||(Array.clone=function(d){return 1===d.length?[d[0]]:Array.apply(null,d)});var d={isFunc:function(d){if(!d)return!1;var k=/Function/;return"function"===typeof d?k.test(d.constructor.toString()):!1},endsWith:function(d,k){return d.substr(d.length-k.length)===k},startsWith:function(d,k){return d.substr(0,k.length)===k},fastTrim:function(d){return d.replace(/^\s+|\s+$/g,"")},trim:function(f,k){return!k?d.fastTrim(f):d.ltrim(d.rtrim(f,k),k)},ltrim:function(d,k){return d.replace(RegExp("^["+
(k||"\\s")+"]+","g"),"")},rtrim:function(d,k){return d.replace(RegExp("["+(k||"\\s")+"]+$","g"),"")},isArray:function(d){return!d?!1:"[object Array]"===Object.prototype.toString.call(d)},format:function(){for(var f="",k=arguments,h=k[0],a=0;;){var b=h.indexOf("{",a),c=h.indexOf("}",a);if(0>b&&0>c){f+=h.slice(a);break}if(0<c&&(c<b||0>b)){if("}"!==h.charAt(c+1))throw Error(d.format(RIAPP.ERRS.ERR_STRING_FORMAT_INVALID,h));f+=h.slice(a,c+1);a=c+2}else if(f+=h.slice(a,b),a=b+1,"{"===h.charAt(a))f+="{",
a++;else{if(0>c)throw Error(d.format(RIAPP.ERRS.ERR_STRING_FORMAT_INVALID,h));var b=h.substring(a,c),g=b.indexOf(":"),a=parseInt(0>g?b:b.substring(0,g),10)+1;if(isNaN(a))throw Error(d.format(RIAPP.ERRS.ERR_STRING_FORMAT_INVALID,h));b=0>g?"":b.substring(g+1);a=k[a];if(void 0===a||null===a)a="";f=a.format?f+a.format(b):f+a.toString();a=c+1}}return f},cloneObj:function(f){if(!f||"object"!==typeof f)return f;for(var k=d.isArray(f)?[]:{},h,a,b=Object.getOwnPropertyNames(f),c=0,g=b.length;c<g;c+=1)h=b[c],
a=f[h],k[h]=a&&"object"===typeof a?d.cloneObj(a):a;return k}};String.format||(String.format=function(){var f=Array.prototype.slice.call(arguments);return d.format.apply(d,f)});return d}();RIAPP.global=null;RIAPP.Application=null;
RIAPP.BaseObject={_create:function(){this.__events=this.__callState=null;this._isDestroying=this._isDestroyed=!1},create:function(){var d=Object.create(this);d._create.apply(d,arguments);return d},extend:function(d,f,k){var h=f||{},a,b=0,c,g;Object.getOwnPropertyNames(h).forEach(function(e){e=h[e];void 0===e.enumerable&&(e.enumerable=!0);void 0===e.configurable&&(e.configurable=!1)});h._typeName=Object.getOwnPropertyDescriptor({_typeName:""},"_typeName");h.__eventNames=Object.getOwnPropertyDescriptor({__eventNames:[]},
"__eventNames");if(d){a=Object.getOwnPropertyNames(d);b=0;for(c=a.length;b<c;b+=1)f=a[b],h.hasOwnProperty(f)||(h[f]=Object.getOwnPropertyDescriptor(d,f))}g=Object.create(this,h);Object.getOwnPropertyNames(g).forEach(function(e){var a=Object.getOwnPropertyDescriptor(g,e),b,c;a.value&&RIAPP.utils.isFunc(a.value)&&(c=a.value.toString(),-1<c.indexOf("._super(")&&(b=g[e],a.value=function(){var a=this.__callState;this.__callState={methodName:e,definedOn:g};try{return b.apply(this,arguments)}finally{this.__callState=
a}},Object.defineProperty(g,e,a)))});g.__eventNames=g._getEventNames();k&&k(g);return g},_super:function(){if(!this.__callState)throw Error(RIAPP.ERRS.ERR_SUPER_INVALID);var d=this.__callState.methodName,f=Object.getPrototypeOf(this.__callState.definedOn);if(!f)throw Error(String.format(RIAPP.ERRS.ERR_ASSERTION_FAILED,"superProto must not be undefined"));d=f[d];if(!d)throw Error(String.format(RIAPP.ERRS.ERR_ASSERTION_FAILED,"superProto[methodName] must be a Function"));return d.apply(this,arguments)},
_addHandler:function(d,f,k,h){if(!this._isDestroyed){if(!RIAPP.utils.isFunc(f))throw Error(RIAPP.ERRS.ERR_EVENT_INVALID_FUNC);if(!d)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_EVENT_INVALID,d));null===this.__events&&(this.__events={});var a=this.__events,b="*";k&&(b=""+k);a[d]||(a[d]=[]);d=a[d];d.some(function(a){return a.fn===f&&a.ns==b})||(h?d.unshift({fn:f,ns:b}):d.push({fn:f,ns:b}))}},_removeHandler:function(d,f){var k=this.__events,h="*";if(k){f&&(h=""+f);var a,b,c;if(d){if(k[d])if("*"==h)delete k[d];
else{a=k[d];b=a.filter(function(a){return a.ns==h});for(c=a.length;0<c;)c-=1,-1<b.indexOf(a[c])&&a.splice(c,1);0==a.length&&delete k[d]}}else"*"!=h?Object.keys(k).forEach(function(a){var e=k[a],b=e.filter(function(e){return e.ns==h});for(c=e.length;0<c;)c-=1,-1<b.indexOf(e[c])&&e.splice(c,1);0==e.length&&delete k[a]}):this.__events=null}},_raiseEvent:function(d,f){var k=this,h=k.__events;null!==h&&d&&("0*"!=d&&RIAPP.utils.startsWith(d,"0")&&this._raiseEvent("0*",f),h[d]&&Array.clone(h[d]).forEach(function(a){a.fn.apply(k,
[k,f])}))},_onError:function(d,f){if(RIAPP.global&&RIAPP.global._checkIsDummy(d))return!0;d.message||(d=Error(""+d));var k={error:d,source:f,isHandled:!1};this._raiseEvent("error",k);return k.isHandled},_getEventNames:function(){return["error","destroyed"]},_checkEventName:function(d){if(-1===this.__eventNames.indexOf(d))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_EVENT_INVALID,d));},_isNotDestroyed:function(){return!(this._isDestroying||this._isDestroyed)},raisePropertyChanged:function(d){this._raiseEvent("0"+
d,{property:d})},addHandler:function(d,f,k){this._checkEventName(d);this._addHandler(d,f,k,!1)},removeHandler:function(d,f){d&&this._checkEventName(d);this._removeHandler(d,f)},addOnDestroyed:function(d,f){this._addHandler("destroyed",d,f,!1)},removeOnDestroyed:function(d){this._removeHandler("destroyed",d)},removeNSHandlers:function(d){this._removeHandler(void 0,d)},raiseEvent:function(d,f){this._checkEventName(d);this._raiseEvent(d,f)},getEventNames:function(){return this.__eventNames},addOnPropertyChange:function(d,
f,k){if(!d)throw Error(RIAPP.ERRS.ERR_PROP_NAME_EMPTY);this._addHandler("0"+d,f,k,!1)},removeOnPropertyChange:function(d,f){d&&(d="0"+d);this._removeHandler(d,f)},destroy:function(){if(!this._isDestroyed){this._isDestroyed=!0;try{this._raiseEvent("destroyed",{})}finally{this.__events=null,this._isDestroying=!1}}}};RIAPP._glob_modules="array_ext consts errors defaults utils converter riapp".split(" ");RIAPP._app_modules="parser collection db listbox datadialog datagrid pager stackpanel dataform binding template content mvvm elview".split(" ");
RIAPP.Global=RIAPP.BaseObject.extend({version:"1.0.0",_create:function(d,f){this._super();if(RIAPP.global)throw Error(RIAPP.ERRS.ERR_GLOBAL_SINGLTON);if(!f)throw Error(RIAPP.ERRS.ERR_APP_NEED_JQUERY);this._window=d;this._appInst={};this._$=f;this._types={_converters:{}};this._defaults=this._currentSelectable=null;this._userCode={};for(var k=0;k<RIAPP._glob_modules.length;k+=1)RIAPP.Global._coreModules[RIAPP._glob_modules[k]].apply(this,[this]);this._init();Object.freeze(this._coreModules)},_init:function(){var d=
this;this.$(this.document).on("click.global",function(f){f.stopPropagation();d.currentSelectable=null});this.$(this.document).on("keydown.global",function(f){f.stopPropagation();d._currentSelectable&&d._currentSelectable._onKeyDown(f.which,f)});this.$(this.document).on("keyup.global",function(f){f.stopPropagation();d._currentSelectable&&d._currentSelectable._onKeyUp(f.which,f)});this.$(this.window).unload(function(){d.raiseEvent("unload",{})});this.window.onerror=function(d,k,h){if(d&&-1<d.indexOf("DUMMY_ERROR"))return!0;
alert("Error message: "+d+"\nURL: "+k+"\nLine Number: "+h);return!1}},_getEventNames:function(){var d=this._super();return["unload"].concat(d)},_onGridAdded:function(d){var f=this,k=f.utils,h=d.$container;h.on("click."+d.uniqueID,function(a){a.stopPropagation();k.isContained(a.target,h.get(0))&&(f.currentSelectable=d)})},_onGridRemoved:function(d){d.$container.off("click."+d.uniqueID);this.currentSelectable===d&&(this.currentSelectable=null)},_onStackPanelAdded:function(d){var f=this,k=f.utils,h=
d._$el;h.on("click."+d.uniqueID,function(a){a.stopPropagation();k.isContained(a.target,h.get(0))&&(f.currentSelectable=d)})},_onStackPanelRemoved:function(d){d._$el.off("click."+d.uniqueID);this.currentSelectable===d&&(this.currentSelectable=null)},_registerApp:function(d){this._appInst[d.appName]||(this._appInst[d.appName]=d)},_unregisterApp:function(d){this._appInst[d.appName]&&delete this._appInst[d.appName]},_destroyApps:function(){var d=this;this.utils.forEachProp(this._appInst,function(f){d._appInst[f].destroy()})},
_registerType:function(d,f,k){var h=f.split(".");d=d.types;var a;for(a=0;a<h.length-1;a+=1)d[h[a]]||(d[h[a]]={}),d=d[h[a]];h=h[h.length-1];if(d[h])throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_TYPE_ALREDY_REGISTERED,f));k._typeName=f;d[h]=k;return d},_getType:function(d,f){var k=f.split("."),h=d.types,a;for(a=0;a<k.length;a+=1){if(!h[k[a]])return null;h=h[k[a]]}return h},findApp:function(d){return this._appInst[d]},destroy:function(){this.removeHandler();this._destroyApps();this.$(this.document).off(".global");
RIAPP.Application=null;RIAPP.global=null;this.window.onerror=null;this._super()},registerType:function(d,f){return this._registerType(this,d,f)},getType:function(d){return this._getType(this,d)},registerConverter:function(d,f){this.types._converters[d]||(this.types._converters[d]=f)},getConverter:function(d){var f=this.types._converters[d];if(!f)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CONVERTER_NOTREGISTERED,d));return f},getImagePath:function(d){return this.defaults.imagesPath+d},_throwDummy:function(d){if(d&&
!d.isDummy)throw this.getType("DummyError").create(d);throw d;},reThrow:function(d,f){if(f)this._throwDummy(d);else throw d;},_checkIsDummy:function(d){return d.isDummy},_checkIsValidationErr:function(d){return this.getType("ValidationError").isPrototypeOf(d)},_coreModules:{}},{$:{get:function(){return this._$}},types:{get:function(){return this._types}},window:{get:function(){return this._window}},document:{get:function(){return this._window.document}},currentSelectable:{set:function(d){this._currentSelectable!==
d&&(this._currentSelectable=d,this.raisePropertyChanged("currentSelectable"))},get:function(){return this._currentSelectable}},defaults:{set:function(d){this._defaults!==d&&(this._defaults=d,this.raisePropertyChanged("defaults"))},get:function(){return this._defaults}},UC:{get:function(){return this._userCode}}});
RIAPP.Global._coreModules.errors=function(d){var f=RIAPP.BaseObject.extend({_create:function(d){this._super();this._message=d;this._isDummy=!1;this._origError=null},toString:function(){return this._message}},{message:{set:function(d){this._message=d},get:function(){return this._message}},isDummy:{set:function(d){this._isDummy=d},get:function(){return this._isDummy}},origError:{set:function(d){this._origError=d},get:function(){return this._origError}}},function(f){d.registerType("BaseError",f)});f.extend({_create:function(d){this._super("DUMMY_ERROR");
this._origError=d;this._isDummy=!0}},null,function(f){d.registerType("DummyError",f)});f.extend({_create:function(d,f){var a=RIAPP.ERRS.ERR_VALIDATION+"\r\n",b=0;d.forEach(function(c){0<b&&(a+="\r\n");a=c.fieldName?a+" "+RIAPP.localizable.TEXT.txtField+": "+c.fieldName+" -> "+c.errors.join(", "):a+c.errors.join(", ");b+=1});this._super(a);this._errors=d;this._item=f}},{item:{get:function(){return this._item}},errors:{get:function(){return this._errors}}},function(f){d.registerType("ValidationError",
f)});f=f.extend({_create:function(d,f){var a;d&&(a=d.message);a||(a=""+d);this._super(a);this._origError=d;this._operationName=f}},{operationName:{get:function(){return this._operationName}}},function(f){d.registerType("DataOperationError",f)});f.extend(null,null,function(f){d.registerType("AccessDeniedError",f)});f.extend(null,null,function(f){d.registerType("ConcurrencyError",f)});f.extend(null,null,function(f){d.registerType("SvcValidationError",f)});f.extend({_create:function(d,f,a){var b=d.message||
""+d;this._super(b,"submit");this._origError=d;this._allSubmitted=f||[];this._notValidated=a||[];if(0<this._notValidated.length){var c=[b+":"];this._notValidated.forEach(function(a){c.push(String.format("item key:{0} errors:{1}",a._key,a.getErrorString()))});this._message=c.join("\r\n")}}},{allSubmitted:{get:function(){return this._allSubmitted}},notValidated:{get:function(){return this._notValidated}}},function(f){d.registerType("SubmitError",f)})};
RIAPP.Global._coreModules.defaults=function(d){var f=RIAPP.BaseObject.extend({_create:function(){this._super();this._datepickerRegional=this._imagesPath="";if(!d.$.datepicker)throw Error(RIAPP.ERRS.ERR_JQUERY_DATEPICKER_NOTFOUND);this._datepickerDefaults=d.$.datepicker.regional[this._datepickerRegional];this._dateTimeFormat="dd.MM.yyyy HH:mm:ss";this._timeFormat="HH:mm:ss";this._decimalPoint=",";this._thousandSep=" ";this._decPrecision=2;this._ajaxTimeOut=600},destroy:function(){this._super()},_setDatePickerRegion:function(f){this.datepickerDefaults=
f?d.$.datepicker.regional[f]:d.$.datepicker.regional[""]}},{ajaxTimeOut:{set:function(d){this._ajaxTimeOut!==d&&(this._ajaxTimeOut=d,this.raisePropertyChanged("ajaxTimeOut"))},get:function(){return this._ajaxTimeOut}},dateFormat:{set:function(f){this._datepickerDefaults.dateFormat!==f&&(this._datepickerDefaults.dateFormat=f,d.$.datepicker.setDefaults(this._datepickerDefaults),this.raisePropertyChanged("dateFormat"))},get:function(){return this._datepickerDefaults.dateFormat}},timeFormat:{set:function(d){this._timeFormat!==
d&&(this._timeFormat=d,this.raisePropertyChanged("timeFormat"))},get:function(){return this._timeFormat}},dateTimeFormat:{set:function(d){this._dateTimeFormat!==d&&(this._dateTimeFormat=d,this.raisePropertyChanged("timeFormat"))},get:function(){return this._dateTimeFormat}},datepickerDefaults:{set:function(f){f||(f=d.$.datepicker.regional[this._datepickerRegional]);var h=this._datepickerDefaults;this._datepickerDefaults=f;d.$.datepicker.setDefaults(f);h.dateFormat!==f.dateFormat&&this.raisePropertyChanged("dateFormat")},
get:function(){return this._datepickerDefaults}},datepickerRegional:{set:function(d){d||(d="");this._datepickerRegional!==d&&(this._datepickerRegional=d,this._setDatePickerRegion(d),this.raisePropertyChanged("datepickerRegional"))},get:function(){return this._datepickerRegional}},imagesPath:{set:function(d){d||(d="");this._imagesPath!==d&&(RIAPP.utils.endsWith(d,"/")?this._imagesPath=d:this._imagesPath=d+"/",this.raisePropertyChanged("imagesPath"))},get:function(){return this._imagesPath}},decimalPoint:{set:function(d){this._decimalPoint!==
d&&(this._decimalPoint=d,this.raisePropertyChanged("decimalPoint"))},get:function(){return this._decimalPoint}},thousandSep:{set:function(d){this._thousandSep!==d&&(this._thousandSep=d,this.raisePropertyChanged("thousandSep"))},get:function(){return this._thousandSep}},decPrecision:{set:function(d){this._decPrecision!==d&&(this._decPrecision=d,this.raisePropertyChanged("decPrecision"))},get:function(){return this._decPrecision}}},function(f){d.registerType("Defaults",f)});d.defaults=f.create();d.defaults.dateFormat=
"dd.mm.yy";d.defaults.imagesPath="/Scripts/jriapp/img/"};RIAPP.Global._coreModules.array_ext=function(d){Array.prototype.distinct=function(){var d={},k,h=this.length,a=[];for(k=0;k<h;k+=1)d[this[k]]=this[k];var b=Object.keys(d);k=0;for(h=b.length;k<h;k+=1)a.push(d[b[k]]);return a};Array.prototype.intersect=function(d){return this.filter(function(k){return-1<d.indexOf(k)})};Array.fromList=function(d){for(var k=Array(d.length),h=0,a=d.length;h<a;h++)k[h]=d[h];return k}};
RIAPP.Global._coreModules.consts=function(d){var f={SORT_ORDER:{ASC:0,DESC:1},DATA_TYPE:{None:0,String:1,Bool:2,Integer:3,Decimal:4,Float:5,DateTime:6,Date:7,Time:8,Guid:9,Binary:10},DATE_CONVERSION:{None:0,ServerLocalToClientLocal:1,UtcToClientLocal:2},CHANGE_TYPE:{NONE:0,ADDED:1,UPDATED:2,DELETED:3},FILTER_TYPE:{Equals:0,Between:1,StartsWith:2,EndsWith:3,Contains:4,Gt:5,Lt:6,GtEq:7,LtEq:8,NotEq:9},BINDING_MODE:["OneTime","OneWay","TwoWay"],COLL_CHANGE_TYPE:{REMOVE:"0",ADDED:"1",RESET:"2",REMAP_KEY:"3"},
DATA_ATTR:{EL_VIEW_KEY:"data-elvwkey",DATA_BIND:"data-bind",DATA_VIEW:"data-view",DATA_APP:"data-app",DATA_EVENT_SCOPE:"data-scope",DATA_ITEM_KEY:"data-key",DATA_CONTENT:"data-content",DATA_COLUMN:"data-column",DATA_NAME:"data-name"},COLUMN_TYPE:{DATA:"data",ROW_EXPANDER:"row_expander",ROW_ACTIONS:"row_actions",ROW_SELECTOR:"row_selector"},DATA_OPER:{SUBMIT:"submit",LOAD:"load",INVOKE:"invoke",REFRESH:"refresh",INIT:"initDbContext"},DATA_SVC_METH:{Invoke:"InvokeMethod",LoadData:"GetItems",InitDbContext:"GetMetadata",
Submit:"SaveChanges",Refresh:"RefreshItem"},REFRESH_MODE:{NONE:0,RefreshCurrent:1,MergeIntoCurrent:2,CommitChanges:3},DELETE_ACTION:{NoAction:0,Cascade:1,SetNulls:2},Key:{backspace:8,tab:9,enter:13,esc:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,del:127}};Object.getOwnPropertyNames(f).forEach(function(d){Object.freeze(this[d])},f);d.consts=f};
RIAPP.Global._coreModules.utils=function(d){var f=d.consts,k=RIAPP.utils,h={_newID:0,getNewID:function(){var a=this._newID;h._newID+=1;return a},isContained:function(a,b){if(!a)return!1;for(;a=a.parentNode;)if(a===b)return!0;return!1},slice:Array.prototype.slice,get_timeZoneOffset:function(){var a=(new Date).getTimezoneOffset();return function(){return a}}(),valueToDate:function(a,b,c){if(!a)return null;a=""+a;var g=a.split("&");if(7!=g.length)throw Error(k.format(RIAPP.ERRS.ERR_PARAM_INVALID,"val",
a));a=new Date(parseInt(g[0],10),parseInt(g[1],10)-1,parseInt(g[2],10),parseInt(g[3],10),parseInt(g[4],10),parseInt(g[5],10),parseInt(g[6],10));var g=f.DATE_CONVERSION,e=h.get_timeZoneOffset();switch(b){case g.None:break;case g.ServerLocalToClientLocal:a.setMinutes(a.getMinutes()+c);a.setMinutes(a.getMinutes()-e);break;case g.UtcToClientLocal:a.setMinutes(a.getMinutes()-e);break;default:throw Error(k.format(RIAPP.ERRS.ERR_PARAM_INVALID,"dtcnv",b));}return a},dateToValue:function(a,b,c){if(null===
a)return null;if(!h.check_is.Date(a))throw Error(k.format(RIAPP.ERRS.ERR_PARAM_INVALID,"dt",a));var g=f.DATE_CONVERSION,e=h.get_timeZoneOffset();switch(b){case g.None:break;case g.ServerLocalToClientLocal:a.setMinutes(a.getMinutes()+e);a.setMinutes(a.getMinutes()-c);break;case g.UtcToClientLocal:a.setMinutes(a.getMinutes()+e);break;default:throw Error(h.format(RIAPP.ERRS.ERR_PARAM_INVALID,"dtcnv",b));}return""+a.getFullYear()+"&"+(a.getMonth()+1)+"&"+a.getDate()+"&"+a.getHours()+"&"+a.getMinutes()+
"&"+a.getSeconds()+"&"+a.getMilliseconds()},compareVals:function(a,b,c){var g=f.DATA_TYPE;if(null===a&&null!==b||null!==a&&null===b)return!1;switch(c){case g.DateTime:case g.Date:case g.Time:return h.check_is.Date(a)&&h.check_is.Date(b)?a.getTime()===b.getTime():!1;default:return a===b}},parseValue:function(a,b,c,g){var e=null,l=f.DATA_TYPE;if(void 0===a||null===a)return e;switch(b){case l.None:e=a;break;case l.String:e=a;break;case l.Bool:e=this.parseBool(a);break;case l.Integer:e=parseInt(a,10);
break;case l.Decimal:case l.Float:e=parseFloat(a);break;case l.DateTime:case l.Date:case l.Time:e=this.valueToDate(a,c,g);break;case l.Guid:case l.Binary:e=a;break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"dataType",b));}return e},parseBool:function(a){var b=k.trim(a).toLowerCase();if("false"===b)return!1;if("true"===b)return!0;throw Error(h.format(RIAPP.ERRS.ERR_PARAM_INVALID,"bool_value",a));},stringifyValue:function(a,b,c){return h.check_is.nt(a)?null:h.check_is.Date(a)?
h.dateToValue(a,b,c):""+a},round:function(a,b){return parseFloat(a.toFixed(b))},performAjaxCall:function(a,b,c,g,e,l){d.$.ajax({url:a,type:"POST",dataType:"json",data:b,async:c,context:l,timeout:1E3*d.defaults.ajaxTimeOut,contentType:"application/json; charset=utf-8",success:function(e){g.call(this,e)},error:function(a,b,m){e.call(this,""+b+": "+m)}})},check_is:{Null:function(a){return null===a},Undefined:function(a){return void 0===a},nt:function(a){return null===a||void 0===a},Function:function(a){return k.isFunc(a)},
String:function(a){if(h.check_is.nt(a))return!1;var b=/string/i;return"string"===typeof a?!0:"object"===typeof a?b.test(a.constructor.toString()):!1},Array:function(a){return k.isArray(a)},Boolean:function(a){if(h.check_is.nt(a))return!1;var b=/boolean/i;return"boolean"===typeof a?!0:"object"===typeof a?b.test(a.constructor.toString()):!1},Date:function(a){if(h.check_is.nt(a))return!1;var b=/date/i;return"date"===typeof a?!0:"object"===typeof a?b.test(a.constructor.toString()):!1},HTML:function(a){if(h.check_is.nt(a))return!1;
var b=/html/i;return"object"===typeof a?b.test(a.constructor.toString()):!1},Number:function(a){if(h.check_is.nt(a))return!1;var b=/Number/;return"number"===typeof a?!0:"object"===typeof a?b.test(a.constructor.toString()):!1},Object:function(a){if(h.nt(a))return!1;var b=/object/i;return"object"===typeof a?b.test(a.constructor.toString()):!1},RegExp:function(a){if(h.nt(a))return!1;var b=/regexp/i;return"function"===typeof a?b.test(a.constructor.toString()):!1},Numeric:function(a){return h.check_is.Number(a)||
h.check_is.String(a)&&!isNaN(Number(a))},BoolString:function(a){return h.check_is.nt(a)?!1:"true"==a||"false"==a}},format:function(){var a=Array.prototype.slice.call(arguments);return k.format.apply(k,a)},normalizeURL:function(a){var b=d.window;"/"==a.slice(0,1)?a=b.location.protocol+"//"+b.location.host+a:"http:"==a.slice(0,5)||"https:"==a.slice(0,6)||(a=b.location.href+"/"+a);return a},extend:function(a,b,c){return a?d.$.extend(!0,b,c):d.$.extend(b,c)},getElementById:function(a){return d.document.getElementById(a)},
removeNode:function(a){if(a){var b=a.parentNode;b&&b.removeChild(a)}},insertAfter:function(a,b){var c=a.parentNode;c.lastChild===a?c.appendChild(b):c.insertBefore(b,a.nextSibling)},getProps:function(a){return Object.getOwnPropertyNames(a)},forEachProp:function(a,b){Object.getOwnPropertyNames(a).forEach(b)},addToolTip:function(a,b,c){c={content:{text:b},style:{classes:c?c:null},position:{my:"top left",at:"bottom right",target:a,viewport:$(d.window),adjust:{method:"flip none",x:0,y:0}},hide:{fixed:!0,
delay:250}};a.data("qtip")?b?a.qtip("option","content.text",b):a.qtip("destroy"):b&&a.qtip(c)},checkNumRange:function(a,b){var c=b.split(",");if(c[0]&&a<parseFloat(c[0]))throw Error(String.format(RIAPP.ERRS.ERR_FIELD_RANGE,a,b));if(c[1]&&a>parseFloat(c[1]))throw Error(String.format(RIAPP.ERRS.ERR_FIELD_RANGE,a,b));},dtRangeToDate:function(a){a=a.split("-");return new Date(parseInt(a[0],10),parseInt(a[1],10)-1,a[2])},checkDateRange:function(a,b){var c=b.split(",");if(c[0]&&a<h.dtRangeToDate(c[0]))throw Error(String.format(RIAPP.ERRS.ERR_FIELD_RANGE,
a,b));if(c[1]&&a>h.dtRangeToDate(c[1]))throw Error(String.format(RIAPP.ERRS.ERR_FIELD_RANGE,a,b));},checkError:function(a,b){if(a)switch(a.name){case "AccessDeniedException":throw d.getType("AccessDeniedError").create(RIAPP.ERRS.ERR_ACCESS_DENIED,b);case "ConcurrencyException":throw d.getType("ConcurrencyError").create(RIAPP.ERRS.ERR_CONCURRENCY,b);case "ValidationException":throw d.getType("SvcValidationError").create(h.format(RIAPP.ERRS.ERR_VALIDATION,a.message),b);case "DomainServiceException":throw d.getType("DataOperationError").create(h.format(RIAPP.ERRS.ERR_SVC_ERROR,
a.message),b);default:throw d.getType("DataOperationError").create(h.format(RIAPP.ERRS.ERR_UNEXPECTED_SVC_ERROR,a.message),b);}},hasProp:function(a,b){if(!a)return!1;if(a.hasOwnProperty(b))return!0;if(Object===a)return!1;var c=Object.getPrototypeOf(a);return h.hasProp(c,b)},createDeferred:function(a){return a?d.$.Deferred(a):d.$.Deferred()},uuid:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");return function(b,c){var g,e=[],l=Math.random;c=c||a.length;if(b)for(g=
0;g<b;g+=1)e[g]=a[0|l()*c];else{var d;e[8]=e[13]=e[18]=e[23]="-";e[14]="4";for(g=0;36>g;g+=1)e[g]||(d=0|16*l(),e[g]=a[19==g?d&3|8:d&15])}return e.join("")}}(),str:{endsWith:function(a,b){return k.endsWith(a,b)},startsWith:function(a,b){return k.startsWith(a,b)},trim:function(a,b){return k.trim(a,b)},formatNumber:function(a,b,c,g){a=(a+"").replace(/[^0-9+-Ee.]/g,"");var e=!isFinite(+a)?0:+a;a=!isFinite(+b)?0:Math.abs(b);g=void 0===g?",":g;c=void 0===c?".":c;var l="",l=function(e,a){var b=Math.pow(10,
a);return""+Math.round(e*b)/b};h.check_is.nt(b)?(l=(""+e).split("."),a=2):l=(a?l(e,a):""+Math.round(e)).split(".");var e="",d=l[0].length;if(3<d){for(b=0;b<d;b+=1)e+=l[0].charAt(b),b<d-1&&0===(d-b-1)%3&&(e+=g);l[0]=e}if((l[1]||"").length<a)l[1]=l[1]||"",l[1]+=Array(a-l[1].length+1).join("0");return l.join(c)},stripNonNumeric:function(a){a+="";for(var b=/^\d|\.|-$/,c="",g=0;g<a.length;g++)b.test(a.charAt(g))&&("."==a.charAt(g)&&-1!=c.indexOf(".")||"-"==a.charAt(g)&&0!=c.length||(c+=a.charAt(g)));return c}}};
RIAPP.BaseObject.extend({_create:function(){this._super();this._objs=[]},addObj:function(a){0>this._objs.indexOf(a)&&this._objs.push(a)},removeObj:function(a){a=this._objs.indexOf(a);0>a||this._objs.splice(a,1)},getObjs:function(){return this._objs},destroy:function(){this._objs.forEach(function(a){a._isNotDestroyed()&&a.destroy()});this._objs=[];this._super()}},null,function(a){d.registerType("LifeTimeScope",a)});RIAPP.BaseObject.extend({_create:function(){this._super();this._objId=""+h.getNewID();
this._objs=[]},addPropWatch:function(a,b,c){a.addOnPropertyChange(b,function(a,e){c(e.property)},this.uniqueID);0>this._objs.indexOf(a)&&this._objs.push(a)},addWatch:function(a,b,c){a.addOnPropertyChange("*",function(a,e){-1<b.indexOf(e.property)&&c(e.property)},this.uniqueID);0>this._objs.indexOf(a)&&this._objs.push(a)},removeWatch:function(a){a.removeNSHandlers(this.uniqueID)},destroy:function(){var a=this;this._objs.forEach(function(b){a.removeWatch(b)});this._objs=[];this._super()}},{uniqueID:{get:function(){return this._objId}}},
function(a){d.registerType("PropWatcher",a)});RIAPP.BaseObject.extend({_create:function(a){this._super();this._objId="wq"+h.getNewID();this._owner=a;this._queue={}},_checkQueue:function(a,b){if(this._owner){var c=this,g=this._queue[a],e;if(g&&0!=g.length){var l,d,f=null,m=[],r=[],t=[];for(l=0;l<g.length;l+=1)if(e=g[l],e.predicate(b))if(!e.group&&0==m.length){d=e;break}else e.group&&(f||(f=e.group),f==e.group&&m.push(e));if(d)r.push(d),t.push(d);else for(;0<m.length;)e=m.pop(),d||(d=e),d.lastWins?
0==r.length&&r.push(e):r.push(e),t.push(e);try{if(0<r.length){for(l=g.length;0<l;)l-=1,-1<t.indexOf(g[l])&&g.splice(l,1);r.forEach(function(e){try{e.action.apply(c._owner,e.args)}catch(a){c._owner._onError(a,c)}})}}finally{0==g.length&&(delete this._queue[a],this._owner.removeOnPropertyChange(a,this.uniqueID))}}}},enQueue:function(a){a=h.extend(!1,{prop:"",groupName:null,predicate:null,action:null,actionArgs:[],lastWins:!1,syncCheck:!1},a);var b=this;if(this._owner){var c=a.prop,g=this._queue[c];
g||(g=[],this._queue[c]=g,this._owner.addOnPropertyChange(c,function(e,a){setTimeout(function(){b._checkQueue(c,b._owner[c])},50)},b.uniqueID));g.push({predicate:a.predicate,action:a.action,group:a.groupName,lastWins:a.lastWins,args:!a.actionArgs?[]:a.actionArgs});a.syncCheck?b._checkQueue(c,b._owner[c]):setTimeout(function(){b._checkQueue(c,b._owner[c])},50)}},destroy:function(){this._owner.removeOnPropertyChange(null,this.uniqueID);this._queue={};this._owner=null;this._super()}},{uniqueID:{get:function(){return this._objId}},
owner:{get:function(){return this._owner}}},function(a){d.registerType("WaitQueue",a)});d.utils=h};
RIAPP.Global._coreModules.converter=function(d){var f=d.utils,k=f.str,h=RIAPP.BaseObject.extend({convertToSource:function(a,c,g){return a},convertToTarget:function(a,c,g){return f.check_is.nt(a)?null:a}},null,function(a){d.registerType("BaseConverter",a)});h.extend({convertToSource:function(a,c,g){return!a?null:d.$.datepicker.parseDate(c,a)},convertToTarget:function(a,c,g){return f.check_is.nt(a)?"":d.$.datepicker.formatDate(c,a)}},null,function(a){d.registerConverter("dateConverter",a)});h.extend({convertToSource:function(a,
c,g){if(!a)return null;c=Date.parseExact(a,c);if(!c)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CONV_INVALID_DATE,a));return c},convertToTarget:function(a,c,g){return f.check_is.nt(a)?"":a.toString(c)}},null,function(a){d.registerConverter("dateTimeConverter",a)});var a=h.extend({convertToSource:function(a,c,g){if(f.check_is.nt(a))return null;g=d.defaults;var e=g.decimalPoint,l=4,n=a.replace(g.thousandSep,""),n=n.replace(e,"."),n=k.stripNonNumeric(n);if(""===n)return null;e=null;switch(c){case 4:e=
parseInt(n,10);break;case 1:e=parseInt(n,10);break;case 2:l=g.decPrecision;e=f.round(parseFloat(n),l);break;case 3:e=parseFloat(n);break;default:e=Number(n)}if(!f.check_is.Number(e))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CONV_INVALID_NUM,a));return e},convertToTarget:function(a,c,g){if(f.check_is.nt(a))return"";var e=d.defaults;g=e.decimalPoint;var l=e.thousandSep;switch(c){case 1:return k.formatNumber(a,0,g,l);case 2:return c=e.decPrecision,k.formatNumber(a,c,g,l);case 4:return k.formatNumber(a,
0,g,"");case 3:return k.formatNumber(a,null,g,l);default:return k.formatNumber(a,null,g,l)}}},null,function(a){d.registerConverter("numberConverter",a)});h.extend({convertToSource:function(b,c,g){return a.convertToSource(b,1,g)},convertToTarget:function(b,c,g){return a.convertToTarget(b,1,g)}},null,function(a){d.registerConverter("integerConverter",a)});h.extend({convertToSource:function(b,c,g){return a.convertToSource(b,4,g)},convertToTarget:function(b,c,g){return a.convertToTarget(b,4,g)}},null,
function(a){d.registerConverter("smallIntConverter",a)});h.extend({convertToSource:function(b,c,g){return a.convertToSource(b,2,g)},convertToTarget:function(b,c,g){return a.convertToTarget(b,2,g)}},null,function(a){d.registerConverter("decimalConverter",a)});h.extend({convertToSource:function(b,c,g){return a.convertToSource(b,3,g)},convertToTarget:function(b,c,g){return a.convertToTarget(b,3,g)}},null,function(a){d.registerConverter("floatConverter",a)})};
RIAPP.Global._coreModules.riapp=function(d){var f=d.utils,k=d.consts,h=RIAPP.BaseObject.extend({_nextInstanceNum:0,_coreModules:{},_userModules:{},_DATA_BIND_SELECTOR:["*[",k.DATA_ATTR.DATA_BIND,"]"].join(""),_TEMPLATES_DATA_BIND_SELECTOR:["section.ria-template *[",k.DATA_ATTR.DATA_BIND,"]"].join(""),_create:function(a){this._super();a=f.extend(!1,{app_name:"default",service_url:"",metadata:null,createDbContext:!0,moduleNames:[]},a);var b=a.app_name;if(d.findApp(b))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_APP_NAME_NOT_UNIQUE,
b));this.options=a;this._lftmBind=this._dbContext=this._parser=null;this._instanceNum=h._nextInstanceNum;h._nextInstanceNum+=1;this.ELV_STORE_KEY=k.DATA_ATTR.EL_VIEW_KEY+this._instanceNum;this._types={_grids:{},_elViews:{},_registerGrid:function(a){this._grids[a.uniqueID]||(this._grids[a.uniqueID]=a,d._onGridAdded(a))},_unregisterGrid:function(a){this._grids[a.uniqueID]&&(delete this._grids[a.uniqueID],d._onGridRemoved(a))},_destroyGrids:function(){var a=this;f.forEachProp(this._grids,function(e){a._grids[e].destroy()})}};
this._global=d;this._elViewStore={};this._nextElViewStoreKey=0;this._userCode={};this._viewModels={};var c,b=0;for(c=RIAPP._app_modules.length;b<c;b+=1)h._coreModules[RIAPP._app_modules[b]].apply(this,[this]);a=f.check_is.Array(a.moduleNames)&&0<a.moduleNames.length?a.moduleNames:[];b=0;for(c=a.length;b<c;b+=1){if(!h._userModules[a[b]])throw Error(String.format(RIAPP.ERRS.ERR_MODULE_UNDEFINED,a[b]));h._userModules[a[b]].apply(this,[this])}d._registerApp(this)},destroy:function(){this._isDestroyed||
(this._isDestroying=!0,this._lftmBind&&(this._lftmBind.destroy(),this._lftmBind=null),this.types._destroyGrids(),this._dbContext&&(this._dbContext.destroy(),this._dbContext=null),this.removeHandler(),d._unregisterApp(this),this._super())},_getEventNames:function(){var a=this._super();return["define_calc"].concat(a)},_onError:function(a,b){if(d._checkIsDummy(a))return!0;var c=this._super(a,b);return!c?d._onError(a,b):c},getNewObjectID:function(){return f.getNewID()},_onGetCalcField:function(a){this.raiseEvent("define_calc",
a)},_getBindingOption:function(a,b,c){var g={},e=a.source,l=a.target;g.sourcePath=!a.sourcePath&&a.to?a.to:a.sourcePath;g.targetPath=a.targetPath;g.converterParam=a.converterParam;g.mode=a.mode;a.converter&&f.check_is.String(a.converter)?g.converter=d.getConverter(a.converter):g.converter=a.converter;l?f.check_is.String(l)?g.target="this"==l?b:this.parser.resolveBindingSource(this,this.parser._getPathParts(l)):g.target=l:g.target=b;e?(g.isSourceFixed=!0,f.check_is.String(e)?g.source="this"==e?b:this.parser.resolveBindingSource(this,
this.parser._getPathParts(e)):g.source=e):g.source=c;return g},_getElViewType:function(a){return this.types._elViews[a]},_getElView:function(a){return(a=a.getAttribute(this.ELV_STORE_KEY))?this._elViewStore[a]:null},_setElView:function(a,b){var c=this.ELV_STORE_KEY,g=a.getAttribute(c);g?b?this._elViewStore[g]=b:(a.removeAttribute(c),delete this._elViewStore[g]):b&&(g="s_"+this._nextElViewStoreKey,this._nextElViewStoreKey+=1,a.setAttribute(c,g),this._elViewStore[g]=b)},_bindTemplateElements:function(a,
b){var c=this,g=Array.fromList(b.querySelectorAll(c._DATA_BIND_SELECTOR)),e=d.getType("LifeTimeScope").create();b.hasAttribute(k.DATA_ATTR.DATA_BIND)&&g.push(b);g.forEach(function(a,b){var g,m,r,d,v,f;if(!c._isInsideDataForm(a)){g=a.getAttribute(k.DATA_ATTR.DATA_BIND);a.removeAttribute(k.DATA_ATTR.DATA_BIND);v=c.parser.parseOptions(g);f=c.getElementView(a);e.addObj(f);m=0;for(r=v.length;m<r;m+=1)g=c._getBindingOption(v[m],f,null),d=c.bind(g),g.target=null,e.addObj(d)}});return e},_isDataForm:function(a){if(!a)return!1;
a=a.getAttribute(k.DATA_ATTR.DATA_VIEW);if(!a)return!1;a=this.parser.parseOptions(a);return 0<a.length&&"dataform"===a[0].name},_isInsideDataForm:function(a){if(!a)return!1;a=a.parentNode;var b=d.document;return a&&a!==b?this._isDataForm(a)?!0:this._isInsideDataForm(a):!1},_bindElements:function(a,b,c){var g=this;a=a||d.document;var e=Array.fromList(a.querySelectorAll(g._TEMPLATES_DATA_BIND_SELECTOR));a=Array.fromList(a.querySelectorAll(g._DATA_BIND_SELECTOR));var l=d.getType("LifeTimeScope").create();
a.forEach(function(a){var d,m;if(!(-1<e.indexOf(a))&&(c||!g._isInsideDataForm(a))){if(!c&&(a.hasAttribute(k.DATA_ATTR.DATA_APP)&&(d=a.getAttribute(k.DATA_ATTR.DATA_APP)),d&&g.appName!==d||!d&&"default"!==g.appName))return;d=a.getAttribute(k.DATA_ATTR.DATA_BIND);a=g.getElementView(a);l.addObj(a);d=g.parser.parseOptions(d);for(var r=0,t=d.length;r<t;r+=1)m=g._getBindingOption(d[r],a,b),m=g.bind(m),l.addObj(m)}});return l},_getContent:function(a,b,c,g,e){if(b.templateInfo)a=a.create(c,b.templateInfo,
g,e);else if(b.bindingInfo)a=a.create(c,b,g,e);else throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"options","bindingInfo"));return a},_getContentType:function(a){if(a.templateInfo)a=this.getType("TemplateContent");else if(a.bindingInfo)a=this.getType("BindingContentFactory").getContentType(a);else throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"options","bindingInfo"));return a},_parseContentAttr:function(a){var b={templateInfo:null,bindingInfo:null,displayInfo:null,fieldName:null};
a=this.parser.parseOptions(a);if(0===a.length)return b;a=a[0];!a.template&&a.fieldName?(a.bindingInfo={target:null,source:null,targetPath:null,sourcePath:a.fieldName,mode:"OneWay",converter:null,converterParam:null},a.displayInfo=a.css):a.template&&(a.templateInfo=a.template,delete a.template);return f.extend(!0,b,a)},setUpBindings:function(){var a=d.document;this.destroyBindings();this._lftmBind=this._bindElements(a,this,!1)},destroyBindings:function(){this._lftmBind&&(this._lftmBind.destroy(),this._lftmBind=
null)},registerElView:function(a,b){this.types._elViews[a]||(this.types._elViews[a]=b)},getElementView:function(a){var b,c,g;if(c=this._getElView(a))return c;if(a.hasAttribute(k.DATA_ATTR.DATA_VIEW)&&(c=a.getAttribute(k.DATA_ATTR.DATA_VIEW),(c=this.parser.parseOptions(c))&&0<c.length)){c=c[0];if(c.name&&"default"!==c.name&&(b=this._getElViewType(c.name),!b))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_ELVIEW_NOT_REGISTERED,c.name));c.options&&(g=c.options)}if(!b){c=a.nodeName.toLowerCase();switch(c){case "input":b=
a.getAttribute("type");c=c+":"+b;b=this._getElViewType(c);break;default:b=this._getElViewType(c)}if(!b)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_ELVIEW_NOT_CREATED,c));}return c=b.create(a,g||{})},findGrid:function(a){for(var b=this._types._grids,c=f.getProps(b),g,e=0;e<c.length;++e)if(g=c[e],b[g].name===a)return b[g];return null},bind:function(a){var b=k.BINDING_MODE;a=f.extend(!1,{target:null,source:null,targetPath:null,sourcePath:null,mode:"OneWay",converter:null,converterParam:null,isSourceFixed:!1},
a);if(!a.target)throw Error(RIAPP.ERRS.ERR_BIND_TARGET_EMPTY);if(!f.check_is.String(a.targetPath))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_BIND_TGTPATH_INVALID,a.targetPath));if(0>b.indexOf(a.mode))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_BIND_MODE_INVALID,a.mode));if(!RIAPP.BaseObject.isPrototypeOf(a.target))throw Error(RIAPP.ERRS.ERR_BIND_TARGET_INVALID);return this.getType("Binding").create(a)},registerType:function(a,b){return d._registerType(this,a,b)},getType:function(a){var b=d._getType(this,
a);b||(b=d._getType(this.global,a));return b},startUp:function(a){var b=this,c=b.options.metadata;try{if(!f.check_is.Function(a))throw Error(RIAPP.ERRS.ERR_APP_SETUP_INVALID);Object.freeze(b.options);Object.seal(b);b.options.createDbContext?(b._dbContext=b.getType("DbContext").create(),b._dbContext.addHandler("define_calc",function(e,a){b._onGetCalcField(a)}),b._dbContext.initialize({serviceUrl:b.options.service_url,metadata:c}),b._dbContext.waitForInitialized(function(){a.apply(b,[b]);b.setUpBindings()},
null)):(a.apply(b,[b]),b.setUpBindings())}catch(g){d.reThrow(g,b._onError(g,b))}},registerModule:function(a,b){if(h._userModules[a])throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_MODULE_ALREDY_REGISTERED,a));h._userModules[a]=b}},{parser:{get:function(){return this._parser}},instanceNum:{get:function(){return this._instanceNum}},appName:{get:function(){return this.options.app_name}},types:{get:function(){return this._types}},global:{get:function(){return this._global}},dbContext:{get:function(){return this._dbContext}},
UC:{get:function(){return this._userCode}},VM:{get:function(){return this._viewModels}},localizable:{get:function(){return RIAPP.localizable}}},function(a){d.registerType("Application",a)});RIAPP.Application=h};RIAPP.global=RIAPP.Global.create(window,jQuery,[]);
RIAPP.Application._coreModules.parser=function(d){var f=d.global.utils,k=f.str,h=RIAPP.BaseObject.extend({__trimOuterBracesRX:/^([{]){0,1}|([}]){0,1}$/g,__trimQuotsRX:/^(['"])+|(['"])+$/g,__trimBracketsRX:/^(\[)+|(\])+$/g,__indexedPropRX:/(^\w+)\s*\[\s*['"]?\s*([^'"]+)\s*['",]?\s*\]/i,__valueDelimeter1:":",__valueDelimeter2:"=",__keyValDelimeter:",",_getPathParts:function(a){var b=this,c=[];(!a?[]:a.split(".")).forEach(function(a){var e;(e=a.match(b.__indexedPropRX))?(a=e[1],e=e[2],c.push(a),c.push("["+
e+"]")):c.push(a)});return c},_resolveProp:function(a,b){return!b?a:k.startsWith(b,"[")?(b=this.trimQuotes(this.trimBrackets(b)),d.getType("Dictionary").isPrototypeOf(a)?a.getItemByKey(b):d.getType("Collection").isPrototypeOf(a)?a.getItemByPos(parseInt(b,10)):RIAPP.utils.isArray(a)?a[parseInt(b,10)]:a[b]):a[b]},_resolvePath:function(a,b){return!a?void 0:0===b.length?a:1===b.length?this._resolveProp(a,b[0]):this._resolvePath(this._resolveProp(a,b[0]),b.slice(1))},_setPropertyValue:function(a,b,c){RIAPP.utils.startsWith(b,
"[")?(b=this.trimQuotes(this.trimBrackets(b)),RIAPP.utils.isArray(a)?a[parseInt(b,10)]=c:a[b]=c):a[b]=c},_getKeyVals:function(a){var b,c,g,e=[],d={key:"",val:""},n=!0,h=this.__valueDelimeter1,m=this.__valueDelimeter2,r=this.__keyValDelimeter,t=function(a){a.val&&(f.check_is.Numeric(a.val)?a.val=Number(a.val):f.check_is.BoolString(a.val)&&(a.val=f.parseBool(a.val)));e.push(a)};for(b=0;b<a.length;b+=1){c=a.charAt(b);if("'"===c||'"'===c)g?g===c&&(g=null):g=c;!g&&"{"===c&&!n?(c=a.substr(b),c=this.getBraceParts(c,
!0)[0],d.val+=c,b+=c.length-1):!g&&c===r?d.key&&(t(d),d={key:"",val:""},n=!0):!g&&(c===h||c===m)?n=!1:n?d.key+=c:d.val+=c}d.key&&t(d);e.forEach(function(e){e.key=k.trim(e.key);f.check_is.String(e.val)&&(e.val=k.trim(e.val));""===e.val&&k.startsWith(e.key,"this.")&&(e.val=e.key.substr(5),e.key="targetPath")});return e=e.filter(function(e){return""!==e.val})},resolveBindingSource:function(a,b){if(a){if(0===b.length)return a;if(0<b.length)return this.resolveBindingSource(this._resolveProp(a,b[0]),b.slice(1));
throw Error("Invalid operation");}},resolvePath:function(a,b){if(!b)return a;var c=this._getPathParts(b);return this._resolvePath(a,c)},getBraceParts:function(a,b){var c,g="",e,d,f=0,h=[];for(c=0;c<a.length;c+=1){e=a.charAt(c);if("'"===e||'"'===e)d?d===e&&(d=null):d=e;if(!d&&"{"===e)f+=1,g+=e;else if(!d&&"}"===e){if(f-=1,g+=e,0===f&&(h.push(g),g="",b))break}else 0<f&&(g+=e)}return h},trimOuterBraces:function(a){return k.trim(a.replace(this.__trimOuterBracesRX,""))},trimQuotes:function(a){return k.trim(a.replace(this.__trimQuotsRX,
""))},trimBrackets:function(a){return k.trim(a.replace(this.__trimBracketsRX,""))},isWithOuterBraces:function(a){return k.startsWith(a,"{")&&k.endsWith(a,"}")},parseOption:function(a){var b={},c=this;a=k.trim(a);c.isWithOuterBraces(a)&&(a=c.trimOuterBraces(a));c._getKeyVals(a).forEach(function(a){var e=f.check_is.String(a.val);e&&c.isWithOuterBraces(a.val)?b[a.key]=c.parseOption(a.val):b[a.key]=e?c.trimQuotes(a.val):a.val});return b},parseOptions:function(a){var b=[],c=this;a=k.trim(a);var d=[a];
c.isWithOuterBraces(a)&&(d=c.getBraceParts(a,!1));d.forEach(function(e){b.push(c.parseOption(e))});return b}},null);d._parser=h.create()};
RIAPP.Application._coreModules.collection=function(d){var f=d.global,k=f.utils,h=f.consts,a,b,c,g=f.getType("ValidationError");f.registerType("BaseObject",RIAPP.BaseObject);b=RIAPP.BaseObject.extend({_app:d,_create:function(){this._super();this._fkey=null;this._isEditing=!1;this._saveVals=null;this._vals={};this._notEdited=!0},_getEventNames:function(){var e=this._super();return["errors_changed"].concat(e)},_onError:function(e,a){var b=this._super(e,a);return!b?this._collection._onError(e,a):b},_beginEdit:function(){var e=
this._collection;if(e.isEditing){var a=e._EditingItem;if(a===this)return!1;try{a.endEdit(),a.getIsHasErrors()&&(this._onError(g.create(a.getAllErrors(),a),a),a.cancelEdit())}catch(b){e=this._onError(b,a),a.cancelEdit(),f.reThrow(b,e)}}this._isEditing=!0;this._saveVals=k.extend(!0,{},this._vals);this._collection.currentItem=this;return!0},_endEdit:function(){if(!this._isEditing)return!1;var e,a=this._collection;if(this.getIsHasErrors())return!1;a._removeAllErrors(this);e=this._validateAll();0<e.length&&
a._addErrors(this,e);if(this.getIsHasErrors())return!1;this._isEditing=!1;this._saveVals=null;return!0},_validate:function(){return this._collection._validateItem(this)},_skipValidate:function(e,a){return!1},_validateField:function(e){var a,b=this.getFieldInfo(e),c=null;try{a=this._vals[e];if(this._skipValidate(b,a))return c;if(this._isNew){if(null===a&&!b.isNullable&&!b.isReadOnly&&!b.isAutoGenerated)throw Error(RIAPP.ERRS.ERR_FIELD_ISNOT_NULLABLE);}else if(null===a&&!b.isNullable&&!b.isReadOnly)throw Error(RIAPP.ERRS.ERR_FIELD_ISNOT_NULLABLE);
}catch(m){c={fieldName:e,errors:[m.message]}}e=this._collection._validateItemField(this,e);c&&e?c.errors=c.errors.concat(e.errors):e&&(c=e);return c},_validateAll:function(){var e=this,a=[];this.getFieldNames().forEach(function(b){(b=e._validateField(b))&&a.push(b)});var b=e._validate();b&&a.push(b);return a},_checkVal:function(e,a){var b=h.DATA_TYPE,c=a,m=RIAPP.ERRS;if(this._skipValidate(e,a))return c;if(e.isReadOnly&&(!e.allowClientDefault||!this._isNew))throw Error(m.ERR_FIELD_READONLY);if((null===
a||k.check_is.String(a)&&!a)&&!e.isNullable)throw Error(m.ERR_FIELD_ISNOT_NULLABLE);if(null===a)return a;switch(e.dataType){case b.None:break;case b.Guid:case b.Binary:case b.String:if(!k.check_is.String(a))throw Error(String.format(m.ERR_FIELD_WRONG_TYPE,a,"String"));if(0<e.maxLength&&a.length>e.maxLength)throw Error(String.format(m.ERR_FIELD_MAXLEN,e.maxLength));e.isNullable&&""===a&&(c=null);if(e.regex&&!RegExp(e.regex,"i").test(a))throw Error(String.format(m.ERR_FIELD_REGEX,a));break;case b.Bool:if(!k.check_is.Boolean(a))throw Error(String.format(m.ERR_FIELD_WRONG_TYPE,
a,"Boolean"));break;case b.Integer:case b.Decimal:case b.Float:if(!k.check_is.Number(a))throw Error(String.format(m.ERR_FIELD_WRONG_TYPE,a,"Number"));e.range&&k.checkNumRange(Number(a),e.range);break;case b.DateTime:case b.Date:if(!k.check_is.Date(a))throw Error(String.format(m.ERR_FIELD_WRONG_TYPE,a,"Date"));e.range&&k.checkDateRange(a,e.range);break;case b.Time:if(!k.check_is.Date(a))throw Error(String.format(m.ERR_FIELD_WRONG_TYPE,a,"Time"));break;default:throw Error(String.format(m.ERR_PARAM_INVALID,
"dataType",e.dataType));}return c},_onErrorsChanged:function(a){this.raiseEvent("errors_changed",a)},_resetIsNew:function(){},getFieldInfo:function(a){return this._collection.getFieldInfo(a)},getFieldNames:function(){return this._collection.getFieldNames()},addOnItemErrorsChanged:function(a,b){this.addHandler("errors_changed",a,b)},getFieldErrors:function(a){var b=this._collection._getErrors(this);if(!b)return[];var c=a;a||(a="*");if(!b[a])return[];"*"===a&&(c=null);return[{fieldName:c,errors:b[a]}]},
getAllErrors:function(){var a=this._collection._getErrors(this);if(!a)return[];var b=[];k.forEachProp(a,function(c){var d=null;"*"!==c&&(d=c);b.push({fieldName:d,errors:a[c]})});return b},getErrorString:function(){var a=this._collection._getErrors(this);if(!a)return"";var b=[];k.forEachProp(a,function(c){b.push(String.format("{0}: {1}",c,a[c]))});return b.join("|")},_onAttaching:function(){},_onAttach:function(){},beginEdit:function(){var a=this._collection;if(!this._beginEdit())return!1;a._onEditing(this,
!0,!1);this.raisePropertyChanged("isEditing");return!0},endEdit:function(){var a=this._collection;if(!this._endEdit())return!1;a._onEditing(this,!1,!1);this._notEdited=!1;this.raisePropertyChanged("isEditing");return!0},cancelEdit:function(){if(!this._isEditing)return!1;var a=this._collection,b=this._isNew,c=this._saveVals;this._vals=this._saveVals;this._saveVals=null;a._removeAllErrors(this);a.getFieldNames().forEach(function(a){c[a]!==this._vals[a]&&this.raisePropertyChanged(a)},this);b&&this._notEdited&&
a.removeItem(this);this._isEditing=!1;a._onEditing(this,!1,!0);this.raisePropertyChanged("isEditing");return!0},deleteItem:function(){var a=this._collection;if(null===this._key||!a._onItemDeleting(this))return!1;a.removeItem(this);return!0},getIsNew:function(){return this._isNew},getIsDeleted:function(){return this._isDeleted},getKey:function(){return this._key},getCollection:function(){return this._collection},getIsEditing:function(){return this._isEditing},getIsHasErrors:function(){return!!this._collection._getErrors(this)},
destroy:function(){this._saveVals=this._fkey=null;this._vals={};this._isEditing=!1;this._super()}},{_isNew:{get:function(){return!1}},_isDeleted:{get:function(){return!1}},_key:{set:function(a){null!==a&&(a=""+a);this._fkey=a},get:function(){return this._fkey}},_collection:{get:function(){return null}},_isUpdating:{get:function(){var a=this._collection;return!a?!1:a.isUpdating}},isEditing:{get:function(){return this._isEditing}}},function(a){d.registerType("CollectionItem",a)});a=RIAPP.BaseObject.extend({_app:d,
_create:function(){this._super();this._options={};this._isLoading=!1;this._options.enablePaging=!1;this._options.pageSize=10;this._EditingItem=null;this._perms={canAddRow:!0,canEditRow:!0,canDeleteRow:!0,canRefreshRow:!1};this._pageIndex=this._totalCount=0;this._items=[];this._itemsByKey={};this._currentPos=-1;this._newKey=0;this._fieldMap={};this._errors={};this._ignoreChangeErrors=!1;this._pkInfo=null;this._isUpdating=!1;this._waitQueue=f.getType("WaitQueue").create(this)},_getEventNames:function(){var a=
this._super();return"begin_edit end_edit fill coll_changed item_deleting item_adding item_added validate current_changing page_changing errors_changed status_changed clearing cleared commit_changes".split(" ").concat(a)},_getStrValue:function(a,b){var c=b.dateConversion,d=k.get_timeZoneOffset();return k.stringifyValue(a,c,d)},_getPKFieldInfos:function(){if(this._pkInfo)return this._pkInfo;var a=this._fieldMap,b=[];k.forEachProp(a,function(c){0<a[c].isPrimaryKey&&b.push(a[c])});b.sort(function(a,e){return a.isPrimaryKey-
e.isPrimaryKey});return this._pkInfo=b},_onError:function(a,b){var c=this._super(a,b);return!c?this._app._onError(a,b):c},_onCurrentChanging:function(a){try{this.endEdit()}catch(b){f.reThrow(b,this._onError(b,this))}this.raiseEvent("current_changing",{newCurrent:a})},_onCurrentChanged:function(){this.raisePropertyChanged("currentItem")},_onEditing:function(a,b,c){this._isUpdating||(b?(this._EditingItem=a,this.raiseEvent("begin_edit",{item:a})):(this._EditingItem=null,this.raiseEvent("end_edit",{item:a,
isCanceled:c})))},_onCommitChanges:function(a,b,c,d){this.raiseEvent("commit_changes",{item:a,isBegin:b,isRejected:c,changeType:d})},_onItemStatusChanged:function(a,b){this.raiseEvent("status_changed",{item:a,oldChangeType:b,key:a._key})},_validateItem:function(a){a={item:a,fieldName:null,errors:[]};this.raiseEvent("validate",a);return a.errors&&0<a.errors.length?{fieldName:null,errors:a.errors}:null},_validateItemField:function(a,b){var c={item:a,fieldName:b,errors:[]};this.raiseEvent("validate",
c);return c.errors&&0<c.errors.length?{fieldName:b,errors:c.errors}:null},_addErrors:function(a,b){var c=this;this._ignoreChangeErrors=!0;try{b.forEach(function(b){c._addError(a,b.fieldName,b.errors)})}finally{this._ignoreChangeErrors=!1}this._onErrorsChanged(a)},_addError:function(a,b,c){b||(b="*");k.check_is.Array(c)&&0<c.length?(this._errors[a._key]||(this._errors[a._key]={}),this._errors[a._key][b]=c,this._ignoreChangeErrors||this._onErrorsChanged(a)):this._removeError(a,b)},_removeError:function(a,
b){var c=this._errors[a._key];c&&(b||(b="*"),c[b]&&(delete c[b],0===k.getProps(c).length&&delete this._errors[a._key],this._onErrorsChanged(a)))},_removeAllErrors:function(a){this._errors[a._key]&&(delete this._errors[a._key],this._onErrorsChanged(a))},_getErrors:function(a){return this._errors[a._key]},_onErrorsChanged:function(a){var b={item:a};this.raiseEvent("errors_changed",b);a._onErrorsChanged(b)},_onItemDeleting:function(a){a={item:a,isCancel:!1};this.raiseEvent("item_deleting",a);return!a.isCancel},
_onFillStart:function(a){this.raiseEvent("fill",a)},_onFillEnd:function(a){this.raiseEvent("fill",a)},_onItemsChanged:function(a){this.raiseEvent("coll_changed",a)},_onItemAdding:function(a){a={item:a,isCancel:!1};this.raiseEvent("item_adding",a);a.isCancel&&f._throwDummy(Error("operation canceled"))},_onItemAdded:function(a){this.raiseEvent("item_added",{item:a,isAddNewHandled:!1})},_createNew:function(){throw Error("Not implemented");},_attach:function(a,b){if(this._itemsByKey[a._key])throw Error(RIAPP.ERRS.ERR_ITEM_IS_ATTACHED);
try{this.endEdit()}catch(c){f.reThrow(c,this._onError(c,this))}var d;a._onAttaching();k.check_is.nt(b)?(d=this._items.length,this._items.push(a)):(d=b,this._items.splice(d,0,a));this._itemsByKey[a._key]=a;this._onItemsChanged({change_type:h.COLL_CHANGE_TYPE.ADDED,items:[a],pos:[d]});a._onAttach();this.raisePropertyChanged("count");this._onCurrentChanging(a);this._currentPos=d;this._onCurrentChanged();return d},_onRemoved:function(a,b){var c=h.COLL_CHANGE_TYPE;try{this._onItemsChanged({change_type:c.REMOVE,
items:[a],pos:[b]})}finally{this.raisePropertyChanged("count")}},_onPageSizeChanged:function(){},_onPageChanging:function(){var a={page:this.pageIndex,isCancel:!1};this._raiseEvent("page_changing",a);if(!a.isCancel)try{this.endEdit()}catch(b){f.reThrow(b,this._onError(b,this))}return!a.isCancel},_onPageChanged:function(){},_setCurrentItem:function(a){var b=this._currentPos;if(a){if(null===a._key)throw Error(RIAPP.ERRS.ERR_ITEM_IS_DETACHED);var c,d;if(!this.getItemByKey(a._key))throw Error(RIAPP.ERRS.ERR_ITEM_IS_NOTFOUND);
c=this.getItemByPos(b);d=this._items.indexOf(a);if(0>d)throw Error(RIAPP.ERRS.ERR_ITEM_IS_NOTFOUND);if(b!==d||c!==a)this._onCurrentChanging(a),this._currentPos=d,this._onCurrentChanged()}else-1!==b&&(this._onCurrentChanging(null),this._currentPos=-1,this._onCurrentChanged())},_destroyItems:function(){this._items.forEach(function(a){a.destroy()})},getFieldInfo:function(a){return this._fieldMap[a]},getFieldNames:function(){return k.getProps(this._fieldMap)},cancelEdit:function(){this.isEditing&&this._EditingItem.cancelEdit()},
endEdit:function(){var a;this.isEditing&&(a=this._EditingItem,!a.endEdit()&&a.getIsHasErrors()&&(this._onError(g.create(a.getAllErrors(),a),a),this.cancelEdit()))},getItemsWithErrors:function(){var a=this,b=[];k.forEachProp(this._errors,function(c){c=a.getItemByKey(c);b.push(c)});return b},addNew:function(){var a,b;a=this._createNew();this._onItemAdding(a);this._attach(a,null);try{this.currentItem=a,a.beginEdit(),this._onItemAdded(a)}catch(c){b=this._onError(c,this),a.cancelEdit(),f.reThrow(c,b)}return a},
getItemByPos:function(a){return 0>a||a>=this._items.length?null:this._items[a]},getItemByKey:function(a){if(!a)throw Error(RIAPP.ERRS.ERR_KEY_IS_EMPTY);return this._itemsByKey[""+a]},findByPK:function(){if(0===arguments.length)return null;var a=k.slice.call(arguments),b=this._getPKFieldInfos(),c=[];1===a.length&&k.check_is.Array(a[0])&&(a=a[0]);if(a.length!==b.length)return null;for(var d=0,m=b.length;d<m;d+=1)c.push(this._getStrValue(a[d],b[d]));a=c.join(";");return this.getItemByKey(a)},moveFirst:function(a){if(0===
this._currentPos)return!1;var b=this.getItemByPos(0);if(!b)return!1;if(a&&b._isDeleted)return this.moveNext(!0);this._onCurrentChanging(b);this._currentPos=0;this._onCurrentChanged();return!0},movePrev:function(a){var b=-1,c=this._currentPos,d=this.getItemByPos(c);d&&(b=c-1);d=this.getItemByPos(b);if(!d)return!1;if(a&&d._isDeleted)return this._currentPos=b,this.movePrev(!0);this._onCurrentChanging(d);this._currentPos=b;this._onCurrentChanged();return!0},moveNext:function(a){var b=-1,c=this._currentPos,
d=this.getItemByPos(c);d&&(b=c+1);d=this.getItemByPos(b);if(!d)return!1;if(a&&d._isDeleted)return this._currentPos=b,this.moveNext(!0);this._onCurrentChanging(d);this._currentPos=b;this._onCurrentChanged();return!0},moveLast:function(a){var b=this._items.length-1;if(this._currentPos===b)return!1;var c=this.getItemByPos(b);if(!c)return!1;if(a&&c._isDeleted)return this.movePrev(!0);this._onCurrentChanging(c);this._currentPos=b;this._onCurrentChanged();return!0},goTo:function(a){if(this._currentPos===
a)return!1;var b=this.getItemByPos(a);if(!b)return!1;this._onCurrentChanging(b);this._currentPos=a;this._onCurrentChanged();return!0},forEach:function(a,b){this._items.forEach(a,b)},removeItem:function(a){if(null===a._key)throw Error(RIAPP.ERRS.ERR_ITEM_IS_DETACHED);if(this._itemsByKey[a._key]){var b=this._items.indexOf(a);if(0>b)throw Error(RIAPP.ERRS.ERR_ITEM_IS_NOTFOUND);this._items.splice(b,1);delete this._itemsByKey[a._key];delete this._errors[a._key];this._onRemoved(a,b);a._key=null;a.removeHandler(null,
null);a=this.getItemByPos(b);var c=this._currentPos;c===b&&(a||(this._currentPos=c-1),this._onCurrentChanged());c>b&&(this._currentPos=c-1,this._onCurrentChanged())}},getIsHasErrors:function(){return!this._errors?!1:0<k.getProps(this._errors).length},sortLocal:function(a,b){var c=1;b&&"DESC"===b.toUpperCase()&&(c=-1);this.sortLocalByFunc(function(b,m){var r=0,d,g,f;d=0;for(g=a.length;d<g&&!(f=a[d],r=b[f],f=m[f],r=r<f?-1*c:r>f?c:0,0!==r);d+=1);return r})},sortLocalByFunc:function(a){this.waitForNotLoading(function(){var b=
this.currentItem;this.isLoading=!0;try{this._items.sort(a),this._onItemsChanged({change_type:h.COLL_CHANGE_TYPE.RESET,items:[]})}finally{this.isLoading=!1}this.currentItem=null;this.currentItem=b},[],!1,null)},clear:function(){this.raiseEvent("clearing",{});this.cancelEdit();this._EditingItem=null;this._newKey=0;this.currentItem=null;this._destroyItems();this._items=[];this._itemsByKey={};this._errors={};this._onItemsChanged({change_type:h.COLL_CHANGE_TYPE.RESET,items:[]});this.raiseEvent("cleared",
{});this.raisePropertyChanged("count")},destroy:function(){this._waitQueue&&(this._waitQueue.destroy(),this._waitQueue=null,this.clear(),this._fieldMap={},this._super())},waitForNotLoading:function(a,b,c,d){this._waitQueue.enQueue({prop:"isLoading",groupName:null,predicate:function(a){return!a},action:a,actionArgs:b,lastWins:!!d,syncCheck:!!c})}},{app:{get:function(){return this._app}},options:{get:function(){return this._options}},currentItem:{set:function(a){this._setCurrentItem(a)},get:function(){return this.getItemByPos(this._currentPos)}},
count:{get:function(){return this._items.length}},totalCount:{set:function(a){a!=this._totalCount&&(this._totalCount=a,this.raisePropertyChanged("totalCount"),this.raisePropertyChanged("pageCount"))},get:function(){return this._totalCount}},pageSize:{set:function(a){this._options.pageSize!==a&&(this._options.pageSize=a,this.raisePropertyChanged("pageSize"),this._onPageSizeChanged())},get:function(){return this._options.pageSize}},pageIndex:{set:function(a){a!==this._pageIndex&&this.isPagingEnabled&&
!(0>a)&&this._onPageChanging()&&(this._pageIndex=a,this._onPageChanged(),this.raisePropertyChanged("pageIndex"))},get:function(){return this._pageIndex}},items:{get:function(){return this._items}},isPagingEnabled:{get:function(){return this._options.enablePaging}},permissions:{get:function(){return this._perms}},isEditing:{get:function(){return!!this._EditingItem}},isLoading:{set:function(a){this._isLoading!==a&&(this._isLoading=a,this.raisePropertyChanged("isLoading"))},get:function(){return this._isLoading}},
isUpdating:{set:function(a){this._isUpdating!==a&&(this._isUpdating=a,this.raisePropertyChanged("isUpdating"))},get:function(){return this._isUpdating}},pageCount:{get:function(){var a=this.totalCount,b=this.pageSize;return 0===a||0===b?0:0===a%b?a/b:a=Math.floor(a/b)+1}}},function(a){d.registerType("Collection",a)});a.getEmptyFieldInfo=function(a){return{isPrimaryKey:0,isRowTimeStamp:!1,dataType:h.DATA_TYPE.NONE,isNullable:!0,maxLength:-1,isReadOnly:!1,isAutoGenerated:!1,allowClientDefault:!1,dateConversion:h.DATE_CONVERSION.NONE,
isClientOnly:!0,isCalculated:!1,isNeedOriginal:!1,dependentOn:null,range:null,regex:null,isNavigation:!1,fieldName:a}};c=b.extend({_create:function(a){this._super();this.__isNew=!a;a&&(this._vals=a);a||this._collection.getFieldNames().forEach(function(a){this._vals[a]=null},this)},_setProp:function(a,b){var c,d=this._collection;if(this._vals[a]!==b)try{if(this._vals[a]=b,this.raisePropertyChanged(a),d._removeError(this,a),c=this._validateField(a))throw g.create([c],this);}catch(m){throw c=g.isPrototypeOf(m)?
m:g.create([{fieldName:a,errors:[m.message]}],this),d._addError(this,a,c.errors[0].errors),c;}},_getProp:function(a){return this._vals[a]},_resetIsNew:function(){this.__isNew=!1}},{_isNew:{get:function(){return this.__isNew}},_collection:{get:function(){return this.__coll}}},function(a){d.registerType("ListItem",a)});a.extend({_create:function(a,b){this._super();this._type_name=a;if(RIAPP.utils.isArray(b)){this._props=b;if(0===this._props.length)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,
"properties",b));this._initFieldMap(!1,b)}else if(this._app.getType("CollectionItem").isPrototypeOf(b))this._props=b.getFieldNames(),this._initFieldMap(!0,b);else if(b)this._props=Object.keys(b),this._initFieldMap(!1,b);else throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"properties",b));this._itemType=null;this._createItemType()},_initFieldMap:function(b,c){var d=this;b?this._props.forEach(function(a){d._fieldMap[a]=k.extend(!1,{},c.getFieldInfo(a))}):this._props.forEach(function(b){d._fieldMap[b]=
a.getEmptyFieldInfo(b)})},_attach:function(a){try{this.endEdit()}catch(b){f.reThrow(b,this._onError(b,this))}return this._super(a)},_createNew:function(){var a=this._itemType.create(null);a._key=this._getNewKey(null);return a},_createItemType:function(){var a={};this.getFieldNames().forEach(function(b){a[b]={set:function(a){this._setProp(b,a)},get:function(){return this._getProp(b)}}},this);a._collection={get:function(){return this.__coll}};var b=this._type_name;this._itemType=c.extend({__coll:this},
a,function(a){a._typeName=b+"Item"})},_getNewKey:function(a){a="clkey_"+this._newKey;this._newKey+=1;return a},fillItems:function(a,b){var c=[],d=[],m=[];this._onFillStart({isBegin:!0,rowCount:a.length,time:new Date,isPageChanged:!1});try{b&&this.clear(),a.forEach(function(a){a=this._itemType.create(a);a._key=this._getNewKey(a);var b=this._itemsByKey[a._key];b?m.push(b):(this._items.push(a),this._itemsByKey[a._key]=a,c.push(a),d.push(this._items.length-1),m.push(a))},this),0<c.length&&(this._onItemsChanged({change_type:h.COLL_CHANGE_TYPE.ADDED,
items:c,pos:d}),this.raisePropertyChanged("count"))}finally{this._onFillEnd({isBegin:!1,rowCount:m.length,time:new Date,resetUI:!!b,fetchedItems:m,newItems:c,isPageChanged:!1})}this.moveFirst()},getNewObjects:function(){return this._items.filter(function(a){return a._isNew})},resetNewObjects:function(){this._items.forEach(function(a){a._resetIsNew()})}},null,function(a){d.registerType("List",a)}).extend({_create:function(a,b,c){if(!c)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"keyName",
c));this._keyName=c;this._super(a,b);a=this.getFieldInfo(c);if(!a)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DICTKEY_IS_NOTFOUND,c));a.isPrimaryKey=1},_getNewKey:function(a){if(!a)return this._super(null);a=a[this._keyName];if(k.check_is.nt(a))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DICTKEY_IS_EMPTY,this._keyName));return""+a}},null,function(a){d.registerType("Dictionary",a)})};
RIAPP.Application._coreModules.db=function(d){var f=d.global,k=d.getType("CollectionItem"),h=d.getType("Collection"),a,b,c,g=f.utils,e=f.consts,l=f.getType("DataOperationError"),n=f.getType("ValidationError"),s=RIAPP.BaseObject.extend({_create:function(a){this._super();this._query=a;this._cache=[];this._totalCount=0;this._itemsByKey={}},getCachedPage:function(a){var b=this._cache.filter(function(b){return b.pageIndex===a});if(0==b.length)return null;if(1!=b.length)throw Error(String.format(RIAPP.ERRS.ERR_ASSERTION_FAILED,
"res.length == 1"));return b[0]},reindexCache:function(){this._itemsByKey={};for(var a=0;a<this._cache.length;a+=1)this._cache[a].items.forEach(function(a){this._itemsByKey[a._key]=a},this)},getPrevCachedPageIndex:function(a){for(var b=-1,e,c=0;c<this._cache.length;c+=1)e=this._cache[c].pageIndex,e>b&&e<a&&(b=e);return b},getNextRange:function(a){var b=Math.floor((this.loadPageCount-1)/2),e=a+b+(this.loadPageCount-1)%2,b=a-b;a=this.getPrevCachedPageIndex(a);0>b&&(e+=0-b,b=0);b<=a&&(e+=a-b+1,b+=a-
b+1);this._pageCount>this.loadPageCount&&e>this._pageCount-1&&(b-=e-(this._pageCount-1),0>b&&(b=0),e=this._pageCount-1);b<=a&&(e+=a-b+1,b+=a-b+1);a=e-b+1;a<this.loadPageCount&&(e+=this.loadPageCount-a,a=e-b+1);return{start:b,end:e,cnt:a}},fillCache:function(a,b){var e,c=this._itemsByKey,d,g,f=b.length,l,p=this.pageSize;for(d=0;d<this.loadPageCount;d+=1){g=a+d;l=this.getCachedPage(g);l||(l={items:[],pageIndex:g},this._cache.push(l));for(g=0;g<p;g+=1)if(e=d*p+g,e<f)e=b[e],c[e._key]||(l.items.push(e),
c[e._key]=e,e._isCached=!0);else return}},clear:function(){var a,b,e,c,d=this._query.dbSet;for(a=0;a<this._cache.length;a+=1){e=this._cache[a].items;for(b=0;b<e.length;b+=1)if((c=e[b])&&null!==c._key)c._isCached=!1,d.getItemByKey(c._key)||c.destroy()}this._cache=[];this._itemsByKey={}},clearCacheForPage:function(a){var b=this.getCachedPage(a);a=this._query.dbSet;if(b){var e,c,d=this._cache.indexOf(b);e=b.items;for(b=0;b<e.length;b+=1)if((c=e[b])&&null!==c._key)delete this._itemsByKey[c._key],c._isCached=
!1,a.getItemByKey(c._key)||c.destroy();this._cache.splice(d,1)}},hasPage:function(a){for(var b=0;b<this._cache.length;b+=1)if(this._cache[b].pageIndex===a)return!0;return!1},getItemByKey:function(a){return this._itemsByKey[a]},getPageByItem:function(a){a=this._itemsByKey[a._key];if(!a)return-1;for(var b=0;b<this._cache.length;b+=1)if(-1<this._cache[b].items.indexOf(a))return this._cache[b].pageIndex;return-1},destroy:function(){this.clear();this._super()}},{_pageCount:{get:function(){var a=this.totalCount,
b=this.pageSize;return 0===a||0===b?0:0===a%b?a/b:a=Math.floor(a/b)+1}},pageSize:{get:function(){return this._query.pageSize}},loadPageCount:{get:function(){return this._query.loadPageCount}},totalCount:{set:function(a){g.check_is.nt(a)&&(a=0);a!==this._totalCount&&(this._totalCount=a,this.raisePropertyChanged("totalCount"))},get:function(){return this._totalCount}},cacheSize:{get:function(){return this._cache.length}}},function(a){d.registerType("DataCache",a)});b=RIAPP.BaseObject.extend({_app:d,
_create:function(a,b){this._super();this._dbSet=a;this.__queryInfo=b;this._filterInfo={filterItems:[]};this._sortInfo={sortItems:[]};this._isClearPrevData=this._isIncludeTotalCount=!0;this._pageSize=a.pageSize;this._pageIndex=a.pageIndex;this._params={};this._loadPageCount=1;this._isClearCacheOnEveryLoad=!0;this._dataCache=null;this._cacheInvalidated=!1},getFieldInfo:function(a){return this._dbSet.getFieldInfo(a)},getFieldNames:function(){return g.getProps(this._dbSet._fieldMap)},_addSort:function(a,
b){var c=e.SORT_ORDER,d=c.ASC,g=this._sortInfo;b&&"d"===b.toLowerCase().substr(0,1)&&(d=c.DESC);g.sortItems.push({fieldName:a,sortOrder:d});this._cacheInvalidated=!0},_addFilterItem:function(a,b,c){var d=e.FILTER_TYPE,f=d.Equals,f=this.getFieldInfo(a);if(!f)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,this.dbSetName,a));var l=this._serverTimezone,h=f.dateConversion,k=c;g.check_is.Array(k)||(k=[c]);k=Array.clone(k).map(function(a){return g.stringifyValue(a,h,l)});switch(b.toLowerCase()){case "equals":case "=":f=
d.Equals;break;case "noteq":case "!=":case "<>":f=d.NotEq;break;case "between":f=d.Between;if(2!=c.length)throw Error(RIAPP.ERRS.ERR_QUERY_BETWEEN);break;case "startswith":f=d.StartsWith;break;case "endswith":f=d.EndsWith;break;case "contains":f=d.Contains;break;case "gt":case ">":f=d.Gt;break;case "gteq":case ">=":f=d.GtEq;break;case "lt":case "<":f=d.Lt;break;case "lteq":case "<=":f=d.LtEq;break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_QUERY_OPERATOR_INVALID,b));}this._filterInfo.filterItems.push({fieldName:a,
kind:f,values:k});this._cacheInvalidated=!0},where:function(a,b,e){this._addFilterItem(a,b,e);return this},and:function(a,b,e){this._addFilterItem(a,b,e);return this},orderBy:function(a,b){this._addSort(a,b);return this},thenBy:function(a,b){this._addSort(a,b);return this},clearSort:function(){this._sortInfo.sortItems=[];this._cacheInvalidated=!0;return this},clearFilter:function(){this._filterInfo.filterItems=[];this._cacheInvalidated=!0;return this},clearParams:function(){this._params={};this._cacheInvalidated=
!0;return this},_clearCache:function(){this._dataCache&&(this._dataCache.destroy(),this._dataCache=null);this._resetCacheInvalidated()},_getCache:function(){this._dataCache||(this._dataCache=s.create(this));return this._dataCache},_reindexCache:function(){this._dataCache&&this._dataCache.reindexCache()},_isPageCached:function(a){return!this._dataCache?!1:this._dataCache.hasPage(a)},_resetCacheInvalidated:function(){this._cacheInvalidated=!1},destroy:function(){this._clearCache();this._super()}},{_queryInfo:{get:function(){return this.__queryInfo}},
_serverTimezone:{get:function(){return this._dbSet.dbContext.serverTimezone}},entityType:{get:function(){return this._dbSet.entityType}},dbSet:{get:function(){return this._dbSet}},dbSetName:{get:function(){return this._dbSet.dbSetName}},queryName:{get:function(){return this.__queryInfo.methodName}},filterInfo:{get:function(){return this._filterInfo}},sortInfo:{get:function(){return this._sortInfo}},isIncludeTotalCount:{set:function(a){this._isIncludeTotalCount=a},get:function(){return this._isIncludeTotalCount}},
isClearPrevData:{set:function(a){this._isClearPrevData=a},get:function(){return this._isClearPrevData}},pageSize:{set:function(a){this._pageSize!=a&&(this._pageSize=a)},get:function(){return this._pageSize}},pageIndex:{set:function(a){this._pageIndex!=a&&(this._pageIndex=a)},get:function(){return this._pageIndex}},params:{set:function(a){this._params!==a&&(this._params=a,this._cacheInvalidated=!0)},get:function(){return this._params}},isPagingEnabled:{get:function(){return this._dbSet.isPagingEnabled}},
loadPageCount:{set:function(a){1>a&&(a=1);this._loadPageCount!=a&&(this._loadPageCount=a,1===a&&this._clearCache(),this.raisePropertyChanged("loadPageCount"))},get:function(){return this._loadPageCount}},isClearCacheOnEveryLoad:{set:function(a){this._isClearCacheOnEveryLoad!=a&&(this._isClearCacheOnEveryLoad=a,this.raisePropertyChanged("isClearCacheOnEveryLoad"))},get:function(){return this._isClearCacheOnEveryLoad}},isCacheValid:{get:function(){return!!this._dataCache&&!this._cacheInvalidated}}},
function(a){d.registerType("DataQuery",a)});a=k.extend({_create:function(a,b){this._super();this.__changeType=e.CHANGE_TYPE.NONE;this._saveChangeType=this._origVals=this._srvRowKey=null;this.__isCached=this.__isRefreshing=!1;this.getFieldNames().forEach(function(a){this._vals[a]=null},this);this._initRowInfo(a,b);Object.seal(this)},_initRowInfo:function(a,b){if(a){var e=this,c=e._serverTimezone;this._key=this._srvRowKey=a.key;a.values.forEach(function(a,m){var d=b[m],f=e.getFieldInfo(d);if(!f)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,
e._dbSetName,d));d=g.parseValue(a,f.dataType,f.dateConversion,c);e._vals[f.fieldName]=d})}},_checkCanRefresh:function(){if(null===this._key||this._changeType===e.CHANGE_TYPE.ADDED)throw Error(RIAPP.ERRS.ERR_OPER_REFRESH_INVALID);},_refreshValue:function(a,b,c){var d=this.getFieldInfo(b);if(!d)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,this._dbSetName,b));var f,l,h=d.dataType;a=g.parseValue(a,h,d.dateConversion,this._serverTimezone);f=this._vals[b];switch(c){case e.REFRESH_MODE.CommitChanges:g.compareVals(a,
f,h)||(this._vals[b]=a,this._onFieldChanged(d));break;case e.REFRESH_MODE.RefreshCurrent:this._origVals&&(this._origVals[b]=a);this._saveVals&&(this._saveVals[b]=a);g.compareVals(a,f,h)||(this._vals[b]=a,this._onFieldChanged(d));break;case e.REFRESH_MODE.MergeIntoCurrent:this._origVals&&(l=this._origVals[b],this._origVals[b]=a);if((void 0===l||g.compareVals(l,f,h))&&!g.compareVals(a,f,h))this._vals[b]=a,this._onFieldChanged(d);break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,
"refreshMode",c));}},_refreshValues:function(a,b){var c=this,d=e.CHANGE_TYPE,g=this._changeType;this._isDestroyed||(b||(b=e.REFRESH_MODE.RefreshCurrent),a.values.forEach(function(a){4===(a.flags&4)&&c._refreshValue(a.val,a.fieldName,b)}),g===d.UPDATED&&0===this._getStrValues(!0).length&&(this._origVals=null,this._changeType=e.CHANGE_TYPE.NONE))},_onFieldChanged:function(a){this.raisePropertyChanged(a.fieldName);a.dependents&&0<a.dependents.length&&a.dependents.forEach(function(a){this.raisePropertyChanged(a)},
this)},_getStrValues:function(a){var b=this.getFieldNames(),e=this._dbSet;return b.map(function(a){var b=this.getFieldInfo(a);if(b.isClientOnly)return null;var c=e._getStrValue(this._vals[a],b),m=null===this._origVals?c:e._getStrValue(this._origVals[a],b);return m!==c?{val:c,orig:m,fieldName:a,flags:3}:0<b.isPrimaryKey||b.isRowTimeStamp||b.isNeedOriginal?{val:c,orig:m,fieldName:a,flags:2}:{val:null,orig:null,fieldName:a,flags:0}},this).filter(function(b){return!b?!1:a?1===(b.flags&1):!0})},_getRowInfo:function(){return{values:this._getStrValues(!1),
changeType:this._changeType,serverKey:this._srvKey,clientKey:this._key,error:null}},_fldChanging:function(a,b,e){this._origVals||(this._origVals=g.extend(!0,{},this._vals));return!0},_fldChanged:function(a,b,c){b=e.CHANGE_TYPE;if(!a.isClientOnly)switch(this._changeType){case b.NONE:this._changeType=b.UPDATED}this._onFieldChanged(a);return!0},_clearFieldVal:function(a){this._vals[a]=null},_skipValidate:function(a,b){var e=this._dbSet._trackAssocMap[a.fieldName],c=!1;if(e&&null===b)for(var d=0,g=e.length;d<
g&&!(c=!!this._getFieldVal(e[d]));d+=1);return c},_getFieldVal:function(a){return this._vals[a]},_setFieldVal:function(a,b){var e,c=this._dbSetName,d=this._collection,g=RIAPP.ERRS,f=this._vals[a],l=b,p=this.getFieldInfo(a);if(!p)throw Error(String.format(g.ERR_DBSET_INVALID_FIELDNAME,c,a));!this._isEditing&&!this._isUpdating&&this.beginEdit();try{if(l=this._checkVal(p,l),f!=l&&this._fldChanging(p,f,l)&&(this._vals[a]=l,this._fldChanged(p,f,l)),d._removeError(this,a),e=this._validateField(a))throw n.create([e],
this);}catch(u){throw e=n.isPrototypeOf(u)?u:n.create([{fieldName:a,errors:[u.message]}],this),d._addError(this,a,e.errors[0].errors),e;}return!0},_onAttaching:function(){this._super();this.__changeType=e.CHANGE_TYPE.ADDED},_onAttach:function(){this._super();if(null===this._key)throw Error(RIAPP.ERRS.ERR_ITEM_IS_DETACHED);this._dbSet._addToChanged(this)},_beginEdit:function(){if(!this._super())return!1;this._saveChangeType=this._changeType;return!0},_endEdit:function(){if(!this._super())return!1;
this._saveChangeType=null;return!0},deleteItem:function(){return this.deleteOnSubmit()},deleteOnSubmit:function(){var a=this._changeType,b=this._dbSet,c=e.CHANGE_TYPE;if(!b._onItemDeleting(this)||null===this._key)return!1;if(a===c.ADDED)return b.removeItem(this),!0;this._changeType=c.DELETED;return!0},acceptChanges:function(a){var b=this._changeType,c=this._dbSet,d=e.CHANGE_TYPE;null!==this._key&&b!==d.NONE&&(c._onCommitChanges(this,!0,!1,b),b===d.DELETED?c.removeItem(this):(this._origVals=null,this._saveVals&&
(this._saveVals=g.extend(!0,{},this._vals)),this._changeType=d.NONE,c._removeAllErrors(this),a&&this._refreshValues(a,e.REFRESH_MODE.CommitChanges),c._onCommitChanges(this,!1,!1,b)))},rejectChanges:function(){var a=this._changeType,b=this._dbSet,c=e.CHANGE_TYPE;if(null!==this._key&&a!==c.NONE)if(b._onCommitChanges(this,!0,!0,a),a===c.ADDED)b.removeItem(this);else{var d=this._getStrValues(!0);this._origVals&&(this._vals=g.extend(!0,{},this._origVals),this._origVals=null,this._saveVals&&(this._saveVals=
g.extend(!0,{},this._vals)));this._changeType=c.NONE;b._removeAllErrors(this);d.forEach(function(a){this._onFieldChanged(b.getFieldInfo(a.fieldName))},this);b._onCommitChanges(this,!1,!0,a)}},refresh:function(){return this._dbSet.dbContext._refreshItem(this)},cancelEdit:function(){if(!this._isEditing)return!1;var a=this._getStrValues(!0),b=this._isNew,e=this._dbSet;this._isEditing=!1;this._vals=this._saveVals;this._saveVals=null;this._changeType=this._saveChangeType;this._saveChangeType=null;e._removeAllErrors(this);
a.forEach(function(a){this.raisePropertyChanged(a.fieldName)},this);b&&this._notEdited&&e.removeItem(this);e._onEditing(this,!1,!0);this.raisePropertyChanged("isEditing");return!0},getDbContext:function(){return this._dbSet.dbContext},toString:function(){var a=[];this.getFieldNames().forEach(function(b){a.push(b+": "+this[b])},this);return a.join(" \r\n")},destroy:function(){this._saveChangeType=this._origVals=this._srvRowKey=null;this.__isCached=this.__isRefreshing=!1;this._super()}},{_isNew:{get:function(){return this._changeType===
e.CHANGE_TYPE.ADDED}},_isDeleted:{get:function(){return this._changeType===e.CHANGE_TYPE.DELETED}},_entityType:{get:function(){return this._dbSet.entityType}},_srvKey:{get:function(){return this._srvRowKey}},_dbSetName:{get:function(){return this._dbSet.dbSetName}},_changeType:{set:function(a){if(this.__changeType!==a){var b=this.__changeType;this.__changeType=a;a!==e.CHANGE_TYPE.NONE?this._dbSet._addToChanged(this):this._dbSet._removeFromChanged(this._key);this._dbSet._onItemStatusChanged(this,b)}},
get:function(){return this.__changeType}},_serverTimezone:{get:function(){return this.getDbContext().serverTimezone}},_collection:{get:function(){return this._dbSet}},_isRefreshing:{set:function(a){this.__isRefreshing!==a&&(this.__isRefreshing=a,this.raisePropertyChanged("_isRefreshing"))},get:function(){return this.__isRefreshing}},_isCached:{set:function(a){this.__isCached=a},get:function(){return this.__isCached}},isHasChanges:{get:function(){return this._changeType!==e.CHANGE_TYPE.NONE}}},function(a){d.registerType("Entity",
a)});c=h.extend({_create:function(a){this._super();a=g.extend(!1,{dbContext:null,dbSetInfo:null,childAssoc:[],parentAssoc:[]},a);var b=a.dbSetInfo;this._dbContext=a.dbContext;this._options.dbSetName=b.dbSetName;this._options.enablePaging=b.enablePaging;this._options.pageSize=b.pageSize;this._perms=g.extend(!1,{},b.permissions);this._entityType=this._query=null;this._isSubmitOnDelete=!1;this._trackAssoc={};this._trackAssocMap={};this._childAssocMap={};this._parentAssocMap={};this._changeCount=0;this._changeCache=
{};this._ignorePageChanged=!1;Object.freeze(this._perms);this._createEntityType(b.dbSetName,b.fieldInfos,a.childAssoc,a.parentAssoc)},getFieldInfo:function(a){var b,e=a.split(".");if(1==e.length)return this._fieldMap[a];if(1<e.length&&(b=this._childAssocMap[e[0]]))return b=this.dbContext.getDbSet(b.parentDbSetName),a=e.slice(1).join("."),b.getFieldInfo(a);throw Error(String.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,this.dbSetName,a));},_onError:function(a,b){return this.dbContext._onError(a,b)},
_mapAssocFields:function(){for(var a=this._trackAssoc,b,e=Object.keys(a),c,d=this._trackAssocMap,g=0,f=e.length;g<f;g+=1){b=a[e[g]];for(var l=0,p=b.fieldRels.length;l<p;l+=1)c=b.fieldRels[l],d[c.childField]?d[c.childField].push(b.childToParentName):d[c.childField]=[b.childToParentName]}},_getStrValue:function(a,b){return g.stringifyValue(a,b.dateConversion,this.dbContext.serverTimezone)},_createEntityType:function(b,e,c,d){var f=this,l={};if(!g.check_is.Array(e))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID_TYPE,
"fldInfos","Array"));e.forEach(function(a){var b=g.extend(!1,{},a);b.dependents=[];f._fieldMap[a.fieldName]=b},this);var h=function(a){a.dependentOn.split(",").forEach(function(b){var e=f._fieldMap[b];if(!e)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CALC_FIELD_DEFINE,b));if(a.fieldName===b)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_CALC_FIELD_SELF_DEPEND,b));0>e.dependents.indexOf(a.fieldName)&&e.dependents.push(a.fieldName)})},k=function(a){var b=f._fieldMap[a.fieldName],e=!0,m=c.filter(function(b){return b.childToParentName==
a.fieldName});0===m.length&&(m=d.filter(function(b){return b.parentToChildrenName==a.fieldName}),e=!1);if(1!=m.length)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID_TYPE,"assocs","Array"));b.isClientOnly=!0;b.isReadOnly=!0;var r=function(){throw Error("getFunc is not emplemented!");},g,p=m[0].name;e?(b.isReadOnly=!1,f._childAssocMap[m[0].childToParentName]=m[0],m[0].fieldRels.forEach(function(a){a=f._fieldMap[a.childField];!b.isReadOnly&&a.isReadOnly&&(b.isReadOnly=!0)}),r=function(){return f.dbContext.getAssociation(p).getParentItem(this)},
b.isReadOnly||(f._trackAssoc[p]=m[0],g=function(b){var e,c,m=f.dbContext.getAssociation(p);if(b&&!m.parentDS.entityType.isPrototypeOf(b))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID_TYPE,"value",m.parentDS.entityType._typeName));if(b&&b._isNew)this._setFieldVal(a.fieldName,b._key);else if(b){e=0;for(c=m.childFldInfos.length;e<c;e+=1)this[m.childFldInfos[e].fieldName]=b[m.parentFldInfos[e].fieldName]}else{this._getFieldVal(a.fieldName)&&this._setFieldVal(a.fieldName,null);e=0;for(c=
m.childFldInfos.length;e<c;e+=1)this[m.childFldInfos[e].fieldName]=null}})):(f._parentAssocMap[m[0].parentToChildrenName]=m[0],r=function(){return f.dbContext.getAssociation(p).getChildItems(this)});l[a.fieldName]={set:g,get:r}},p=function(a){l[a.fieldName]={set:function(b){this._setFieldVal(a.fieldName,b)},get:function(){return this._getFieldVal(a.fieldName)}}};e.forEach(function(e){if(g.hasProp(a,e.fieldName))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_ITEM_NAME_COLLISION,b,e.fieldName));if(e.isCalculated){var c=
f.getFieldInfo(e.fieldName);c.isClientOnly=!0;c.isReadOnly=!0;c={dbSetName:b,fieldName:e.fieldName,getFunc:null};f.dbContext._onGetCalcField(c);g.check_is.Function(c.getFunc)&&(e.dependentOn&&h(e),l[e.fieldName]={get:c.getFunc})}else e.isNavigation?k(e):p(e)});l._dbSet={get:function(){return this.__dbSet}};this._entityType=a.extend({__dbSet:f},l,function(a){a._typeName=b+"Entity"});this._mapAssocFields()},_fillFromService:function(a){a=g.extend(!1,{res:{names:[],rows:[],pageIndex:null,pageCount:null,
dbSetName:this.dbSetName,totalCount:null},isPageChanged:!1,fn_beforeFillEnd:null},a);var b=a.res,c=b.names,d=b.rows,f=this._entityType,l=[],h=[],k=[],p=[],u=this.isPagingEnabled,C=e.REFRESH_MODE.RefreshCurrent,n=this.query,s=!0,x;this._onFillStart({isBegin:!0,rowCount:d.length,time:new Date,isPageChanged:a.isPageChanged});try{n&&(s=n.isClearPrevData,n.isClearCacheOnEveryLoad&&n._clearCache(),s&&this.clear(),n._reindexCache(),1<n.loadPageCount&&u&&(x=n._getCache(),n.isIncludeTotalCount&&!g.check_is.nt(b.totalCount)&&
(x.totalCount=b.totalCount)));k=d.map(function(a){var b=a.key;if(!b)throw Error(RIAPP.ERRS.ERR_KEY_IS_EMPTY);var e=this._itemsByKey[b];e?a.values.forEach(function(a,b){e._refreshValue(a,c[b],C)}):(x&&(e=x.getItemByKey(b)),e?a.values.forEach(function(a,b){e._refreshValue(a,c[b],C)}):e=f.create(a,c));return e},this);if(n&&(n.isIncludeTotalCount&&!g.check_is.nt(b.totalCount)&&(this.totalCount=b.totalCount),1<n.loadPageCount&&u)){x.fillCache(b.pageIndex,k);var y=x.getCachedPage(n.pageIndex),k=y?y.items:
[]}k.forEach(function(a){var b=this._itemsByKey[a._key];b?p.push(b):(this._items.push(a),this._itemsByKey[a._key]=a,l.push(a),h.push(this._items.length-1),p.push(a))},this);0<l.length&&(this._onItemsChanged({change_type:e.COLL_CHANGE_TYPE.ADDED,items:l,pos:h}),this.raisePropertyChanged("count"));a.fn_beforeFillEnd&&a.fn_beforeFillEnd()}finally{this._onFillEnd({isBegin:!1,rowCount:p.length,time:new Date,resetUI:s,fetchedItems:p,newItems:l,isPageChanged:a.isPageChanged})}this.moveFirst();return{fetchedItems:p,
newItems:l,isPageChanged:a.isPageChanged}},_fillFromCache:function(a){a=g.extend(!1,{isPageChanged:!1,fn_beforeFillEnd:null},a);var b=[],c=[],d=this.query;if(!d)throw Error(String.format(RIAPP.ERRS.ERR_ASSERTION_FAILED,"query is not null"));d=d._getCache().getCachedPage(d.pageIndex);d=!d?[]:d.items;this._onFillStart({isBegin:!0,rowCount:d.length,time:new Date,isPageChanged:a.isPageChanged});try{this.clear(),this._items=d,d.forEach(function(a,e){this._itemsByKey[a._key]=a;b.push(e);c.push(a)},this),
a.fn_beforeFillEnd&&a.fn_beforeFillEnd(),0<c.length&&(this._onItemsChanged({change_type:e.COLL_CHANGE_TYPE.ADDED,items:c,pos:b}),this.raisePropertyChanged("count"))}finally{this._onFillEnd({isBegin:!1,rowCount:c.length,time:new Date,resetUI:!0,fetchedItems:c,newItems:c,isPageChanged:a.isPageChanged})}this.moveFirst();return{fetchedItems:c,newItems:c,isPageChanged:a.isPageChanged}},_commitChanges:function(a){var b=this,c=e.CHANGE_TYPE,d=e.COLL_CHANGE_TYPE;a.forEach(function(a){var e=a.clientKey,m=
b._itemsByKey[e];if(!m)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_KEY_IS_NOTFOUND,e));var g=m._changeType;m.acceptChanges(a);g===c.ADDED&&(delete b._itemsByKey[e],m._srvRowKey=a.serverKey,m._key=m._srvRowKey,b._itemsByKey[m._key]=m,b._onItemsChanged({change_type:d.REMAP_KEY,items:[m],old_key:e,new_key:m._key}))})},_setItemInvalid:function(a){var b=this._itemsByKey[a.clientKey],e={};a.invalid.forEach(function(a){a.fieldName||(a.fieldName="*");e[a.fieldName]?e[a.fieldName].push(a.message):e[a.fieldName]=
[a.message]});var c=[];g.forEachProp(e,function(a){c.push({fieldName:a,errors:e[a]})});this._addErrors(b,c);return b},_getChanges:function(){var a=[],b=this._changeCache;g.forEachProp(b,function(e){a.push(b[e]._getRowInfo())});return a},_getTrackAssocInfo:function(){var a=this,b=[],e=this._changeCache,c=Object.keys(a._trackAssoc);g.forEachProp(e,function(d){var g=e[d];c.forEach(function(e){var c=g._getFieldVal(a._trackAssoc[e].childToParentName),d=g._key;c&&d&&b.push({assocName:e,parentKey:c,childKey:d})})});
return b},_getNewKey:function(a){a="clkey_"+this._newKey;this._newKey+=1;return a},_createNew:function(){var a=this._entityType.create(null,null);a._key=this._getNewKey(a);return a},_addToChanged:function(a){null!==a._key&&!this._changeCache[a._key]&&(this._changeCache[a._key]=a,this._changeCount+=1,1===this._changeCount&&this.raisePropertyChanged("hasChanges"))},_removeFromChanged:function(a){null!==a&&this._changeCache[a]&&(delete this._changeCache[a],this._changeCount-=1,0===this._changeCount&&
this.raisePropertyChanged("hasChanges"))},_clearChangeCache:function(){var a=this._changeCount;this._changeCache={};this._changeCount=0;a!==this._changeCount&&this.raisePropertyChanged("hasChanges")},_onItemStatusChanged:function(a,b){this._super(a,b);a._isDeleted&&this.isSubmitOnDelete&&this.dbContext.submitChanges()},_onRemoved:function(a,b){this._removeFromChanged(a._key);this._super(a,b)},_onPageChanging:function(){var a=this._super();if(!a)return a;this.hasChanges&&this.rejectChanges();return a},
_onPageChanged:function(){this.cancelEdit();this._super();this._ignorePageChanged||(this.query.pageIndex=this.pageIndex,this.dbContext._load(this.query,!0))},_onPageSizeChanged:function(){this._super();this._query&&(this._query.pageSize=this.pageSize)},_destroyItems:function(){this._items.forEach(function(a){a._isCached?a.removeHandler(null,null):a.destroy()})},fillItems:function(a){a={res:g.extend(!1,{names:[],rows:[],pageIndex:this.query?this.query.pageIndex:null,pageCount:null,dbSetName:this.dbSetName,
totalCount:null},a),isPageChanged:!1,fn_beforeFillEnd:null};this._fillFromService(a)},acceptChanges:function(){var a=this._changeCache;g.forEachProp(a,function(b){a[b].acceptChanges(null)});this._changeCount=0},rejectChanges:function(){var a=this._changeCache;g.forEachProp(a,function(b){a[b].rejectChanges()})},deleteOnSubmit:function(a){a.deleteOnSubmit()},clear:function(){this._clearChangeCache();this._super()},createQuery:function(a){var e=this.dbContext._getQueryInfo(a);if(!e)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_QUERY_NAME_NOTFOUND,
a));return b.create(this,e)},clearCache:function(){var a=this._query;a&&a._clearCache()()},destroy:function(){var a=this._query;this._query=null;a&&a.destroy();this._super()}},{dbContext:{get:function(){return this._dbContext}},dbSetName:{get:function(){return this._options.dbSetName}},entityType:{get:function(){return this._entityType}},query:{get:function(){return this._query}},hasChanges:{get:function(){return 0<this._changeCount}},cacheSize:{get:function(){var a=this._query;return a&&a.isCacheValid?
(a=a._getCache(),a.cacheSize):0}},isSubmitOnDelete:{set:function(a){this._isSubmitOnDelete!==a&&(this._isSubmitOnDelete=!!a,this.raisePropertyChanged("isSubmitOnDelete"))},get:function(){return this._isSubmitOnDelete}}},function(a){d.registerType("DbSet",a)});RIAPP.BaseObject.extend({_app:d,_create:function(){this._super();this._isInitialized=!1;this._dbSets={};this._arrDbSets=[];this._svcMethods={};this._assoc={};this._arrAssoc=[];this._queryInf={};this._serviceUrl=null;this._isBusy=0;this._hasChanges=
this._isSubmiting=!1;this._pendingSubmit=null;this._serverTimezone=g.get_timeZoneOffset();this._waitQueue=f.getType("WaitQueue").create(this)},_onGetCalcField:function(a){this.raiseEvent("define_calc",a)},_getQueryInfo:function(a){return this._queryInf[a]},_initDbSets:function(a){if(this._isInitialized)throw Error(RIAPP.ERRS.ERR_DOMAIN_CONTEXT_INITIALIZED);var b=this,e=this._dbSets;if(!g.check_is.Array(a.dbSets))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID_TYPE,"metadata.dbSets","Array"));
this._serverTimezone=a.serverTimezone;a.dbSets.forEach(function(d){var g=d.dbSetName,f;f=a.associations.filter(function(a){return d.dbSetName==a.childDbSetName});var l=a.associations.filter(function(a){return d.dbSetName==a.parentDbSetName});f=c.create({dbContext:b,dbSetInfo:d,childAssoc:f,parentAssoc:l});b._arrDbSets.push(f);f.addOnPropertyChange("hasChanges",function(a,e){b._onDbSetHasChangesChanged(a)},null);e[g]=f});a.associations.forEach(function(a){b._initAssociation(a)});a.methods.forEach(function(a){a.isQuery?
b._queryInf[a.methodName]=a:b._initMethod(a)});Object.freeze(this._dbSets);Object.freeze(this._svcMethods);Object.freeze(this._queryInf);this._isInitialized=!0;this.raisePropertyChanged("isInitialized")},_onDbSetHasChangesChanged:function(a){var b=this._hasChanges;this._hasChanges=!1;if(a.hasChanges)this._hasChanges=!0;else for(var e=0,c=this._arrDbSets.length;e<c;e+=1)if(a=this._arrDbSets[e],a.hasChanges){this._hasChanges=!0;break}this._hasChanges!==b&&this.raisePropertyChanged("hasChanges")},_initAssociation:function(a){var b=
this,e={dbContext:b,parentName:a.parentDbSetName,childName:a.childDbSetName,onDeleteAction:a.onDeleteAction,parentKeyFields:a.fieldRels.map(function(a){return a.parentField}),childKeyFields:a.fieldRels.map(function(a){return a.childField}),parentToChildrenName:a.parentToChildrenName,childToParentName:a.childToParentName,name:a.name};this._assoc[a.name]=function(){var c=b._app.getType("Association").create(e);b._arrAssoc.push(c);b._assoc[a.name]=function(){return c};return c}},_initMethod:function(a){var b=
this;this._svcMethods[a.methodName]=function(e){var c=g.createDeferred(),d=function(a){a.error?c.reject():c.resolve(a.result)};try{var l=b._getMethodParams(a,e);b._invokeMethod(a,l,d)}catch(h){f._checkIsDummy(h)||(b._onError(h,b),d({result:null,error:h}))}finally{return c.promise()}}},_getMethodParams:function(a,b){var c={methodName:a.methodName,paramInfo:{parameters:[]}},d,f=a.parameters,l=f.length,h,k,p;b||(b={});for(d=0;d<l;d+=1){h=f[d];k=b[h.name];if(!h.isNullable&&!h.isArray&&h.dataType!==e.DATA_TYPE.String&&
g.check_is.nt(k))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_SVC_METH_PARAM_INVALID,h.name,k,a.methodName));if(g.check_is.Function(k))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_SVC_METH_PARAM_INVALID,h.name,k,a.methodName));h.isArray&&(!g.check_is.nt(k)&&!g.check_is.Array(k))&&(k=[k]);p=null;g.check_is.Array(k)?(p=[],k.forEach(function(a){p.push(g.stringifyValue(a,h.dateConversion,self._serverTimezone))}),p=JSON.stringify(p)):p=g.stringifyValue(k,h.dateConversion,self._serverTimezone);c.paramInfo.parameters.push({name:h.name,
value:p})}return c},_invokeMethod:function(a,b,c){var d=this,l=e.DATA_OPER.INVOKE,h,k;this.isBusy=!0;var n=function(a){try{if(!a)throw Error(g.format(RIAPP.ERRS.ERR_UNEXPECTED_SVC_ERROR,"operation result is undefined"));g.checkError(a.error);c({result:a.result,error:null})}catch(b){f._checkIsDummy(b)||(d._onDataOperError(b,l),c({result:null,error:b}))}};try{h=JSON.stringify(b),k=this._getUrl(e.DATA_SVC_METH.Invoke),g.performAjaxCall(k,h,!0,function(a){n(a);d.isBusy=!1},function(a){n({result:null,
error:a});d.isBusy=!1},null)}catch(p){f._checkIsDummy(p)&&f._throwDummy(p),this.isBusy=!1,this._onDataOperError(p,l),c({result:null,error:p}),f._throwDummy(p)}},_getEventNames:function(){var a=this._super();return["submit_error","define_calc"].concat(a)},_loadFromCache:function(a,b){var c=e.DATA_OPER.LOAD,d=a._dbSet,g;try{g=d._fillFromCache({isPageChanged:b,fn_beforeFillEnd:null})}catch(l){f._checkIsDummy(l)&&f._throwDummy(l),this._onDataOperError(l,c),f._throwDummy(l)}return g},_loadIncluded:function(a){var b=
this;a.included&&0<a.included.length&&a.included.forEach(function(a){b.getDbSet(a.dbSetName).fillItems(a,!0)})},_onLoaded:function(a,b){var c=this,d=e.DATA_OPER.LOAD,l,h,k;try{if(!a)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_UNEXPECTED_SVC_ERROR,"null result"));l=a.dbSetName;h=this.getDbSet(l);if(!h)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_NAME_INVALID,l));g.checkError(a.error);k=h._fillFromService({res:a,isPageChanged:b,fn_beforeFillEnd:function(){c._loadIncluded(a)}})}catch(n){f._checkIsDummy(n)&&
f._throwDummy(n),this._onDataOperError(n,d),f._throwDummy(n)}return k},_dataSaved:function(a){var b=this,e=[],c=[];try{try{g.checkError(a.error)}catch(d){throw a.dbSets.forEach(function(a){var d=b._dbSets[a.dbSetName];a.rows.forEach(function(a){var b=d.getItemByKey(a.clientKey);if(!b)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_KEY_IS_NOTFOUND,a.clientKey));e.push(b);a.invalid&&(d._setItemInvalid(a),c.push(b))})}),f.getType("SubmitError").create(d,e,c);}a.dbSets.forEach(function(a){b._dbSets[a.dbSetName]._commitChanges(a.rows)})}catch(l){f._checkIsDummy(l)&&
f._throwDummy(l),this._onSubmitError(l),f._throwDummy(l)}},_getChanges:function(){var a={dbSets:[],error:null,trackAssocs:[]};this._arrDbSets.forEach(function(b){b.endEdit();var e=b._getChanges();if(0!==e.length){var c=b._getTrackAssocInfo();a.dbSets.push({dbSetName:b.dbSetName,rows:e});a.trackAssocs=a.trackAssocs.concat(c)}});return a},_getUrl:function(a){var b=this.service_url;g.str.endsWith(b,"/")||(b+="/");return b+=[a,""].join("/")},_onItemRefreshed:function(a,b){var c=e.DATA_OPER.REFRESH;try{if(g.checkError(a.error),
a.rowInfo)b._refreshValues(a.rowInfo,e.REFRESH_MODE.MergeIntoCurrent);else throw b._dbSet.removeItem(b),b.destroy(),Error(RIAPP.ERRS.ERR_ITEM_DELETED_BY_ANOTHER_USER);}catch(d){f._checkIsDummy(d)&&f._throwDummy(d),this._onDataOperError(d,c),f._throwDummy(d)}},_refreshItem:function(a){var b=g.createDeferred(),c=function(e){e?b.resolve(a):b.reject()},d=this._getUrl(e.DATA_SVC_METH.Refresh),f=a._dbSet;this.waitForNotSubmiting(function(){var b=this;f.waitForNotLoading(function(){var r,l=e.DATA_OPER.REFRESH,
p=function(){b.isBusy=!1;f.isLoading=!1;a._isRefreshing=!1},h=function(a){p();b._onDataOperError(a,l)};a._isRefreshing=!0;b.isBusy=!0;f.isLoading=!0;try{var k={dbSetName:a._dbSetName,rowInfo:a._getRowInfo(),error:null};a._checkCanRefresh();r=JSON.stringify(k);g.performAjaxCall(d,r,!0,function(e){try{b._onItemRefreshed(e,a),p(),c(!0)}catch(d){h(d),c(!1)}},function(a){p();b._onDataOperError(a,l);c(!1)},null)}catch(n){h(n),c(!1)}},[],!0,null)},[],null);return b.promise()},_onError:function(a,b){var e=
this._super(a,b);return!e?this.app?this.app._onError(a,b):f._onError(a,b):e},_onDataOperError:function(a,b){if(f._checkIsDummy(a))return!0;var e;e=l.isPrototypeOf(a)?a:l.create(a,b);return this._onError(e,this)},_onSubmitError:function(a){var b={error:a,isHandled:!1};this.raiseEvent("submit_error",b);b.isHandled||(this.rejectChanges(),this._onDataOperError(a,e.DATA_OPER.SUBMIT))},_loadChunks:function(a,b,e,c){var d=this;g.performAjaxCall(a,b,!0,function(f){try{g.checkError(f.error);var l=f.chunksID&&
0<f.chunksLeft;e.rows=e.rows.concat(f.rows);f.rows=[];e.included&&0<e.included.length&&e.included.forEach(function(a){var b=f.included.filter(function(b){return b.dbSetName==a.dbSetName});1==b.length&&(a.rows=a.rows.concat(b[0].rows))});l?d._loadChunks(a,b,e,c):c(e,null)}catch(h){c(null,h)}},function(a){c(null,a)},null)},_beforeLoad:function(a,b,e){a&&b!==a&&(e._query=a,e.pageIndex=0);b&&b!==a&&b.destroy();if(a.pageSize!==e.pageSize){e._ignorePageChanged=!0;try{e.pageIndex=0,e.pageSize=a.pageSize}finally{e._ignorePageChanged=
!1}}if(a.pageIndex!==e.pageIndex){e._ignorePageChanged=!0;try{e.pageIndex=a.pageIndex}finally{e._ignorePageChanged=!1}}a.isCacheValid||a._clearCache()},_load:function(a,b){if(!a)throw Error(RIAPP.ERRS.ERR_DB_LOAD_NO_QUERY);var c=this,d=g.createDeferred(),f=function(a,b){a?d.resolve(b):d.reject()},l=a.loadPageCount,h=a.pageIndex,k=a.isPagingEnabled,p=a.dbSetName,u=this.getDbSet(p);this.waitForNotSubmiting(function(){u.waitForNotLoading(function(){var d=u.query,v=c._getUrl(e.DATA_SVC_METH.LoadData),
n,s,y=e.DATA_OPER.LOAD,z=function(){u.isLoading=!1;c.isBusy=!1},A=function(a){z();f(!0,a)},D=function(a){z();c._onDataOperError(a,y);f(!1,null)},w;u.isLoading=!0;c.isBusy=!0;try{a.pageIndex=h;c._beforeLoad(a,d,u);var B,d=1;if(1<l&&k){if(a._isPageCached(h)){w=c._loadFromCache(a,b);w.outOfBandData=null;A(w);return}B=a._getCache().getNextRange(h);h=B.start;d=B.cnt}n={dbSetName:p,pageIndex:h,pageSize:a.pageSize,pageCount:d,isIncludeTotalCount:a.isIncludeTotalCount,filterInfo:a.filterInfo,sortInfo:a.sortInfo,
paramInfo:c._getMethodParams(a._queryInfo,a.params).paramInfo,queryName:a.queryName,chunksID:null};s=JSON.stringify(n);g.performAjaxCall(v,s,!0,function(a){try{a.chunksID&&0<a.chunksLeft?(n.chunksID=a.chunksID,n.filterInfo=null,n.sortInfo=null,n.paramInfo=null,s=JSON.stringify(n),c._loadChunks(v,s,a,function(a,e){e?(z(),c._onDataOperError(e,y),f(!1,null)):(w=c._onLoaded(a,b),w.outOfBandData=a.extraInfo,A(w))})):(w=c._onLoaded(a,b),w.outOfBandData=a.extraInfo,A(w))}catch(e){D(e)}},function(a){z();
c._onDataOperError(a,y);f(!1,null)},null)}catch(H){D(H)}},[],!0,b?"paging":null)},[],b?"paging":null);return d.promise()},getDbSet:function(a){if(!this.isInitialized)throw Error(RIAPP.ERRS.ERR_DOMAIN_CONTEXT_NOT_INITIALIZED);var b=this._dbSets[a];if(!b)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_NAME_INVALID,a));return b},getAssociation:function(a){var b=this._assoc[a];if(!b)throw Error(RIAPP.utils.format(RIAPP.ERR_ASSOC_NAME_INVALID,a));return b()},submitChanges:function(){if(this._pendingSubmit)return this._pendingSubmit.deferred.promise();
var a=this,b={deferred:g.createDeferred()},c=function(a){a?b.deferred.resolve():b.deferred.reject()};this._pendingSubmit=b;this.waitForNotBusy(function(){var b,d,f=e.DATA_OPER.SUBMIT,r,l=function(){a.isBusy=!1;a.isSubmiting=!1},p=function(b){l();a._onDataOperError(b,f);c(!1)};try{if(this.isSubmiting=this.isBusy=!0,this._pendingSubmit=null,b=this._getUrl(e.DATA_SVC_METH.Submit),r=this._getChanges(),0===r.dbSets.length){l();c(!0);return}}catch(h){p(h);return}try{d=JSON.stringify(r),g.performAjaxCall(b,
d,!0,function(b){try{a._dataSaved(b),l(),c(!0)}catch(e){p(e)}},function(b){l();a._onSubmitError(b);c(!1)},null)}catch(k){p(k)}},[]);return b.deferred.promise()},load:function(a){return this._load(a,!1)},acceptChanges:function(){this._arrDbSets.forEach(function(a){a.acceptChanges()})},rejectChanges:function(){this._arrDbSets.forEach(function(a){a.rejectChanges()})},initialize:function(a){if(!this._isInitialized){var b=this;a=g.extend(!1,{serviceUrl:null,metadata:null},a);this._serviceUrl=a.serviceUrl;
if(a.metadata)this._initDbSets(a.metadata);else{a=this._getUrl(e.DATA_SVC_METH.InitDbContext);var c=e.DATA_OPER.INIT;try{this.isBusy=!0,g.performAjaxCall(a,void 0,!0,function(a){try{b._initDbSets(a),b.isBusy=!1}catch(e){b.isBusy=!1,b._onDataOperError(e,c),f._throwDummy(e)}},function(a){b.isBusy=!1;b._onDataOperError(a,c)},null)}catch(d){this.isBusy=!1,this._onDataOperError(d,c),f._throwDummy(d)}}}},waitForNotBusy:function(a,b){this._waitQueue.enQueue({prop:"isBusy",groupName:null,predicate:function(a){return!a},
action:a,actionArgs:b})},waitForNotSubmiting:function(a,b,e){this._waitQueue.enQueue({prop:"isSubmiting",predicate:function(a){return!a},action:a,actionArgs:b,groupName:e,lastWins:!!e})},waitForInitialized:function(a,b){this._waitQueue.enQueue({prop:"isInitialized",groupName:"dbContext",predicate:function(a){return!!a},action:a,actionArgs:b})},destroy:function(){this._waitQueue&&(this._waitQueue.destroy(),this._waitQueue=null,this._arrAssoc.forEach(function(a){a.destroy()}),this._arrAssoc=[],this._assoc=
{},this._arrDbSets.forEach(function(a){a.destroy()}),this._arrDbSets=[],this._dbSets={},this._svcMethods={},this._queryInf={},this._serviceUrl=null,this._hasChanges=this._isSubmiting=this._isBusy=this._isInitialized=!1,this._super())}},{app:{get:function(){return this._app}},service_url:{get:function(){return this._serviceUrl}},isInitialized:{get:function(){return this._isInitialized}},isBusy:{set:function(a){var b=0<this._isBusy;a?this._isBusy+=1:(this._isBusy-=1,0>this._isBusy&&(this._isBusy=0));
0<this._isBusy!=b&&this.raisePropertyChanged("isBusy")},get:function(){return 0<this._isBusy}},isSubmiting:{set:function(a){this._isSubmiting!==a&&(this._isSubmiting=a,this.raisePropertyChanged("isSubmiting"))},get:function(){return this._isSubmiting}},serverTimezone:{get:function(){return this._serverTimezone}},dbSets:{get:function(){return this._dbSets}},arrDbSets:{get:function(){return this._arrDbSets}},serviceMethods:{get:function(){return this._svcMethods}},hasChanges:{get:function(){return this._hasChanges}}},
function(a){d.registerType("DbContext",a)});k=h.extend({_create:function(a){this._super();a=g.extend(!1,{dataSource:null,fn_filter:null,fn_sort:null,fn_itemsProvider:null},a);if(!a.dataSource||!h.isPrototypeOf(a.dataSource))throw Error(RIAPP.ERRS.ERR_DATAVIEW_DATASRC_INVALID);if(!a.fn_filter||!g.check_is.Function(a.fn_filter))throw Error(RIAPP.ERRS.ERR_DATAVIEW_FILTER_INVALID);this._dataSource=a.dataSource;this._fn_filter=a.fn_filter;this._fn_sort=a.fn_sort;this._fn_itemsProvider=a.fn_itemsProvider;
this._isAddingNew=this._isDSFilling=!1;var b=this,e=this._dataSource;e.getFieldNames().forEach(function(a){b._fieldMap[a]=g.extend(!1,{},e.getFieldInfo(a))});this._bindDS()},_getEventNames:function(){var a=this._super();return["view_refreshed"].concat(a)},_filterForPaging:function(a){var b=0,e=0,c=-1,d=-1,g=[],b=this.pageSize*this.pageIndex,e=this.pageSize;a.forEach(function(a){d+=1;d<b||(c+=1,c<e&&g.push(a))});return g},_onViewRefreshed:function(a){this.raiseEvent("view_refreshed",a)},_refresh:function(a){var b;
if(b=this._dataSource)b=this._fn_itemsProvider?this._fn_itemsProvider(b):b.items,this._fn_filter&&(b=b.filter(this._fn_filter)),this._fn_sort&&(b=b.sort(this._fn_sort)),this._fillItems({items:b,isPageChanged:!!a},!0),this._onViewRefreshed({})},_fillItems:function(a,b){a=g.extend(!1,{items:[],isPageChanged:!1},a);var c,d=[],f=[],l=[];this._onFillStart({isBegin:!0,rowCount:a.items.length,time:new Date,isPageChanged:a.isPageChanged});try{b&&this.clear(),c=this.isPagingEnabled?this._filterForPaging(a.items):
a.items,c.forEach(function(a){var b=this._itemsByKey[a._key];b?l.push(b):(this._itemsByKey[a._key]=a,d.push(a),f.push(this._items.length-1),this._items.push(a),l.push(a))},this),0<d.length&&(this._onItemsChanged({change_type:e.COLL_CHANGE_TYPE.ADDED,items:d,pos:f}),this.raisePropertyChanged("count"))}finally{this._onFillEnd({isBegin:!1,rowCount:l.length,time:new Date,resetUI:!!b,fetchedItems:l,newItems:d,isPageChanged:a.isPageChanged})}this.totalCount=b?a.items.length:this.totalCount+d.length;this.moveFirst();
return d},_onDSCollectionChanged:function(a){var b=this,c;c=e.COLL_CHANGE_TYPE;var d=a.items;switch(a.change_type){case c.RESET:this._isDSFilling||this._refresh(!1);break;case c.ADDED:!this._isAddingNew&&!this._isDSFilling&&(b._fn_filter&&(d=d.filter(b._fn_filter)),b.appendItems([d]));break;case c.REMOVE:d.forEach(function(a){(a=b._itemsByKey[a._key])&&b.removeItem(a)});break;case c.REMAP_KEY:if(c=b._itemsByKey[a.old_key])delete b._itemsByKey[a.old_key],b._itemsByKey[a.new_key]=c,this._onItemsChanged(a);
break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,a.change_type));}},_onDSFill:function(a){var b=a.fetchedItems;a.isBegin?this._isDSFilling=!0:(this._isDSFilling=!1,a.resetUI?this._refresh(!1):(this._fn_filter&&(b=b.filter(this._fn_filter)),this.appendItems(b)))},_onDSStatusChanged:function(a){var b=a.item,e=a.oldChangeType,c=!!this._fn_filter;this._itemsByKey[a.key]?(this._onItemStatusChanged(b,e),c&&((a=this._fn_filter(b))||this.removeItem(b))):c&&(a=this._fn_filter(b))&&
this.appendItems([b])},_bindDS:function(){var a=this,b=this._dataSource;b&&(b.addHandler("coll_changed",function(e,c){b===e&&a._onDSCollectionChanged(c)},a._objId),b.addHandler("fill",function(e,c){b===e&&a._onDSFill(c)},a._objId),b.addHandler("begin_edit",function(e,c){b===e&&a._itemsByKey[c.item._key]&&a._onEditing(c.item,!0,!1)},a._objId),b.addHandler("end_edit",function(e,c){if(b===e){var d,g=c.item;d=!!a._fn_filter;a._itemsByKey[g._key]?(a._onEditing(g,!1,c.isCanceled),!c.isCanceled&&d&&((d=
a._fn_filter(g))||a.removeItem(g))):!c.isCanceled&&d&&(d=a._fn_filter(g))&&a._appendItems([g])}},a._objId),b.addHandler("errors_changed",function(e,c){b===e&&a._itemsByKey[c.item._key]&&a._onErrorsChanged(c.item)},a._objId),b.addHandler("status_changed",function(e,c){b===e&&a._onDSStatusChanged(c)},a._objId),b.addHandler("item_deleting",function(e,c){b===e&&a._itemsByKey[c.item._key]&&a._onItemDeleting(c)},a._objId),b.addHandler("item_added",function(e,c){b===e&&a._isAddingNew&&(a._itemsByKey[c.item._key]||
a._attach(c.item),a.currentItem=c.item,a._onEditing(c.item,!0,!1),a._onItemAdded(c.item))},a._objId),b.addHandler("item_adding",function(e,c){b===e&&a._isAddingNew&&a._onItemAdding(c.item)},a._objId))},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},appendItems:function(a){return this._isDestroyed?[]:this._fillItems({items:a,isPageChanged:!1},!1)},_getStrValue:function(a,b){return this._dataSource._getStrValue(a,b)},_onCurrentChanging:function(a){var b=this._dataSource;
try{b._EditingItem&&a!==b._EditingItem&&b.endEdit()}catch(e){b.cancelEdit(),f.reThrow(e,this._onError(e,this))}},_getErrors:function(a){return this._dataSource._getErrors(a)},_onPageChanged:function(){this._refresh(!0)},getItemsWithErrors:function(){return this._dataSource.getItemsWithErrors()},addNew:function(){var a=this._dataSource,b;this._isAddingNew=!0;try{b=a.addNew()}finally{this._isAddingNew=!1}return b},removeItem:function(a){if(null===a._key)throw Error(RIAPP.ERRS.ERR_ITEM_IS_DETACHED);
if(this._itemsByKey[a._key]){var b=this._items.indexOf(a);if(0>b)throw Error(RIAPP.ERRS.ERR_ITEM_IS_NOTFOUND);this._items.splice(b,1);delete this._itemsByKey[a._key];delete this._errors[a._key];this.totalCount-=1;this._onRemoved(a,b);a=this.getItemByPos(b);var e=this._currentPos;e===b&&(a||(this._currentPos=e-1),this._onCurrentChanged());e>b&&(this._currentPos=e-1,this._onCurrentChanged())}},sortLocal:function(a,b){var e=1,c=this._app.parser;b&&"DESC"===b.toUpperCase()&&(e=-1);this.fn_sort=function(b,
d){var g=0,f,p,l;f=0;for(p=a.length;f<p&&!(l=a[f],g=c.resolvePath(b,l),l=c.resolvePath(d,l),g=g<l?-1*e:g>l?e:0,0!==g);f+=1);return g}},getIsHasErrors:function(){return this._dataSource.getIsHasErrors()},clear:function(){this.cancelEdit();this._EditingItem=null;this._newKey=0;this.currentItem=null;this._items=[];this._itemsByKey={};this._errors={};this._onItemsChanged({change_type:e.COLL_CHANGE_TYPE.RESET,items:[]});this.raisePropertyChanged("count")},refresh:function(){this._refresh(!1)},destroy:function(){this._isDestroyed||
(this._unbindDS(),this._fn_sort=this._fn_filter=this._dataSource=null,this._super())}},{isPagingEnabled:{set:function(a){this._options.enablePaging!==a&&(this._options.enablePaging=a,this.raisePropertyChanged("isPagingEnabled"),this._refresh())},get:function(){return this._options.enablePaging}},permissions:{get:function(){return this._dataSource.permissions}},fn_filter:{set:function(a){this._fn_filter!==a&&(this._fn_filter=a,this._refresh())},get:function(){return this._fn_filter}},fn_sort:{set:function(a){this._fn_sort!==
a&&(this._fn_sort=a,this._refresh())},get:function(){return this._fn_sort}},fn_itemsProvider:{set:function(a){this._fn_itemsProvider!==a&&(this._fn_itemsProvider=a,this._refresh())},get:function(){return this._fn_itemsProvider}}},function(a){d.registerType("DataView",a)});RIAPP.BaseObject.extend({_app:d,_create:function(a){this._super();var b=this;this._objId="assoc:"+g.getNewID();a=g.extend(!1,{dbContext:null,parentName:"",childName:"",parentKeyFields:[],childKeyFields:[],parentToChildrenName:null,
childToParentName:null,name:this._objId,onDeleteAction:e.DELETE_ACTION.NoAction},a);this._name=a.name;this._dbContext=a.dbContext;this._onDeleteAction=a.onDeleteAction;this._parentDS=a.dbContext.dbSets[a.parentName];this._childDS=a.dbContext.dbSets[a.childName];this._parentFldInfos=a.parentKeyFields.map(function(a){return b._parentDS.getFieldInfo(a)});this._childFldInfos=a.childKeyFields.map(function(a){return b._childDS.getFieldInfo(a)});this._parentToChildrenName=a.parentToChildrenName;this._childToParentName=
a.childToParentName;this._parentMap={};this._childMap={};this._isChildFilling=this._isParentFilling=!1;this._bindParentDS();a=this._mapParentItems(this._parentDS.items);this._bindChildDS();var c=this._mapChildren(this._childDS.items);this._changedTimeout=this._saveChildFKey=this._saveParentFKey=null;this._changed={};b._notifyParentChanged(a);b._notifyChildrenChanged(c)},_onError:function(a,b){var e=this._super(a,b);return!e?this.app._onError(a,b):e},_bindParentDS:function(){var a=this,b=this._parentDS;
b&&(b._addHandler("coll_changed",function(e,c){b===e&&a._onParentCollChanged(c)},a._objId,!0),b._addHandler("fill",function(e,c){b===e&&a._onParentFill(c)},a._objId,!0),b._addHandler("begin_edit",function(e,c){b===e&&a._onParentEdit(c.item,!0,void 0)},a._objId,!0),b._addHandler("end_edit",function(e,c){b===e&&a._onParentEdit(c.item,!1,c.isCanceled)},a._objId,!0),b._addHandler("item_deleting",function(c,d){if(b===c){var g=e.DELETE_ACTION,f=a.getChildItems(d.item);switch(a.onDeleteAction){case g.NoAction:0<
f.length&&(d.isCancel=!0,a._onError(Error(RIAPP.ERRS.ERR_ASSOC_HAS_CHILDREN),a))}}},a._objId,!0),b._addHandler("status_changed",function(e,c){b===e&&a._onParentStatusChanged(c.item,c.oldChangeType)},a._objId,!0),b._addHandler("commit_changes",function(e,c){b===e&&a._onParentCommitChanges(c.item,c.isBegin,c.isRejected,c.changeType)},a._objId,!0))},_bindChildDS:function(){var a=this,b=this._childDS;b&&(b._addHandler("coll_changed",function(e,c){b===e&&a._onChildCollChanged(c)},a._objId,!0),b._addHandler("fill",
function(e,c){b===e&&a._onChildFill(c)},a._objId,!0),b._addHandler("begin_edit",function(e,c){b===e&&a._onChildEdit(c.item,!0,void 0)},a._objId,!0),b._addHandler("end_edit",function(e,c){b===e&&a._onChildEdit(c.item,!1,c.isCanceled)},a._objId,!0),b._addHandler("status_changed",function(e,c){b===e&&a._onChildStatusChanged(c.item,c.oldChangeType)},a._objId,!0),b._addHandler("commit_changes",function(e,c){b===e&&a._onChildCommitChanges(c.item,c.isBegin,c.isRejected,c.changeType)},a._objId,!0))},_onParentCollChanged:function(a){var b=
this,c=e.COLL_CHANGE_TYPE,d=a.items,g=[],f={};switch(a.change_type){case c.RESET:b._isParentFilling||(g=b.refreshParentMap());break;case c.ADDED:this._isParentFilling||(g=b._mapParentItems(d));break;case c.REMOVE:d.forEach(function(a){(a=b._unMapParentItem(a))&&(f[a]=null)});g=Object.keys(f);break;case c.REMAP_KEY:if(a.old_key&&(c=this._parentMap[a.old_key]))delete this._parentMap[a.old_key],g=this._mapParentItems([c]);break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,
a.change_type));}b._notifyParentChanged(g)},_onParentFill:function(a){a.isBegin?this._isParentFilling=!0:(this._isParentFilling=!1,a=a.resetUI?this.refreshParentMap():this._mapParentItems(a.newItems),this._notifyParentChanged(a))},_onParentEdit:function(a,b,e){b?this._storeParentFKey(a):e?this._saveParentFKey=null:this._checkParentFKey(a)},_onParentCommitChanges:function(a,b,c,d){var g=e.CHANGE_TYPE;b?c&&d===g.ADDED?(a=this._unMapParentItem(a))&&this._notifyParentChanged([a]):!c&&d===g.DELETED?(a=
this._unMapParentItem(a))&&this._notifyParentChanged([a]):this._storeParentFKey(a):this._checkParentFKey(a)},_storeParentFKey:function(a){a=this.getParentFKey(a);null!==a&&this._parentMap[a]&&(this._saveParentFKey=a)},_checkParentFKey:function(a){var b,e=this._saveParentFKey;this._saveParentFKey=null;b=this.getParentFKey(a);b!==e&&(e&&(delete this._parentMap[e],this._notifyChildrenChanged([e]),this._notifyParentChanged([e])),b&&(this._mapParentItems([a]),this._notifyChildrenChanged([b]),this._notifyParentChanged([b])))},
_onParentStatusChanged:function(a,b){var c=this,d,g,f=e.DELETE_ACTION;if(a._changeType===e.CHANGE_TYPE.DELETED){g=c.getChildItems(a);d=this._unMapParentItem(a);switch(c.onDeleteAction){case f.Cascade:g.forEach(function(a){a.deleteItem()});break;case f.SetNulls:g.forEach(function(a){var b=a.isEditing;b||a.beginEdit();try{c._childFldInfos.forEach(function(b){a[b.fieldName]=null}),b||a.endEdit()}finally{b||a.cancelEdit()}})}d&&c._notifyParentChanged([d])}},_onChildCollChanged:function(a){var b=this,
c=e.COLL_CHANGE_TYPE,d=a.items,g=[],f={};switch(a.change_type){case c.RESET:b._isChildFilling||(g=b.refreshChildMap());break;case c.ADDED:this._isChildFilling||(g=b._mapChildren(d));break;case c.REMOVE:d.forEach(function(a){(a=b._unMapChildItem(a))&&(f[a]=null)});g=Object.keys(f);break;case c.REMAP_KEY:if(a.old_key&&(a=d[0])){if(g=a._getFieldVal(this._childToParentName))delete this._childMap[g],a._clearFieldVal(this._childToParentName);g=this._mapChildren([a])}break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,
a.change_type));}b._notifyChildrenChanged(g)},_notifyChildrenChanged:function(a){this._notifyChanged([],a)},_notifyParentChanged:function(a){this._notifyChanged(a,[])},_notifyChanged:function(a,b){var e=this;if(0<a.length||0<b.length)a.forEach(function(a){var b=e._changed[a];e._changed[a]=b?b|1:1}),b.forEach(function(a){var b=e._changed[a];e._changed[a]=b?b|2:2}),this._changedTimeout||(this._changedTimeout=setTimeout(function(){e._changedTimeout=null;var a=e._changed;e._changed={};Object.keys(a).forEach(function(b){var c=
a[b];1==(c&1)&&e._onParentChanged(b);2==(c&2)&&e._onChildrenChanged(b)})},100))},_onChildFill:function(a){a.isBegin?this._isChildFilling=!0:(this._isChildFilling=!1,a=a.resetUI?this.refreshChildMap():this._mapChildren(a.newItems),this._notifyChildrenChanged(a))},_onChildEdit:function(a,b,e){b?this._storeChildFKey(a):e?this._saveChildFKey=null:this._checkChildFKey(a)},_onChildCommitChanges:function(a,b,c,d){var g=e.CHANGE_TYPE;b?c&&d===g.ADDED?(a=this._unMapChildItem(a))&&this._notifyChildrenChanged([a]):
!c&&d===g.DELETED?(a=this._unMapChildItem(a))&&this._notifyChildrenChanged([a]):this._storeChildFKey(a):this._checkChildFKey(a)},_storeChildFKey:function(a){var b=this.getChildFKey(a),e;if(b&&(e=this._childMap[b])&&-1<e.indexOf(a))this._saveChildFKey=b},_checkChildFKey:function(a){var b=this._saveChildFKey,e,c,d;this._saveChildFKey=null;e=this.getChildFKey(a);e!==b&&(b&&(c=this._childMap[b],d=c.indexOf(a),-1<d&&c.splice(d,1),0==c.length&&delete this._childMap[b],this._notifyParentChanged([b]),this._notifyChildrenChanged([b])),
e&&(this._mapChildren([a]),this._notifyParentChanged([e]),this._notifyChildrenChanged([e])))},_onChildStatusChanged:function(a,b){var c=e.CHANGE_TYPE.DELETED,d=a._changeType,g=this.getChildFKey(a);g&&d===c&&(g=this._unMapChildItem(a))&&this._notifyChildrenChanged([g])},_getItemKey:function(a,b,e){for(var c=[],d,g=0,f=a.length;g<f;g+=1){d=e[a[g].fieldName];d=b._getStrValue(d,a[g]);if(null===d)return null;c.push(d)}return c.join(";")},_resetChildMap:function(){var a=Object.keys(this._childMap);this._childMap=
{};this._notifyChildrenChanged(a)},_resetParentMap:function(){var a=Object.keys(this._parentMap);this._parentMap={};this._notifyParentChanged(a)},_unMapChildItem:function(a){var b,e,c=null;if(b=this.getChildFKey(a))if(e=this._childMap[b])a=e.indexOf(a),-1<a&&(e.splice(a,1),0==e.length&&delete this._childMap[b],c=b);return c},_unMapParentItem:function(a){var b=null;if((a=this.getParentFKey(a))&&this._parentMap[a])delete this._parentMap[a],b=a;return b},_mapParentItems:function(a){for(var b,c,d=e.CHANGE_TYPE.DELETED,
g,f={},l=0,h=a.length;l<h;l+=1)if(b=a[l],c=b._changeType,c!==d&&(c=this.getParentFKey(b)))g=this._parentMap[c],g!==b&&(this._parentMap[c]=b,f[c]=null);return Object.keys(f)},_onChildrenChanged:function(a){a&&this._parentToChildrenName&&(a=this._parentMap[a])&&a.raisePropertyChanged(this._parentToChildrenName)},_onParentChanged:function(a){var b=this;a&&this._childToParentName&&(a=this._childMap[a])&&a.forEach(function(a){a.raisePropertyChanged(b._childToParentName)})},_mapChildren:function(a){for(var b,
c,d,g=e.CHANGE_TYPE.DELETED,f={},l=0,h=a.length;l<h;l+=1)if(b=a[l],c=b._changeType,c!==g&&(c=this.getChildFKey(b)))d=this._childMap[c],d||(d=[],this._childMap[c]=d),0>d.indexOf(b)&&(d.push(b),f[c]||(f[c]=null));return Object.keys(f)},_unbindParentDS:function(){var a=this.parentDS;a&&a.removeNSHandlers(this._objId)},_unbindChildDS:function(){var a=this.childDS;a&&a.removeNSHandlers(this._objId)},getParentFKey:function(a){return a&&a._isNew?a._key:this._getItemKey(this._parentFldInfos,this._parentDS,
a)},getChildFKey:function(a){if(a&&this._childToParentName){var b=a._getFieldVal(this._childToParentName);if(b)return b}return this._getItemKey(this._childFldInfos,this._childDS,a)},getChildItems:function(a){if(!a)return[];a=this.getParentFKey(a);a=this._childMap[a];return!a?[]:a},getParentItem:function(a){if(!a)return null;a=this.getChildFKey(a);return(a=this._parentMap[a])?a:null},refreshParentMap:function(){this._resetParentMap();return this._mapParentItems(this._parentDS.items)},refreshChildMap:function(){this._resetChildMap();
return this._mapChildren(this._childDS.items)},destroy:function(){this._isDestroying=!0;clearTimeout(this._changedTimeout);this._changedTimeout=null;this._changed={};this._unbindParentDS();this._unbindChildDS();this._childFldInfos=this._parentFldInfos=this._childMap=this._parentMap=null;this._super()}},{app:{get:function(){return this._app}},name:{get:function(){return this._name}},parentToChildrenName:{get:function(){return this._parentToChildrenName}},childToParentName:{get:function(){return this._childToParentName}},
parentDS:{get:function(){return this._parentDS}},childDS:{get:function(){return this._childDS}},parentFldInfos:{get:function(){return this._parentFldInfos}},childFldInfos:{get:function(){return this._childFldInfos}},onDeleteAction:{get:function(){return this._onDeleteAction}}},function(a){d.registerType("Association",a)});k.extend({_create:function(a){this._refreshTimeout=this._parentItem=null;this._association=a.association;a.dataSource=this._association.childDS;var b=this,e=this._association,c=
a.fn_filter;a.fn_filter=function(a){if(!b._parentItem)return!1;var d=e.getParentFKey(b._parentItem);if(!d)return!1;var g=e.getChildFKey(a);return!g||d!==g?!1:c?c(a):!0};this._super(a)},_refresh:function(){var a=this;this._dataSource&&(clearTimeout(a._refreshTimeout),a._refreshTimeout=setTimeout(function(){var b=a._association.getChildItems(a._parentItem);a._fn_filter&&(b=b.filter(a._fn_filter));a._fn_sort&&(b=b.sort(a._fn_sort));a._fillItems({items:b,isPageChanged:!1},!0);a._onViewRefreshed({})},
250))},destroy:function(){clearTimeout(this._refreshTimeout);this._association=null;this._super()}},{parentItem:{set:function(a){this._parentItem!==a&&(this._parentItem=a,this.raisePropertyChanged("parentItem"),0<this.items.length&&(this.clear(),this._onViewRefreshed({})),this._refresh())},get:function(){return this._parentItem}},association:{get:function(){return this._association}}},function(a){d.registerType("ChildDataView",a)})};
RIAPP.Application._coreModules.datadialog=function(d){var f=d.global,k=f.utils,h=f.consts,a=RIAPP.localizable.TEXT;h.DIALOG_ACTION={Default:0,StayOpen:1};Object.freeze(h.DIALOG_ACTION);RIAPP.BaseObject.extend({_app:d,_create:function(a){this._super();var c=this;this._objId="dlg"+k.getNewID();a=k.extend(!1,{dataContext:null,dbContext:null,templateID:null,width:500,height:350,title:"data edit dialog",submitOnOK:!1,canRefresh:!1,canCancel:!0,fn_OnClose:null,fn_OnOK:null,fn_OnCancel:null,fn_OnTemplateCreated:null},
a);this._dataContext=a.dataContext;this._dbContext=a.dbContext||this._app.dbContext;this._templateID=a.templateID;this._submitOnOK=a.submitOnOK;this._canRefresh=a.canRefresh;this._canCancel=a.canCancel;this._fn_OnClose=a.fn_OnClose;this._fn_OnOK=a.fn_OnOK;this._fn_OnShow=a.fn_OnShow;this._fn_OnCancel=a.fn_OnCancel;this._fn_OnTemplateCreated=a.fn_OnTemplateCreated;this._isEditable=!1;this._result=this._$template=this._template=null;this._fn_submitOnOK=function(){var a=c._dbContext;if(!a)return k.createDeferred().resolve();
a.addHandler("submit_error",function(a,b){f.getType("SubmitError").isPrototypeOf(b.error)&&0<b.error.notValidated.length&&(b.isHandled=!0)},c._objId);var b=a.submitChanges();b.always(function(){a.removeHandler("submit_error",c._objId)});return b};this._updateIsEditable();this._options={width:a.width,height:a.height,title:a.title,autoOpen:!1,modal:!0,close:function(a,b){c._onClose()},buttons:c._getButtons()};this._dialogCreated=!1;this._createDialog()},_updateIsEditable:function(){var a=this._dataContext;
this._isEditable=a?!!a.endEdit&&!!a.cancelEdit:!1},_createDialog:function(){this._dialogCreated||(this._template=this._createTemplate(this._dataContext),this._$template=f.$(this._template.el),f.document.body.appendChild(this._template.el),this._$template.dialog(this._options),this._dialogCreated=!0,this._fn_OnTemplateCreated&&this._fn_OnTemplateCreated(this._template))},_getEventNames:function(){var a=this._super();return["close","refresh"].concat(a)},_createTemplate:function(a){var c=this._app.getType("Template").create(this._templateID);
c.isDisabled=!0;c.dataContext=a;return c},_getButtons:function(){var b=this,c=[{id:b._objId+"Refresh",text:a.txtRefresh,"class":"btn btn-info",click:function(){b._onRefresh()}},{id:b._objId+"Ok",text:a.txtOk,"class":"btn btn-info",click:function(){b._onOk()}},{id:b._objId+"Cancel",text:a.txtCancel,"class":"btn btn-info",click:function(){b._onCancel()}}];this.canRefresh||c.shift();this.canCancel||c.pop();return c},_getOkButton:function(){return $("#"+this._objId+"Ok")},_getCancelButton:function(){return $("#"+
this._objId+"Cancel")},_getRefreshButton:function(){return $("#"+this._objId+"Refresh")},_getAllButtons:function(){return[this._getOkButton(),this._getCancelButton(),this._getRefreshButton()]},_disableButtons:function(a){this._getAllButtons().forEach(function(c){c.prop("disabled",!!a)})},_onOk:function(){var b=this,c;c=h.DIALOG_ACTION.Default;this._fn_OnOK&&(c=this._fn_OnOK(this));if(c!=h.DIALOG_ACTION.StayOpen)if(this._dataContext){if(c=this._isEditable?this._dataContext.endEdit():!0)if(this._submitOnOK){this._disableButtons(!0);
var d=this.title;this.title=a.txtSubmitting;c=this._fn_submitOnOK();c.always(function(){b._disableButtons(!1);b.title=d});c.done(function(){b._result="ok";b.hide()});c.fail(function(){b._isEditable&&b._dataContext.beginEdit()})}else b._result="ok",b.hide()}else b.hide()},_onCancel:function(){var a=h.DIALOG_ACTION.Default;this._fn_OnCancel&&(a=this._fn_OnCancel(this));a!=h.DIALOG_ACTION.StayOpen&&(this._result="cancel",this.hide())},_onRefresh:function(){var a={isHandled:!1};this.raiseEvent("refresh",
a);a.isHandled||this._dataContext&&this._dataContext.refresh&&this._dataContext.refresh()},_onClose:function(){try{"ok"!=this._result&&this._dataContext&&(this._isEditable&&this._dataContext.cancelEdit(),this._submitOnOK&&this._dataContext.rejectChanges&&this._dataContext.rejectChanges()),this._fn_OnClose&&this._fn_OnClose(this),this.raiseEvent("close",{})}finally{this._template.isDisabled=!0}},show:function(){this._result=null;this._$template.dialog("option","buttons",this._getButtons());this._template.isDisabled=
!1;this._fn_OnShow&&this._fn_OnShow(this);this._$template.dialog("open")},hide:function(){this._$template.dialog("close")},getOption:function(a){return this._$template.dialog("option",a)},setOption:function(a,c){this._$template.dialog("option",a,c)},destroy:function(){this._dialogCreated&&(this.hide(),this._$template.remove(),this._template.destroy(),this._template=this._$template=null,this._dialogCreated=!1);this._fn_submitOnOK=this._dbContext=this._dataContext=null;this._super()}},{app:{get:function(){return this._app}},
dataContext:{set:function(a){a!==this._dataContext&&(this._dataContext=a,this._template&&(this._template.dataContext=this._dataContext),this._updateIsEditable(),this.raisePropertyChanged("dataContext"))},get:function(){return this._dataContext}},result:{get:function(){return this._result}},template:{get:function(){return this._template}},isSubmitOnOK:{set:function(a){this._submitOnOK!==a&&(this._submitOnOK=a,this.raisePropertyChanged("isSubmitOnOK"))},get:function(){return this._submitOnOK}},width:{set:function(a){var c=
this.getOption("width");a!==c&&(this.setOption("width",a),this.raisePropertyChanged("width"))},get:function(){return this.getOption("width")}},height:{set:function(a){var c=this.getOption("height");a!==c&&(this.setOption("height",a),this.raisePropertyChanged("height"))},get:function(){return this.getOption("height")}},title:{set:function(a){var c=this.getOption("title");a!==c&&(this.setOption("title",a),this.raisePropertyChanged("title"))},get:function(){return this.getOption("title")}},canRefresh:{set:function(a){a!==
this._canRefresh&&(this._canRefresh=a,this.raisePropertyChanged("canRefresh"))},get:function(){return this._canRefresh}},canCancel:{set:function(a){a!==this._canCancel&&(this._canCancel=a,this.raisePropertyChanged("canCancel"))},get:function(){return this._canCancel}}},function(a){d.registerType("DataEditDialog",a)})};
RIAPP.Application._coreModules.datagrid=function(d){var f=d.global,k=f.utils,h=f.consts,a,b,c,g,e,l,n,s,m,r,t,v,E=d.getType("Collection"),F=d.getType("DataEditDialog"),q={container:"ria-table-container",dataTable:"ria-data-table",columnInfo:"ria-col-info",column:"ria-ex-column",cellDiv:"cell-div",headerDiv:"ria-table-header",wrapDiv:"ria-table-wrap",dataColumn:"data-column",rowCollapsed:"row-collapsed",rowExpanded:"row-expanded",rowExpander:"row-expander",columnSelected:"selected",rowSelected:"selected",
rowActions:"row-actions",rowDetails:"row-details",rowSelector:"row-selector",rowHighlight:"row-highlight",rowDeleted:"row-deleted",rowError:"row-error",nobr:"ria-nobr",colSortable:"sortable",colSortAsc:"sort-asc",colSortDesc:"sort-desc"};Object.freeze(q);var G=RIAPP.localizable.TEXT;a=RIAPP.BaseObject.extend({_app:d,_create:function(a,b){this._super();this._row=a;this._el=b.td;this._column=b.column;this._div=f.document.createElement("div");var e=f.$(this._div);this._clickTimeOut=null;e.addClass(q.cellDiv).attr(h.DATA_ATTR.DATA_EVENT_SCOPE,
this._column.uniqueID);this._div.cell=this;this._column.options.width&&(this._el.style.width=this._column.options.width);this._init();this._column.options.rowCellCss&&e.addClass(this._column.options.rowCellCss);this._el.appendChild(this._div);this._row.el.appendChild(this._el)},_init:function(){},_onCellClicked:function(){this.grid.currentRow=this._row},_onDblClicked:function(){this.grid.currentRow=this._row;this.grid._onCellDblClicked(this)},_onError:function(a,b){var e=this._super(a,b);return!e?
this.row._onError(a,b):e},scrollIntoView:function(a){this._div.scrollIntoView(!!a)},destroy:function(){this._isDestroyed||(this._isDestroying=!0,f.$(this._div).remove(),this._column=this._el=this._row=this._div=this._div.cell=null,this._super())}},{el:{get:function(){return this._el}},row:{get:function(){return this._row}},column:{get:function(){return this._column}},grid:{get:function(){return this._row.grid}},app:{get:function(){return this._app}},item:{get:function(){return this._row.item}}},function(a){d.registerType("grid.BaseCell",
a)});g=a.extend({_create:function(a,b){this._stateCss=this._content=null;this._super(a,b)},_init:function(){var a=this._column.options.content;if(!a.fieldInfo&&a.fieldName&&(a.fieldInfo=this.item.getFieldInfo(a.fieldName),!a.fieldInfo))throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,"",a.fieldName));a.initContentFn=null;try{var b=this.app._getContentType(a);this.app.getType("LookupContent")===b&&(a.initContentFn=this._getInitLookUpFn());this._content=this.app._getContent(b,a,
this._div,this.item,this.item.isEditing)}finally{delete a.initContentFn}},_getInitLookUpFn:function(){var a=this;return function(b){b.addHandler("listbox_created",function(b,e){a._column._listBox=e.listBox;e.isCachedExternally=!!a._column._listBox});b.addHandler("need_listbox",function(b,e){e.listBox=a._column._listBox})}},_beginEdit:function(){this._content.isEditing||(this._content.isEditing=!0)},_endEdit:function(a){this._content.isEditing&&(this._content.isEditing=!1)},_setState:function(a){var b;
this._stateCss!==a&&(b=f.$(this._div),this._stateCss&&b.removeClass(this._stateCss),(this._stateCss=a)&&b.addClass(this._stateCss))},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._content&&(this._content.destroy(),this._content=null),this._initLookUpFn=null,this._super())}},null,function(a){d.registerType("grid.DataCell",a)});l=a.extend({_init:function(){var a=f.$(this.el);a.addClass(q.rowCollapsed);a.addClass(q.rowExpander)},_onCellClicked:function(){this._row&&(this._super(),
this._row.isExpanded=!this._row.isExpanded)},_toggleImage:function(){var a=f.$(this.el);this._row.isExpanded?(a.removeClass(q.rowCollapsed),a.addClass(q.rowExpanded)):(a.removeClass(q.rowExpanded),a.addClass(q.rowCollapsed))}},null,function(a){d.registerType("grid.ExpanderCell",a)});n=a.extend({_create:function(a,b){this._isEditing=!1;this._super(a,b)},_init:function(){var a=f.$(this.el),b=f.$(this._div);a.addClass([q.rowActions,q.cellDiv,q.nobr].join(" "));b.on("mouseenter","img",function(a){a.stopPropagation();
$(this).css("opacity",0.5)});b.on("mouseout","img",function(a){a.stopPropagation();$(this).css("opacity",1)});this._createButtons(!1)},destroy:function(){if(!this._isDestroyed){this._isDestroying=!0;for(var a=this._div.getElementsByTagName("img"),b=0,e=a.length;b<e;b+=1)a[b].cell=null;this._super()}},_createButtons:function(a){if(this._el){var b=this,e=f.$,c=f.$(this._div),d={img_ok:"txtOk",img_cancel:"txtCancel",img_edit:"txtEdit",img_delete:"txtDelete"};c.empty();var g=b._column.options;a?(this._isEditing=
!0,a=e('<img name="img_ok" alt="ok"/>&nbsp;<img name="img_cancel" alt="cancel"/>')):(this._isEditing=!1,a=e('<img name="img_edit" alt="edit"/>&nbsp;<img name="img_delete" alt="delete"/>'),b.isCanEdit||(a=a.not('img[name="img_edit"]')),b.isCanDelete||(a=a.not('img[name="img_delete"]')));(function(a){a.each(function(a,c){var p=f.$(c);c.style.cursor="pointer";c.src=g[c.name];c.cell=b;k.addToolTip(p,G[d[c.name]]);e(c).attr(h.DATA_ATTR.DATA_EVENT_SCOPE,b._column.uniqueID)})})(a.filter("img"));c.append(a)}},
update:function(){this._row&&this._isEditing!=this._row.isEditing&&this._createButtons(this._row.isEditing)}},{isCanEdit:{get:function(){return this.grid.isCanEdit}},isCanDelete:{get:function(){return this.grid.isCanDelete}}},function(a){d.registerType("grid.ActionsCell",a)});s=a.extend({_init:function(){f.$(this.el).addClass(q.rowSelector);var a={},b=this.app.getType("RowSelectContent");a.bindingInfo={target:null,source:null,targetPath:null,sourcePath:"isSelected",mode:"TwoWay",converter:null,converterParam:null};
a.displayInfo=null;a.fieldName="isSelected";this._content=b.create(this._div,a,this.row,!0)},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._content&&(this._content.destroy(),this._content=null),this._super())}},null,function(a){d.registerType("grid.RowSelectorCell",a)});c=RIAPP.BaseObject.extend({_app:d,_create:function(a,b){this._super();this._row=a;this._el=b.td;this._isDestroying=!1;this._init(b)},_init:function(a){a=a.details_id;var b=this.grid.app.getType("Template");a&&(this._template=
b.create(a),this._el.colSpan=this.grid.columns.length,this._el.appendChild(this._template.el),this._row.el.appendChild(this._el))},destroy:function(){!this._isDestroyed&&this._el&&(this._isDestroying=!0,this._template&&(this._template.destroy(),this._template=null),this._el=this._row=null,this._super())}},{el:{get:function(){return this._el}},row:{get:function(){return this._row}},grid:{get:function(){return this._row.grid}},app:{get:function(){return this._app}},item:{set:function(a){this._template.dataContext=
a},get:function(){return this._template.dataContext}}},function(a){d.registerType("grid.DetailsCell",a)});e=RIAPP.BaseObject.extend({_app:d,_create:function(a,b){var e=this;this._super();this._grid=a;this._el=b.tr;this._item=b.item;this._cells=[];this._objId=this._grid.uniqueID+"_"+this._item._key;this._rowSelectorCell=this._actionsCell=this._expanderCell=null;this._isSelected=this._isDeleted=this._isCurrent=!1;this._createCells();this._item.addOnDestroyed(function(a,b){e._onItemDestroyed(b)},e._objId);
this.isDeleted=this._item._isDeleted;var c=function(){var a=e._grid._onRowStateChanged(e,e._item[e._grid._options.rowStateField]);e._setState(a)};this._grid._options.rowStateField&&(this._item.addOnPropertyChange(this._grid._options.rowStateField,function(a,b){c()},this._objId),c())},_onItemDestroyed:function(){this.destroy()},_onError:function(a,b){var e=this._super(a,b);return!e?this.grid._onError(a,b):e},_createCells:function(){var a=this;this.columns.forEach(function(b){b=a._createCell(b);a._cells.push(b)})},
_createCell:function(a){var b=f.document.createElement("td");r.isPrototypeOf(a)?this._expanderCell=a=l.create(this,{td:b,column:a}):t.isPrototypeOf(a)?this._actionsCell=a=n.create(this,{td:b,column:a}):v.isPrototypeOf(a)?this._rowSelectorCell=a=s.create(this,{td:b,column:a}):a=g.create(this,{td:b,column:a});return a},_onBeginEdit:function(){this._cells.forEach(function(a){g.isPrototypeOf(a)&&a._beginEdit()});this._actionsCell&&this._actionsCell.update()},_onEndEdit:function(a){this._cells.forEach(function(b){g.isPrototypeOf(b)&&
b._endEdit(a)});this._actionsCell&&this._actionsCell.update()},beginEdit:function(){return this._item.beginEdit()},endEdit:function(){return this._item.endEdit()},cancelEdit:function(){return this._item.cancelEdit()},destroy:function(){if(!this._isDestroyed){this._isDestroying=!0;var a=this._grid;a&&(this.isExpanded&&a.collapseDetails(),this._cells.forEach(function(a){a.destroy()}),this._cells=[],a._isClearing||(a._removeRow(this),this._el&&k.removeNode(this._el)));this._item&&this._item.removeNSHandlers(this._objId);
this._grid=this._el=this._expanderCell=this._item=null;this._super()}},deleteRow:function(){this._item.deleteItem()},updateErrorState:function(){var a=this._item.getIsHasErrors(),b=f.$(this.el);a?b.addClass(q.rowError):b.removeClass(q.rowError)},scrollIntoView:function(a){0<this._cells.length&&this._cells[0].scrollIntoView(a)},_setState:function(a){this.cells.forEach(function(b){g.isPrototypeOf(b)&&b._setState(a)})}},{el:{get:function(){return this._el}},grid:{get:function(){return this._grid}},item:{get:function(){return this._item}},
cells:{get:function(){return this._cells}},columns:{get:function(){return this._grid.columns}},uniqueID:{get:function(){return this._objId}},itemKey:{get:function(){return!this._item?null:this._item._key}},isCurrent:{set:function(a){if(a!==this._isCurrent){var b=f.$(this._el);(this._isCurrent=a)?b.addClass(q.rowHighlight):b.removeClass(q.rowHighlight);this.raisePropertyChanged("isCurrent")}},get:function(){return this._isCurrent}},isSelected:{set:function(a){this._isSelected!=a&&(this._isSelected=
a,this.raisePropertyChanged("isSelected"),this.grid._onRowSelectionChanged(this))},get:function(){return this._isSelected}},isExpanded:{set:function(a){a!==this.isExpanded&&(!a&&this.isExpanded?this.grid._expandDetails(this,!1):a&&this.grid._expandDetails(this,!0))},get:function(){return this.grid._expandedRow===this}},expanderCell:{get:function(){return this._expanderCell}},actionsCell:{get:function(){return this._actionsCell}},isDeleted:{set:function(a){this._el&&this._isDeleted!==a&&((this._isDeleted=
a)?(this.isExpanded=!1,f.$(this._el).addClass(q.rowDeleted)):f.$(this._el).removeClass(q.rowDeleted))},get:function(){return!this._el?!0:this._isDeleted}},isEditing:{get:function(){return this._item._isEditing}}},function(a){d.registerType("grid.Row",a)});b=RIAPP.BaseObject.extend({_app:d,_create:function(a,b){this._super();this._grid=a;this._el=b.tr;this._parentRow=this._cell=this._item=null;this._objId="drow"+this.grid.app.getNewObjectID();this._createCell(b.details_id);this.$el=f.$(this._el);this.$el.addClass(q.rowDetails)},
_createCell:function(a){var b=f.document.createElement("td");this._cell=c.create(this,{td:b,details_id:a})},destroy:function(){!this._isDestroyed&&this.el&&(this._isDestroying=!0,k.removeNode(this.el),this._cell&&(this._cell.destroy(),this._cell=null),this._grid=this._el=this._item=null,this._super())},_setParentRow:function(a){var b=this;this._item=null;this._cell.item=null;k.removeNode(this.el);if(this._parentRow=a)this._item=this._parentRow.item,this._cell.item=this._item,k.insertAfter(this._parentRow.el,
this.el),f.$(this._cell._template.el).slideDown("fast",function(){b._parentRow&&b.grid._options.isUseScrollIntoDetails&&b._parentRow.scrollIntoView(!0)})}},{el:{get:function(){return this._el}},grid:{get:function(){return this._grid}},item:{set:function(a){this._item!==a&&(this._item=a)},get:function(){return this._item}},cell:{get:function(){return this._cell}},uniqueID:{get:function(){return this._objId}},itemKey:{get:function(){return!this._item?null:this._item._key}},parentRow:{set:function(a){var b=
this;if(a!==this._parentRow){var e=f.$(this._cell._template.el);this._parentRow?e.slideUp("fast",function(){b._setParentRow(a)}):b._setParentRow(a)}},get:function(){return this._parentRow}}},function(a){d.registerType("grid.DetailsRow",a)});a=RIAPP.BaseObject.extend({_app:d,_create:function(a,b){this._super();var e=this;this._grid=a;this._el=b.th;this._options=b.colinfo;this._isSelected=!1;this._objId="col"+this.app.getNewObjectID();var c=f.$("<div></div>");c.addClass(q.column);this._grid._headerDiv.append(c);
this._extcol=c;var d=f.$("<div></div>");d.addClass(q.cellDiv).click(function(b){b.stopPropagation();f.currentSelectable=a;a._setCurrentColumn(e);e._onColumnClicked()});c.append(d);d.get(0).cell=this;this._div=d;f.$(this.grid._tableEl).on("click","div["+h.DATA_ATTR.DATA_EVENT_SCOPE+'="'+this.uniqueID+'"]',function(b){b.stopPropagation();var c=this.cell;c&&(f.currentSelectable=a,a._setCurrentColumn(e),g.isPrototypeOf(c)?null!==c._clickTimeOut?(clearTimeout(c._clickTimeOut),c._clickTimeOut=null,c._onDblClicked()):
(c._onCellClicked(),c._clickTimeOut=setTimeout(function(){c._clickTimeOut=null},350)):c._onCellClicked())});this._options.width&&(this._el.style.width=this._options.width);this._init();this._options.colCellCss&&d.addClass(this._options.colCellCss)},_init:function(){this.title&&this._div.html(this.title)},destroy:function(){!this._isDestroyed&&this.el&&(this._isDestroying=!0,this._extcol.remove(),this._extcol=null,this._grid=this._el=this._item=this._div=this._div.get(0).cell=null,this._super())},
scrollIntoView:function(a){this._div&&this._div.get(0).scrollIntoView(!!a)},_onColumnClicked:function(){}},{uniqueID:{get:function(){return this._objId}},app:{get:function(){return this._app}},el:{get:function(){return this._el}},$div:{get:function(){return this._div}},$extcol:{get:function(){return this._extcol}},grid:{get:function(){return this._grid}},options:{get:function(){return this._options}},title:{get:function(){return this._options.title}},isSelected:{set:function(a){this._isSelected!==
a&&((this._isSelected=a)?this._div.addClass(q.columnSelected):this._div.removeClass(q.columnSelected))},get:function(){return this._isSelected}}},function(a){d.registerType("grid.BaseColumn",a)});m=a.extend({_create:function(a,b){this._super(a,b);this._listBox=null;this.$div.addClass(q.dataColumn)},_init:function(){this._super();this.isSortable&&this.$div.addClass(q.colSortable);this._sortOrder=null},_onColumnClicked:function(){if(this.isSortable&&this.sortMemberName){var a=this._sortOrder;this.grid._resetColumnsSort();
this.sortOrder="ASC"==a?"DESC":"ASC";this.grid._sortByColumn(this)}},destroy:function(){!this._isDestroyed&&this.el&&(this._isDestroying=!0,this._listBox&&(this._listBox.destroy(),this._listBox=null),this._super())}},{isSortable:{get:function(){return this._options.sortable}},sortMemberName:{get:function(){return this._options.sortMemberName}},sortOrder:{set:function(a){var b=this.$div;b.removeClass(q.colSortable).removeClass(q.colSortAsc).removeClass(q.colSortDesc);switch(a){case "ASC":b.addClass(q.colSortAsc);
break;case "DESC":b.addClass(q.colSortDesc);break;default:this.isSortable&&b.addClass(q.colSortable)}this._sortOrder=a},get:function(){return this._sortOrder}}},function(a){d.registerType("grid.DataColumn",a)});r=a.extend({_init:function(){this._super();this.$div.addClass(q.rowExpander)}},null,function(a){d.registerType("grid.ExpanderColumn",a)});t=a.extend({_init:function(){this._super();var a=this,b=this.options;this.$div.addClass(q.rowActions);b.img_ok=f.getImagePath(b.img_ok||"ok.png");b.img_cancel=
f.getImagePath(b.img_cancel||"cancel.png");b.img_edit=f.getImagePath(b.img_edit||"edit.png");b.img_delete=f.getImagePath(b.img_delete||"delete.png");f.$(this.grid._tableEl).on("click","img["+h.DATA_ATTR.DATA_EVENT_SCOPE+'="'+this.uniqueID+'"]',function(b){b.stopPropagation();b=this.cell;switch(this.name){case "img_ok":a._onOk(b);break;case "img_cancel":a._onCancel(b);break;case "img_edit":a._onEdit(b);break;case "img_delete":a._onDelete(b)}})},_onOk:function(a){a._row&&(a._row.endEdit(),a.update())},
_onCancel:function(a){a._row&&(a._row.cancelEdit(),a.update())},_onDelete:function(a){a._row&&a._row.deleteRow()},_onEdit:function(a){a._row&&(a._row.beginEdit(),a.update(),this.grid.showEditDialog())}},null,function(a){d.registerType("grid.ActionsColumn",a)});v=a.extend({_init:function(){this._super();var a=this;this._val=!1;this.$div.addClass(q.rowSelector);var b=f.$('<input type="checkbox"/>');this.$div.append(b);this._chk=b;b.click(function(b){b.stopPropagation();a._onCheckBoxClicked(this.checked)});
b.on("change",function(b){b.stopPropagation();a.checked=this.checked})},_onCheckBoxClicked:function(a){this.grid._selectRows(a)}},{checked:{set:function(a){var b=this._chk;null!==a&&(a=!!a);a!==this._val&&(this._val=a,b&&(b[0].checked=!!this._val),this.raisePropertyChanged("checked"))},get:function(){return this._val}}},function(a){d.registerType("grid.RowSelectorColumn",a)});RIAPP.BaseObject.extend({_app:d,_create:function(a,b,e){this._super();if(b&&!E.isPrototypeOf(b))throw Error(RIAPP.ERRS.ERR_GRID_DATASRC_INVALID);
this._options=k.extend(!1,{isUseScrollInto:!0,isUseScrollIntoDetails:!0,containerCss:null,wrapCss:null,headerCss:null,rowStateField:null,isCanEdit:null,isCanDelete:null,isHandleAddNew:!1},e);e=f.$(a);this._tableEl=a;this._$tableEl=e;e.addClass(q.dataTable);this._name=e.attr(h.DATA_ATTR.DATA_NAME);this._objId="grd"+this._app.getNewObjectID();this._dataSource=b;this._rowMap={};this._rows=[];this._columns=[];this._isDSFilling=this._isClearing=!1;this._editingRow=this._currentColumn=this._rowSelectorCol=
this._actionsCol=this._expanderCol=this._details=this._expandedRow=this._currentRow=null;this._isSorting=!1;this._contaner=this._wrapDiv=this._chkWidthInterval=this._headerDiv=this._dialog=null;this._wrapTable();this._createColumns();this._bindDS();this._app.types._registerGrid(this);this._refreshGrid();this._updateColsDim()},_getEventNames:function(){var a=this._super();return["row_expanded","row_selected","page_changed","row_state_changed","cell_dblclicked"].concat(a)},_setCurrentColumn:function(a){this._currentColumn&&
(this._currentColumn.isSelected=!1);if(this._currentColumn=a)this._currentColumn.isSelected=!0},_parseColumnAttr:function(a,b){var e={type:h.COLUMN_TYPE.DATA,title:null,sortable:!1,sortMemberName:null,content:{}},c=this._app.parser.parseOptions(a),e=0<c.length?k.extend(!0,e,c[0]):e;b&&(e.content=this._app._parseContentAttr(b),!e.sortMemberName&&e.content.fieldName&&(e.sortMemberName=e.content.fieldName));return e},_findUndeleted:function(a,b){if(!a)return null;if(!a.isDeleted)return a;var e=this.rows.indexOf(a),
c=this.rows.length;if(b){e+=1;for(e<c&&(a=this.rows[e]);e<c&&a.isDeleted;)e+=1,e<c&&(a=this.rows[e])}else{e-=1;for(0<=e&&(a=this.rows[e]);0<=e&&a.isDeleted;)e-=1,0<=e&&(a=this.rows[e])}a.isDeleted&&(a=null);return a},_updateCurrent:function(a,b){this.currentRow=a;b&&(a&&!a.isDeleted)&&this._scrollToCurrent(!0)},_scrollToCurrent:function(a){var b=this.currentRow;b&&b.scrollIntoView(a)},_onRowStateChanged:function(a,b){var e={row:a,val:b,css:null};this.raiseEvent("row_state_changed",e);return e.css},
_onCellDblClicked:function(a){this.raiseEvent("cell_dblclicked",{cell:a})},_onError:function(a,b){var e=this._super(a,b);return!e?this._app._onError(a,b):e},_onDSCurrentChanged:function(a){(a=this._dataSource.currentItem)?this._updateCurrent(this._rowMap[a._key],!1):this._updateCurrent(null,!1)},_onDSCollectionChanged:function(a){var b=this,e;e=h.COLL_CHANGE_TYPE;var c=a.items;switch(a.change_type){case e.RESET:this._isDSFilling||this._refreshGrid();break;case e.ADDED:this._isDSFilling||b._appendItems(a.items,
a.pos);break;case e.REMOVE:c.forEach(function(a){(a=b._rowMap[a._key])&&b._removeRow(a)});break;case e.REMAP_KEY:if(e=b._rowMap[a.old_key])delete b._rowMap[a.old_key],b._rowMap[a.new_key]=e;break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,a.change_type));}},_onDSFill:function(a){var b=this;a.isBegin?(b._isDSFilling=!0,b._isSorting?b._isSorting=!1:a.isPageChanged||b._resetColumnsSort()):(b._isDSFilling=!1,a.resetUI?b._refreshGrid():b._appendItems(a.newItems),
a.isPageChanged&&setTimeout(function(){b._onPageChanged()},100),setTimeout(function(){b._updateColsDim()},200))},_onPageChanged:function(){this._rowSelectorCol&&(this._rowSelectorCol.checked=!1);this._scrollToCurrent(!1);this.raiseEvent("page_changed",{})},_onItemEdit:function(a,b,e){if(a=this._rowMap[a._key])b?(a._onBeginEdit(),this._editingRow=a):(a._onEndEdit(e),this._editingRow=null),this.raisePropertyChanged("editingRow")},_onItemAdded:function(a){var b=this._rowMap[a.item._key];b&&(this._updateCurrent(b,
!0),this._options.isHandleAddNew&&!a.isAddNewHandled&&(a.isAddNewHandled=this.showEditDialog()))},_onItemStatusChanged:function(a,b){var e=h.CHANGE_TYPE.DELETED,c=a._changeType,d=this._dataSource,g=this._rowMap[a._key];g&&(c===e?(g.isDeleted=!0,(e=this._findUndeleted(g,!0))||(e=this._findUndeleted(g,!1)),e&&(d.currentItem=e.item)):b===e&&c!==e&&(g.isDeleted=!1))},_onRowSelectionChanged:function(a){this.raiseEvent("row_selected",{row:a})},_onDSErrorsChanged:function(a){(a=this._rowMap[a._key])&&a.updateErrorState()},
_resetColumnsSort:function(){this.columns.forEach(function(a){m.isPrototypeOf(a)&&(a.sortOrder=null)})},_bindDS:function(){var a=this,b=this._dataSource;b&&(b.addHandler("coll_changed",function(e,c){b===e&&a._onDSCollectionChanged(c)},a._objId),b.addHandler("fill",function(e,c){b===e&&a._onDSFill(c)},a._objId),b.addOnPropertyChange("currentItem",function(e,c){b===e&&a._onDSCurrentChanged(c)},a._objId),b.addHandler("begin_edit",function(e,c){b===e&&a._onItemEdit(c.item,!0,void 0)},a._objId),b.addHandler("end_edit",
function(e,c){b===e&&a._onItemEdit(c.item,!1,c.isCanceled)},a._objId),b.addHandler("errors_changed",function(e,c){b===e&&a._onDSErrorsChanged(c.item)},a._objId),b.addHandler("status_changed",function(e,c){b===e&&a._onItemStatusChanged(c.item,c.oldChangeType)},a._objId),b.addHandler("item_added",function(e,c){b===e&&a._onItemAdded(c)},a._objId))},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},_getLastRow:function(){if(0===this._rows.length)return null;for(var a=this._rows.length-
1,b=this._rows[a];b.isDeleted&&0<a;)a-=1,b=this._rows[a];return b.isDeleted?null:b},_removeRow:function(a){this._expandedRow===a&&this.collapseDetails();if(0!==this._rows.length){var b=this._rows.indexOf(a);a=a.itemKey;try{if(-1<b){var e=this._rows[b];this._rows.splice(b,1);!e._isDestroying&&!e._isDestroyed&&e.destroy()}}finally{this._rowMap[a]&&delete this._rowMap[a]}}},_clearGrid:function(){if(0!==this._rows.length){this._isClearing=!0;try{this.collapseDetails();var a=this._tBodyEl,b=f.document.createElement("tbody");
this._tableEl.replaceChild(b,a);var e=this._rows;this._rows=[];this._rowMap={};e.forEach(function(a){a.destroy()})}finally{this._isClearing=!1}this._currentRow=null}},_updateColsDim:function(){if(this._isNotDestroyed()){var a=0,b=this._headerDiv;this._columns.forEach(function(b){a+=b.el.offsetWidth});b.width(a);this._columns.forEach(function(a){a.$extcol.width(a.el.offsetWidth);a.$extcol.position({my:"left top",at:"left top",of:b,offset:""+a.el.offsetLeft+" 0"})})}},_wrapTable:function(){var a=this._$tableEl,
b,e,c,d=this;a.wrap(f.$("<div></div>").addClass(q.wrapDiv));e=a.parent();e.wrap(f.$("<div></div>").addClass(q.container));c=e.parent();b=f.$("<div></div>").addClass(q.headerDiv).insertBefore(e);f.$(this._tHeadRow).addClass(q.columnInfo);this._wrapDiv=e;this._headerDiv=b;this._contaner=c;this._options.containerCss&&c.addClass(this._options.containerCss);this._options.wrapCss&&e.addClass(this._options.wrapCss);this._options.headerCss&&b.addClass(this._options.headerCss);var g=a.width();this._chkWidthInterval=
setInterval(function(){var b=a.width();g!==b&&(g=b,d._updateColsDim())},1E3)},_unWrapTable:function(){var a=this._$tableEl;this._headerDiv&&(clearInterval(this._chkWidthInterval),this._chkWidthInterval=null,this._headerDiv.remove(),this._headerDiv=null,a.unwrap(),this._wrapDiv=null,a.unwrap(),this._contaner=null)},_createColumns:function(){for(var a=this,b=this._tHeadCells,e=b.length,c=[],d,g,f=0;f<e;f+=1)d=b[f],g=this._parseColumnAttr(d.getAttribute(h.DATA_ATTR.DATA_COLUMN),d.getAttribute(h.DATA_ATTR.DATA_CONTENT)),
c.push({th:d,colinfo:g});c.forEach(function(b){(b=a._createColumn(b))&&a._columns.push(b)})},_createColumn:function(a){var b;switch(a.colinfo.type){case h.COLUMN_TYPE.ROW_EXPANDER:this._expanderCol||(this._expanderCol=b=r.create(this,a));break;case h.COLUMN_TYPE.ROW_ACTIONS:this._actionsCol||(this._actionsCol=b=t.create(this,a));break;case h.COLUMN_TYPE.ROW_SELECTOR:this._rowSelectorCol||(this._rowSelectorCol=b=v.create(this,a));break;case h.COLUMN_TYPE.DATA:b=m.create(this,a);break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_GRID_COLTYPE_INVALID,
a.colinfo.type));}return b},_appendItems:function(a){if(!this._isDestroyed)for(var b,e=this._tBodyEl,c=0,d=a.length;c<d;c+=1)b=a[c],this._rowMap[b._key]||this._createRowForItem(e,b)},_onKeyDown:function(a,b){var e=this._dataSource,c=h.Key;if(e)switch(a){case c.up:b.preventDefault();e.movePrev(!0)&&this.isUseScrollInto&&this._scrollToCurrent(!1);break;case c.down:b.preventDefault();e.moveNext(!0)&&this.isUseScrollInto&&this._scrollToCurrent(!1);break;case c.pageDown:0<e.pageIndex&&(e.pageIndex-=1);
break;case c.pageUp:e.pageIndex+=1;break;case c.enter:this._currentRow&&this._actionsCol&&b.preventDefault();break;case c.esc:this._currentRow&&this._actionsCol&&this._currentRow.isEditing&&b.preventDefault();break;case c.space:this._rowSelectorCol&&(this._currentRow&&!this._currentRow.isEditing)&&b.preventDefault()}},_onKeyUp:function(a,b){var e=h.Key;if(this._dataSource)switch(a){case e.enter:this._currentRow&&this._actionsCol&&(this._currentRow.isEditing?this._actionsCol._onOk(this._currentRow.actionsCell):
this._actionsCol._onEdit(this._currentRow.actionsCell),b.preventDefault());break;case e.esc:this._currentRow&&this._actionsCol&&this._currentRow.isEditing&&(this._actionsCol._onCancel(this._currentRow.actionsCell),b.preventDefault());break;case e.space:this._rowSelectorCol&&(this._currentRow&&!this._currentRow.isEditing)&&(b.preventDefault(),this._currentRow.isSelected=!this._currentRow.isSelected)}},_refreshGrid:function(){var a=this,b=this._dataSource;a._clearGrid();if(b){var e=f.document.createDocumentFragment(),
c=this._tBodyEl,d=f.document.createElement("tbody");b.items.forEach(function(b,c){a._createRowForItem(e,b,c)});d.appendChild(e);a._tableEl.replaceChild(d,c)}},_createRowForItem:function(a,b){var c=f.document.createElement("tr"),c=e.create(this,{tr:c,item:b});this._rowMap[b._key]=c;this._rows.push(c);a.appendChild(c.el);return c},_createDetails:function(){var a=this._options.details.templateID,e=f.document.createElement("tr");return b.create(this,{tr:e,details_id:a})},_expandDetails:function(a,b){if(this._options.details){this._details||
(this._details=this._createDetails());var e=this._expandedRow;e===a&&e&&b||(this._expandedRow=null,this._details.parentRow=null,b?(this._expandedRow=a,this._details.parentRow=a,this._expandedRow.expanderCell._toggleImage()):(this._expandedRow=null,this._details.parentRow=null,e&&e.expanderCell._toggleImage()),e!==a&&e&&e.expanderCell._toggleImage(),this.raiseEvent("row_expanded",{old_expandedRow:e,expandedRow:a,isExpanded:b}))}},_sortByColumn:function(a){var b=this._dataSource,e=b.query,c=a.sortMemberName.split(";");
if(e){e.clearSort();for(var d=0;d<c.length;d+=1)0==d?e.orderBy(c[d],a.sortOrder):e.thenBy(c[d],a.sortOrder);e.isClearPrevData=!0;e.pageIndex=0;this._isSorting=!0;b.dbContext.load(e)}else this._isSorting=!0,b.sortLocal(c,a.sortOrder)},_selectRows:function(a){this._rows.forEach(function(b){b.isDeleted||(b.isSelected=a)})},findRowByItem:function(a){a=this._rowMap[a._key];return!a?null:a},collapseDetails:function(){if(this._details){var a=this._expandedRow;a&&(this._expandedRow=null,this._details._setParentRow(null),
this.raiseEvent("row_expanded",{old_expandedRow:a,expandedRow:null,isExpanded:!1}))}},getSelectedRows:function(){var a=[];this._rows.forEach(function(b){b.isDeleted||b.isSelected&&a.push(b)});return a},showEditDialog:function(){if(!this._options.editor||!this._options.editor.templateID||!this._editingRow)return!1;var a,b=this._editingRow.item;b.isEditing||b.beginEdit();this._dialog?this._dialog.dataContext=b:(a=k.extend(!1,{dataContext:b},this._options.editor),this._dialog=F.create(a));this._dialog.canRefresh=
!!this.dataSource.permissions.canRefreshRow&&!b._isNew;this._dialog.show();return!0},scrollToCurrent:function(a){this._scrollToCurrent(a)},addNew:function(){var a=this._dataSource;try{a.addNew(),this.showEditDialog()}catch(b){f.reThrow(b,this._onError(b,this))}},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._details&&(this._details.destroy(),this._details=null),this._dialog&&(this._dialog.destroy(),this._dialog=null),this._clearGrid(),this._app.types._unregisterGrid(this),this._unbindDS(),
this._dataSource=null,this._unWrapTable(),this._$tableEl.removeClass(q.dataTable),f.$(this._tHeadRow).removeClass(q.columnInfo),this._$tableEl=this._tableEl=null,this._super())}},{app:{get:function(){return this._app}},$container:{get:function(){return this._contaner}},_tBodyEl:{get:function(){return this._tableEl.tBodies[0]}},_tHeadEl:{get:function(){return this._tableEl.tHead}},_tFootEl:{get:function(){return this._tableEl.tFoot}},_tHeadRow:{get:function(){if(!this._tHeadEl)return[];var a=this._tHeadEl.rows;
return 0===a.length?null:a[0]}},_tHeadCells:{get:function(){var a=this._tHeadRow;return!a?[]:a.cells}},uniqueID:{get:function(){return this._objId}},name:{get:function(){return this._name}},dataSource:{set:function(a){a!==this._dataSource&&(null!==this._dataSource&&this._unbindDS(),this._clearGrid(),this._dataSource=a,null!==this._dataSource&&this._bindDS(),this.raisePropertyChanged("dataSource"))},get:function(){return this._dataSource}},rows:{get:function(){return this._rows}},columns:{get:function(){return this._columns}},
currentRow:{set:function(a){var b=this._dataSource,e=this._currentRow,c=!1;b&&(e!==a&&(this._currentRow=a,e&&(e.isCurrent=!1),a&&(a.isCurrent=!0),c=!0),a?a.item!==b.currentItem&&(b.currentItem=a.item):b.currentItem=null,c&&this.raisePropertyChanged("currentRow"))},get:function(){return this._currentRow}},editingRow:{get:function(){return this._editingRow}},isCanEdit:{get:function(){if(null!==this._options.isCanEdit)return this._options.isCanEdit;var a=this._dataSource;return!!a&&a.permissions.canEditRow}},
isCanDelete:{get:function(){if(null!==this._options.isCanDelete)return this._options.isCanDelete;var a=this._dataSource;return!!a&&a.permissions.canDeleteRow}},isCanAddNew:{get:function(){var a=this._dataSource;return!!a&&a.permissions.canAddRow}},isUseScrollInto:{set:function(a){this._options.isUseScrollInto=a},get:function(){return this._options.isUseScrollInto}}},function(a){d.registerType("grid.DataGrid",a)})};
RIAPP.Application._coreModules.pager=function(d){var f=d.global,k=f.utils,h={pager:"ria-data-pager",info:"pager-info",currentPage:"pager-current-page",otherPage:"pager-other-page"};Object.freeze(h);var a=RIAPP.localizable.PAGER,b=RIAPP.utils.format;RIAPP.BaseObject.extend({_app:d,_create:function(a,b,e){this._super();this._el=a;this._$el=f.$(this._el);this._objId="pgr"+this._app.getNewObjectID();if(b&&!this._app.getType("Collection").isPrototypeOf(b))throw Error(RIAPP.ERRS.ERR_PAGER_DATASRC_INVALID);
this._dataSource=b;this._showTip=!0;this._showInfo=!1;this._showFirstAndLast=!0;this._showPreviousAndNext=!1;this._showNumbers=!0;this._rowPerPage=25;this._rowCount=0;this._currentPage=1;this._useSlider=k.check_is.nt(e.useSlider)?!0:!!e.useSlider;this._sliderSize=e.sliderSize||25;this._hideOnSinglePage=k.check_is.nt(e.hideOnSinglePage)?!0:!!e.hideOnSinglePage;this._$el.addClass(h.pager);this._dataSource&&this._bindDS()},_createElement:function(a){return f.$(f.document.createElement(a))},_render:function(){var c=
this._$el,d,e;this._clearContent();if(0!==this.rowPerPage&&(d=this.rowCount,0!=d&&(d=this.currentPage,0!=d)))if(e=this.pageCount,this.hideOnSinglePage&&1==e)c.hide();else{c.show();if(this.showInfo){var f=this._createElement("span"),k=b(a.pageInfo,d,e);f.addClass(h.info).text(k).appendTo(c)}this.showFirstAndLast&&1!=d&&c.append(this._createFirst());this.showPreviousAndNext&&1!=d&&c.append(this._createPrevious());if(this.showNumbers){var f=1,k=e,s=this.sliderSize;this.useSlider&&0<s&&(f=Math.floor((s-
1)/2),k=d+f+(s-1)%2,f=d-f,1>f&&(k+=1-f,f=1),k>e&&(f-=k-e,1>f&&(f=1),k=e));for(;f<=k;f++)f===d?c.append(this._createCurrent()):c.append(this._createOther(f))}this.showPreviousAndNext&&d!=e&&c.append(this._createNext());this.showFirstAndLast&&d!=e&&c.append(this._createLast())}},_setDSPageIndex:function(a){this.dataSource.pageIndex=a-1},_onPageSizeChanged:function(a){this.rowPerPage=a.pageSize},_onPageIndexChanged:function(a){this.currentPage=a.pageIndex+1},_onTotalCountChanged:function(a){this.rowCount=
a.totalCount},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._unbindDS(),this._clearContent(),this._$el.removeClass(h.pager),this._$el=this._el=null,this._super())},_bindDS:function(){var a=this,b=this._dataSource;b&&(b.addOnPropertyChange("pageIndex",function(e,d){b===e&&a._onPageIndexChanged(b)},a._objId),b.addOnPropertyChange("pageSize",function(e,d){b===e&&a._onPageSizeChanged(b)},a._objId),b.addOnPropertyChange("totalCount",function(e,d){b===e&&a._onTotalCountChanged(b)},a._objId),
this._currentPage=b.pageIndex+1,this._rowPerPage=b.pageSize,this._rowCount=b.totalCount,this._render())},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},_clearContent:function(){this._$el.empty()},_createLink:function(a,b,e){var d=this._createElement("a"),f=this;d.text(""+b);d.attr("href","javascript:void(0)");e&&k.addToolTip(d,e);d.click(function(b){b.preventDefault();f._setDSPageIndex(a);f.currentPage=a});return d},_createFirst:function(){var b=this._createElement("span"),
d;this.showTip&&(d=a.firstPageTip);d=this._createLink(1,a.firstText,d);b.addClass(h.otherPage).append(d);return b},_createPrevious:function(){var c=this._createElement("span"),d=this.currentPage-1,e;this.showTip&&(e=b(a.prevPageTip,d));d=this._createLink(d,a.previousText,e);c.addClass(h.otherPage).append(d);return c},_createCurrent:function(){var a=this._createElement("span"),b=this.currentPage;a.text(""+b);this.showTip&&k.addToolTip(a,this._buildTip(b));a.addClass(h.currentPage);return a},_createOther:function(a){var b=
this._createElement("span"),e;this.showTip&&(e=this._buildTip(a));a=this._createLink(a,a,e);b.addClass(h.otherPage);b.append(a);return b},_createNext:function(){var c=this._createElement("span"),d=this.currentPage+1,e;this.showTip&&(e=b(a.nextPageTip,d));d=this._createLink(d,a.nextText,e);c.addClass(h.otherPage).append(d);return c},_createLast:function(){var b=this._createElement("span"),d;this.showTip&&(d=a.lastPageTip);d=this._createLink(this.pageCount,a.lastText,d);b.addClass(h.otherPage).append(d);
return b},_buildTip:function(c){var d=this.rowPerPage,e=this.rowCount,f=(c-1)*d+1,d=c==this.pageCount?e:c*d,h="";return h=c==this.currentPage?b(a.showingTip,f,d,e):b(a.showTip,f,d,e)}},{el:{get:function(){return this._el}},app:{get:function(){return this._app}},dataSource:{set:function(a){a!==this._dataSource&&(null!==this._dataSource&&this._unbindDS(),this._dataSource=a,null!==this._dataSource&&this._bindDS(),this.raisePropertyChanged("dataSource"))},get:function(){return this._dataSource}},pageCount:{get:function(){var a=
this.rowCount,b=this.rowPerPage;return 0===a||0===b?0:0===a%b?a/b:a=Math.floor(a/b)+1}},rowCount:{set:function(a){this._rowCount!=a&&(this._rowCount=a,this._render(),this.raisePropertyChanged("rowCount"))},get:function(){return this._rowCount}},rowPerPage:{set:function(a){this._rowPerPage!=a&&(this._rowPerPage=a,this._render())},get:function(){return this._rowPerPage}},currentPage:{set:function(a){this._currentPage!=a&&(this._currentPage=a,this._render(),this.raisePropertyChanged("currentPage"))},
get:function(){return this._currentPage}},useSlider:{set:function(a){this._useSlider!=a&&(this._useSlider=a,this._render())},get:function(){return this._useSlider}},sliderSize:{set:function(a){this._sliderSize!=a&&(this._sliderSize=a,this._render())},get:function(){return this._sliderSize}},hideOnSinglePage:{set:function(a){this._hideOnSinglePage!=a&&(this._hideOnSinglePage=a,this._render())},get:function(){return this._hideOnSinglePage}},showTip:{set:function(a){this._showTip!==a&&(this._showTip=
a,this._render())},get:function(){return this._showTip}},showInfo:{set:function(a){this._showInfo!==a&&(this._showInfo=a,this._render())},get:function(){return this._showInfo}},showFirstAndLast:{set:function(a){this._showFirstAndLast!==a&&(this._showFirstAndLast=a,this._render())},get:function(){return this._showFirstAndLast}},showPreviousAndNext:{set:function(a){this._showPreviousAndNext!==a&&(this._showPreviousAndNext=a,this._render())},get:function(){return this._showPreviousAndNext}},showNumbers:{set:function(a){this._showNumbers!==
a&&(this._showNumbers=a,this._render())},get:function(){return this._showNumbers}}},function(a){d.registerType("grid.Pager",a)})};
RIAPP.Application._coreModules.stackpanel=function(d){var f=d.global,k=f.utils,h=f.consts,a={stackpanel:"ria-stackpanel",item:"stackpanel-item",currentItem:"current-item"};Object.freeze(a);RIAPP.BaseObject.extend({_app:d,_create:function(b,c,d){this._super();this._el=b;this._$el=f.$(this._el);this._objId="pnl"+this._app.getNewObjectID();if(c&&!this._app.getType("Collection").isPrototypeOf(c))throw Error(RIAPP.ERRS.ERR_STACKPNL_DATASRC_INVALID);this._dataSource=c;this._isDSFilling=!1;this._orientation=
d.orientation||"horizontal";this._templateID=d.templateID;this._currentItem=null;this._$el.addClass(a.stackpanel);this._itemMap={};if(!this._templateID)throw Error(RIAPP.ERRS.ERR_STACKPNL_TEMPLATE_INVALID);this._dataSource&&this._bindDS();f._onStackPanelAdded(this)},_getEventNames:function(){var a=this._super();return["item_clicked"].concat(a)},_onKeyDown:function(a,c){var d=this._dataSource,e=h.Key;if(d)if("horizontal"==this._orientation)switch(a){case e.left:c.preventDefault();d.movePrev(!0)&&this.scrollIntoView(d.currentItem);
break;case e.right:c.preventDefault(),d.moveNext(!0)&&this.scrollIntoView(d.currentItem)}else switch(a){case e.up:c.preventDefault();d.movePrev(!0)&&this.scrollIntoView(d.currentItem);break;case e.down:c.preventDefault(),d.moveNext(!0)&&this.scrollIntoView(d.currentItem)}},_onKeyUp:function(a,c){},_updateCurrent:function(b,c){var d=this._currentItem;if(d!==b){this._currentItem=b;d&&(d=this._itemMap[d._key])&&f.$(d.div).removeClass(a.currentItem);if(b&&(d=this._itemMap[b._key]))f.$(d.div).addClass(a.currentItem),
c&&d.div.scrollIntoView(!1);this.raisePropertyChanged("currentItem")}},_onDSCurrentChanged:function(a){(a=this._dataSource.currentItem)?this._updateCurrent(a,!0):this._updateCurrent(null,!1)},_onDSCollectionChanged:function(a){var c=this,d=h.COLL_CHANGE_TYPE,e=a.items;switch(a.change_type){case d.RESET:this._isDSFilling||this._refresh();break;case d.ADDED:this._isDSFilling||c._appendItems(e);break;case d.REMOVE:e.forEach(function(a){c._removeItem(a)});break;case d.REMAP_KEY:if(d=c._itemMap[a.old_key])delete c._itemMap[a.old_key],
c._itemMap[a.new_key]=d,d.div.setAttribute(h.DATA_ATTR.DATA_ITEM_KEY,a.new_key);break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_COLLECTION_CHANGETYPE_INVALID,a.change_type));}},_onDSFill:function(a){a.isBegin?this._isDSFilling=!0:(this._isDSFilling=!1,a.resetUI?this._refresh():this._appendItems(a.newItems))},_onItemStatusChanged:function(a,c){var d=h.CHANGE_TYPE.DELETED,e=a._changeType,l=this._itemMap[a._key];l&&(e===d?f.$(l.div).hide():c===d&&e!==d&&f.$(l.div).show())},_createTemplate:function(a){var c=
this._app.getType("Template").create(this._templateID);c.dataContext=a;return c},_appendItems:function(a){if(!this._isDestroyed){var c=this;a.forEach(function(a){c._itemMap[a._key]||c._appendItem(a)})}},_appendItem:function(b){if(b._key){var c=this,d=c._createElement("div"),e=d.get(0),f=c._createTemplate(b);d.addClass(a.item);d.append(f.el);"horizontal"==this._orientation&&d.css("display","inline-block");c._$el.append(d);d.attr(h.DATA_ATTR.DATA_ITEM_KEY,b._key);d.click(function(a){a=this.getAttribute(h.DATA_ATTR.DATA_ITEM_KEY);
(a=c._itemMap[a])&&c._onItemClicked(a.div,a.item)});c._itemMap[b._key]={div:e,template:f,item:b}}},_bindDS:function(){var a=this,c=this._dataSource;c&&(c.addHandler("coll_changed",function(d,e){c===d&&a._onDSCollectionChanged(e)},a._objId),c.addHandler("fill",function(d,e){c===d&&a._onDSFill(e)},a._objId),c.addOnPropertyChange("currentItem",function(d,e){c===d&&a._onDSCurrentChanged(e)},a._objId),-1<c.getEventNames().indexOf("status_changed")&&c.addHandler("status_changed",function(d,e){c===d&&a._onItemStatusChanged(e.item,
e.oldChangeType)},a._objId),this._refresh())},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},_createElement:function(a){return f.$(f.document.createElement(a))},_onItemClicked:function(a,c){this._updateCurrent(c,!1);this._dataSource.currentItem=c;this.raiseEvent("item_clicked",{item:c})},destroy:function(){this._isDestroyed||(this._isDestroying=!0,f._onStackPanelRemoved(this),this._unbindDS(),this._clearContent(),this._$el.removeClass(a.stackpanel),this._currentItem=
this._$el=this._el=null,this._itemMap={},this._super())},_clearContent:function(){var a=this;a._$el.empty();k.forEachProp(a._itemMap,function(c){a._removeItemByKey(c)})},_removeItemByKey:function(a){var c=this._itemMap[a];c&&(delete this._itemMap[a],c.template.destroy())},_removeItem:function(a){a=a._key;var c=this._itemMap[a];c&&(delete this._itemMap[a],c.template.destroy(),f.$(c.div).remove())},_refresh:function(){var a=this._dataSource,c=this;this._clearContent();a&&a.forEach(function(a){c._appendItem(a)})},
scrollIntoView:function(a){a&&(a=this._itemMap[a._key])&&a.div.scrollIntoView(!1)},getDivElementByItem:function(a){a=this._itemMap[a._key];return!a?null:a.div}},{el:{get:function(){return this._el}},app:{get:function(){return this._app}},dataSource:{set:function(a){a!==this._dataSource&&(null!==this._dataSource&&this._unbindDS(),this._dataSource=a,null!==this._dataSource&&this._bindDS(),this.raisePropertyChanged("dataSource"))},get:function(){return this._dataSource}},currentItem:{get:function(){return this._currentItem}}},
function(a){d.registerType("StackPanel",a)})};
RIAPP.Application._coreModules.listbox=function(d){var f=d.global,k=f.utils,h=f.consts;RIAPP.BaseObject.extend({_app:d,_create:function(a,b,c){var d=this;this._super();this._el=a;this._$el=f.$(this._el);this._objId="lst"+this._app.getNewObjectID();if(b&&!this._app.getType("Collection").isPrototypeOf(b))throw Error(RIAPP.ERRS.ERR_LISTBOX_DATASRC_INVALID);this._$el.on("change."+this._objId,function(a){a.stopPropagation();d._isRefreshing||d._onChanged()});this._dataSource=null;this._css=c.css;this._isRefreshing=
this._isDSFilling=!1;this._valuePath=c.valuePath;this._textPath=c.textPath;this._saveSelected=this._selectedItem=null;this._keyMap={};this._valMap={};this._saveVal=void 0;this._css&&this._$el.addClass(this._css);this.dataSource=b},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._unbindDS(),this._$el.off("."+this._objId),this._css&&this._$el.removeClass(this._css),this._clear(!0),this._$el=this._el=null,this._super())},_onChanged:function(){var a=null,b;0<=this._el.selectedIndex&&
(a=this._el.options[this._el.selectedIndex],a=a.value,b=this._keyMap[a]);!b&&this._selectedItem?this.selectedItem=null:b.item!==this._selectedItem&&(this.selectedItem=b.item)},_getValue:function(a){a=this._getRealValue(a);return k.check_is.nt(a)?"":a},_getRealValue:function(a){if(!a)return null;if(this._valuePath)return this._app.parser.resolvePath(a,this._valuePath)},_getText:function(a){return!a?"":this._textPath?(a=this._app.parser.resolvePath(a,this._textPath),k.check_is.nt(a)?"":""+a):""+this._getValue(a)},
_onDSCollectionChanged:function(a){var b=this,c=h.COLL_CHANGE_TYPE;switch(a.change_type){case c.RESET:this._isDSFilling||this._refresh();break;case c.ADDED:this._isDSFilling||a.items.forEach(function(a){b._addOption(a,a._isNew)});break;case c.REMOVE:a.items.forEach(function(a){b._removeOption(a)});break;case c.REMAP_KEY:if(c=b._keyMap[a.old_key])delete b._keyMap[a.old_key],b._keyMap[a.new_key]=c,c.op.value=a.new_key}},_onDSFill:function(a){a.isBegin?this._isDSFilling=!0:(this._isDSFilling=!1,this._refresh())},
_onEdit:function(a,b,c){b?this._saveVal=this._getValue(a):(b=this._saveVal,this._saveVal=void 0,c||(c=a._key,(c=this._keyMap[c])?(c.op.text=this._getText(a),a=this._getValue(a),b!==a&&(""!==b&&delete this._valMap[b],""!==a&&(this._valMap[a]=c))):""!==b&&delete this._valMap[b]))},_onStatusChanged:function(a,b){a._changeType===h.CHANGE_TYPE.DELETED&&this._removeOption(a)},_onCommitChanges:function(a,b,c,d){var e=h.CHANGE_TYPE;if(b){if(!(c&&d===e.ADDED)&&(c||d!==e.DELETED))this._saveVal=this._getValue(a)}else b=
this._saveVal,this._saveVal=void 0,c&&d===e.DELETED?this._addOption(a,!0):(c=this._getValue(a),d=this._keyMap[a._key],b!==c&&(""!==b&&delete this._valMap[b],d&&""!==c&&(this._valMap[c]=d)),d&&(d.op.text=this._getText(a)))},_bindDS:function(){var a=this,b=this._dataSource;b&&(b.addHandler("coll_changed",function(c,d){b===c&&a._onDSCollectionChanged(d)},a._objId),b.addHandler("fill",function(c,d){b===c&&a._onDSFill(d)},a._objId),b.addHandler("begin_edit",function(c,d){b===c&&a._onEdit(d.item,!0,void 0)},
a._objId),b.addHandler("end_edit",function(c,d){b===c&&a._onEdit(d.item,!1,d.isCanceled)},a._objId),b.addHandler("status_changed",function(c,d){b===c&&a._onStatusChanged(d.item,d.oldChangeType)},a._objId),b.addHandler("commit_changes",function(c,d){b===c&&a._onCommitChanges(d.item,d.isBegin,d.isRejected,d.changeType)},a._objId))},_unbindDS:function(){var a=this._dataSource;a&&a.removeNSHandlers(this._objId)},_addOption:function(a,b){if(this._isDestroyed)return null;var c,d="",e,l;a&&(d=a._key);if(this._keyMap[d])return null;
l=this._getText(a);e=this._getValue(a);c=f.document.createElement("option");c.text=l;c.value=d;l={item:a,op:c};this._keyMap[d]=l;""!==e&&(this._valMap[e]=l);b?2>this._el.options.length?this._el.add(c,null):this._el.add(c,this._el.options[1]):this._el.add(c,null);return c},_removeOption:function(a){if(!this._isDestroyed){var b="",c;if(a&&(b=a._key,c=this._keyMap[b]))this._el.remove(c.op.index),c=this._getValue(a),delete this._keyMap[b],""!==c&&delete this._valMap[c],this._saveSelected===a&&(this._saveSelected=
null),this.selectedItem===a&&(this.selectedItem=this._saveSelected)}},_clear:function(a){this._el.options.length=0;this._keyMap={};this._valMap={};this._saveSelected=null;a?this._selectedItem=null:(this._addOption(null,!1),this.selectedItem=null)},clear:function(){this._clear(!1)},_refresh:function(){var a=this,b=this._dataSource,c=this._selectedItem;this._isRefreshing=!0;try{this.clear(),b&&b.forEach(function(b){a._addOption(b,!1)}),this._el.selectedIndex=this._findItemIndex(c)}finally{this._isRefreshing=
!1}this._onChanged()},_findItemIndex:function(a){if(!a)return 0;a=this._keyMap[a._key];return!a?0:a.op.index},findItemByValue:function(a){a=this._valMap[a];return!a?null:a.item},getTextByValue:function(a){return(a=this._valMap[a])?a.op.text:""},_setIsEnabled:function(a,b){a.disabled=!b},_getIsEnabled:function(a){return!a.disabled}},{dataSource:{set:function(a){this._dataSource!==a&&(this._dataSource&&this._unbindDS(),this.clear(),(this._dataSource=a)&&this._bindDS(),this._refresh(),this.raisePropertyChanged("dataSource"))},
get:function(){return this._dataSource}},selectedValue:{set:function(a){this.selectedValue!==a&&(this.selectedItem=this.findItemByValue(a))},get:function(){return this._getRealValue(this.selectedItem)}},selectedItem:{set:function(a){this._selectedItem!==a&&(this._selectedItem&&(this._saveSelected=this._selectedItem),this._selectedItem=a,this._el.selectedIndex=this._findItemIndex(this._selectedItem),this.raisePropertyChanged("selectedItem"),this.raisePropertyChanged("selectedValue"))},get:function(){return this._selectedItem}},
valuePath:{set:function(a){a!==this._valuePath&&(this._valuePath=a,this.raisePropertyChanged("valuePath"))},get:function(){return this._valuePath}},textPath:{set:function(a){a!==this._textPath&&(this._textPath=a,this._refresh(),this.raisePropertyChanged("textPath"))},get:function(){return this._textPath}},isEnabled:{set:function(a){a!==this.isEnabled&&(this._setIsEnabled(this.$el,a),this.raisePropertyChanged("isEnabled"))},get:function(){return this._getIsEnabled(this.$el)}},el:{get:function(){return this._el}}},
function(a){d.registerType("ListBox",a)})};
RIAPP.Application._coreModules.dataform=function(d){var f=d.global,k=f.utils,h=f.consts;d.getType("CollectionItem");var a={dataform:"ria-dataform"};Object.freeze(a);RIAPP.BaseObject.extend({_DATA_CONTENT_SELECTOR:"*["+h.DATA_ATTR.DATA_CONTENT+"]:not(["+h.DATA_ATTR.DATA_COLUMN+"])",_app:d,_create:function(b,c){var g=this,e;this._super();this._el=b;this._$el=f.$(this._el);this._objId="frm"+this._app.getNewObjectID();this._css=c.css;this._dataContext=null;this._$el.addClass(a.dataform);this._css&&this._$el.addClass(this._css);
this._isEditing=!1;this._content=[];this._lfBindings=null;this._supportEdit=this._contentCreated=!1;this._errors=this._parentDataForm=this._collection=null;if(e=this._getParentDataForm(this._el))g._parentDataForm=d.getElementView(e),g._parentDataForm.addOnDestroyed(function(a,b){g.destroy()},g._objId)},_updateContent:function(){var a=this._dataContext,c,d=this;if(this._contentCreated)this._content.forEach(function(e){e.dataContext=a;e.isEditing=this.isEditing},this),c=this._lfBindings.getObjs(),c.forEach(function(e){e.isSourceFixed||
(e.source=a)});else if(a){c=Array.fromList(this._el.querySelectorAll(d._DATA_CONTENT_SELECTOR));var e=this.isEditing;c.forEach(function(c){if(d._getParentDataForm(c)===d._el){var f=c.getAttribute(h.DATA_ATTR.DATA_CONTENT),f=d._app._parseContentAttr(f);if(f.fieldName&&!f.fieldInfo){if(!a.getFieldInfo)throw Error(RIAPP.ERRS.ERR_DCTX_HAS_NO_FIELDINFO);f.fieldInfo=a.getFieldInfo(f.fieldName);if(!f.fieldInfo)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_DBSET_INVALID_FIELDNAME,"",f.fieldName));}var k=
d._app._getContentType(f);(c=d._app._getContent(k,f,c,a,e))&&d._content.push(c)}});this._lfBindings=this._app._bindElements(this._el,a,!0);this._contentCreated=!0}},_getParentDataForm:function(a){if(!a)return null;a=a.parentNode;var c=f.document;if(a){if(a===this._el)return this._el;if(a===c)return null;c=a.getAttribute(h.DATA_ATTR.DATA_VIEW);if(!c)return this._getParentDataForm(a);c=this._app.parser.parseOptions(c);return 0<c.length&&"dataform"===c[0].name?a:this._getParentDataForm(a)}return null},
_onDSErrorsChanged:function(a){this.validationErrors=a?a.getAllErrors():null},_bindDS:function(){var a=this._dataContext,c=this;a&&(a.addOnDestroyed(function(a,b){c.dataContext=null},this._objId),this._supportEdit&&a.addOnPropertyChange("isEditing",function(a,b){c.isEditing=a.isEditing},this._objId),this._collection&&this._collection.addHandler("errors_changed",function(d,e){e.item===a&&c._onDSErrorsChanged(e.item)},c._objId))},_unbindDS:function(){var a=this._dataContext;this.validationErrors=null;
a&&(a._isNotDestroyed()&&a.removeNSHandlers(this._objId),this._collection&&this._collection._isNotDestroyed()&&this._collection.removeNSHandlers(this._objId))},_clearContent:function(){this._content.forEach(function(a){a.destroy()});this._content=[];this._lfBindings&&(this._lfBindings.destroy(),this._lfBindings=null);this._contentCreated=!1},_onError:function(a,c){var d=this._super(a,c);return!d?this._app._onError(a,c):d},destroy:function(){if(!this._isDestroyed){this._isDestroying=!0;this._clearContent();
this._css&&this._$el.removeClass(this._css);this._$el.removeClass(a.dataform);this._$el=this._el=null;this._unbindDS();var b=this._parentDataForm;this._parentDataForm=null;b&&b._isNotDestroyed()&&b.removeNSHandlers(this._objId);this._dataContext=null;this._contentCreated=!1;this._owner=null;this._super()}}},{el:{get:function(){return this._el}},app:{get:function(){return this._app}},dataContext:{set:function(a){var c;try{if(a!==this._dataContext){if(a&&!RIAPP.BaseObject.isPrototypeOf(a))throw Error(RIAPP.ERRS.ERR_DATAFRM_DCTX_INVALID);
this._unbindDS();this._supportEdit=!1;this._collection=null;if(c=this._dataContext=a)this._supportEdit=k.hasProp(c,"isEditing")&&!!c.beginEdit,this._collection=c._collection;this._bindDS();this._updateContent();this.raisePropertyChanged("dataContext");c&&(this._supportEdit&&this._isEditing!==c.isEditing&&(this.isEditing=c.isEditing),this._collection&&c.getAllErrors&&this._onDSErrorsChanged(c))}}catch(d){f.reThrow(d,this._onError(d,this))}},get:function(){return this._dataContext}},isEditing:{set:function(a){var c=
this._dataContext,d=this._isEditing;if(c)if(!this._supportEdit&&a!==d)this._isEditing=a,this._updateContent(),this.raisePropertyChanged("isEditing");else{if(a!==d)try{a?c.beginEdit():c.endEdit()}catch(e){f.reThrow(e,this._onError(e,c))}c.isEditing!==d&&(this._isEditing=c.isEditing,this._updateContent(),this.raisePropertyChanged("isEditing"))}},get:function(){return this._isEditing}},validationErrors:{set:function(a){a!==this._errors&&(this._errors=a,this.raisePropertyChanged("validationErrors"))},
get:function(){return this._errors}}},function(a){d.registerType("DataForm",a)})};
RIAPP.Application._coreModules.binding=function(d){var f=d.global,k=f.utils,h=f.consts;RIAPP.BaseObject.extend({_app:d,_create:function(a){this._super();this._state=null;this._mode=a.mode;this._converter=a.converter||f.getType("BaseConverter");this._converterParam=a.converterParam;this._srcPath=this._app.parser._getPathParts(a.sourcePath);this._tgtPath=this._app.parser._getPathParts(a.targetPath);if(1>this._tgtPath.length)throw Error(String.format(RIAPP.ERRS.ERR_BIND_TGTPATH_INVALID,a.targetPath));
this._isSourceFixed=!!a.isSourceFixed;this._bounds={};this._objId="bnd"+k.getNewID();this._ignoreTgtChange=this._ignoreSrcChange=!1;this._target=this._source=this._targetObj=this._sourceObj=null;this.target=a.target;this.source=a.source;this._sourceObj&&(this._sourceObj.addOnItemErrorsChanged&&this._sourceObj.getIsHasErrors())&&this._onSrcErrorsChanged()},_getOnTgtDestroyedProxy:function(){var a=this;return function(b,c){a._onTgtDestroyed()}},_getOnSrcDestroyedProxy:function(){var a=this;return function(b,
c){a._onSrcDestroyed()}},_getUpdTgtProxy:function(){var a=this;return function(){a._updateTarget()}},_getUpdSrcProxy:function(){var a=this;return function(){a._updateSource()}},_getSrcErrChangedProxy:function(){var a=this;return function(b,c){a._onSrcErrorsChanged()}},_onSrcErrorsChanged:function(){var a=[],b=this._targetObj,c=this._sourceObj,d=this._srcPath;b&&this._app.getType("BaseElView").isPrototypeOf(b)&&(c&&0<d.length&&(a=c.getFieldErrors(d[d.length-1])),b.validationErrors=a)},_onError:function(a,
b){var c=this._super(a,b);return!c?this._app._onError(a,b):c},_getTgtChangedFn:function(a,b,c,d,e){return function(f,h){var k=a._app.parser._resolveProp(b,c);0<d.length&&a._checkBounded(null,"target",e,d);a._parseTgtPath(k,d,e)}},_getSrcChangedFn:function(a,b,c,d,e){return function(f,h){var k=a._app.parser._resolveProp(b,c);0<d.length&&a._checkBounded(null,"source",e,d);a._parseSrcPath(k,d,e)}},_parseSrcPath:function(a,b,c){this._sourceObj=null;0===b.length?this._sourceObj=a:this._parseSrcPath2(a,
b,c);this._targetObj&&this._updateTarget()},_parseSrcPath2:function(a,b,c){var d=RIAPP.BaseObject;if(d=!!a&&d.isPrototypeOf(a))a.addOnDestroyed(this._getOnSrcDestroyedProxy(),this._objId),this._checkBounded(a,"source",c,b);1<b.length?(d&&a.addOnPropertyChange(b[0],this._getSrcChangedFn(this,a,b[0],b.slice(1),c+1),this._objId),a&&(a=this._app.parser._resolveProp(a,b[0]))&&this._parseSrcPath2(a,b.slice(1),c+1)):a&&1===b.length&&(c=h.BINDING_MODE,(this._mode===c[1]||this._mode===c[2])&&d&&a.addOnPropertyChange(b[0],
this._getUpdTgtProxy(),this._objId),a&&a.addOnItemErrorsChanged&&a.addOnItemErrorsChanged(this._getSrcErrChangedProxy(),this._objId),this._sourceObj=a)},_parseTgtPath:function(a,b,c){this._targetObj=null;0===b.length?this._targetObj=a:this._parseTgtPath2(a,b,c);this._targetObj&&this._updateTarget()},_parseTgtPath2:function(a,b,c){var d=RIAPP.BaseObject;if(d=!!a&&d.isPrototypeOf(a))a.addOnDestroyed(this._getOnTgtDestroyedProxy(),this._objId),this._checkBounded(a,"target",c,b);1<b.length?(d&&a.addOnPropertyChange(b[0],
this._getTgtChangedFn(this,a,b[0],b.slice(1),c+1),this._objId),a&&(a=this._app.parser._resolveProp(a,b[0]))&&this._parseTgtPath2(a,b.slice(1),c+1)):a&&1===b.length&&(this._mode===h.BINDING_MODE[2]&&d&&a.addOnPropertyChange(b[0],this._getUpdSrcProxy(),this._objId),this._targetObj=a)},_checkBounded:function(a,b,c,d){var e,f;if("source"===b)f="s"+c;else if("target"===b)f="t"+c;else throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_PARAM_INVALID,"to",b));if(e=this._bounds[f])e.removeNSHandlers(this._objId),
delete this._bounds[f];0<d.length&&this._checkBounded(null,b,c+1,d.slice(1));a&&(this._bounds[f]=a)},_onTgtDestroyed:function(a,b){!this._isDestroyed&&!this._isDestroying&&(this.target=null)},_onSrcDestroyed:function(a,b){var c=this;!c._isDestroyed&&!c._isDestroying&&(a===c.source?c.source=null:(c._checkBounded(null,"source",0,c._srcPath),setTimeout(function(){!c._isDestroyed&&!c._isDestroying&&c._bindToSource()},0)))},_bindToSource:function(){this._parseSrcPath(this.source,this._srcPath,0)},_bindToTarget:function(){this._parseTgtPath(this.target,
this._tgtPath,0)},_updateTarget:function(){if(!this._ignoreSrcChange){this._ignoreTgtChange=!0;try{var a=this._converter.convertToTarget(this.sourceValue,this._converterParam,this._sourceObj);void 0!==a&&(this.targetValue=a)}catch(b){f.reThrow(b,this._onError(b,this))}finally{this._ignoreTgtChange=!1}}},_updateSource:function(){if(!this._ignoreTgtChange){this._ignoreSrcChange=!0;try{var a=this._converter.convertToSource(this.targetValue,this._converterParam,this._sourceObj);void 0!==a&&(this.sourceValue=
a)}catch(b){if(!f._checkIsValidationErr(b)||!this._app.getType("BaseElView").isPrototypeOf(this._targetObj))if(this._updateTarget(),!this._onError(b,this))throw b;}finally{this._ignoreSrcChange=!1}}},destroy:function(){if(!this._isDestroyed){this._isDestroying=!0;var a=this;k.forEachProp(this._bounds,function(b){a._bounds[b].removeNSHandlers(a._objId)});this._bounds={};this._target=this._source=this._targetObj=this._sourceObj=this._tgtPath=this._srcPath=this._converterParam=this._converter=this._state=
this.target=this.source=null;this._super()}}},{bindingID:{get:function(){return this._objId}},target:{set:function(a){if(this._state)this._state.target=a;else if(this._target!==a){var b=this._targetObj;if(b&&!b._isDestroyed&&!b._isDestroying){this._ignoreTgtChange=!0;try{this.targetValue=null}finally{this._ignoreTgtChange=!1}}this._checkBounded(null,"target",0,this._tgtPath);if(a&&!RIAPP.BaseObject.isPrototypeOf(a))throw Error(RIAPP.ERRS.ERR_BIND_TARGET_INVALID);this._target=a;this._bindToTarget();
if(this._target&&!this._targetObj)throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_BIND_TGTPATH_INVALID,this._tgtPath.join(".")));}},get:function(){return this._target}},source:{set:function(a){this._state?this._state.source=a:this._source!==a&&(this._checkBounded(null,"source",0,this._srcPath),this._source=a,this._bindToSource())},get:function(){return this._source}},targetPath:{get:function(){return this._tgtPath}},sourcePath:{get:function(){return this._srcPath}},sourceValue:{set:function(a){0===
this._srcPath.length||null===this._sourceObj||this._app.parser._setPropertyValue(this._sourceObj,this._srcPath[this._srcPath.length-1],a)},get:function(){return 0===this._srcPath.length?this._sourceObj:null===this._sourceObj?null:this._app.parser._resolveProp(this._sourceObj,this._srcPath[this._srcPath.length-1])}},targetValue:{set:function(a){null!==this._targetObj&&this._app.parser._setPropertyValue(this._targetObj,this._tgtPath[this._tgtPath.length-1],a)},get:function(){return null===this._targetObj?
null:this._app.parser._resolveProp(this._targetObj,this._tgtPath[this._tgtPath.length-1])}},mode:{get:function(){return this._mode}},converter:{set:function(a){this._converter=a},get:function(){return this._converter}},converterParam:{set:function(a){this._converterParam=a},get:function(){return this._converterParam}},isSourceFixed:{get:function(){return this._isSourceFixed}},isDisabled:{set:function(a){a=!!a;if(this.isDisabled!=a)if(a){a={source:this._source,target:this._target};try{this.source=
this.target=null}finally{this._state=a}}else a=this._state,this._state=null,this.target=a.target,this.source=a.source},get:function(){return!!this._state}}},function(a){d.registerType("Binding",a)})};
RIAPP.Application._coreModules.template=function(d){var f=d.global,k=f.utils,h=f.consts;RIAPP.BaseObject.extend({_app:d,_create:function(a){this._super();this._el=this._dctxt=null;this._isDisabled=!1;this._lfTime=null;this._templateID=a;this._templElView=void 0;this._templateID&&this._loadTemplate()},_getBindings:function(){if(!this._lfTime)return[];for(var a=this._lfTime.getObjs(),b=[],c=this._app.getType("Binding"),d=0,e=a.length;d<e;d+=1)c.isPrototypeOf(a[d])&&b.push(a[d]);return b},_getElViews:function(){if(!this._lfTime)return[];
for(var a=this._lfTime.getObjs(),b=[],c=this._app.getType("BaseElView"),d=0,e=a.length;d<e;d+=1)c.isPrototypeOf(a[d])&&b.push(a[d]);return b},_getTemplateElView:function(){if(!this._lfTime||null===this._templElView)return null;if(this._templElView)return this._templElView;for(var a=null,b=this._app.getType("TemplateElView"),c=this._getElViews(),d=0,e=c.length;d<e;d+=1)if(b.isPrototypeOf(c[d])){a=c[d];break}return this._templElView=a},_loadTemplate:function(){var a,b=this._templateID;this._unloadTemplate();
if(b){a=k.getElementById(b);if(!a)throw Error(String.format(RIAPP.ERRS.ERR_TEMPLATE_ID_INVALID,this._templateID));a=a.cloneNode(!0);a.removeAttribute("id");this._lfTime=this._app._bindTemplateElements(b,a);this._el=a;(b=this._getTemplateElView())&&b.templateLoaded(this)}},_updateBindingSource:function(){var a,b,c,d=this._getBindings();a=0;for(b=d.length;a<b;a+=1)c=d[a],c.isDisabled=this._isDisabled,c.isSourceFixed||(c.source=this._dctxt)},_updateIsDisabled:function(){var a,b,c,d=this._getBindings();
a=0;for(b=d.length;a<b;a+=1)c=d[a],c.isDisabled=this._isDisabled},_unloadTemplate:function(){try{if(this._el){var a=this._templElView;this._templElView=void 0;a&&a.templateUnloading(this)}}finally{this._lfTime&&(this._lfTime.destroy(),this._lfTime=null),this._el&&f.$(this._el).remove(),this._el=null}},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._dctxt=null,this._unloadTemplate(),this._templateID=null,this._templElView=void 0,this._super())},findElByDataName:function(a){return f.$(this._el).find(["*[",
h.DATA_ATTR.DATA_NAME,'="',a,'"]'].join("")).toArray()},findElViewsByDataName:function(a){var b=this,c=[];this.findElByDataName(a).forEach(function(a){(a=b._app._getElView(a))&&c.push(a)});return c}},{dataContext:{set:function(a){this._dctxt!==a&&(this._dctxt=a,this.raisePropertyChanged("dataContext"),this._updateBindingSource())},get:function(){return this._dctxt}},templateID:{set:function(a){this._templateID!==a&&(this._templateID=a,this._loadTemplate(),this.raisePropertyChanged("templateID"),this._updateBindingSource())},
get:function(){return this._templateID}},el:{get:function(){return this._el}},isDisabled:{set:function(a){this._isDisabled!==a&&(this._isDisabled=!!a,this._updateIsDisabled(),this.raisePropertyChanged("isDisabled"))},get:function(){return this._isDisabled}}},function(a){d.registerType("Template",a)})};
RIAPP.Application._coreModules.content=function(d){var f=d.global,k=f.utils,h=f.consts,a=d.getType("Template"),b=RIAPP.BaseObject.extend({_app:d,_create:function(a,b,e,c){this._super();this._parentEl=a;this._el=null;this._options=b;this._isReadOnly=!!this._options.readOnly;this._isEditing=!!c;this._dctx=e;this._tgt=this._lfScope=null;f.$(this._parentEl).addClass("ria-content-field");b.initContentFn&&b.initContentFn(this);this._init();this.update()},_init:function(){},_updateCss:function(){var a=this._getDisplayInfo(),
b=f.$(this._parentEl),e=this.getFieldInfo();this._isEditing&&this._canBeEdited()?(a&&(a.editCss&&b.addClass(a.editCss),a.displayCss&&b.removeClass(a.displayCss)),e&&!e.isNullable&&b.addClass("ria-required-field")):a&&(a.displayCss&&b.addClass(a.displayCss),a.editCss&&b.removeClass(a.editCss),e&&!e.isNullable&&b.removeClass("ria-required-field"))},_canBeEdited:function(){if(this._isReadOnly)return!1;var a=this.getFieldInfo();return!a?!1:!!this._dctx&&!!this._dctx.beginEdit&&!a.isReadOnly&&!a.isCalculated},
_createTargetElement:function(){var a;a=f.document;this._isEditing&&this._canBeEdited()?(a=a.createElement("input"),a.setAttribute("type","text")):a=a.createElement("span");this._updateCss();return a},_getBindingOption:function(a,b,e,c){a=this._app._getBindingOption(a,b,e);this.isEditing&&this._canBeEdited()?a.mode="TwoWay":a.mode="OneWay";c&&(a.targetPath=c);return a},_getBindings:function(){if(!this._lfScope)return[];for(var a=this._lfScope.getObjs(),b=[],e=this._app.getType("Binding"),c=0,d=a.length;c<
d;c+=1)e.isPrototypeOf(a[c])&&b.push(a[c]);return b},_updateBindingSource:function(){var a,b,e,c=this._getBindings();a=0;for(b=c.length;a<b;a+=1)e=c[a],e.isSourceFixed||(e.source=this._dctx)},_cleanUp:function(){this._lfScope&&(this._lfScope.destroy(),this._lfScope=null);this._el&&(k.removeNode(this._el),this._el=null);this._tgt=null},getFieldInfo:function(){return this._options.fieldInfo},_getBindingInfo:function(){return this._options.bindingInfo},_getDisplayInfo:function(){return this._options.displayInfo},
_getElementView:function(a){return this._app.getElementView(a)},update:function(){this._cleanUp();var a=this._getBindingInfo();a&&(this._el=this._createTargetElement(),this._tgt=this._getElementView(this._el),this._lfScope=f.getType("LifeTimeScope").create(),this._lfScope.addObj(this._tgt),a=this._getBindingOption(a,this._tgt,this._dctx,"value"),this._parentEl.appendChild(this._el),this._lfScope.addObj(this._app.bind(a)))},destroy:function(){if(!this._isDestroyed){this._isDestroying=!0;var a=this._getDisplayInfo(),
b=f.$(this._parentEl);b.removeClass("ria-content-field");b.removeClass("ria-required-field");a&&a.displayCss&&b.removeClass(a.displayCss);a&&a.editCss&&b.removeClass(a.editCss);this._cleanUp();this._options=this._dctx=this._parentEl=null;this._super()}}},{parentEl:{get:function(){return this._parentEl}},target:{get:function(){return this._tgt}},isEditing:{set:function(a){this._isEditing!==a&&(this._isEditing=a,this.update())},get:function(){return this._isEditing}},dataContext:{set:function(a){this._dctx!==
a&&(this._dctx=a,this._updateBindingSource())},get:function(){return this._dctx}},app:{get:function(){return this._app}}},function(a){d.registerType("BindingContent",a)});RIAPP.BaseObject.extend({_app:d,_create:function(a,b,e,c){this._super();this._parentEl=a;this._isEditing=!!c;this._dctx=e;this._templateInfo=b;this._template=null;f.$(this._parentEl).addClass("ria-content-field");this.update()},_createTemplate:function(){var b=this._templateInfo,e=b.displayID;this._isEditing?b.editID&&(e=b.editID):
e||(e=b.editID);if(!e)throw Error(RIAPP.ERRS.ERR_TEMPLATE_ID_INVALID);return a.create(e)},update:function(){this._cleanUp();var a;this._templateInfo&&(this._template=a=this._createTemplate(),this._parentEl.appendChild(a.el),a.dataContext=this._dctx)},_cleanUp:function(){this._template&&(this._template.destroy(),this._template=null)},destroy:function(){this._isDestroyed||(this._isDestroying=!0,f.$(this._parentEl).removeClass("ria-content-field"),this._cleanUp(),this._templateInfo=this._dctx=this._parentEl=
null,this._super())}},{parentEl:{get:function(){return this._parentEl}},template:{get:function(){return this._template}},isEditing:{set:function(a){this._isEditing!==a&&(this._isEditing=a,this.update())},get:function(){return this._isEditing}},dataContext:{set:function(a){this._dctx!==a&&(this._dctx=a,this._template&&(this._template.dataContext=this._dctx))},get:function(){return this._dctx}},app:{get:function(){return this._app}}},function(a){d.registerType("TemplateContent",a)});var c=b.extend({_create:function(a,
b,e){this._super(a,b,e);this._fn_cleanup=null},_getBindingOption:function(a,b,e,c){a=this._super(a,b,e,c);a.converter=f.getConverter("dateConverter");a.converterParam=f.defaults.dateFormat;return a},_createTargetElement:function(){var a=this._super();if(this.isEditing){var b=f.$(a);b.datepicker();this._fn_cleanup=function(){b.datepicker("destroy")}}return a},_cleanUp:function(){this._fn_cleanup&&(this._fn_cleanup(),this._fn_cleanup=null);this._super()}},null,function(a){d.registerType("DateContent",
a)}),g=b.extend({_init:function(){this._createTargetElement();var a=this._getBindingInfo();a&&(this._updateCss(),this._lfScope=f.getType("LifeTimeScope").create(),a=this._getBindingOption(a,this._tgt,this._dctx,"checked"),a.mode="TwoWay",this._lfScope.addObj(this._app.bind(a)))},_createCheckBoxView:function(){var a=f.document.createElement("input");a.setAttribute("type","checkbox");return d.getType("CheckBoxElView").create(a,{})},_createTargetElement:function(){this._tgt||(this._tgt=this._createCheckBoxView(),
this._el=this._tgt.el);this._parentEl.appendChild(this._el)},_updateCss:function(){this._super();this._isEditing&&this._canBeEdited()?this._el.hasAttribute("disabled")&&this._el.removeAttribute("disabled"):this._el.hasAttribute("disabled")||this._el.setAttribute("disabled","disabled")},destroy:function(){this._isDestroyed||(this._isDestroying=!0,this._lfScope&&(this._lfScope.destroy(),this._lfScope=null),this._tgt&&(this._tgt.destroy(),this._tgt=null),this._super())},_cleanUp:function(){},update:function(){this._cleanUp();
this._updateCss()}},null,function(a){d.registerType("BoolContent",a)});g.extend({_canBeEdited:function(){return!0}},null,function(a){d.registerType("RowSelectContent",a)});var e=b.extend({_getBindingOption:function(a,b,e,c){a=this._super(a,b,e,c);a.converter=f.getConverter("dateTimeConverter");b=this.getFieldInfo();e=f.defaults;switch(b.dataType){case h.DATA_TYPE.DateTime:a.converterParam=e.dateTimeFormat;break;case h.DATA_TYPE.Time:a.converterParam=e.timeFormat;break;default:a.converterParam=e.dateTimeFormat}return a}},
null,function(a){d.registerType("DateTimeContent",a)}),l=b.extend({_allowedKeys:[0,h.Key.backspace,h.Key.del,h.Key.left,h.Key.right,h.Key.end,h.Key.home,h.Key.tab,h.Key.esc,h.Key.enter],_getBindingOption:function(a,b,e,c){a=this._super(a,b,e,c);switch(this.getFieldInfo().dataType){case h.DATA_TYPE.Integer:a.converter=f.getConverter("integerConverter");break;case h.DATA_TYPE.Decimal:a.converter=f.getConverter("decimalConverter");break;default:a.converter=f.getConverter("floatConverter")}return a},
update:function(){this._super();var a=this;a._app.getType("TextBoxElView").isPrototypeOf(a._tgt)&&a._tgt.addHandler("keypress",function(b,e){e.isCancel=!a._previewKeyPress(e.keyCode,e.value)})},_previewKeyPress:function(a,b){if(-1<this._allowedKeys.indexOf(a))return!0;if(47===a)return!1;var e={32:" ",44:",",46:"."}[a],c=f.defaults;return e===c.decimalPoint?0===b.length?!1:0>b.indexOf(e):e&&e!==c.thousandSep?!1:!(!e&&(45>a||57<a))}},null,function(a){d.registerType("NumberContent",a)}),n=b.extend({_allowedKeys:[0,
h.Key.backspace,h.Key.del,h.Key.left,h.Key.right,h.Key.end,h.Key.home,h.Key.tab,h.Key.esc,h.Key.enter],update:function(){this._super();var a=this,b=a.getFieldInfo();a._app.getType("TextBoxElView").isPrototypeOf(a._tgt)&&a._tgt.addHandler("keypress",function(e,c){c.isCancel=!a._previewKeyPress(b,c.keyCode,c.value)})},_previewKeyPress:function(a,b,e){return!(0<a.maxLength&&e.length>=a.maxLength&&-1===this._allowedKeys.indexOf(b))}},null,function(a){d.registerType("StringContent",a)}),s=b.extend({_allowedKeys:[0,
h.Key.backspace,h.Key.del,h.Key.left,h.Key.right,h.Key.end,h.Key.home,h.Key.tab,h.Key.esc,h.Key.enter],update:function(){this._super();var a=this,b=a.getFieldInfo();if(a._app.getType("TextAreaElView").isPrototypeOf(a._tgt)){a._tgt.addHandler("keypress",function(e,c){c.isCancel=!a._previewKeyPress(b,c.keyCode,c.value)});var e=this._options.multyline;e&&(e.rows&&(a._tgt.rows=e.rows),e.cols&&(a._tgt.cols=e.cols),e.wrap&&(a._tgt.wrap=e.wrap))}},_createTargetElement:function(){var a;a=this._isEditing&&
this._canBeEdited()?f.document.createElement("textarea"):f.document.createElement("div");this._updateCss();return a},_previewKeyPress:function(a,b,e){return!(0<a.maxLength&&e.length>=a.maxLength&&-1===this._allowedKeys.indexOf(b))}},null,function(a){d.registerType("MultyLineContent",a)}),m=b.extend({_init:function(){this._super();this._listBox=this._valBinding=this._spanView=null;this._isListBoxCachedExternally=!1;this._listBinding=this._valBinding=null},_getEventNames:function(){var a=this._super();
return["listbox_created","need_listbox"].concat(a)},_getListBox:function(){if(this._listBox)return this._listBox;var a=this._options.lookup,b={listBox:null,dataSource:a.dataSource};this.raiseEvent("need_listbox",b);if(b.listBox)return this._isListBoxCachedExternally=!0,b.listBox;var b=this._app,b=b.parser.resolvePath(b,a.dataSource),e={valuePath:a.valuePath,textPath:a.textPath},c=f.document.createElement("select");c.setAttribute("size","1");e=this._getListBoxElView(c,e);e.dataSource=b;b={listBox:e,
dataSource:a.dataSource,isCachedExternally:!1};this.raiseEvent("listbox_created",b);this._isListBoxCachedExternally=b.isCachedExternally;return e},_getListBoxElView:function(a,b){var e;return(e=this.app._getElView(a))?e:e=this.app.getType("SelectElView").create(a,b||{})},_updateTextValue:function(){this._spanView&&(this._spanView.value=this._getLookupText())},_getLookupText:function(){return this._getListBox().listBox.getTextByValue(this.value)},_createSpanView:function(){var a=f.document.createElement("span"),
b=this._getDisplayInfo(),a=d.getType("SpanElView").create(a,{});b&&b.displayCss&&a.$el.addClass(b.displayCss);return a},update:function(){this._cleanUp();this._el=this._createTargetElement();this._parentEl.appendChild(this._el)},_createTargetElement:function(){var a;this._isEditing&&this._canBeEdited()?(this._listBox||(this._listBox=this._getListBox()),this._listBinding=this._bindToList(),a=this._listBox.el):(this._spanView||(this._spanView=this._createSpanView()),this._valBinding=this._bindToValue(),
a=this._spanView.el);this._updateCss();return a},_cleanUp:function(){this._el&&(k.removeNode(this._el),this._el=null);this._listBinding&&(this._listBinding.destroy(),this._listBinding=null);this._valBinding&&(this._valBinding.destroy(),this._valBinding=null);this._listBox&&this._isListBoxCachedExternally&&(this._listBox=null)},_updateBindingSource:function(){this._valBinding&&(this._valBinding.source=this._dctx);this._listBinding&&(this._listBinding.source=this._dctx)},_bindToValue:function(){if(!this._options.fieldName)return null;
var a={target:this,source:this._dctx,targetPath:"value",sourcePath:this._options.fieldName,mode:"OneWay",converter:null,converterParam:null,isSourceFixed:!1};return this._app.getType("Binding").create(a)},_bindToList:function(){if(!this._options.fieldName)return null;var a={target:this._getListBox(),source:this._dctx,targetPath:"selectedValue",sourcePath:this._options.fieldName,mode:"TwoWay",converter:null,converterParam:null,isSourceFixed:!1};return this._app.getType("Binding").create(a)},destroy:function(){this._isDestroyed||
(this._isDestroying=!0,this._cleanUp(),this._listBox&&!this._isListBoxCachedExternally&&this._listBox.destroy(),this._listBox=null,this._spanView&&this._spanView.destroy(),this._spanView=null,this._super())}},{value:{set:function(a){this._value!==a&&(this._value=a,this._updateTextValue(),this.raisePropertyChanged("value"))},get:function(){return this._value}}},function(a){d.registerType("LookupContent",a)});RIAPP.BaseObject.extend({_app:d,getContentType:function(a){var d=h.DATA_TYPE,f=a.fieldInfo;
if(a.lookup)return m;switch(f.dataType){case d.None:a=b;break;case d.String:a=a.multyline?s:n;break;case d.Bool:a=g;break;case d.Integer:a=l;break;case d.Decimal:case d.Float:a=l;break;case d.DateTime:case d.Time:a=e;break;case d.Date:a=c;break;case d.Guid:case d.Binary:a=b;break;default:throw Error(RIAPP.utils.format(RIAPP.ERRS.ERR_FIELD_DATATYPE,f.dataType));}return a},createContent:function(a,b,e,c){return this.getContentType(b).create(a,b,e,c)}},null,function(a){d.registerType("BindingContentFactory",
a)})};
RIAPP.Application._coreModules.elview=function(d){var f=d.global,k=f.utils,h=f.consts,a=RIAPP.localizable.VALIDATE,b=RIAPP.BaseObject.extend({_app:d,_create:function(a,b){this._super();this._el=a;this._oldDisplay=this._$el=null;this._objId="elv"+k.getNewID();this._propChangedCommand=null;this._app._setElView(this._el,this);this._errors=null;this._toolTip=b.tip;this._css=b.css;this._init(b);this._applyToolTip()},_applyToolTip:function(){this._toolTip&&this._setToolTip(this.$el,this._toolTip)},_init:function(a){this._css&&
this.$el.addClass(this._css)},_createElement:function(a){return f.$(f.document.createElement(a))},_setIsEnabled:function(a,b){a.prop("disabled",!b);b?a.removeClass("disabled"):a.addClass("disabled")},_getIsEnabled:function(a){return!a.prop("disabled")},destroy:function(){if(!this._isDestroyed&&this._el){var a=this._$el,b=this._el;a&&a.off("."+this._objId);try{this._$el=this._el=this.toolTip=this.validationErrors=this._propChangedCommand=null}finally{this._app._setElView(b,null)}this._super()}},invokePropChanged:function(a){a=
{property:a};this._propChangedCommand&&this._propChangedCommand.execute(this,a)},_getErrorTipInfo:function(b){var c=["<b>",a.errorInfo,"</b>","<br/>"];b.forEach(function(a){var b="";a.errors.forEach(function(a){b=b+" "+a});c.push(b);b=""});return c.join("")},_setFieldError:function(a){var b=this.$el;a?b.addClass("ria-field-error"):b.removeClass("ria-field-error")},_updateErrorUI:function(a,b){if(a){var c=this.$el;b&&0<b.length?(k.addToolTip(c,this._getErrorTipInfo(b),"ui-tooltip-red"),this._setFieldError(!0)):
(this._setToolTip(c,this.toolTip),this._setFieldError(!1))}},_onError:function(a,b){var c=this._super(a,b);return!c?this._app._onError(a,b):c},_setToolTip:function(a,b,c){k.addToolTip(a,b,c)}},{app:{get:function(){return this._app}},$el:{get:function(){this._el&&!this._$el&&(this._$el=f.$(this._el));return this._$el}},el:{get:function(){return this._el}},uniqueID:{get:function(){return this._objId}},isVisible:{set:function(a){a=!!a;a!==this.isVisible&&(a?this.el.style.display=this._oldDisplay?this._oldDisplay:
"":(this._oldDisplay=this.el.style.display,this.el.style.display="none"),this.raisePropertyChanged("isVisible"))},get:function(){return"none"!==this.el.style.display}},propChangedCommand:{set:function(a){a!==this._propChangedCommand&&(this._propChangedCommand=a,this.invokePropChanged("*"))},get:function(){return this._propChangedCommand}},validationErrors:{set:function(a){a!==this._errors&&(this._errors=a,this.raisePropertyChanged("validationErrors"),this._updateErrorUI(this._el,this._errors))},get:function(){return this._errors}},
dataNameAttr:{get:function(){return this._el.getAttribute(h.DATA_ATTR.DATA_NAME)}},toolTip:{set:function(a){this._toolTip!=a&&(this._toolTip=a,this._setToolTip(this.$el,a),this.raisePropertyChanged("toolTip"))},get:function(){return this._toolTip}},css:{set:function(a){var b=this.$el;this._css!=a&&(this._css&&b.removeClass(this._css),(this._css=a)&&b.addClass(this._css),this.raisePropertyChanged("css"))},get:function(){return this._css}}},function(a){d.registerType("BaseElView",a);d.registerElView("baseview",
a)}),c=b.extend(null,{isEnabled:{set:function(a){a=!!a;a!==this.isEnabled&&(this._setIsEnabled(this.$el,a),this.raisePropertyChanged("isEnabled"))},get:function(){return this._getIsEnabled(this.$el)}}},function(a){d.registerType("EditableElView",a)}),g=c.extend({_init:function(a){var b=this;this._super(a);var c=this.$el;c.on("change."+this._objId,function(a){a.stopPropagation();b.raisePropertyChanged("value")});c.on("keypress."+this._objId,function(a){a.stopPropagation();var e={keyCode:a.which,value:a.target.value,
isCancel:!1};b.raiseEvent("keypress",e);e.isCancel&&a.preventDefault()});if(a.updateOnKeyUp)c.on("keyup."+this._objId,function(a){a.stopPropagation();b.raisePropertyChanged("value")})},_getEventNames:function(){var a=this._super();return["keypress"].concat(a)},destroy:function(){this._super()}},{value:{set:function(a){if(this._el){var b=this._el,c=b.value;a=null===a?"":""+a;c!==a&&(b.value=a,this.raisePropertyChanged("value"))}},get:function(){var a=this._el;return!a?"":a.value}}},function(a){d.registerType("TextBoxElView",
a);d.registerElView("input:text",a)});b.extend({},{value:{set:function(a){if(this._el){var b=this._el,c=b.value;a=null===a?"":""+a;c!==a&&(b.value=a,this.raisePropertyChanged("value"))}},get:function(){var a=this._el;return!a?"":a.value}}},function(a){d.registerType("HiddenElView",a);d.registerElView("input:hidden",a)});g.extend({_init:function(a){this._super(a);a.rows&&(this.rows=a.rows);a.cols&&(this.cols=a.cols);a.wrap&&(this.wrap=a.wrap)}},{rows:{set:function(a){var b=this._el;if(b){var c=b.rows;
a=!a?1:a;c!==a&&(b.rows=a,this.raisePropertyChanged("rows"))}},get:function(){var a=this._el;return!a?1:a.rows}},cols:{set:function(a){var b=this._el;if(b){var c=b.cols;a=!a?1:a;c!==a&&(b.cols=a,this.raisePropertyChanged("cols"))}},get:function(){var a=this._el;return!a?1:a.cols}},wrap:{set:function(a){var b=this._el;if(b){var c=b.wrap;a=!a?"off":a;0>["hard","off","soft"].indexOf(a)&&(a="off");c!==a&&(b.wrap=a,this.raisePropertyChanged("wrap"))}},get:function(){var a=this._el;return!a?"off":a.wrap}}},
function(a){d.registerType("TextAreaElView",a);d.registerElView("textarea",a)});c.extend({_init:function(a){var b=this;this._super(a);this._val=this.el.checked;this.$el.on("change."+this._objId,function(a){a.stopPropagation();b.checked=this.checked})},_setFieldError:function(a){var b=this.$el;a?(a=f.$("<div></div>").addClass("ria-field-error"),b.wrap(a)):0<b.parent(".ria-field-error").length&&b.unwrap()},destroy:function(){this.$el.off("."+this._objId);this._super()}},{checked:{set:function(a){var b=
this._el;null!==a&&(a=!!a);a!==this._val&&(this._val=a,b&&(b.checked=!!this._val),null===this._val?this.$el.css("opacity",0.33):this.$el.css("opacity",1),this.raisePropertyChanged("checked"))},get:function(){return this._val}}},function(a){d.registerType("CheckBoxElView",a);d.registerElView("input:checkbox",a)});c.extend({_init:function(a){var b=this;this._super(a);this._val=this.el.checked;this.$el.on("change."+this._objId,function(a){a.stopPropagation();b.checked=this.checked;b._updateGroup()})},
_updateGroup:function(){var a=this.el.getAttribute("name");if(a){var b=this.el.parentNode;if(b){var c=this,d=c.el;f.$('input[type="radio"][name="'+a+'"]',b).each(function(a,b){if(d!==this){var e=c.app._getElView(this);e&&(e.checked=this.checked)}})}}},_setFieldError:function(a){var b=this.$el;a?(a=f.$("<div></div>").addClass("ria-field-error"),b.wrap(a)):0<b.parent(".ria-field-error").length&&b.unwrap()},destroy:function(){this.$el.off("."+this._objId);this._super()}},{checked:{set:function(a){var b=
this._el;null!==a&&(a=!!a);a!==this._val&&(this._val=a,b&&(b.checked=!!this._val),null===this._val?this.$el.css("opacity",0.33):this.$el.css("opacity",1),this.raisePropertyChanged("checked"))},get:function(){return this._val}},value:{set:function(a){var b=this._el;if(b){var c=""+a;null===a&&(c="");c!==b.value&&(b.value=c,this.raisePropertyChanged("value"))}},get:function(){return this._el.value}},name:{get:function(){return this._el.name}}},function(a){d.registerType("RadioElView",a);d.registerElView("input:radio",
a)});g=b.extend({_init:function(a){this._super(a);this._commandParam=this._command=null},destroy:function(){this.commandParam=this.command=null;this._super()},invokeCommand:function(){this.command&&this.command.canExecute(this,this.commandParam)&&this.command.execute(this,this.commandParam)},_onCommandChanged:function(){this.raisePropertyChanged("command")},_setCommand:function(a){var b=this;a!==this._command&&(this._command&&this._command.removeNSHandlers(this._objId),(this._command=a)?(this._command.addHandler("canExecute_changed",
function(a,e){b.isEnabled=a.canExecute(b,b.commandParam)},this._objId),b.isEnabled=this._command.canExecute(b,b.commandParam)):b.isEnabled=!1,this._onCommandChanged())}},{command:{set:function(a){this._setCommand(a)},get:function(){return this._command}},commandParam:{set:function(a){a!==this._commandParam&&(this._commandParam=a,this.raisePropertyChanged("commandParam"))},get:function(){return this._commandParam}}},function(a){d.registerType("CommandElView",a)});g.extend({templateLoaded:function(a){var b=
this._commandParam;this._commandParam={template:a,isLoaded:!0};this.invokeCommand();this._commandParam=b},templateUnloading:function(a){var b=this._commandParam;this._commandParam={template:a,isLoaded:!1};this.invokeCommand();this._commandParam=b},_setCommand:function(a){this._super(a)}},{},function(a){d.registerType("TemplateElView",a);d.registerElView("template",a)});g.extend({_init:function(a){this._super(a);var b=this;this.$el.on("click."+this._objId,function(a){b._onClick(a)})},_onClick:function(a){this.invokeCommand()}},
{value:{set:function(a){if(this._el){var b=this.$el.val();a=null===a?"":""+a;b!==a&&(this.$el.val(a),this.raisePropertyChanged("value"))}},get:function(){return!this._el?"":this.$el.val()}},text:{set:function(a){if(this._el){var b=this.$el.text();a=null===a?"":""+a;b!==a&&(this.$el.text(a),this.raisePropertyChanged("text"))}},get:function(){return!this._el?"":this.$el.text()}},html:{set:function(a){if(this._el){var b=this.$el.html();a=null===a?"":""+a;b!==a&&(this.$el.html(a),this.raisePropertyChanged("html"))}},
get:function(){return!this._el?"":this.$el.html()}},isEnabled:{set:function(a){a!==this.isEnabled&&(this._setIsEnabled(this.$el,a),this.raisePropertyChanged("isEnabled"))},get:function(){return this._getIsEnabled(this.$el)}}},function(a){d.registerType("ButtonElView",a);d.registerElView("input:button",a);d.registerElView("input:submit",a);d.registerElView("button",a)});g.extend({_init:function(a){this._super(a);var b=this,c=this.$el;this._image=this._imageSrc=null;a.imageSrc&&(this.imageSrc=a.imageSrc);
c.addClass("ria-command-link");c.on("click."+this._objId,function(a){b._onClick(a)})},_onClick:function(a){a.preventDefault();this.invokeCommand()},_updateImage:function(a){var b=this.$el,c=this;this._imageSrc!==a&&(this._imageSrc=a,this._image&&!a&&(f.$(this._image).remove(),this._image=null),a&&(this._image?this._image.src=a:(c.html=null,a=f.$(new Image).attr("src",a).mouseenter(function(a){c._isEnabled&&f.$(this).css("opacity",0.5)}).mouseout(function(a){c._isEnabled&&f.$(this).css("opacity",1)}).appendTo(b),
this._image=a.get(0))))},destroy:function(){this._isDestroyed||(this.$el.removeClass("ria-command-link"),this.imageSrc=null,this._super())}},{imageSrc:{set:function(a){this._$el&&this._imageSrc!==a&&(this._updateImage(a),this.raisePropertyChanged("imageSrc"))},get:function(){return this._imageSrc}},html:{set:function(a){if(this._el){var b=this.$el.html();a=null===a?"":""+a;b!==a&&(this.$el.html(a),this.raisePropertyChanged("html"))}},get:function(){return!this._el?"":this.$el.html()}},text:{set:function(a){if(this._el){var b=
this.$el.text();a=null===a?"":""+a;b!==a&&(this.$el.text(a),this.raisePropertyChanged("text"))}},get:function(){return!this._el?"":this.$el.text()}},href:{set:function(a){if(this._el){var b=this.href;a=null===a?"":""+a;b!==a&&(this.$el.prop("href",a),this.raisePropertyChanged("href"))}},get:function(){return!this._el?"":this.$el.prop("href")}},isEnabled:{set:function(a){a!==this.isEnabled&&(this._setIsEnabled(this.$el,a),this.raisePropertyChanged("isEnabled"))},get:function(){return this._getIsEnabled(this.$el)}}},
function(a){d.registerType("AncorButtonElView",a);d.registerElView("a",a);d.registerElView("abutton",a)}).extend({_init:function(a){this._expandedsrc=a.expandedsrc||f.getImagePath("collapse.jpg");this._collapsedsrc=a.collapsedsrc||f.getImagePath("expand.jpg");this._isExpanded=!!a.isExpanded;a.imageSrc=this._isExpanded?this._expandedsrc:this._collapsedsrc;this._super(a)},destroy:function(){this._isDestroyed||(this._collapsedsrc=this._expandedsrc=null,this._isExpanded=!1,this._super())},_onCommandChanged:function(){this._super();
this.invokeCommand()},_onClick:function(a){this._isExpanded=!this._isExpanded;this._super(a)},invokeCommand:function(){this.imageSrc=this._isExpanded?this._expandedsrc:this._collapsedsrc;this._super()}},{isExpanded:{set:function(a){this._isExpanded!==a&&(this._isExpanded=a,this.invokeCommand(),this.raisePropertyChanged("isExpanded"))},get:function(){return this._isExpanded}}},function(a){d.registerType("ExpanderElView",a);d.registerElView("expander",a)});b.extend(null,{value:{set:function(a){this.text=
a},get:function(){return this.text}},text:{set:function(a){var b=this.$el,c=b.text();a=null===a?"":""+a;c!==a&&(b.text(a),this.raisePropertyChanged("text"),this.raisePropertyChanged("value"))},get:function(){return this.$el.text()}},html:{set:function(a){var b=this.el.innerHTML;a=null===a?"":""+a;b!==a&&(this.el.innerHTML=a,this.raisePropertyChanged("html"))},get:function(){return this.el.innerHTML}},color:{set:function(a){var b=this.$el,c=b.css("color");a!==c&&(b.css("color",a),this.raisePropertyChanged("color"))},
get:function(){return this.$el.css("color")}},fontSize:{set:function(a){var b=this.$el,c=b.css("font-size");a!==c&&(b.css("font-size",a),this.raisePropertyChanged("fontSize"))},get:function(){return this.$el.css("font-size")}}},function(a){d.registerType("SpanElView",a);d.registerElView("span",a)}).extend(null,{borderColor:{set:function(a){var b=this.$el.css("border-top-color");a!==b&&(this.el.style.borderColor=a,this.raisePropertyChanged("borderColor"))},get:function(){return this.$el.css("border-top-color")}},
borderStyle:{set:function(a){var b=this.$el,c=b.css("border-top-style");a!==c&&(b.css("border-style",a),this.raisePropertyChanged("borderStyle"))},get:function(){return this.$el.css("border-top-style")}},width:{set:function(a){var b=this.$el,c=b.width();a!==c&&(b.width(a),this.raisePropertyChanged("width"))},get:function(){return this.$el.width()}},height:{set:function(a){var b=this.$el,c=b.height();a!==c&&(b.height(a),this.raisePropertyChanged("height"))},get:function(){return this.$el.height()}}},
function(a){d.registerType("DivElView",a);d.registerElView("div",a)});b.extend({_init:function(a){this._super(a)}},{src:{set:function(a){this.$el.prop("src")!==a&&(this.$el.prop("src",a),this.raisePropertyChanged("src"))},get:function(){return this.$el.prop("src")}}},function(a){d.registerType("ImgElView",a);d.registerElView("img",a)});b.extend({_init:function(a){this._super(a);this._loaderPath=f.getImagePath("loader.gif");this._$loader=f.$(new Image);this._$loader.css({position:"absolute",display:"none",
zIndex:"10000"});this._$loader.attr("src",this._loaderPath);this._$loader.appendTo(this.el);this._isBusy=!1},destroy:function(){this._$loader&&(this._$loader.remove(),this._$loader=null,this._super())}},{isBusy:{set:function(a){a!==this._isBusy&&((this._isBusy=a)?(this._$loader.show(),this._$loader.position({of:f.$(this.el)})):this._$loader.hide())},get:function(){return this._isBusy}}},function(a){d.registerType("BusyElView",a);d.registerElView("busy_indicator",a)});b.extend({_init:function(a){this._super(a);
this._gridEventCommand=this._grid=this._dataSource=null;this._options=a},destroy:function(){this._dataSource&&(this.dataSource=null);this._gridEventCommand=null;this._super()},_createGrid:function(){this._grid=this._app.getType("grid.DataGrid").create(this._el,this._dataSource,this._options);this._bindGridEvents()},_bindGridEvents:function(){if(this._grid){var a=this;this._grid.addHandler("row_expanded",function(b,c){a.invokeGridEvent("row_expanded",c)},this.uniqueID);this._grid.addHandler("row_selected",
function(b,c){a.invokeGridEvent("row_selected",c)},this.uniqueID);this._grid.addHandler("page_changed",function(b,c){a.invokeGridEvent("page_changed",c)},this.uniqueID);this._grid.addOnDestroyed(function(b,c){a._grid=null},this.uniqueID)}},invokeGridEvent:function(a,b){var c={eventName:a,args:b};this._gridEventCommand&&this._gridEventCommand.execute(this,c)}},{dataSource:{set:function(a){this._dataSource!==a&&(this._dataSource=a,this._grid&&this._grid._isNotDestroyed()&&(this._grid.destroy(),this._grid=
null),this._dataSource&&this._createGrid(),this.invokePropChanged("grid"))},get:function(){return this._dataSource}},grid:{get:function(){return this._grid}},gridEventCommand:{set:function(a){a!==this._gridEventCommand&&(this._gridEventCommand&&this.invokeGridEvent("command_disconnected",{}),(this._gridEventCommand=a)&&this.invokeGridEvent("command_connected",{}))},get:function(){return this._gridEventCommand}}},function(a){d.registerType("GridElView",a);d.registerElView("table",a)});b.extend({_init:function(a){this._super(a);
this._pager=this._dataSource=null;this._options=a},destroy:function(){this._pager&&this._pager._isNotDestroyed()&&this._pager.destroy();this._dataSource=this._pager=null;this._super()}},{dataSource:{set:function(a){var b=this;this._dataSource!==a&&(this._dataSource=a,this._pager&&this._pager.destroy(),this._pager=null,this._dataSource&&this._dataSource.isPagingEnabled&&(this._pager=this._app.getType("grid.Pager").create(this._el,this._dataSource,this._options),this._pager.addOnDestroyed(function(){b._pager=
null})),b.invokePropChanged("pager"))},get:function(){return this._dataSource}},pager:{get:function(){return this._pager}}},function(a){d.registerType("PagerElView",a);d.registerElView("pager",a)});b.extend({_init:function(a){this._super(a);this._panel=this._dataSource=null;this._options=a},destroy:function(){this._panel&&this._panel._isNotDestroyed()&&this._panel.destroy();this._dataSource=this._panel=null;this._super()}},{dataSource:{set:function(a){var b=this;this._dataSource!==a&&(this._dataSource=
a,this._panel&&this._panel.destroy(),this._panel=null,this._dataSource&&(this._panel=this._app.getType("StackPanel").create(this._el,this._dataSource,this._options),this._panel.addOnDestroyed(function(){b._panel=null})),b.invokePropChanged("panel"))},get:function(){return this._dataSource}},panel:{get:function(){return this._panel}}},function(a){d.registerType("StackPanelElView",a);d.registerElView("stackpanel",a)});c.extend({_init:function(a){this._super(a);this._listBox=this._dataSource=null;this._options=
a},destroy:function(){this._listBox&&this._listBox._isNotDestroyed()&&this._listBox.destroy();this._dataSource=this._listBox=null;this._super()}},{dataSource:{set:function(a){var b=this;this._dataSource!==a&&(this._dataSource=a,this._listBox&&this._listBox.destroy(),this._listBox=null,this._dataSource&&(this._listBox=this._app.getType("ListBox").create(this._el,this._dataSource,this._options),this._listBox.addOnDestroyed(function(){b._listBox=null},this.uniqueID),this._listBox.addOnPropertyChange("*",
function(a,c){b.raisePropertyChanged(c.property)},this.uniqueID)),b.invokePropChanged("listBox"))},get:function(){return this._dataSource}},selectedValue:{set:function(a){this._listBox&&this._listBox.selectedValue!==a&&(this._listBox.selectedValue=a)},get:function(){return!this._listBox?null:this._listBox.selectedValue}},selectedItem:{set:function(a){this._listBox&&(this._listBox.selectedItem=a)},get:function(){return!this._listBox?null:this._listBox.selectedItem}},listBox:{get:function(){return this._listBox}}},
function(a){d.registerType("SelectElView",a);d.registerElView("select",a)});b.extend({_init:function(a){this._super(a);this._form=this._dataContext=null;this._options=a},_getErrorTipInfo:function(b){var c=["<b>",a.errorInfo,"</b>","<ul>"];b.forEach(function(b){var d=b.fieldName,e="";d&&(e=a.errorField+" "+d);b.errors.forEach(function(a){e=e?e+" -> "+a:a});c.push("<li>"+e+"</li>");e=""});c.push("</ul>");return c.join("")},_updateErrorUI:function(a,b){if(a){var c=this.$el;if(b&&0<b.length){var d,g=
f.getImagePath("warning.png");d=f.$('<img name="error_info" alt="error_info" class="error-info" />');c.prepend(d);d.get(0).src=g;k.addToolTip(d,this._getErrorTipInfo(b),"ui-tooltip-red");this._setFieldError(!0)}else c.children('img[name="error_info"]').remove(),this._setFieldError(!1)}},destroy:function(){this._form&&this._form._isNotDestroyed()&&this._form.destroy();this._dataContext=this._form=null;this._super()}},{dataContext:{set:function(a){var b=this;this._dataContext!==a&&(this._dataContext=
a,this._form||(this._form=this._app.getType("DataForm").create(this._el,this._options)),this._form.dataContext=this._dataContext,this._form.addOnDestroyed(function(){b._form=null}),this.form.addOnPropertyChange("validationErrors",function(a,c){b.validationErrors=a.validationErrors},this._objId),b.invokePropChanged("form"))},get:function(){return this._dataContext}},form:{get:function(){return this._form}}},function(a){d.registerType("DataFormElView",a);d.registerElView("dataform",a)});b.extend({_init:function(a){this._super(a);
this._tabsEventCommand=null;this._tabOpts=a},_createTabs:function(){var a=this.$el,b=this,c={select:function(a,c){b.invokeTabsEvent("select",c)},show:function(a,c){b.invokeTabsEvent("show",c)},disable:function(a,c){b.invokeTabsEvent("disable",c)},enable:function(a,c){b.invokeTabsEvent("enable",c)},add:function(a,c){b.invokeTabsEvent("add",c)},remove:function(a,c){b.invokeTabsEvent("remove",c)},load:function(a,c){b.invokeTabsEvent("load",c)}},c=k.extend(!0,c,b._tabOpts);a.tabs(c)},_destroyTabs:function(){this.$el.tabs("destroy")},
invokeTabsEvent:function(a,b){var c={eventName:a,args:b};this._tabsEventCommand&&this._tabsEventCommand.execute(this,c)},destroy:function(){this._tabsEventCommand&&(this._tabsEventCommand=null,this._destroyTabs(),this._super())}},{tabsEventCommand:{set:function(a){var b=this._tabsEventCommand;a!==b&&(b&&this._destroyTabs(),(this._tabsEventCommand=a)&&this._createTabs())},get:function(){return this._tabsEventCommand}}},function(a){d.registerType("TabsElView",a);d.registerElView("tabs",a)})};
RIAPP.Application._coreModules.mvvm=function(d){var f=d.global.utils;RIAPP.BaseObject.extend({_app:d,_create:function(d,h,a){this._super();this._action=d;this._thisObj=h;this._canExecute=a;this._isEnabled=!0;this._objId="cmd"+f.getNewID()},_getEventNames:function(){var d=this._super();return["canExecute_changed"].concat(d)},canExecute:function(d,f){return!this._canExecute?!0:this._canExecute.apply(this._thisObj,[d,f])},execute:function(d,f){this._isEnabled&&this._action&&this._action.apply(this._thisObj,
[d,f])},destroy:function(){this._isDestroyed||(this._canExecute=this._thisObj=this._action=null,this._super())},raiseCanExecuteChanged:function(){this.raiseEvent("canExecute_changed",{})}},{app:{get:function(){return this._app}}},function(f){d.registerType("Command",f)});RIAPP.BaseObject.extend({_app:d,_create:function(){this._super();this._objId="vm"+f.getNewID()},_onError:function(d,f){var a=this._super(d,f);return!a?this._app._onError(d,f):a}},{uniqueID:{get:function(){return this._objId}},app:{get:function(){return this._app}},
$:{get:function(){return this._app.global.$}}},function(f){d.registerType("BaseViewModel",f)})};
